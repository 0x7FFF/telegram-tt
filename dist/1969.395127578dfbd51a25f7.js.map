{"version":3,"file":"1969.395127578dfbd51a25f7.js","mappings":"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","sources":["webpack://telegram-t/webpack/runtime/chunk loaded","webpack://telegram-t/webpack/runtime/startup chunk dependencies","webpack://telegram-t/./src/config.ts","webpack://telegram-t/./src/util/debugConsole.ts","webpack://telegram-t/./src/util/schedulers.ts","webpack://telegram-t/./src/api/gramjs/apiBuilders/peers.ts","webpack://telegram-t/./src/api/gramjs/apiBuilders/helpers.ts","webpack://telegram-t/./src/api/gramjs/localDb.ts","webpack://telegram-t/./src/api/gramjs/helpers.ts","webpack://telegram-t/./src/util/iteratees.ts","webpack://telegram-t/./src/util/serverTime.ts","webpack://telegram-t/./src/api/gramjs/apiBuilders/pathBytesToSvg.ts","webpack://telegram-t/./src/api/gramjs/apiBuilders/common.ts","webpack://telegram-t/./src/api/gramjs/apiBuilders/symbols.ts","webpack://telegram-t/./src/api/gramjs/apiBuilders/messageContent.ts","webpack://telegram-t/./src/api/gramjs/apiBuilders/bots.ts","webpack://telegram-t/./src/api/gramjs/apiBuilders/calls.ts","webpack://telegram-t/./src/api/gramjs/apiBuilders/reactions.ts","webpack://telegram-t/./src/api/gramjs/apiBuilders/chats.ts","webpack://telegram-t/./src/util/waveform.ts","webpack://telegram-t/./src/api/gramjs/gramjsBuilders/index.ts","webpack://telegram-t/./src/api/gramjs/apiBuilders/messages.ts","webpack://telegram-t/./src/api/gramjs/apiBuilders/users.ts","webpack://telegram-t/./src/api/gramjs/apiBuilders/misc.ts","webpack://telegram-t/./src/api/gramjs/apiBuilders/stories.ts","webpack://telegram-t/./src/api/gramjs/scheduleUnmute.ts","webpack://telegram-t/./src/api/gramjs/updates/UpdatePts.ts","webpack://telegram-t/./src/api/gramjs/updates/updater.ts","webpack://telegram-t/./src/api/gramjs/methods/auth.ts","webpack://telegram-t/./src/util/SortedQueue.ts","webpack://telegram-t/./src/api/gramjs/updates/updateManager.ts","webpack://telegram-t/./src/util/cacheApi.ts","webpack://telegram-t/./src/api/gramjs/methods/media.ts","webpack://telegram-t/./src/api/gramjs/ChatAbortController.ts","webpack://telegram-t/./src/api/gramjs/methods/client.ts","webpack://telegram-t/./src/api/gramjs/methods/bots.ts","webpack://telegram-t/./src/api/gramjs/methods/calls.ts","webpack://telegram-t/./src/api/gramjs/methods/chats.ts","webpack://telegram-t/./src/api/gramjs/methods/account.ts","webpack://telegram-t/./src/util/files.ts","webpack://telegram-t/./src/api/gramjs/methods/messages.ts","webpack://telegram-t/./src/util/messageKey.ts","webpack://telegram-t/./src/api/gramjs/methods/users.ts","webpack://telegram-t/./src/api/gramjs/methods/symbols.ts","webpack://telegram-t/./src/api/gramjs/methods/management.ts","webpack://telegram-t/./src/api/gramjs/apiBuilders/appConfig.ts","webpack://telegram-t/./src/api/gramjs/methods/settings.ts","webpack://telegram-t/./src/api/gramjs/methods/twoFaSettings.ts","webpack://telegram-t/./src/api/gramjs/methods/reactions.ts","webpack://telegram-t/./src/api/gramjs/apiBuilders/statistics.ts","webpack://telegram-t/./src/api/gramjs/methods/statistics.ts","webpack://telegram-t/./src/api/gramjs/methods/phoneCallState.ts","webpack://telegram-t/./src/api/gramjs/methods/payments.ts","webpack://telegram-t/./src/api/gramjs/methods/init.ts","webpack://telegram-t/./src/api/gramjs/methods/stories.ts","webpack://telegram-t/./src/api/gramjs/apiBuilders/payments.ts","webpack://telegram-t/./src/api/gramjs/worker/worker.ts","webpack://telegram-t/./src/api/types/messages.ts","webpack://telegram-t/./src/api/types/media.ts","webpack://telegram-t/./src/lib/gramjs/Utils.js","webpack://telegram-t/./src/lib/twemojiRegex.js","webpack://telegram-t/./src/util/Deferred.ts","webpack://telegram-t/./src/util/parseEmojiOnlyString.ts","webpack://telegram-t/./node_modules/idb-keyval/dist/index.js","webpack://telegram-t/webpack/bootstrap","webpack://telegram-t/webpack/runtime/compat get default export","webpack://telegram-t/webpack/runtime/define property getters","webpack://telegram-t/webpack/runtime/ensure chunk","webpack://telegram-t/webpack/runtime/get javascript chunk filename","webpack://telegram-t/webpack/runtime/get mini-css chunk filename","webpack://telegram-t/webpack/runtime/global","webpack://telegram-t/webpack/runtime/hasOwnProperty shorthand","webpack://telegram-t/webpack/runtime/make namespace object","webpack://telegram-t/webpack/runtime/node module decorator","webpack://telegram-t/webpack/runtime/publicPath","webpack://telegram-t/webpack/runtime/importScripts chunk loading","webpack://telegram-t/webpack/startup"],"sourcesContent":["var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","var next = __webpack_require__.x;\n__webpack_require__.x = () => {\n\treturn Promise.all([5802,8764,24,1637].map(__webpack_require__.e, __webpack_require__)).then(next);\n};","import type { ApiReactionEmoji } from './api/types';\nimport type { ApiLimitType } from './global/types';\n\nexport const APP_CODE_NAME = 'A';\nexport const APP_NAME = process.env.APP_NAME || `Telegram Web ${APP_CODE_NAME}`;\nexport const RELEASE_DATETIME = process.env.RELEASE_DATETIME;\n\nexport const PRODUCTION_HOSTNAME = 'web.telegram.org';\nexport const PRODUCTION_URL = 'https://web.telegram.org/a';\nexport const WEB_VERSION_BASE = 'https://web.telegram.org/'; // Used to redirect to other versions\nexport const BASE_URL = process.env.BASE_URL;\n\nexport const IS_MOCKED_CLIENT = process.env.APP_MOCKED_CLIENT === '1';\nexport const IS_TEST = process.env.APP_ENV === 'test';\nexport const IS_PERF = process.env.APP_ENV === 'perf';\nexport const IS_BETA = process.env.APP_ENV === 'staging';\nexport const IS_PACKAGED_ELECTRON = process.env.IS_PACKAGED_ELECTRON;\n\nexport const DEBUG = process.env.APP_ENV !== 'production';\nexport const DEBUG_MORE = false;\nexport const DEBUG_LOG_FILENAME = 'tt-log.json';\nexport const STRICTERDOM_ENABLED = DEBUG;\n\nexport const BETA_CHANGELOG_URL = 'https://telegra.ph/WebA-Beta-03-20';\nexport const ELECTRON_HOST_URL = process.env.ELECTRON_HOST_URL!;\n\nexport const DEBUG_ALERT_MSG = 'Shoot!\\nSomething went wrong, please see the error details in Dev Tools Console.';\nexport const DEBUG_GRAMJS = false;\n\nexport const PAGE_TITLE = process.env.APP_TITLE!;\nexport const INACTIVE_MARKER = '[Inactive]';\n\nexport const DEBUG_PAYMENT_SMART_GLOCAL = false;\n\nexport const SESSION_USER_KEY = 'user_auth';\nexport const LEGACY_SESSION_KEY = 'GramJs:sessionId';\nexport const PASSCODE_CACHE_NAME = 'tt-passcode';\n\nexport const GLOBAL_STATE_CACHE_DISABLED = false;\nexport const GLOBAL_STATE_CACHE_KEY = 'tt-global-state';\nexport const GLOBAL_STATE_CACHE_USER_LIST_LIMIT = 500;\nexport const GLOBAL_STATE_CACHE_CHAT_LIST_LIMIT = 200;\nexport const GLOBAL_STATE_CACHE_CUSTOM_EMOJI_LIMIT = 150;\n\nexport const MEDIA_CACHE_DISABLED = false;\nexport const MEDIA_CACHE_NAME = 'tt-media';\nexport const MEDIA_CACHE_NAME_AVATARS = 'tt-media-avatars';\nexport const MEDIA_PROGRESSIVE_CACHE_DISABLED = false;\nexport const MEDIA_PROGRESSIVE_CACHE_NAME = 'tt-media-progressive';\nexport const CUSTOM_EMOJI_PREVIEW_CACHE_DISABLED = false;\nexport const CUSTOM_EMOJI_PREVIEW_CACHE_NAME = 'tt-custom-emoji-preview';\nexport const MEDIA_CACHE_MAX_BYTES = 512 * 1024; // 512 KB\nexport const CUSTOM_BG_CACHE_NAME = 'tt-custom-bg';\nexport const LANG_CACHE_NAME = 'tt-lang-packs-v31';\nexport const ASSET_CACHE_NAME = 'tt-assets';\nexport const AUTODOWNLOAD_FILESIZE_MB_LIMITS = [1, 5, 10, 50, 100, 500];\nexport const DATA_BROADCAST_CHANNEL_NAME = 'tt-global';\nexport const ESTABLISH_BROADCAST_CHANNEL_NAME = 'tt-establish';\nexport const MULTITAB_LOCALSTORAGE_KEY = 'tt-multitab';\n\nexport const DOWNLOAD_WORKERS = 16;\nexport const UPLOAD_WORKERS = 16;\n\nconst isBigScreen = typeof window !== 'undefined' && window.innerHeight >= 900;\n\nexport const MIN_PASSWORD_LENGTH = 1;\n\nexport const MESSAGE_LIST_SLICE = isBigScreen ? 60 : 40;\nexport const MESSAGE_LIST_VIEWPORT_LIMIT = MESSAGE_LIST_SLICE * 2;\n\nexport const ARCHIVE_MINIMIZED_HEIGHT = 36;\nexport const CHAT_HEIGHT_PX = 72;\nexport const TOPIC_HEIGHT_PX = 65;\nexport const CHAT_LIST_SLICE = isBigScreen ? 30 : 25;\nexport const CHAT_LIST_LOAD_SLICE = 100;\nexport const SHARED_MEDIA_SLICE = 42;\nexport const MESSAGE_SEARCH_SLICE = 42;\nexport const GLOBAL_SEARCH_SLICE = 20;\nexport const GLOBAL_TOPIC_SEARCH_SLICE = 5;\nexport const GLOBAL_SEARCH_CONTACTS_LIMIT = 20;\nexport const MEMBERS_SLICE = 30;\nexport const MEMBERS_LOAD_SLICE = 200;\nexport const PINNED_MESSAGES_LIMIT = 50;\nexport const BLOCKED_LIST_LIMIT = 100;\nexport const PROFILE_PHOTOS_LIMIT = 40;\nexport const PROFILE_SENSITIVE_AREA = 500;\nexport const TOPIC_LIST_SENSITIVE_AREA = 600;\nexport const COMMON_CHATS_LIMIT = 100;\nexport const GROUP_CALL_PARTICIPANTS_LIMIT = 100;\nexport const STORY_LIST_LIMIT = 100;\nexport const API_GENERAL_ID_LIMIT = 100;\nexport const STATISTICS_PUBLIC_FORWARDS_LIMIT = 50;\n\nexport const STORY_VIEWS_MIN_SEARCH = 15;\nexport const STORY_MIN_REACTIONS_SORT = 10;\nexport const STORY_VIEWS_MIN_CONTACTS_FILTER = 20;\n\n// As in Telegram for Android\n// https://github.com/DrKLO/Telegram/blob/51e9947527/TMessagesProj/src/main/java/org/telegram/messenger/MediaDataController.java#L7799\nexport const TOP_REACTIONS_LIMIT = 100;\n\n// As in Telegram for Android\n// https://github.com/DrKLO/Telegram/blob/51e9947527/TMessagesProj/src/main/java/org/telegram/messenger/MediaDataController.java#L7781\nexport const RECENT_REACTIONS_LIMIT = 50;\nexport const REACTION_LIST_LIMIT = 100;\nexport const REACTION_UNREAD_SLICE = 100;\nexport const MENTION_UNREAD_SLICE = 100;\nexport const TOPICS_SLICE = 20;\nexport const TOPICS_SLICE_SECOND_LOAD = 500;\n\nexport const TOP_CHAT_MESSAGES_PRELOAD_LIMIT = 20;\n\nexport const SPONSORED_MESSAGE_CACHE_MS = 300000; // 5 min\n\nexport const DEFAULT_VOLUME = 1;\nexport const DEFAULT_PLAYBACK_RATE = 1;\nexport const PLAYBACK_RATE_FOR_AUDIO_MIN_DURATION = 20 * 60; // 20 min\n\nexport const ANIMATION_LEVEL_CUSTOM = -1;\nexport const ANIMATION_LEVEL_MIN = 0;\nexport const ANIMATION_LEVEL_MED = 1;\nexport const ANIMATION_LEVEL_MAX = 2;\nexport const ANIMATION_LEVEL_DEFAULT = ANIMATION_LEVEL_MAX;\n\nexport const DEFAULT_MESSAGE_TEXT_SIZE_PX = 16;\nexport const IOS_DEFAULT_MESSAGE_TEXT_SIZE_PX = 17;\nexport const MACOS_DEFAULT_MESSAGE_TEXT_SIZE_PX = 15;\n\nexport const PREVIEW_AVATAR_COUNT = 3;\n\nexport const DRAFT_DEBOUNCE = 10000; // 10s\nexport const SEND_MESSAGE_ACTION_INTERVAL = 3000; // 3s\n// 10000s from https://corefork.telegram.org/api/url-authorization#automatic-authorization\nexport const APP_CONFIG_REFETCH_INTERVAL = 10000 * 1000;\nexport const GENERAL_REFETCH_INTERVAL = 60 * 60 * 1000; // 1h\n\nexport const EDITABLE_INPUT_ID = 'editable-message-text';\nexport const EDITABLE_INPUT_MODAL_ID = 'editable-message-text-modal';\nexport const EDITABLE_STORY_INPUT_ID = 'editable-story-input-text';\n// eslint-disable-next-line max-len\nexport const EDITABLE_INPUT_CSS_SELECTOR = `.messages-layout .Transition_slide-active #${EDITABLE_INPUT_ID}, .messages-layout .Transition > .Transition_slide-to #${EDITABLE_INPUT_ID}`;\nexport const EDITABLE_INPUT_MODAL_CSS_SELECTOR = `#${EDITABLE_INPUT_MODAL_ID}`;\nexport const EDITABLE_STORY_INPUT_CSS_SELECTOR = `#${EDITABLE_STORY_INPUT_ID}`;\n\nexport const CUSTOM_APPENDIX_ATTRIBUTE = 'data-has-custom-appendix';\nexport const MESSAGE_CONTENT_CLASS_NAME = 'message-content';\nexport const MESSAGE_CONTENT_SELECTOR = '.message-content';\n\n// Screen width where Pinned Message / Audio Player in the Middle Header can be safely displayed\nexport const SAFE_SCREEN_WIDTH_FOR_STATIC_RIGHT_COLUMN = 1440; // px\n// Screen width where Pinned Message / Audio Player in the Middle Header shouldn't collapse with ChatInfo\nexport const SAFE_SCREEN_WIDTH_FOR_CHAT_INFO = 1150; // px\n\nexport const MIN_SCREEN_WIDTH_FOR_STATIC_RIGHT_COLUMN = 1275; // px\nexport const MIN_SCREEN_WIDTH_FOR_STATIC_LEFT_COLUMN = 925; // px\nexport const MAX_SCREEN_WIDTH_FOR_EXPAND_PINNED_MESSAGES = 1340; // px\nexport const MOBILE_SCREEN_MAX_WIDTH = 600; // px\nexport const MOBILE_SCREEN_LANDSCAPE_MAX_WIDTH = 950; // px\nexport const MOBILE_SCREEN_LANDSCAPE_MAX_HEIGHT = 450; // px\n\nexport const MAX_INT_32 = 2 ** 31 - 1;\nexport const TMP_CHAT_ID = '0';\n\nexport const ANIMATION_END_DELAY = 100;\n\nexport const FAST_SMOOTH_MIN_DURATION = 300;\nexport const FAST_SMOOTH_MAX_DURATION = 600;\nexport const FAST_SMOOTH_MAX_DISTANCE = 750;\nexport const FAST_SMOOTH_SHORT_TRANSITION_MAX_DISTANCE = 300; // px\n\n// Average duration of message sending animation\nexport const API_UPDATE_THROTTLE = Math.round((FAST_SMOOTH_MIN_DURATION + FAST_SMOOTH_MAX_DURATION) / 2);\nexport const API_THROTTLE_RESET_UPDATES = new Set([\n  'newMessage', 'newScheduledMessage', 'deleteMessages', 'deleteScheduledMessages', 'deleteHistory',\n  'updateThreadInfos',\n]);\n\nexport const LOCK_SCREEN_ANIMATION_DURATION_MS = 200;\n\nexport const STICKER_SIZE_INLINE_DESKTOP_FACTOR = 13;\nexport const STICKER_SIZE_INLINE_MOBILE_FACTOR = 11;\nexport const STICKER_SIZE_AUTH = 160;\nexport const STICKER_SIZE_AUTH_MOBILE = 120;\nexport const STICKER_SIZE_PICKER = 72;\nexport const EMOJI_SIZE_PICKER = 36;\nexport const COMPOSER_EMOJI_SIZE_PICKER = 32;\nexport const STICKER_SIZE_GENERAL_SETTINGS = 48;\nexport const STICKER_SIZE_PICKER_HEADER = 32;\nexport const STICKER_PICKER_MAX_SHARED_COVERS = 20;\nexport const STICKER_SIZE_SEARCH = 72;\nexport const STICKER_SIZE_MODAL = 72;\nexport const EMOJI_SIZE_MODAL = 36;\nexport const STICKER_SIZE_TWO_FA = 160;\nexport const STICKER_SIZE_PASSCODE = 160;\nexport const STICKER_SIZE_DISCUSSION_GROUPS = 140;\nexport const STICKER_SIZE_FOLDER_SETTINGS = 100;\nexport const STICKER_SIZE_INLINE_BOT_RESULT = 100;\nexport const STICKER_SIZE_JOIN_REQUESTS = 140;\nexport const STICKER_SIZE_INVITES = 140;\nexport const RECENT_STICKERS_LIMIT = 20;\nexport const RECENT_STATUS_LIMIT = 20;\nexport const EMOJI_STATUS_LOOP_LIMIT = 2;\nexport const EMOJI_SIZES = 7;\nexport const TOP_SYMBOL_SET_ID = 'top';\nexport const POPULAR_SYMBOL_SET_ID = 'popular';\nexport const RECENT_SYMBOL_SET_ID = 'recent';\nexport const FAVORITE_SYMBOL_SET_ID = 'favorite';\nexport const CHAT_STICKER_SET_ID = 'chatStickers';\nexport const PREMIUM_STICKER_SET_ID = 'premium';\nexport const DEFAULT_TOPIC_ICON_STICKER_ID = 'topic-default-icon';\nexport const DEFAULT_STATUS_ICON_ID = 'status-default-icon';\nexport const EMOJI_IMG_REGEX = /<img[^>]+alt=\"([^\"]+)\"(?![^>]*data-document-id)[^>]*>/gm;\n\nexport const BASE_EMOJI_KEYWORD_LANG = 'en';\n\nexport const MENU_TRANSITION_DURATION = 200;\nexport const SLIDE_TRANSITION_DURATION = 450;\n\nexport const VIDEO_WEBM_TYPE = 'video/webm';\nexport const GIF_MIME_TYPE = 'image/gif';\n\nexport const LOTTIE_STICKER_MIME_TYPE = 'application/x-tgsticker';\nexport const VIDEO_STICKER_MIME_TYPE = 'video/webm';\n\nexport const SUPPORTED_IMAGE_CONTENT_TYPES = new Set([\n  'image/png', 'image/jpeg', GIF_MIME_TYPE,\n]);\n\nexport const SUPPORTED_VIDEO_CONTENT_TYPES = new Set([\n  'video/mp4', 'video/quicktime',\n]);\n\nexport const SUPPORTED_AUDIO_CONTENT_TYPES = new Set([\n  'audio/mp3',\n  'audio/ogg',\n  'audio/wav',\n  'audio/mpeg',\n  'audio/flac',\n  'audio/aac',\n  'audio/m4a',\n  'audio/mp4',\n  'audio/x-m4a',\n]);\n\nexport const CONTENT_TYPES_WITH_PREVIEW = new Set([\n  ...SUPPORTED_IMAGE_CONTENT_TYPES,\n  ...SUPPORTED_VIDEO_CONTENT_TYPES,\n]);\n\nexport const CONTENT_NOT_SUPPORTED = 'The message is not supported on this version of Telegram.';\n\n// Taken from https://github.com/telegramdesktop/tdesktop/blob/41d9a9fcbd0c809c60ddbd9350791b1436aff7d9/Telegram/SourceFiles/ui/boxes/choose_language_box.cpp#L28\nexport const SUPPORTED_TRANSLATION_LANGUAGES = [\n  // Official\n  'en', 'ar', 'be', 'ca', 'zh', 'nl', 'fr', 'de', 'id',\n  'it', 'ja', 'ko', 'pl', 'pt', 'ru', 'es', 'uk',\n  // Unofficial\n  'af', 'sq', 'am', 'hy', 'az', 'eu', 'bn', 'bs', 'bg',\n  'ceb', 'zh-CN', 'zh-TW', 'co', 'hr', 'cs', 'da', 'eo',\n  'et', 'fi', 'fy', 'gl', 'ka', 'el', 'gu', 'ht', 'ha',\n  'haw', 'he', 'iw', 'hi', 'hmn', 'hu', 'is', 'ig', 'ga',\n  'jv', 'kn', 'kk', 'km', 'rw', 'ku', 'ky', 'lo', 'la',\n  'lv', 'lt', 'lb', 'mk', 'mg', 'ms', 'ml', 'mt', 'mi',\n  'mr', 'mn', 'my', 'ne', 'no', 'ny', 'or', 'ps', 'fa',\n  'pa', 'ro', 'sm', 'gd', 'sr', 'st', 'sn', 'sd', 'si',\n  'sk', 'sl', 'so', 'su', 'sw', 'sv', 'tl', 'tg', 'ta',\n  'tt', 'te', 'th', 'tr', 'tk', 'ur', 'ug', 'uz', 'vi',\n  'cy', 'xh', 'yi', 'yo', 'zu',\n];\n\n// eslint-disable-next-line max-len\nexport const RE_LINK_TEMPLATE = '((ftp|https?):\\\\/\\\\/)?((www\\\\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\\\\.[a-zA-Z][-a-zA-Z0-9]{1,62})\\\\b([-a-zA-Z0-9()@:%_+.,~#?&/=]*)';\nexport const RE_MENTION_TEMPLATE = '(@[\\\\w\\\\d_-]+)';\nexport const RE_TG_LINK = /^tg:(\\/\\/)?/i;\nexport const RE_TME_LINK = /^(https?:\\/\\/)?([-a-zA-Z0-9@:%_+~#=]{1,32}\\.)?t\\.me/i;\nexport const RE_TELEGRAM_LINK = /^(https?:\\/\\/)?telegram\\.org\\//i;\nexport const TME_LINK_PREFIX = 'https://t.me/';\nexport const BOT_FATHER_USERNAME = 'botfather';\nexport const USERNAME_PURCHASE_ERROR = 'USERNAME_PURCHASE_AVAILABLE';\nexport const PURCHASE_USERNAME = 'auction';\nexport const TME_WEB_DOMAINS = new Set(['t.me', 'web.t.me', 'a.t.me', 'k.t.me', 'z.t.me']);\nexport const WEB_APP_PLATFORM = 'weba';\n\n// eslint-disable-next-line max-len\nexport const COUNTRIES_WITH_12H_TIME_FORMAT = new Set(['AU', 'BD', 'CA', 'CO', 'EG', 'HN', 'IE', 'IN', 'JO', 'MX', 'MY', 'NI', 'NZ', 'PH', 'PK', 'SA', 'SV', 'US']);\n\nexport const API_CHAT_TYPES = ['bots', 'channels', 'chats', 'users'] as const;\n\nexport const HEART_REACTION: ApiReactionEmoji = {\n  emoticon: '❤',\n};\n\n// MTProto constants\nexport const SERVICE_NOTIFICATIONS_USER_ID = '777000';\nexport const REPLIES_USER_ID = '1271266957'; // TODO For Test connection ID must be equal to 708513\nexport const ANONYMOUS_USER_ID = '2666000';\nexport const RESTRICTED_EMOJI_SET_ID = '7173162320003080';\nexport const CHANNEL_ID_LENGTH = 14; // 14 symbols, including -100 prefix\nexport const DEFAULT_GIF_SEARCH_BOT_USERNAME = 'gif';\nexport const ALL_FOLDER_ID = 0;\nexport const ARCHIVED_FOLDER_ID = 1;\nexport const SAVED_FOLDER_ID = -1;\nexport const DELETED_COMMENTS_CHANNEL_ID = '-100777';\nexport const MAX_MEDIA_FILES_FOR_ALBUM = 10;\nexport const MAX_ACTIVE_PINNED_CHATS = 5;\nexport const SCHEDULED_WHEN_ONLINE = 0x7FFFFFFE;\nexport const DEFAULT_LANG_CODE = 'en';\nexport const DEFAULT_LANG_PACK = 'android';\nexport const LANG_PACKS = ['android', 'ios', 'tdesktop', 'macos'] as const;\nexport const FEEDBACK_URL = 'https://bugs.telegram.org/?tag_ids=41&sort=time';\nexport const FAQ_URL = 'https://telegram.org/faq';\nexport const PRIVACY_URL = 'https://telegram.org/privacy';\nexport const MINI_APP_TOS_URL = 'https://telegram.org/tos/mini-apps';\nexport const GENERAL_TOPIC_ID = 1;\nexport const STORY_EXPIRE_PERIOD = 86400; // 1 day\nexport const STORY_VIEWERS_EXPIRE_PERIOD = 86400; // 1 day\nexport const FRESH_AUTH_PERIOD = 86400; // 1 day\n\nexport const LIGHT_THEME_BG_COLOR = '#99BA92';\nexport const DARK_THEME_BG_COLOR = '#0F0F0F';\nexport const DEFAULT_PATTERN_COLOR = '#4A8E3A8C';\nexport const DARK_THEME_PATTERN_COLOR = '#0A0A0A8C';\nexport const PEER_COLOR_BG_OPACITY = '1a';\nexport const PEER_COLOR_BG_ACTIVE_OPACITY = '2b';\nexport const PEER_COLOR_GRADIENT_STEP = 5; // px\nexport const MAX_UPLOAD_FILEPART_SIZE = 524288;\n\n// Group calls\nexport const GROUP_CALL_VOLUME_MULTIPLIER = 100;\nexport const GROUP_CALL_DEFAULT_VOLUME = 100 * GROUP_CALL_VOLUME_MULTIPLIER;\nexport const GROUP_CALL_THUMB_VIDEO_DISABLED = true;\n\nexport const DEFAULT_LIMITS: Record<ApiLimitType, readonly [number, number]> = {\n  uploadMaxFileparts: [4000, 8000],\n  stickersFaved: [5, 10],\n  savedGifs: [200, 400],\n  dialogFiltersChats: [100, 200],\n  dialogFilters: [10, 20],\n  dialogFolderPinned: [5, 10],\n  captionLength: [1024, 2048],\n  channels: [500, 1000],\n  channelsPublic: [10, 20],\n  aboutLength: [70, 140],\n  chatlistInvites: [3, 100],\n  chatlistJoined: [2, 20],\n  recommendedChannels: [10, 100],\n  savedDialogsPinned: [5, 100],\n};\n\nexport const ONE_TIME_MEDIA_TTL_SECONDS = 2147483647;\n","/* eslint-disable no-console */\n\nexport const DEBUG_LEVELS = ['log', 'error', 'warn', 'info', 'debug'] as const;\nexport type DebugLevel = typeof DEBUG_LEVELS[number];\n// @ts-ignore\nconst ORIGINAL_FUNCTIONS: Record<DebugLevel, (...args: any[]) => void> = DEBUG_LEVELS.reduce((acc, level) => {\n  // @ts-ignore\n  acc[level] = console[level];\n  return acc;\n}, {});\n\ntype DebugEntry = {\n  level: DebugLevel;\n  args: any[];\n  date: Date;\n};\nlet DEBUG_LOGS: DebugEntry[] = [];\n\nexport function logDebugMessage(level: DebugLevel, ...args: any[]) {\n  DEBUG_LOGS.push({\n    level,\n    args,\n    date: new Date(),\n  });\n  ORIGINAL_FUNCTIONS[level](...args);\n}\n\nexport function initDebugConsole() {\n  DEBUG_LOGS = [];\n  DEBUG_LEVELS.forEach((level) => {\n    // @ts-ignore\n    console[level] = (...args: any[]) => {\n      logDebugMessage(level, ...args);\n    };\n  });\n}\n\nexport function disableDebugConsole() {\n  DEBUG_LEVELS.forEach((level) => {\n    // @ts-ignore\n    console[level] = ORIGINAL_FUNCTIONS[level];\n  });\n  DEBUG_LOGS = [];\n}\n\nexport function getDebugLogs() {\n  return JSON.stringify(DEBUG_LOGS, (key, value) => (typeof value === 'bigint'\n    ? value.toString()\n    : value));\n}\n","export type Scheduler = typeof requestAnimationFrame | typeof onTickEnd;\n\nexport function debounce<F extends AnyToVoidFunction>(\n  fn: F,\n  ms: number,\n  shouldRunFirst = true,\n  shouldRunLast = true,\n) {\n  let waitingTimeout: number | undefined;\n\n  return (...args: Parameters<F>) => {\n    if (waitingTimeout) {\n      clearTimeout(waitingTimeout);\n      waitingTimeout = undefined;\n    } else if (shouldRunFirst) {\n      fn(...args);\n    }\n\n    // eslint-disable-next-line no-restricted-globals\n    waitingTimeout = self.setTimeout(() => {\n      if (shouldRunLast) {\n        fn(...args);\n      }\n\n      waitingTimeout = undefined;\n    }, ms);\n  };\n}\n\nexport function throttle<F extends AnyToVoidFunction>(\n  fn: F,\n  ms: number,\n  shouldRunFirst = true,\n) {\n  let interval: number | undefined;\n  let isPending: boolean;\n  let args: Parameters<F>;\n\n  return (..._args: Parameters<F>) => {\n    isPending = true;\n    args = _args;\n\n    if (!interval) {\n      if (shouldRunFirst) {\n        isPending = false;\n        fn(...args);\n      }\n\n      // eslint-disable-next-line no-restricted-globals\n      interval = self.setInterval(() => {\n        if (!isPending) {\n          // eslint-disable-next-line no-restricted-globals\n          self.clearInterval(interval!);\n          interval = undefined;\n          return;\n        }\n\n        isPending = false;\n        fn(...args);\n      }, ms);\n    }\n  };\n}\n\nexport function throttleWithTickEnd<F extends AnyToVoidFunction>(fn: F) {\n  return throttleWith(onTickEnd, fn);\n}\n\nexport function throttleWith<F extends AnyToVoidFunction>(schedulerFn: Scheduler, fn: F) {\n  let waiting = false;\n  let args: Parameters<F>;\n\n  return (..._args: Parameters<F>) => {\n    args = _args;\n\n    if (!waiting) {\n      waiting = true;\n\n      schedulerFn(() => {\n        waiting = false;\n        fn(...args);\n      });\n    }\n  };\n}\n\nexport function onIdle(cb: NoneToVoidFunction, timeout?: number) {\n  // eslint-disable-next-line no-restricted-globals\n  if (self.requestIdleCallback) {\n    // eslint-disable-next-line no-restricted-globals\n    self.requestIdleCallback(cb, { timeout });\n  } else {\n    onTickEnd(cb);\n  }\n}\n\nexport const pause = (ms: number) => new Promise<void>((resolve) => {\n  setTimeout(() => resolve(), ms);\n});\n\nexport function rafPromise() {\n  return new Promise<void>((resolve) => {\n    fastRaf(resolve);\n  });\n}\n\nconst FAST_RAF_TIMEOUT_FALLBACK_MS = 35; // < 30 FPS\n\nlet fastRafCallbacks: Set<NoneToVoidFunction> | undefined;\nlet fastRafFallbackCallbacks: Set<NoneToVoidFunction> | undefined;\nlet fastRafFallbackTimeout: number | undefined;\n\n// May result in an immediate execution if called from another RAF callback which was scheduled\n// (and therefore is executed) earlier than RAF callback scheduled by `fastRaf`\nexport function fastRaf(callback: NoneToVoidFunction, withTimeoutFallback = false) {\n  if (!fastRafCallbacks) {\n    fastRafCallbacks = new Set([callback]);\n\n    requestAnimationFrame(() => {\n      const currentCallbacks = fastRafCallbacks!;\n\n      fastRafCallbacks = undefined;\n      fastRafFallbackCallbacks = undefined;\n\n      if (fastRafFallbackTimeout) {\n        clearTimeout(fastRafFallbackTimeout);\n        fastRafFallbackTimeout = undefined;\n      }\n\n      currentCallbacks.forEach((cb) => cb());\n    });\n  } else {\n    fastRafCallbacks.add(callback);\n  }\n\n  if (withTimeoutFallback) {\n    if (!fastRafFallbackCallbacks) {\n      fastRafFallbackCallbacks = new Set([callback]);\n    } else {\n      fastRafFallbackCallbacks.add(callback);\n    }\n\n    if (!fastRafFallbackTimeout) {\n      fastRafFallbackTimeout = window.setTimeout(() => {\n        const currentTimeoutCallbacks = fastRafFallbackCallbacks!;\n\n        if (fastRafCallbacks) {\n          currentTimeoutCallbacks.forEach(fastRafCallbacks.delete, fastRafCallbacks);\n        }\n        fastRafFallbackCallbacks = undefined;\n\n        if (fastRafFallbackTimeout) {\n          clearTimeout(fastRafFallbackTimeout);\n          fastRafFallbackTimeout = undefined;\n        }\n\n        currentTimeoutCallbacks.forEach((cb) => cb());\n      }, FAST_RAF_TIMEOUT_FALLBACK_MS);\n    }\n  }\n}\n\nlet onTickEndCallbacks: NoneToVoidFunction[] | undefined;\n\nexport function onTickEnd(callback: NoneToVoidFunction) {\n  if (!onTickEndCallbacks) {\n    onTickEndCallbacks = [callback];\n\n    Promise.resolve().then(() => {\n      const currentCallbacks = onTickEndCallbacks!;\n      onTickEndCallbacks = undefined;\n      currentCallbacks.forEach((cb) => cb());\n    });\n  } else {\n    onTickEndCallbacks.push(callback);\n  }\n}\n\nlet beforeUnloadCallbacks: NoneToVoidFunction[] | undefined;\n\nexport function onBeforeUnload(callback: NoneToVoidFunction, isLast = false) {\n  if (!beforeUnloadCallbacks) {\n    beforeUnloadCallbacks = [];\n    // eslint-disable-next-line no-restricted-globals\n    self.addEventListener('beforeunload', () => {\n      beforeUnloadCallbacks!.forEach((cb) => cb());\n    });\n  }\n\n  if (isLast) {\n    beforeUnloadCallbacks.push(callback);\n  } else {\n    beforeUnloadCallbacks.unshift(callback);\n  }\n\n  return () => {\n    beforeUnloadCallbacks = beforeUnloadCallbacks!.filter((cb) => cb !== callback);\n  };\n}\n","import type BigInt from 'big-integer';\nimport { Api as GramJs } from '../../../lib/gramjs';\n\nimport type { ApiEmojiStatus, ApiPeerColor } from '../../types';\n\nexport function isPeerUser(peer: GramJs.TypePeer | GramJs.TypeInputPeer): peer is GramJs.PeerUser {\n  return peer.hasOwnProperty('userId');\n}\n\nexport function isPeerChat(peer: GramJs.TypePeer | GramJs.TypeInputPeer): peer is GramJs.PeerChat {\n  return peer.hasOwnProperty('chatId');\n}\n\nexport function isPeerChannel(peer: GramJs.TypePeer | GramJs.TypeInputPeer): peer is GramJs.PeerChannel {\n  return peer.hasOwnProperty('channelId');\n}\n\nexport function buildApiPeerId(id: BigInt.BigInteger, type: 'user' | 'chat' | 'channel') {\n  if (type === 'user') {\n    return id.toString();\n  }\n\n  if (type === 'channel') {\n    return `-100${id}`;\n  }\n\n  return `-${id}`;\n}\n\nexport function getApiChatIdFromMtpPeer(peer: GramJs.TypePeer | GramJs.TypeInputPeer) {\n  if (isPeerUser(peer)) {\n    return buildApiPeerId(peer.userId, 'user');\n  } else if (isPeerChat(peer)) {\n    return buildApiPeerId(peer.chatId, 'chat');\n  } else {\n    return buildApiPeerId((peer as GramJs.InputPeerChannel).channelId, 'channel');\n  }\n}\n\nexport function buildApiPeerColor(peerColor: GramJs.TypePeerColor): ApiPeerColor {\n  const { color, backgroundEmojiId } = peerColor;\n  return {\n    color,\n    backgroundEmojiId: backgroundEmojiId?.toString(),\n  };\n}\n\nexport function buildApiEmojiStatus(mtpEmojiStatus: GramJs.TypeEmojiStatus): ApiEmojiStatus | undefined {\n  if (mtpEmojiStatus instanceof GramJs.EmojiStatus) {\n    return { documentId: mtpEmojiStatus.documentId.toString() };\n  }\n\n  if (mtpEmojiStatus instanceof GramJs.EmojiStatusUntil) {\n    return { documentId: mtpEmojiStatus.documentId.toString(), until: mtpEmojiStatus.until };\n  }\n\n  return undefined;\n}\n","import type { Api as GramJs } from '../../../lib/gramjs';\n\ntype VirtualFields =\n  'flags'\n  | 'CONSTRUCTOR_ID'\n  | 'SUBCLASS_OF_ID'\n  | 'className'\n  | 'classType'\n  | 'getBytes';\n\nexport function bytesToDataUri(bytes: Buffer, shouldOmitPrefix = false, mimeType: string = 'image/jpeg') {\n  const prefix = shouldOmitPrefix ? '' : `data:${mimeType};base64,`;\n\n  return `${prefix}${btoa(String.fromCharCode(...bytes))}`;\n}\n\nexport function omitVirtualClassFields<T extends GramJs.VirtualClass<T> & { flags?: any }>(\n  instance: T,\n): Omit<T, VirtualFields> {\n  const {\n    flags,\n    CONSTRUCTOR_ID,\n    SUBCLASS_OF_ID,\n    className,\n    classType,\n    getBytes,\n    ...rest\n  } = instance;\n\n  return rest;\n}\n","import BigInt from 'big-integer';\nimport { constructors } from '../../lib/gramjs/tl';\n\nimport type { Api as GramJs } from '../../lib/gramjs';\n\nimport { DATA_BROADCAST_CHANNEL_NAME } from '../../config';\nimport { throttle } from '../../util/schedulers';\nimport { omitVirtualClassFields } from './apiBuilders/helpers';\n\n// eslint-disable-next-line no-restricted-globals\nconst IS_MULTITAB_SUPPORTED = 'BroadcastChannel' in self;\n\nexport type StoryRepairInfo = {\n  storyData?: {\n    peerId: string;\n    id: number;\n  };\n};\n\nexport interface LocalDb {\n  // Used for loading avatars and media through in-memory Gram JS instances.\n  chats: Record<string, GramJs.Chat | GramJs.Channel>;\n  users: Record<string, GramJs.User>;\n  messages: Record<string, GramJs.Message | GramJs.MessageService>;\n  documents: Record<string, GramJs.Document & StoryRepairInfo>;\n  stickerSets: Record<string, GramJs.StickerSet>;\n  photos: Record<string, GramJs.Photo & StoryRepairInfo>;\n  webDocuments: Record<string, GramJs.TypeWebDocument>;\n  commonBoxState: Record<string, number>;\n  channelPtsById: Record<string, number>;\n}\n\nconst channel = IS_MULTITAB_SUPPORTED ? new BroadcastChannel(DATA_BROADCAST_CHANNEL_NAME) : undefined;\n\nlet batchedUpdates: {\n  name: string;\n  prop: string;\n  value: any;\n}[] = [];\nconst throttledLocalDbUpdate = throttle(() => {\n  channel!.postMessage({\n    type: 'localDbUpdate',\n    batchedUpdates,\n  });\n  batchedUpdates = [];\n}, 100);\n\nfunction createProxy(name: string, object: any) {\n  return new Proxy(object, {\n    get(target, prop: string, value: any) {\n      return Reflect.get(target, prop, value);\n    },\n    set(target, prop: string, value: any) {\n      batchedUpdates.push({ name, prop, value });\n      throttledLocalDbUpdate();\n      return Reflect.set(target, prop, value);\n    },\n  });\n}\n\nfunction convertToVirtualClass(value: any): any {\n  if (value instanceof Uint8Array) return Buffer.from(value);\n  if (typeof value === 'object' && Object.keys(value).length === 1 && Object.keys(value)[0] === 'value') {\n    return BigInt(value.value);\n  }\n\n  if (Array.isArray(value)) {\n    return value.map(convertToVirtualClass);\n  }\n\n  if (typeof value !== 'object' || !('CONSTRUCTOR_ID' in value)) {\n    return value;\n  }\n  const path = value.className.split('.');\n  const VirtualClass = path.reduce((acc: any, field: string) => {\n    return acc[field];\n  }, constructors);\n\n  const valueOmited = omitVirtualClassFields(value);\n  const valueConverted = Object.keys(valueOmited).reduce((acc, key) => {\n    acc[key] = convertToVirtualClass(valueOmited[key]);\n    return acc;\n  }, {} as Record<string, any>);\n\n  return new VirtualClass(valueConverted);\n}\n\nfunction createLocalDbInitial(initial?: LocalDb): LocalDb {\n  return [\n    'localMessages', 'chats', 'users', 'messages', 'documents', 'stickerSets', 'photos', 'webDocuments', 'stories',\n    'commonBoxState', 'channelPtsById',\n  ]\n    .reduce((acc: Record<string, any>, key) => {\n      const value = initial?.[key as keyof LocalDb] ?? {};\n      const convertedValue = Object.keys(value).reduce((acc2, key2) => {\n        if (key === 'commonBoxState' || key === 'channelPtsById') {\n          const typedValue = value as Record<string, number>;\n          acc2[key2] = typedValue[key2];\n          return acc2;\n        }\n\n        acc2[key2] = convertToVirtualClass(value[key2]);\n        return acc2;\n      }, {} as Record<string, any>);\n\n      acc[key] = IS_MULTITAB_SUPPORTED\n        ? createProxy(key, convertedValue)\n        : convertedValue;\n      return acc;\n    }, {} as LocalDb) as LocalDb;\n}\n\nconst localDb: LocalDb = createLocalDbInitial();\n\nexport default localDb;\n\nexport function broadcastLocalDbUpdateFull() {\n  if (!channel) return;\n\n  channel.postMessage({\n    type: 'localDbUpdateFull',\n    localDb: Object.keys(localDb).reduce((acc: Record<string, any>, key) => {\n      acc[key] = { ...localDb[key as keyof LocalDb] };\n      return acc;\n    }, {} as Record<string, any>),\n  });\n}\n\nexport function updateFullLocalDb(initial: LocalDb) {\n  Object.assign(localDb, createLocalDbInitial(initial));\n}\n\nexport function clearLocalDb() {\n  Object.assign(localDb, createLocalDbInitial());\n}\n","import { Api as GramJs } from '../../lib/gramjs';\n\nimport type { StoryRepairInfo } from './localDb';\n\nimport { buildApiPeerId, getApiChatIdFromMtpPeer } from './apiBuilders/peers';\nimport localDb from './localDb';\n\nconst LOG_BACKGROUND = '#111111DD';\nconst LOG_PREFIX_COLOR = '#E4D00A';\nconst LOG_SUFFIX = {\n  INVOKE: '#49DBF5',\n  BEACON: '#F549DB',\n  RESPONSE: '#6887F7',\n  CONNECTING: '#E4D00A',\n  CONNECTED: '#26D907',\n  'CONNECTING ERROR': '#D1191C',\n  'INVOKE ERROR': '#D1191C',\n  UPDATE: '#0DD151',\n  'UNEXPECTED UPDATE': '#9C9C9C',\n  'UNEXPECTED RESPONSE': '#D1191C',\n};\n\nexport function resolveMessageApiChatId(mtpMessage: GramJs.TypeMessage) {\n  if (!(mtpMessage instanceof GramJs.Message || mtpMessage instanceof GramJs.MessageService)) {\n    return undefined;\n  }\n\n  return getApiChatIdFromMtpPeer(mtpMessage.peerId);\n}\n\nexport function isChatFolder(\n  filter?: GramJs.TypeDialogFilter,\n): filter is GramJs.DialogFilter | GramJs.DialogFilterChatlist {\n  return filter instanceof GramJs.DialogFilter || filter instanceof GramJs.DialogFilterChatlist;\n}\n\nexport function addMessageToLocalDb(message: GramJs.Message | GramJs.MessageService) {\n  const messageFullId = `${resolveMessageApiChatId(message)}-${message.id}`;\n\n  let mockMessage = message;\n  if (message instanceof GramJs.Message\n    && message.media instanceof GramJs.MessageMediaInvoice\n    && message.media.extendedMedia instanceof GramJs.MessageExtendedMedia) {\n    mockMessage = new GramJs.Message({\n      ...message,\n      media: message.media.extendedMedia.media,\n    });\n  }\n\n  localDb.messages[messageFullId] = mockMessage;\n\n  if (mockMessage instanceof GramJs.Message) {\n    if (mockMessage.media) addMediaToLocalDb(mockMessage.media);\n\n    if (mockMessage.replyTo instanceof GramJs.MessageReplyHeader && mockMessage.replyTo.replyMedia) {\n      addMediaToLocalDb(mockMessage.replyTo.replyMedia);\n    }\n  }\n\n  if (mockMessage instanceof GramJs.MessageService && 'photo' in mockMessage.action) {\n    addPhotoToLocalDb(mockMessage.action.photo);\n  }\n}\n\nfunction addMediaToLocalDb(media: GramJs.TypeMessageMedia) {\n  if (media instanceof GramJs.MessageMediaDocument\n    && media.document instanceof GramJs.Document\n  ) {\n    localDb.documents[String(media.document.id)] = media.document;\n  }\n\n  if (media instanceof GramJs.MessageMediaWebPage\n    && media.webpage instanceof GramJs.WebPage\n    && media.webpage.document instanceof GramJs.Document\n  ) {\n    localDb.documents[String(media.webpage.document.id)] = media.webpage.document;\n  }\n\n  if (media instanceof GramJs.MessageMediaGame) {\n    if (media.game.document instanceof GramJs.Document) {\n      localDb.documents[String(media.game.document.id)] = media.game.document;\n    }\n    addPhotoToLocalDb(media.game.photo);\n  }\n\n  if (media instanceof GramJs.MessageMediaInvoice\n    && media.photo) {\n    localDb.webDocuments[String(media.photo.url)] = media.photo;\n  }\n}\n\nexport function addStoryToLocalDb(story: GramJs.TypeStoryItem, peerId: string) {\n  if (!(story instanceof GramJs.StoryItem)) {\n    return;\n  }\n\n  const storyData = {\n    id: story.id,\n    peerId,\n  };\n\n  if (story.media instanceof GramJs.MessageMediaPhoto) {\n    const photo = story.media.photo as GramJs.Photo & StoryRepairInfo;\n    photo.storyData = storyData;\n    addPhotoToLocalDb(photo);\n  }\n  if (story.media instanceof GramJs.MessageMediaDocument) {\n    if (story.media.document instanceof GramJs.Document) {\n      const doc = story.media.document as GramJs.Document & StoryRepairInfo;\n      doc.storyData = storyData;\n      localDb.documents[String(story.media.document.id)] = doc;\n    }\n\n    if (story.media.altDocument instanceof GramJs.Document) {\n      const doc = story.media.altDocument as GramJs.Document & StoryRepairInfo;\n      doc.storyData = storyData;\n      localDb.documents[String(story.media.altDocument.id)] = doc;\n    }\n  }\n}\n\nexport function addPhotoToLocalDb(photo: GramJs.TypePhoto) {\n  if (photo instanceof GramJs.Photo) {\n    localDb.photos[String(photo.id)] = photo;\n  }\n}\n\nexport function addChatToLocalDb(chat: GramJs.Chat | GramJs.Channel) {\n  const id = buildApiPeerId(chat.id, chat instanceof GramJs.Chat ? 'chat' : 'channel');\n  const storedChat = localDb.chats[id];\n\n  const isStoredMin = storedChat && 'min' in storedChat && storedChat.min;\n  const isChatMin = 'min' in chat && chat.min;\n  if (storedChat && !isStoredMin && isChatMin) return;\n\n  localDb.chats[id] = chat;\n}\n\nexport function addUserToLocalDb(user: GramJs.User) {\n  const id = buildApiPeerId(user.id, 'user');\n  const storedUser = localDb.users[id];\n  if (storedUser && !storedUser.min && user.min) return;\n\n  localDb.users[id] = user;\n}\n\nexport function addEntitiesToLocalDb(entities: (GramJs.TypeUser | GramJs.TypeChat)[]) {\n  entities.forEach((entity) => {\n    if (entity instanceof GramJs.User) {\n      addUserToLocalDb(entity);\n    } else if ((entity instanceof GramJs.Chat || entity instanceof GramJs.Channel)) {\n      addChatToLocalDb(entity);\n    }\n  });\n}\n\nexport function swapLocalInvoiceMedia(\n  chatId: string, messageId: number, extendedMedia: GramJs.TypeMessageExtendedMedia,\n) {\n  const localMessage = localDb.messages[`${chatId}-${messageId}`];\n  if (!(localMessage instanceof GramJs.Message) || !localMessage.media) return;\n\n  if (extendedMedia instanceof GramJs.MessageExtendedMediaPreview) {\n    if (!(localMessage.media instanceof GramJs.MessageMediaInvoice)) {\n      return;\n    }\n    localMessage.media.extendedMedia = extendedMedia;\n  }\n\n  if (extendedMedia instanceof GramJs.MessageExtendedMedia) {\n    localMessage.media = extendedMedia.media;\n  }\n}\n\nexport function serializeBytes(value: Buffer) {\n  return String.fromCharCode(...value);\n}\n\nexport function deserializeBytes(value: string) {\n  return Buffer.from(value, 'binary');\n}\n\nexport function log(suffix: keyof typeof LOG_SUFFIX, ...data: any) {\n  /* eslint-disable max-len */\n  /* eslint-disable no-console */\n  const func = suffix === 'UNEXPECTED RESPONSE' ? console.error\n    : suffix === 'INVOKE ERROR' || suffix === 'UNEXPECTED UPDATE' ? console.warn : console.log;\n  /* eslint-enable no-console */\n  func(\n    `%cGramJS%c${suffix}`,\n    `color: ${LOG_PREFIX_COLOR}; background: ${LOG_BACKGROUND}; padding: 0.25rem; border-radius: 0.25rem;`,\n    `color: ${LOG_SUFFIX[suffix]}; background: ${LOG_BACKGROUND}; padding: 0.25rem; border-radius: 0.25rem; margin-left: 0.25rem;`,\n    ...data,\n  );\n  /* eslint-enable max-len */\n}\n\nexport function isResponseUpdate<T extends GramJs.AnyRequest>(result: T['__response']): result is GramJs.TypeUpdate {\n  return result instanceof GramJs.UpdatesTooLong || result instanceof GramJs.UpdateShortMessage\n    || result instanceof GramJs.UpdateShortChatMessage || result instanceof GramJs.UpdateShort\n    || result instanceof GramJs.UpdatesCombined || result instanceof GramJs.Updates\n    || result instanceof GramJs.UpdateShortSentMessage;\n}\n","type CollectionByKey<Member> = Record<number | string, Member>;\n\ntype OrderDirection =\n  'asc'\n  | 'desc';\n\ninterface OrderCallback<T> {\n  (member: T): any;\n}\n\nexport function buildCollectionByKey<T extends AnyLiteral>(collection: T[], key: keyof T) {\n  return collection.reduce((byKey: CollectionByKey<T>, member: T) => {\n    byKey[member[key]] = member;\n\n    return byKey;\n  }, {});\n}\n\nexport function buildCollectionByCallback<T extends AnyLiteral, K extends number | string, R extends unknown>(\n  collection: T[],\n  callback: (member: T) => [K, R],\n) {\n  return collection.reduce((byKey: Record<K, R>, member: T) => {\n    const [key, value] = callback(member);\n    byKey[key] = value;\n\n    return byKey;\n  }, {} as Record<K, R>);\n}\n\nexport function mapValues<R extends any, M extends any>(\n  byKey: CollectionByKey<M>,\n  callback: (member: M, key: string, index: number, originalByKey: CollectionByKey<M>) => R,\n): CollectionByKey<R> {\n  return Object.keys(byKey).reduce((newByKey: CollectionByKey<R>, key, index) => {\n    newByKey[key] = callback(byKey[key], key, index, byKey);\n    return newByKey;\n  }, {});\n}\n\nexport function pick<T, K extends keyof T>(object: T, keys: K[]) {\n  return keys.reduce((result, key) => {\n    result[key] = object[key];\n    return result;\n  }, {} as Pick<T, K>);\n}\n\nexport function pickTruthy<T, K extends keyof T>(object: T, keys: K[]) {\n  return keys.reduce((result, key) => {\n    if (object[key]) {\n      result[key] = object[key];\n    }\n\n    return result;\n  }, {} as Pick<T, K>);\n}\n\nexport function omit<T extends object, K extends keyof T>(object: T, keys: K[]): Omit<T, K> {\n  const stringKeys = new Set(keys.map(String));\n  const savedKeys = Object.keys(object)\n    .filter((key) => !stringKeys.has(key)) as Array<Exclude<keyof T, K>>;\n\n  return pick(object, savedKeys);\n}\n\nexport function omitUndefined<T extends object>(object: T): T {\n  return Object.keys(object).reduce((result, stringKey) => {\n    const key = stringKey as keyof T;\n    if (object[key] !== undefined) {\n      result[key as keyof T] = object[key];\n    }\n    return result;\n  }, {} as T);\n}\n\nexport function orderBy<T>(\n  collection: T[],\n  orderRule: (keyof T) | OrderCallback<T> | ((keyof T) | OrderCallback<T>)[],\n  mode: OrderDirection | [OrderDirection, OrderDirection] = 'asc',\n): T[] {\n  function compareValues(a: T, b: T, currentOrderRule: (keyof T) | OrderCallback<T>, isAsc: boolean) {\n    const aValue = (typeof currentOrderRule === 'function' ? currentOrderRule(a) : a[currentOrderRule]) || 0;\n    const bValue = (typeof currentOrderRule === 'function' ? currentOrderRule(b) : b[currentOrderRule]) || 0;\n\n    return isAsc ? aValue - bValue : bValue - aValue;\n  }\n\n  if (Array.isArray(orderRule)) {\n    const [mode1, mode2] = Array.isArray(mode) ? mode : [mode, mode];\n    const [orderRule1, orderRule2] = orderRule;\n    const isAsc1 = mode1 === 'asc';\n    const isAsc2 = mode2 === 'asc';\n\n    return collection.sort((a, b) => {\n      return compareValues(a, b, orderRule1, isAsc1) || compareValues(a, b, orderRule2, isAsc2);\n    });\n  }\n\n  const isAsc = mode === 'asc';\n  return collection.sort((a, b) => {\n    return compareValues(a, b, orderRule, isAsc);\n  });\n}\n\nexport function unique<T extends any>(array: T[]): T[] {\n  return Array.from(new Set(array));\n}\n\nexport function uniqueByField<T extends any>(array: T[], field: keyof T): T[] {\n  return [...new Map(array.map((item) => [item[field], item])).values()];\n}\n\nexport function compact<T extends any>(array: T[]) {\n  return array.filter(Boolean);\n}\n\nexport function areSortedArraysEqual(array1: any[], array2: any[]) {\n  if (array1.length !== array2.length) {\n    return false;\n  }\n\n  return array1.every((item, i) => item === array2[i]);\n}\n\nexport function areSortedArraysIntersecting(array1: any[], array2: any[]) {\n  return array1[0] <= array2[array2.length - 1] && array1[array1.length - 1] >= array2[0];\n}\n\nexport function findIntersectionWithSet<T>(array: T[], set: Set<T>): T[] {\n  return array.filter((a) => set.has(a));\n}\n/**\n * Exlude elements from base array. Both arrays should be sorted in same order\n * @param base\n * @param toExclude\n * @returns New array without excluded elements\n */\nexport function excludeSortedArray<T extends any>(base: T[], toExclude: T[]) {\n  if (!base?.length) return base;\n\n  const result: T[] = [];\n\n  let excludeIndex = 0;\n\n  for (let i = 0; i < base.length; i++) {\n    if (toExclude[excludeIndex] === base[i]) {\n      excludeIndex += 1;\n    } else {\n      result.push(base[i]);\n    }\n  }\n\n  return result;\n}\n\nexport function split<T extends any>(array: T[], chunkSize: number) {\n  const result: T[][] = [];\n  for (let i = 0; i < array.length; i += chunkSize) {\n    result.push(array.slice(i, i + chunkSize));\n  }\n\n  return result;\n}\n\nexport function partition<T extends unknown>(\n  array: T[], filter: (value: T, index: number, array: T[]) => boolean,\n): [T[], T[]] {\n  const pass: T[] = [];\n  const fail: T[] = [];\n\n  array.forEach((e, idx, arr) => (filter(e, idx, arr) ? pass : fail).push(e));\n\n  return [pass, fail];\n}\n\nexport function cloneDeep<T>(value: T): T {\n  if (!isObject(value)) {\n    return value;\n  }\n\n  if (Array.isArray(value)) {\n    return value.map(cloneDeep) as typeof value;\n  }\n\n  return Object.keys(value).reduce((acc, key) => {\n    acc[key as keyof T] = cloneDeep(value[key as keyof T]);\n    return acc;\n  }, {} as T);\n}\n\nfunction isObject(value: any): value is object {\n  // eslint-disable-next-line no-null/no-null\n  return typeof value === 'object' && value !== null;\n}\n\nexport function findLast<T>(array: Array<T>, predicate: (value: T, index: number, obj: T[]) => boolean): T | undefined {\n  let cursor = array.length;\n\n  while (cursor--) {\n    if (predicate(array[cursor], cursor, array)) {\n      return array[cursor];\n    }\n  }\n\n  return undefined;\n}\n\nexport function compareFields<T>(a: T, b: T) {\n  return Number(b) - Number(a);\n}\n","let serverTimeOffset = 0;\n\nexport function setServerTimeOffset(_serverTimeOffset: number) {\n  serverTimeOffset = _serverTimeOffset;\n}\n\nexport function getServerTimeOffset() {\n  return serverTimeOffset;\n}\n\nexport function getServerTime() {\n  return Math.floor(Date.now() / 1000) + serverTimeOffset;\n}\n","/* eslint-disable no-bitwise */\n\n// eslint-disable-next-line max-len\nconst TEMPLATE = '<?xml version=\"1.0\" encoding=\"utf-8\"?><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 {{width}} {{height}}\" xml:space=\"preserve\"><path fill-opacity=\"0.1\" d=\"{{path}}\" /></svg>';\nconst LOOKUP = 'AACAAAAHAAALMAAAQASTAVAAAZaacaaaahaaalmaaaqastava.az0123456789-,';\n\nexport function pathBytesToSvg(bytes: Buffer, width: number, height: number) {\n  return TEMPLATE\n    .replace('{{path}}', buildPath(bytes))\n    .replace('{{width}}', String(width))\n    .replace('{{height}}', String(height));\n}\n\nfunction buildPath(bytes: Buffer) {\n  let path = 'M';\n\n  const len = bytes.length;\n  for (let i = 0; i < len; i++) {\n    const num = bytes[i];\n    if (num >= 128 + 64) {\n      path += LOOKUP[num - 128 - 64];\n    } else {\n      if (num >= 128) {\n        path += ',';\n      } else if (num >= 64) {\n        path += '-';\n      }\n      path += String(num & 63);\n    }\n  }\n\n  path += 'z';\n\n  return path;\n}\n","import { Api as GramJs } from '../../../lib/gramjs';\nimport { strippedPhotoToJpg } from '../../../lib/gramjs/Utils';\n\nimport type { ApiPrivacySettings, PrivacyVisibility } from '../../../types';\nimport type {\n  ApiFormattedText,\n  ApiMessageEntity,\n  ApiMessageEntityDefault,\n  ApiPhoto,\n  ApiPhotoSize,\n  ApiThumbnail,\n  ApiUsername,\n  ApiVideoSize,\n} from '../../types';\nimport {\n  ApiMessageEntityTypes,\n} from '../../types';\n\nimport { compact } from '../../../util/iteratees';\nimport localDb from '../localDb';\nimport { bytesToDataUri } from './helpers';\nimport { pathBytesToSvg } from './pathBytesToSvg';\nimport { buildApiPeerId } from './peers';\n\nconst DEFAULT_THUMB_SIZE = { w: 100, h: 100 };\n\nexport function buildApiThumbnailFromStripped(\n  sizes?: GramJs.TypePhotoSize[], mimeType?: string,\n): ApiThumbnail | undefined {\n  if (!sizes || !sizes.length) {\n    return undefined;\n  }\n\n  const thumb = sizes.find((s: any): s is GramJs.PhotoStrippedSize => s instanceof GramJs.PhotoStrippedSize);\n  if (!thumb) {\n    return undefined;\n  }\n\n  const realSizes = sizes.filter((s): s is GramJs.PhotoSize => s instanceof GramJs.PhotoSize);\n  const { w, h } = realSizes.length ? realSizes[realSizes.length - 1] : DEFAULT_THUMB_SIZE;\n  const { bytes } = thumb;\n  const dataUri = bytesToDataUri(\n    !mimeType || mimeType === 'image/jpeg' ? strippedPhotoToJpg(bytes) : bytes,\n    undefined,\n    mimeType,\n  );\n\n  return {\n    dataUri,\n    width: w,\n    height: h,\n  };\n}\n\nexport function buildApiThumbnailFromCached(photoSize: GramJs.PhotoCachedSize): ApiThumbnail | undefined {\n  const { w, h, bytes } = photoSize;\n  const dataUri = bytesToDataUri(bytes, undefined, 'image/webp');\n\n  return {\n    dataUri,\n    width: w,\n    height: h,\n  };\n}\n\nexport function buildApiThumbnailFromPath(\n  photoSize: GramJs.PhotoPathSize,\n  sizeAttribute: GramJs.DocumentAttributeImageSize | GramJs.DocumentAttributeVideo,\n): ApiThumbnail | undefined {\n  const { w, h } = sizeAttribute;\n  const dataUri = `data:image/svg+xml;utf8,${pathBytesToSvg(photoSize.bytes, w, h)}`;\n\n  return {\n    dataUri,\n    width: w,\n    height: h,\n  };\n}\n\nexport function buildApiPhoto(photo: GramJs.Photo, isSpoiler?: boolean): ApiPhoto {\n  const sizes = photo.sizes\n    .filter((s: any): s is GramJs.PhotoSize => {\n      return s instanceof GramJs.PhotoSize || s instanceof GramJs.PhotoSizeProgressive;\n    })\n    .map(buildApiPhotoSize);\n\n  return {\n    id: String(photo.id),\n    thumbnail: buildApiThumbnailFromStripped(photo.sizes),\n    sizes,\n    isSpoiler,\n    ...(photo.videoSizes && { videoSizes: compact(photo.videoSizes.map(buildApiVideoSize)), isVideo: true }),\n  };\n}\n\nexport function buildApiVideoSize(videoSize: GramJs.TypeVideoSize): ApiVideoSize | undefined {\n  if (!(videoSize instanceof GramJs.VideoSize)) return undefined;\n\n  const {\n    videoStartTs, size, h, w, type,\n  } = videoSize;\n\n  return {\n    videoStartTs,\n    size,\n    height: h,\n    width: w,\n    type: type as ('u' | 'v'),\n  };\n}\n\nexport function buildApiPhotoSize(photoSize: GramJs.PhotoSize): ApiPhotoSize {\n  const { w, h, type } = photoSize;\n\n  return {\n    width: w,\n    height: h,\n    type: type as ('m' | 'x' | 'y'),\n  };\n}\n\nexport function buildApiUsernames(mtpPeer: GramJs.User | GramJs.Channel | GramJs.UpdateUserName) {\n  if (!mtpPeer.usernames && !('username' in mtpPeer && mtpPeer.username)) {\n    return undefined;\n  }\n\n  const usernames: ApiUsername[] = [];\n\n  if ('username' in mtpPeer && mtpPeer.username) {\n    usernames.push({\n      username: mtpPeer.username,\n      isActive: true,\n      isEditable: true,\n    });\n  }\n\n  if (mtpPeer.usernames) {\n    mtpPeer.usernames.forEach(({ username, active, editable }) => {\n      usernames.push({\n        username,\n        ...(active && { isActive: true }),\n        ...(editable && { isEditable: true }),\n      });\n    });\n  }\n\n  return usernames;\n}\n\nexport function buildPrivacyRules(rules: GramJs.TypePrivacyRule[]): ApiPrivacySettings {\n  let visibility: PrivacyVisibility | undefined;\n  let isUnspecified: boolean | undefined;\n  let allowUserIds: string[] | undefined;\n  let allowChatIds: string[] | undefined;\n  let blockUserIds: string[] | undefined;\n  let blockChatIds: string[] | undefined;\n\n  const localChats = localDb.chats;\n\n  rules.forEach((rule) => {\n    if (rule instanceof GramJs.PrivacyValueAllowAll) {\n      visibility ||= 'everybody';\n    } else if (rule instanceof GramJs.PrivacyValueAllowContacts) {\n      visibility ||= 'contacts';\n    } else if (rule instanceof GramJs.PrivacyValueAllowCloseFriends) {\n      visibility ||= 'closeFriends';\n    } else if (rule instanceof GramJs.PrivacyValueDisallowContacts) {\n      visibility ||= 'nonContacts';\n    } else if (rule instanceof GramJs.PrivacyValueDisallowAll) {\n      visibility ||= 'nobody';\n    } else if (rule instanceof GramJs.PrivacyValueAllowUsers) {\n      allowUserIds = rule.users.map((chatId) => buildApiPeerId(chatId, 'user'));\n    } else if (rule instanceof GramJs.PrivacyValueDisallowUsers) {\n      blockUserIds = rule.users.map((chatId) => buildApiPeerId(chatId, 'user'));\n    } else if (rule instanceof GramJs.PrivacyValueAllowChatParticipants) {\n      // Server allows channel ids here, so we need to check\n      allowChatIds = rule.chats.map((chatId) => {\n        const dialogId = buildApiPeerId(chatId, 'chat');\n        const channelId = buildApiPeerId(chatId, 'channel');\n        if (localChats[dialogId]) return dialogId;\n        return channelId;\n      });\n    } else if (rule instanceof GramJs.PrivacyValueDisallowChatParticipants) {\n      blockChatIds = rule.chats.map((chatId) => {\n        const dialogId = buildApiPeerId(chatId, 'chat');\n        const channelId = buildApiPeerId(chatId, 'channel');\n        if (localChats[dialogId]) return dialogId;\n        return channelId;\n      });\n    }\n  });\n\n  if (!visibility) {\n    // Disallow by default\n    visibility = 'nobody';\n    isUnspecified = true;\n  }\n\n  return {\n    visibility,\n    isUnspecified,\n    allowUserIds: allowUserIds || [],\n    allowChatIds: allowChatIds || [],\n    blockUserIds: blockUserIds || [],\n    blockChatIds: blockChatIds || [],\n  };\n}\n\nexport function buildApiFormattedText(textWithEntities: GramJs.TextWithEntities): ApiFormattedText {\n  const { text, entities } = textWithEntities;\n\n  return {\n    text,\n    entities: entities.map(buildApiMessageEntity),\n  };\n}\n\nexport function buildApiMessageEntity(entity: GramJs.TypeMessageEntity): ApiMessageEntity {\n  const {\n    className: type, offset, length,\n  } = entity;\n\n  if (entity instanceof GramJs.MessageEntityMentionName) {\n    return {\n      type: ApiMessageEntityTypes.MentionName,\n      offset,\n      length,\n      userId: buildApiPeerId(entity.userId, 'user'),\n    };\n  }\n\n  if (entity instanceof GramJs.MessageEntityTextUrl) {\n    return {\n      type: ApiMessageEntityTypes.TextUrl,\n      offset,\n      length,\n      url: entity.url,\n    };\n  }\n\n  if (entity instanceof GramJs.MessageEntityPre) {\n    return {\n      type: ApiMessageEntityTypes.Pre,\n      offset,\n      length,\n      language: entity.language,\n    };\n  }\n\n  if (entity instanceof GramJs.MessageEntityCustomEmoji) {\n    return {\n      type: ApiMessageEntityTypes.CustomEmoji,\n      offset,\n      length,\n      documentId: entity.documentId.toString(),\n    };\n  }\n\n  return {\n    type: type as `${ApiMessageEntityDefault['type']}`,\n    offset,\n    length,\n  };\n}\n","import { Api as GramJs } from '../../../lib/gramjs';\n\nimport type {\n  ApiEmojiInteraction, ApiSticker, ApiStickerSet, ApiStickerSetInfo, GramJsEmojiInteraction,\n} from '../../types';\n\nimport { LOTTIE_STICKER_MIME_TYPE, VIDEO_STICKER_MIME_TYPE } from '../../../config';\nimport { compact } from '../../../util/iteratees';\nimport localDb from '../localDb';\nimport { buildApiThumbnailFromCached, buildApiThumbnailFromPath } from './common';\n\nexport function buildStickerFromDocument(document: GramJs.TypeDocument, isNoPremium?: boolean): ApiSticker | undefined {\n  if (document instanceof GramJs.DocumentEmpty) {\n    return undefined;\n  }\n\n  const { mimeType, videoThumbs } = document;\n  const stickerAttribute = document.attributes\n    .find((attr: any): attr is GramJs.DocumentAttributeSticker => (\n      attr instanceof GramJs.DocumentAttributeSticker\n    ));\n  const customEmojiAttribute = document.attributes\n    .find((attr): attr is GramJs.DocumentAttributeCustomEmoji => attr instanceof GramJs.DocumentAttributeCustomEmoji);\n\n  const fileAttribute = (mimeType === LOTTIE_STICKER_MIME_TYPE || mimeType === VIDEO_STICKER_MIME_TYPE)\n    && document.attributes\n      .find((attr: any): attr is GramJs.DocumentAttributeFilename => (\n        attr instanceof GramJs.DocumentAttributeFilename\n      ));\n\n  if (!(stickerAttribute || customEmojiAttribute) && !fileAttribute) {\n    return undefined;\n  }\n\n  const isLottie = mimeType === LOTTIE_STICKER_MIME_TYPE;\n  const isVideo = mimeType === VIDEO_STICKER_MIME_TYPE;\n  const isCustomEmoji = Boolean(customEmojiAttribute);\n  const shouldUseTextColor = isCustomEmoji && customEmojiAttribute.textColor;\n\n  const imageSizeAttribute = document.attributes\n    .find((attr: any): attr is GramJs.DocumentAttributeImageSize => (\n      attr instanceof GramJs.DocumentAttributeImageSize\n    ));\n\n  const videoSizeAttribute = document.attributes\n    .find((attr: any): attr is GramJs.DocumentAttributeVideo => (\n      attr instanceof GramJs.DocumentAttributeVideo\n    ));\n\n  const sizeAttribute = imageSizeAttribute || videoSizeAttribute;\n\n  const stickerOrEmojiAttribute = (stickerAttribute || customEmojiAttribute)!;\n  const stickerSetInfo = buildApiStickerSetInfo(stickerOrEmojiAttribute?.stickerset);\n  const emoji = stickerOrEmojiAttribute?.alt;\n  const isFree = Boolean(customEmojiAttribute?.free ?? true);\n\n  const cachedThumb = document.thumbs && document.thumbs.find(\n    (s): s is GramJs.PhotoCachedSize => s instanceof GramJs.PhotoCachedSize,\n  );\n\n  // eslint-disable-next-line no-restricted-globals\n  if (mimeType === VIDEO_STICKER_MIME_TYPE && !(self as any).isWebmSupported && !cachedThumb) {\n    const staticThumb = document.thumbs && document.thumbs.find(\n      (s): s is GramJs.PhotoSize => s instanceof GramJs.PhotoSize,\n    );\n\n    if (!staticThumb) {\n      return undefined;\n    }\n  }\n\n  const pathThumb = document.thumbs && document.thumbs.find(\n    (s): s is GramJs.PhotoPathSize => s instanceof GramJs.PhotoPathSize,\n  );\n\n  const thumbnail = cachedThumb ? (\n    buildApiThumbnailFromCached(cachedThumb)\n  ) : pathThumb && sizeAttribute ? (\n    buildApiThumbnailFromPath(pathThumb, sizeAttribute)\n  ) : undefined;\n\n  const { w: width, h: height } = cachedThumb as GramJs.PhotoCachedSize || sizeAttribute || {};\n\n  const hasEffect = !isNoPremium && videoThumbs && compact(videoThumbs\n    ?.filter((thumb) => thumb instanceof GramJs.VideoSize) as GramJs.VideoSize[])\n    .some(({ type }) => type === 'f');\n\n  return {\n    id: String(document.id),\n    stickerSetInfo,\n    emoji,\n    isCustomEmoji,\n    isLottie,\n    isVideo,\n    width,\n    height,\n    thumbnail,\n    hasEffect,\n    isFree,\n    shouldUseTextColor,\n  };\n}\n\nexport function buildStickerSet(set: GramJs.StickerSet): ApiStickerSet {\n  const {\n    archived,\n    animated,\n    installedDate,\n    videos,\n    id,\n    accessHash,\n    title,\n    thumbs,\n    count,\n    shortName,\n    emojis,\n    thumbDocumentId,\n  } = set;\n\n  return {\n    isArchived: archived,\n    isLottie: animated,\n    isVideos: videos,\n    isEmoji: emojis,\n    installedDate,\n    id: String(id),\n    accessHash: String(accessHash),\n    title,\n    hasThumbnail: Boolean(thumbs?.length || thumbDocumentId),\n    thumbCustomEmojiId: thumbDocumentId?.toString(),\n    count,\n    shortName,\n  };\n}\n\nfunction buildApiStickerSetInfo(inputSet?: GramJs.TypeInputStickerSet): ApiStickerSetInfo {\n  if (inputSet instanceof GramJs.InputStickerSetID) {\n    return {\n      id: String(inputSet.id),\n      accessHash: String(inputSet.accessHash),\n    };\n  }\n  if (inputSet instanceof GramJs.InputStickerSetShortName) {\n    return {\n      shortName: inputSet.shortName,\n    };\n  }\n\n  return {\n    isMissing: true,\n  };\n}\n\nexport function buildStickerSetCovered(coveredStickerSet: GramJs.TypeStickerSetCovered): ApiStickerSet {\n  const stickerSet = buildStickerSet(coveredStickerSet.set);\n\n  if (coveredStickerSet instanceof GramJs.StickerSetNoCovered) {\n    return stickerSet;\n  }\n\n  const stickerSetCovers = (coveredStickerSet instanceof GramJs.StickerSetCovered) ? [coveredStickerSet.cover]\n    : (coveredStickerSet instanceof GramJs.StickerSetMultiCovered) ? coveredStickerSet.covers\n      : coveredStickerSet.documents;\n\n  const stickers = processStickerResult(stickerSetCovers);\n\n  if (coveredStickerSet instanceof GramJs.StickerSetFullCovered) {\n    return {\n      ...stickerSet,\n      stickers,\n      packs: processStickerPackResult(coveredStickerSet.packs),\n    };\n  }\n\n  return {\n    ...stickerSet,\n    covers: stickers,\n  };\n}\n\nexport function buildApiEmojiInteraction(json: GramJsEmojiInteraction): ApiEmojiInteraction {\n  return {\n    timestamps: json.a.map(({ t }) => t),\n  };\n}\n\nexport function processStickerPackResult(packs: GramJs.StickerPack[]) {\n  return packs.reduce((acc, { emoticon, documents }) => {\n    acc[emoticon] = documents.map((documentId) => buildStickerFromDocument(\n      localDb.documents[String(documentId)],\n    )).filter(Boolean);\n    return acc;\n  }, {} as Record<string, ApiSticker[]>);\n}\n\nexport function processStickerResult(stickers: GramJs.TypeDocument[]) {\n  return stickers\n    .map((document) => {\n      if (document instanceof GramJs.Document) {\n        const sticker = buildStickerFromDocument(document);\n        if (sticker) {\n          localDb.documents[String(document.id)] = document;\n\n          return sticker;\n        }\n      }\n\n      return undefined;\n    })\n    .filter(Boolean);\n}\n","import { Api as GramJs } from '../../../lib/gramjs';\n\nimport type {\n  ApiAudio,\n  ApiContact,\n  ApiDocument,\n  ApiFormattedText,\n  ApiGame,\n  ApiGiveaway,\n  ApiGiveawayResults,\n  ApiInvoice,\n  ApiLocation,\n  ApiMessageExtendedMediaPreview,\n  ApiMessageStoryData,\n  ApiPhoto,\n  ApiPoll,\n  ApiSticker,\n  ApiVideo,\n  ApiVoice,\n  ApiWebDocument,\n  ApiWebPage,\n  ApiWebPageStoryData,\n  MediaContent,\n} from '../../types';\nimport type { UniversalMessage } from './messages';\n\nimport { SUPPORTED_IMAGE_CONTENT_TYPES, SUPPORTED_VIDEO_CONTENT_TYPES, VIDEO_WEBM_TYPE } from '../../../config';\nimport { pick } from '../../../util/iteratees';\nimport { addStoryToLocalDb, serializeBytes } from '../helpers';\nimport {\n  buildApiMessageEntity,\n  buildApiPhoto,\n  buildApiPhotoSize,\n  buildApiThumbnailFromPath,\n  buildApiThumbnailFromStripped,\n} from './common';\nimport { buildApiPeerId, getApiChatIdFromMtpPeer } from './peers';\nimport { buildStickerFromDocument } from './symbols';\n\nexport function buildMessageContent(\n  mtpMessage: UniversalMessage | GramJs.UpdateServiceNotification,\n) {\n  let content: MediaContent = {};\n\n  if (mtpMessage.media) {\n    content = {\n      ...buildMessageMediaContent(mtpMessage.media),\n    };\n  }\n\n  const hasUnsupportedMedia = mtpMessage.media instanceof GramJs.MessageMediaUnsupported;\n\n  if (mtpMessage.message && !hasUnsupportedMedia\n    && !content.sticker && !content.poll && !content.contact && !content.video?.isRound) {\n    content = {\n      ...content,\n      text: buildMessageTextContent(mtpMessage.message, mtpMessage.entities),\n    };\n  }\n\n  return content;\n}\n\nexport function buildMessageTextContent(\n  message: string,\n  entities?: GramJs.TypeMessageEntity[],\n): ApiFormattedText {\n  return {\n    text: message,\n    ...(entities && { entities: entities.map(buildApiMessageEntity) }),\n  };\n}\n\nexport function buildMessageMediaContent(media: GramJs.TypeMessageMedia): MediaContent | undefined {\n  const ttlSeconds = 'ttlSeconds' in media ? media.ttlSeconds : undefined;\n\n  const isExpiredVoice = isExpiredVoiceMessage(media);\n  if (isExpiredVoice) {\n    return { isExpiredVoice };\n  }\n  const isExpiredRoundVideo = isExpiredRoundVideoMessage(media);\n  if (isExpiredRoundVideo) {\n    return { isExpiredRoundVideo };\n  }\n\n  const voice = buildVoice(media);\n  if (voice) return { voice, ttlSeconds };\n\n  if ('round' in media && media.round) {\n    const video = buildVideo(media);\n    if (video) return { video, ttlSeconds };\n  }\n\n  // Other disappearing media types are not supported\n  if (ttlSeconds !== undefined) {\n    return undefined;\n  }\n\n  if ('extendedMedia' in media && media.extendedMedia instanceof GramJs.MessageExtendedMedia) {\n    return buildMessageMediaContent(media.extendedMedia.media);\n  }\n\n  const sticker = buildSticker(media);\n  if (sticker) return { sticker };\n\n  const photo = buildPhoto(media);\n  if (photo) return { photo };\n\n  const video = buildVideo(media);\n  const altVideo = buildAltVideo(media);\n  if (video) return { video, altVideo };\n\n  const audio = buildAudio(media);\n  if (audio) return { audio };\n\n  const document = buildDocumentFromMedia(media);\n  if (document) return { document };\n\n  const contact = buildContact(media);\n  if (contact) return { contact };\n\n  const poll = buildPollFromMedia(media);\n  if (poll) return { poll };\n\n  const webPage = buildWebPage(media);\n  if (webPage) return { webPage };\n\n  const invoice = buildInvoiceFromMedia(media);\n  if (invoice) return { invoice };\n\n  const location = buildLocationFromMedia(media);\n  if (location) return { location };\n\n  const game = buildGameFromMedia(media);\n  if (game) return { game };\n\n  const storyData = buildMessageStoryData(media);\n  if (storyData) return { storyData };\n\n  const giveaway = buildGiweawayFromMedia(media);\n  if (giveaway) return { giveaway };\n\n  const giveawayResults = buildGiweawayResultsFromMedia(media);\n  if (giveawayResults) return { giveawayResults };\n\n  return undefined;\n}\n\nfunction buildSticker(media: GramJs.TypeMessageMedia): ApiSticker | undefined {\n  if (\n    !(media instanceof GramJs.MessageMediaDocument)\n    || !media.document\n    || !(media.document instanceof GramJs.Document)\n  ) {\n    return undefined;\n  }\n\n  return buildStickerFromDocument(media.document, media.nopremium);\n}\n\nfunction buildPhoto(media: GramJs.TypeMessageMedia): ApiPhoto | undefined {\n  if (!(media instanceof GramJs.MessageMediaPhoto) || !media.photo || !(media.photo instanceof GramJs.Photo)) {\n    return undefined;\n  }\n\n  return buildApiPhoto(media.photo, media.spoiler);\n}\n\nexport function buildVideoFromDocument(document: GramJs.Document, isSpoiler?: boolean): ApiVideo | undefined {\n  if (document instanceof GramJs.DocumentEmpty) {\n    return undefined;\n  }\n\n  const {\n    id, mimeType, thumbs, size, attributes,\n  } = document;\n\n  // eslint-disable-next-line no-restricted-globals\n  if (mimeType === VIDEO_WEBM_TYPE && !(self as any).isWebmSupported) {\n    return undefined;\n  }\n\n  const videoAttr = attributes\n    .find((a: any): a is GramJs.DocumentAttributeVideo => a instanceof GramJs.DocumentAttributeVideo);\n\n  if (!videoAttr) {\n    return undefined;\n  }\n\n  const gifAttr = attributes\n    .find((a: any): a is GramJs.DocumentAttributeAnimated => a instanceof GramJs.DocumentAttributeAnimated);\n\n  const {\n    duration,\n    w: width,\n    h: height,\n    supportsStreaming = false,\n    roundMessage: isRound = false,\n    nosound,\n  } = videoAttr;\n\n  return {\n    id: String(id),\n    mimeType,\n    duration,\n    fileName: getFilenameFromDocument(document, 'video'),\n    width,\n    height,\n    supportsStreaming,\n    isRound,\n    isGif: Boolean(gifAttr),\n    thumbnail: buildApiThumbnailFromStripped(thumbs),\n    size: size.toJSNumber(),\n    isSpoiler,\n    ...(nosound && { noSound: true }),\n  };\n}\n\nfunction buildVideo(media: GramJs.TypeMessageMedia): ApiVideo | undefined {\n  if (\n    !(media instanceof GramJs.MessageMediaDocument)\n    || !(media.document instanceof GramJs.Document)\n    || !media.document.mimeType.startsWith('video')\n  ) {\n    return undefined;\n  }\n\n  return buildVideoFromDocument(media.document, media.spoiler);\n}\n\nfunction buildAltVideo(media: GramJs.TypeMessageMedia): ApiVideo | undefined {\n  if (\n    !(media instanceof GramJs.MessageMediaDocument)\n    || !(media.altDocument instanceof GramJs.Document)\n    || !media.altDocument.mimeType.startsWith('video')\n  ) {\n    return undefined;\n  }\n\n  return buildVideoFromDocument(media.altDocument, media.spoiler);\n}\n\nfunction buildAudio(media: GramJs.TypeMessageMedia): ApiAudio | undefined {\n  if (\n    !(media instanceof GramJs.MessageMediaDocument)\n    || !media.document\n    || !(media.document instanceof GramJs.Document)\n  ) {\n    return undefined;\n  }\n\n  const audioAttribute = media.document.attributes\n    .find((attr: any): attr is GramJs.DocumentAttributeAudio => (\n      attr instanceof GramJs.DocumentAttributeAudio\n    ));\n\n  if (!audioAttribute || audioAttribute.voice) {\n    return undefined;\n  }\n\n  const thumbnailSizes = media.document.thumbs && media.document.thumbs\n    .filter((thumb): thumb is GramJs.PhotoSize => thumb instanceof GramJs.PhotoSize)\n    .map((thumb) => buildApiPhotoSize(thumb));\n\n  return {\n    id: String(media.document.id),\n    fileName: getFilenameFromDocument(media.document, 'audio'),\n    thumbnailSizes,\n    size: media.document.size.toJSNumber(),\n    ...pick(media.document, ['mimeType']),\n    ...pick(audioAttribute, ['duration', 'performer', 'title']),\n  };\n}\n\nfunction isExpiredVoiceMessage(media: GramJs.TypeMessageMedia): MediaContent['isExpiredVoice'] {\n  if (!(media instanceof GramJs.MessageMediaDocument)) {\n    return false;\n  }\n  return !media.document && media.voice;\n}\n\nfunction isExpiredRoundVideoMessage(media: GramJs.TypeMessageMedia): MediaContent['isExpiredRoundVideo'] {\n  if (!(media instanceof GramJs.MessageMediaDocument)) {\n    return false;\n  }\n  return !media.document && media.round;\n}\n\nfunction buildVoice(media: GramJs.TypeMessageMedia): ApiVoice | undefined {\n  if (\n    !(media instanceof GramJs.MessageMediaDocument)\n    || !media.document\n    || !(media.document instanceof GramJs.Document)\n  ) {\n    return undefined;\n  }\n\n  const audioAttribute = media.document.attributes\n    .find((attr: any): attr is GramJs.DocumentAttributeAudio => (\n      attr instanceof GramJs.DocumentAttributeAudio\n    ));\n\n  if (!audioAttribute || !audioAttribute.voice) {\n    return undefined;\n  }\n\n  const { duration, waveform } = audioAttribute;\n\n  return {\n    id: String(media.document.id),\n    duration,\n    waveform: waveform ? Array.from(waveform) : undefined,\n  };\n}\n\nfunction buildDocumentFromMedia(media: GramJs.TypeMessageMedia) {\n  if (!(media instanceof GramJs.MessageMediaDocument) || !media.document) {\n    return undefined;\n  }\n\n  return buildApiDocument(media.document);\n}\n\nexport function buildApiDocument(document: GramJs.TypeDocument): ApiDocument | undefined {\n  if (!(document instanceof GramJs.Document)) {\n    return undefined;\n  }\n\n  const {\n    id, size, mimeType, date, thumbs, attributes,\n  } = document;\n\n  const photoSize = thumbs && thumbs.find((s: any): s is GramJs.PhotoSize => s instanceof GramJs.PhotoSize);\n  let thumbnail = thumbs && buildApiThumbnailFromStripped(thumbs);\n  if (!thumbnail && thumbs && photoSize) {\n    const photoPath = thumbs.find((s: any): s is GramJs.PhotoPathSize => s instanceof GramJs.PhotoPathSize);\n    if (photoPath) {\n      thumbnail = buildApiThumbnailFromPath(photoPath, photoSize);\n    }\n  }\n\n  let mediaType: ApiDocument['mediaType'] | undefined;\n  let mediaSize: ApiDocument['mediaSize'] | undefined;\n  if (photoSize) {\n    mediaSize = {\n      width: photoSize.w,\n      height: photoSize.h,\n    };\n\n    if (SUPPORTED_IMAGE_CONTENT_TYPES.has(mimeType)) {\n      mediaType = 'photo';\n\n      const imageAttribute = attributes\n        .find((a: any): a is GramJs.DocumentAttributeImageSize => a instanceof GramJs.DocumentAttributeImageSize);\n\n      if (imageAttribute) {\n        const { w: width, h: height } = imageAttribute;\n        mediaSize = {\n          width,\n          height,\n        };\n      }\n    } else if (SUPPORTED_VIDEO_CONTENT_TYPES.has(mimeType)) {\n      mediaType = 'video';\n      const videoAttribute = attributes\n        .find((a: any): a is GramJs.DocumentAttributeVideo => a instanceof GramJs.DocumentAttributeVideo);\n\n      if (videoAttribute) {\n        const { w: width, h: height } = videoAttribute;\n        mediaSize = {\n          width,\n          height,\n        };\n      }\n    }\n  }\n\n  return {\n    id: String(id),\n    size: size.toJSNumber(),\n    mimeType,\n    timestamp: date,\n    fileName: getFilenameFromDocument(document),\n    thumbnail,\n    mediaType,\n    mediaSize,\n  };\n}\n\nfunction buildContact(media: GramJs.TypeMessageMedia): ApiContact | undefined {\n  if (!(media instanceof GramJs.MessageMediaContact)) {\n    return undefined;\n  }\n\n  const {\n    firstName, lastName, phoneNumber, userId,\n  } = media;\n\n  return {\n    firstName, lastName, phoneNumber, userId: buildApiPeerId(userId, 'user'),\n  };\n}\n\nfunction buildPollFromMedia(media: GramJs.TypeMessageMedia): ApiPoll | undefined {\n  if (!(media instanceof GramJs.MessageMediaPoll)) {\n    return undefined;\n  }\n\n  return buildPoll(media.poll, media.results);\n}\n\nfunction buildInvoiceFromMedia(media: GramJs.TypeMessageMedia): ApiInvoice | undefined {\n  if (!(media instanceof GramJs.MessageMediaInvoice)) {\n    return undefined;\n  }\n\n  return buildInvoice(media);\n}\n\nfunction buildLocationFromMedia(media: GramJs.TypeMessageMedia): ApiLocation | undefined {\n  if (media instanceof GramJs.MessageMediaGeo) {\n    return buildGeo(media);\n  }\n\n  if (media instanceof GramJs.MessageMediaVenue) {\n    return buildVenue(media);\n  }\n\n  if (media instanceof GramJs.MessageMediaGeoLive) {\n    return buildGeoLive(media);\n  }\n\n  return undefined;\n}\n\nfunction buildGeo(media: GramJs.MessageMediaGeo): ApiLocation | undefined {\n  const point = buildGeoPoint(media.geo);\n  return point && { type: 'geo', geo: point };\n}\n\nfunction buildVenue(media: GramJs.MessageMediaVenue): ApiLocation | undefined {\n  const {\n    geo, title, provider, address, venueId, venueType,\n  } = media;\n  const point = buildGeoPoint(geo);\n  return point && {\n    type: 'venue',\n    geo: point,\n    title,\n    provider,\n    address,\n    venueId,\n    venueType,\n  };\n}\n\nfunction buildGeoLive(media: GramJs.MessageMediaGeoLive): ApiLocation | undefined {\n  const { geo, period, heading } = media;\n  const point = buildGeoPoint(geo);\n  return point && {\n    type: 'geoLive',\n    geo: point,\n    period,\n    heading,\n  };\n}\n\nexport function buildGeoPoint(geo: GramJs.TypeGeoPoint): ApiLocation['geo'] | undefined {\n  if (geo instanceof GramJs.GeoPointEmpty) return undefined;\n  const {\n    long, lat, accuracyRadius, accessHash,\n  } = geo;\n  return {\n    long,\n    lat,\n    accessHash: accessHash.toString(),\n    accuracyRadius,\n  };\n}\n\nfunction buildGameFromMedia(media: GramJs.TypeMessageMedia): ApiGame | undefined {\n  if (!(media instanceof GramJs.MessageMediaGame)) {\n    return undefined;\n  }\n\n  return buildGame(media);\n}\n\nfunction buildGame(media: GramJs.MessageMediaGame): ApiGame | undefined {\n  const {\n    id, accessHash, shortName, title, description, photo: apiPhoto, document: apiDocument,\n  } = media.game;\n\n  const photo = apiPhoto instanceof GramJs.Photo ? buildApiPhoto(apiPhoto) : undefined;\n  const document = apiDocument instanceof GramJs.Document ? buildApiDocument(apiDocument) : undefined;\n\n  return {\n    id: id.toString(),\n    accessHash: accessHash.toString(),\n    shortName,\n    title,\n    description,\n    photo,\n    document,\n  };\n}\n\nfunction buildGiweawayFromMedia(media: GramJs.TypeMessageMedia): ApiGiveaway | undefined {\n  if (!(media instanceof GramJs.MessageMediaGiveaway)) {\n    return undefined;\n  }\n\n  return buildGiveaway(media);\n}\n\nfunction buildGiveaway(media: GramJs.MessageMediaGiveaway): ApiGiveaway | undefined {\n  const {\n    channels, months, quantity, untilDate, countriesIso2, onlyNewSubscribers, prizeDescription,\n  } = media;\n\n  const channelIds = channels.map((channel) => buildApiPeerId(channel, 'channel'));\n\n  return {\n    channelIds,\n    months,\n    quantity,\n    untilDate,\n    countries: countriesIso2,\n    isOnlyForNewSubscribers: onlyNewSubscribers,\n    prizeDescription,\n  };\n}\n\nfunction buildGiweawayResultsFromMedia(media: GramJs.TypeMessageMedia): ApiGiveawayResults | undefined {\n  if (!(media instanceof GramJs.MessageMediaGiveawayResults)) {\n    return undefined;\n  }\n\n  return buildGiveawayResults(media);\n}\n\nfunction buildGiveawayResults(media: GramJs.MessageMediaGiveawayResults): ApiGiveawayResults | undefined {\n  const {\n    months, untilDate, onlyNewSubscribers, launchMsgId, unclaimedCount, winners, winnersCount,\n    additionalPeersCount, prizeDescription, refunded, channelId,\n  } = media;\n\n  const winnerIds = winners.map((winner) => buildApiPeerId(winner, 'user'));\n\n  return {\n    months,\n    untilDate,\n    isOnlyForNewSubscribers: onlyNewSubscribers,\n    launchMessageId: launchMsgId,\n    channelId: buildApiPeerId(channelId, 'channel'),\n    unclaimedCount,\n    additionalPeersCount,\n    isRefunded: refunded,\n    prizeDescription,\n    winnerIds,\n    winnersCount,\n  };\n}\n\nexport function buildMessageStoryData(media: GramJs.TypeMessageMedia): ApiMessageStoryData | undefined {\n  if (!(media instanceof GramJs.MessageMediaStory)) {\n    return undefined;\n  }\n\n  const peerId = getApiChatIdFromMtpPeer(media.peer);\n\n  return { id: media.id, peerId, ...(media.viaMention && { isMention: true }) };\n}\n\nexport function buildPoll(poll: GramJs.Poll, pollResults: GramJs.PollResults): ApiPoll {\n  const { id, answers: rawAnswers } = poll;\n  const answers = rawAnswers.map((answer) => ({\n    text: answer.text,\n    option: serializeBytes(answer.option),\n  }));\n\n  return {\n    id: String(id),\n    summary: {\n      isPublic: poll.publicVoters,\n      ...pick(poll, [\n        'closed',\n        'multipleChoice',\n        'quiz',\n        'question',\n        'closePeriod',\n        'closeDate',\n      ]),\n      answers,\n    },\n    results: buildPollResults(pollResults),\n  };\n}\n\nexport function buildInvoice(media: GramJs.MessageMediaInvoice): ApiInvoice {\n  const {\n    description: text, title, photo, test, totalAmount, currency, receiptMsgId, extendedMedia,\n  } = media;\n\n  const preview = extendedMedia instanceof GramJs.MessageExtendedMediaPreview\n    ? buildApiMessageExtendedMediaPreview(extendedMedia) : undefined;\n\n  return {\n    title,\n    text,\n    photo: buildApiWebDocument(photo),\n    receiptMsgId,\n    amount: Number(totalAmount),\n    currency,\n    isTest: test,\n    extendedMedia: preview,\n  };\n}\n\nexport function buildPollResults(pollResults: GramJs.PollResults): ApiPoll['results'] {\n  const {\n    results: rawResults, totalVoters, recentVoters, solution, solutionEntities: entities, min,\n  } = pollResults;\n  const results = rawResults?.map(({\n    option, chosen, correct, voters,\n  }) => ({\n    isChosen: chosen,\n    isCorrect: correct,\n    option: serializeBytes(option),\n    votersCount: voters,\n  }));\n\n  return {\n    isMin: min,\n    totalVoters,\n    recentVoterIds: recentVoters?.map((peer) => getApiChatIdFromMtpPeer(peer)),\n    results,\n    solution,\n    ...(entities && { solutionEntities: entities.map(buildApiMessageEntity) }),\n  };\n}\n\nexport function buildWebPage(media: GramJs.TypeMessageMedia): ApiWebPage | undefined {\n  if (\n    !(media instanceof GramJs.MessageMediaWebPage)\n    || !(media.webpage instanceof GramJs.WebPage)\n  ) {\n    return undefined;\n  }\n\n  const {\n    id, photo, document, attributes,\n  } = media.webpage;\n\n  let video;\n  if (document instanceof GramJs.Document && document.mimeType.startsWith('video/')) {\n    video = buildVideoFromDocument(document);\n  }\n  let story: ApiWebPageStoryData | undefined;\n  const attributeStory = attributes\n    ?.find((a: any): a is GramJs.WebPageAttributeStory => a instanceof GramJs.WebPageAttributeStory);\n  if (attributeStory) {\n    const peerId = getApiChatIdFromMtpPeer(attributeStory.peer);\n    story = {\n      id: attributeStory.id,\n      peerId,\n    };\n\n    if (attributeStory.story instanceof GramJs.StoryItem) {\n      addStoryToLocalDb(attributeStory.story, peerId);\n    }\n  }\n\n  return {\n    id: Number(id),\n    ...pick(media.webpage, [\n      'url',\n      'displayUrl',\n      'type',\n      'siteName',\n      'title',\n      'description',\n      'duration',\n    ]),\n    photo: photo instanceof GramJs.Photo ? buildApiPhoto(photo) : undefined,\n    document: !video && document ? buildApiDocument(document) : undefined,\n    video,\n    story,\n  };\n}\n\nfunction getFilenameFromDocument(document: GramJs.Document, defaultBase = 'file') {\n  const { mimeType, attributes } = document;\n  const filenameAttribute = attributes\n    .find((a: any): a is GramJs.DocumentAttributeFilename => a instanceof GramJs.DocumentAttributeFilename);\n\n  if (filenameAttribute) {\n    return filenameAttribute.fileName;\n  }\n\n  const extension = mimeType.split('/')[1];\n\n  return `${defaultBase}${String(document.id)}.${extension}`;\n}\n\nexport function buildApiMessageExtendedMediaPreview(\n  preview: GramJs.MessageExtendedMediaPreview,\n): ApiMessageExtendedMediaPreview {\n  const {\n    w, h, thumb, videoDuration,\n  } = preview;\n\n  return {\n    width: w,\n    height: h,\n    duration: videoDuration,\n    thumbnail: thumb ? buildApiThumbnailFromStripped([thumb]) : undefined,\n  };\n}\n\nexport function buildApiWebDocument(document?: GramJs.TypeWebDocument): ApiWebDocument | undefined {\n  if (!document) return undefined;\n\n  const {\n    url, size, mimeType,\n  } = document;\n  const accessHash = document instanceof GramJs.WebDocument ? document.accessHash.toString() : undefined;\n  const sizeAttr = document.attributes.find((attr): attr is GramJs.DocumentAttributeImageSize => (\n    attr instanceof GramJs.DocumentAttributeImageSize\n  ));\n  const dimensions = sizeAttr && { width: sizeAttr.w, height: sizeAttr.h };\n\n  return {\n    url,\n    accessHash,\n    size,\n    mimeType,\n    dimensions,\n  };\n}\n","import { Api as GramJs } from '../../../lib/gramjs';\n\nimport type {\n  ApiAttachBot,\n  ApiAttachBotIcon,\n  ApiAttachMenuPeerType,\n  ApiBotApp,\n  ApiBotCommand,\n  ApiBotInfo,\n  ApiBotInlineMediaResult,\n  ApiBotInlineResult,\n  ApiBotInlineSwitchPm,\n  ApiBotInlineSwitchWebview,\n  ApiBotMenuButton,\n  ApiInlineResultType,\n  ApiMessagesBotApp,\n} from '../../types';\n\nimport { pick } from '../../../util/iteratees';\nimport localDb from '../localDb';\nimport { buildApiPhoto, buildApiThumbnailFromStripped } from './common';\nimport { omitVirtualClassFields } from './helpers';\nimport { buildApiDocument, buildApiWebDocument, buildVideoFromDocument } from './messageContent';\nimport { buildApiPeerId } from './peers';\nimport { buildStickerFromDocument } from './symbols';\n\nexport function buildApiBotInlineResult(result: GramJs.BotInlineResult, queryId: string): ApiBotInlineResult {\n  const {\n    id, type, title, description, url, thumb,\n  } = result;\n\n  return {\n    id,\n    queryId,\n    type: type as ApiInlineResultType,\n    title,\n    description,\n    url,\n    webThumbnail: buildApiWebDocument(thumb),\n  };\n}\n\nexport function buildApiBotInlineMediaResult(\n  result: GramJs.BotInlineMediaResult, queryId: string,\n): ApiBotInlineMediaResult {\n  const {\n    id, type, title, description, photo, document,\n  } = result;\n\n  return {\n    id,\n    queryId,\n    type: type as ApiInlineResultType,\n    title,\n    description,\n    ...(type === 'sticker' && document instanceof GramJs.Document && { sticker: buildStickerFromDocument(document) }),\n    ...(photo instanceof GramJs.Photo && { photo: buildApiPhoto(photo) }),\n    ...(type === 'gif' && document instanceof GramJs.Document && { gif: buildVideoFromDocument(document) }),\n    ...(type === 'video' && document instanceof GramJs.Document && {\n      thumbnail: buildApiThumbnailFromStripped(document.thumbs),\n    }),\n  };\n}\n\nexport function buildBotSwitchPm(switchPm?: GramJs.InlineBotSwitchPM) {\n  return switchPm ? pick(switchPm, ['text', 'startParam']) as ApiBotInlineSwitchPm : undefined;\n}\n\nexport function buildBotSwitchWebview(switchWebview?: GramJs.InlineBotWebView) {\n  return switchWebview ? pick(switchWebview, ['text', 'url']) as ApiBotInlineSwitchWebview : undefined;\n}\n\nexport function buildApiAttachBot(bot: GramJs.AttachMenuBot): ApiAttachBot {\n  return {\n    id: bot.botId.toString(),\n    shouldRequestWriteAccess: bot.requestWriteAccess,\n    shortName: bot.shortName,\n    isForAttachMenu: bot.showInAttachMenu!,\n    isForSideMenu: bot.showInSideMenu,\n    attachMenuPeerTypes: bot.peerTypes?.map(buildApiAttachMenuPeerType)!,\n    icons: bot.icons.map(buildApiAttachMenuIcon).filter(Boolean),\n    isInactive: bot.inactive,\n    isDisclaimerNeeded: bot.sideMenuDisclaimerNeeded,\n  };\n}\n\nfunction buildApiAttachMenuPeerType(peerType: GramJs.TypeAttachMenuPeerType): ApiAttachMenuPeerType {\n  if (peerType instanceof GramJs.AttachMenuPeerTypeBotPM) return 'bots';\n  if (peerType instanceof GramJs.AttachMenuPeerTypePM) return 'users';\n  if (peerType instanceof GramJs.AttachMenuPeerTypeChat) return 'chats';\n  if (peerType instanceof GramJs.AttachMenuPeerTypeBroadcast) return 'channels';\n  if (peerType instanceof GramJs.AttachMenuPeerTypeSameBotPM) return 'self';\n  return undefined!; // Never reached\n}\n\nfunction buildApiAttachMenuIcon(icon: GramJs.AttachMenuBotIcon): ApiAttachBotIcon | undefined {\n  if (!(icon.icon instanceof GramJs.Document)) return undefined;\n\n  const document = buildApiDocument(icon.icon);\n\n  if (!document) return undefined;\n\n  localDb.documents[String(icon.icon.id)] = icon.icon;\n\n  return {\n    name: icon.name,\n    document,\n  };\n}\n\nexport function buildApiBotInfo(botInfo: GramJs.BotInfo, chatId: string): ApiBotInfo {\n  const {\n    description, descriptionPhoto, descriptionDocument, userId, commands, menuButton,\n  } = botInfo;\n\n  const botId = userId && buildApiPeerId(userId, 'user');\n  const photo = descriptionPhoto instanceof GramJs.Photo ? buildApiPhoto(descriptionPhoto) : undefined;\n  const gif = descriptionDocument instanceof GramJs.Document ? buildVideoFromDocument(descriptionDocument) : undefined;\n\n  const commandsArray = commands?.map((command) => buildApiBotCommand(botId || chatId, command));\n\n  return {\n    botId: botId || chatId,\n    description,\n    gif,\n    photo,\n    menuButton: buildApiBotMenuButton(menuButton),\n    commands: commandsArray?.length ? commandsArray : undefined,\n  };\n}\n\nfunction buildApiBotCommand(botId: string, command: GramJs.BotCommand): ApiBotCommand {\n  return {\n    botId,\n    ...omitVirtualClassFields(command),\n  };\n}\n\nexport function buildApiBotMenuButton(menuButton?: GramJs.TypeBotMenuButton): ApiBotMenuButton {\n  if (menuButton instanceof GramJs.BotMenuButton) {\n    return {\n      type: 'webApp',\n      text: menuButton.text,\n      url: menuButton.url,\n    };\n  }\n\n  return {\n    type: 'commands',\n  };\n}\n\nexport function buildApiBotApp(app: GramJs.TypeBotApp): ApiBotApp | undefined {\n  if (app instanceof GramJs.BotAppNotModified) return undefined;\n\n  const {\n    id, accessHash, title, description, shortName, photo, document,\n  } = app;\n\n  const apiPhoto = photo instanceof GramJs.Photo ? buildApiPhoto(photo) : undefined;\n  const apiDocument = document instanceof GramJs.Document ? buildApiDocument(document) : undefined;\n\n  return {\n    id: id.toString(),\n    accessHash: accessHash.toString(),\n    title,\n    description,\n    shortName,\n    photo: apiPhoto,\n    document: apiDocument,\n  };\n}\n\nexport function buildApiMessagesBotApp(botApp: GramJs.messages.BotApp): ApiMessagesBotApp | undefined {\n  const { app, inactive, requestWriteAccess } = botApp;\n  const baseApp = buildApiBotApp(app);\n  if (!baseApp) return undefined;\n\n  return {\n    ...baseApp,\n    isInactive: inactive,\n    shouldRequestWriteAccess: requestWriteAccess,\n  };\n}\n","import { Api as GramJs } from '../../../lib/gramjs';\n\nimport type {\n  ApiCallProtocol,\n  ApiPhoneCallConnection,\n  GroupCallParticipant,\n  GroupCallParticipantVideo,\n  SsrcGroup,\n} from '../../../lib/secret-sauce';\nimport type { ApiGroupCall, ApiPhoneCall } from '../../types';\n\nimport { getApiChatIdFromMtpPeer, isPeerUser } from './peers';\n\nexport function buildApiGroupCallParticipant(participant: GramJs.GroupCallParticipant): GroupCallParticipant {\n  const {\n    self, min, about, date, versioned, canSelfUnmute, justJoined, left, muted, mutedByYou, source, volume,\n    volumeByAdmin, videoJoined, peer, video, presentation, raiseHandRating,\n  } = participant;\n\n  return {\n    isSelf: self,\n    isMin: min,\n    canSelfUnmute,\n    isLeft: left,\n    isMuted: muted,\n    isMutedByMe: mutedByYou,\n    hasJustJoined: justJoined,\n    isVolumeByAdmin: volumeByAdmin,\n    isVersioned: versioned,\n    isVideoJoined: videoJoined,\n    about,\n    source,\n    raiseHandRating: raiseHandRating?.toString(),\n    volume,\n    date: new Date(date),\n    isUser: isPeerUser(peer),\n    id: getApiChatIdFromMtpPeer(peer),\n    video: video ? buildApiGroupCallParticipantVideo(video) : undefined,\n    presentation: presentation ? buildApiGroupCallParticipantVideo(presentation) : undefined,\n  };\n}\n\nfunction buildApiGroupCallParticipantVideo(\n  participantVideo: GramJs.GroupCallParticipantVideo,\n): GroupCallParticipantVideo {\n  const {\n    audioSource, endpoint, paused, sourceGroups,\n  } = participantVideo;\n  return {\n    audioSource,\n    endpoint,\n    isPaused: paused,\n    sourceGroups: sourceGroups.map(buildApiGroupCallParticipantVideoSourceGroup),\n  };\n}\n\nfunction buildApiGroupCallParticipantVideoSourceGroup(\n  participantVideoSourceGroup: GramJs.GroupCallParticipantVideoSourceGroup,\n): SsrcGroup {\n  return {\n    semantics: participantVideoSourceGroup.semantics,\n    sources: participantVideoSourceGroup.sources,\n  };\n}\n\nexport function buildApiGroupCall(groupCall: GramJs.TypeGroupCall): ApiGroupCall {\n  const {\n    id, accessHash,\n  } = groupCall;\n\n  if (groupCall instanceof GramJs.GroupCallDiscarded) {\n    return {\n      connectionState: 'discarded',\n      id: id.toString(),\n      accessHash: accessHash.toString(),\n      participantsCount: 0,\n      version: 0,\n      participants: {},\n    };\n  }\n\n  const {\n    version, participantsCount, streamDcId, scheduleDate, canChangeJoinMuted, joinMuted, canStartVideo,\n    scheduleStartSubscribed,\n  } = groupCall;\n\n  return {\n    connectionState: 'disconnected',\n    isLoaded: true,\n    id: id.toString(),\n    accessHash: accessHash.toString(),\n    version,\n    participantsCount,\n    streamDcId,\n    scheduleDate,\n    canChangeJoinMuted,\n    joinMuted,\n    canStartVideo,\n    scheduleStartSubscribed,\n    participants: {},\n  };\n}\n\nexport function getGroupCallId(groupCall: GramJs.TypeInputGroupCall) {\n  return groupCall.id.toString();\n}\n\nexport function buildPhoneCall(call: GramJs.TypePhoneCall): ApiPhoneCall {\n  const { id } = call;\n\n  let phoneCall: ApiPhoneCall = {\n    id: id.toString(),\n  };\n\n  if (call instanceof GramJs.PhoneCallAccepted\n    || call instanceof GramJs.PhoneCallWaiting\n    || call instanceof GramJs.PhoneCall\n    || call instanceof GramJs.PhoneCallRequested) {\n    const {\n      accessHash, adminId, date, video, participantId, protocol,\n    } = call;\n\n    phoneCall = {\n      ...phoneCall,\n      accessHash: accessHash.toString(),\n      adminId: adminId.toString(),\n      participantId: participantId.toString(),\n      date,\n      isVideo: video,\n      protocol: buildApiCallProtocol(protocol),\n    };\n  }\n\n  if (call instanceof GramJs.PhoneCall) {\n    const {\n      p2pAllowed, gAOrB, keyFingerprint, connections, startDate,\n    } = call;\n\n    phoneCall = {\n      ...phoneCall,\n      state: 'active',\n      gAOrB: Array.from(gAOrB),\n      keyFingerprint: keyFingerprint.toString(),\n      startDate,\n      isP2pAllowed: Boolean(p2pAllowed),\n      connections: connections.map(buildApiCallConnection).filter(Boolean) as ApiPhoneCallConnection[],\n    };\n  }\n\n  if (call instanceof GramJs.PhoneCallDiscarded) {\n    phoneCall = {\n      ...phoneCall,\n      state: 'discarded',\n      duration: call.duration,\n      reason: buildApiCallDiscardReason(call.reason),\n      needRating: call.needRating,\n      needDebug: call.needDebug,\n    };\n  }\n\n  if (call instanceof GramJs.PhoneCallWaiting) {\n    phoneCall = {\n      ...phoneCall,\n      state: 'waiting',\n      receiveDate: call.receiveDate,\n    };\n  }\n\n  if (call instanceof GramJs.PhoneCallAccepted) {\n    phoneCall = {\n      ...phoneCall,\n      state: 'accepted',\n      gB: Array.from(call.gB),\n    };\n  }\n\n  if (call instanceof GramJs.PhoneCallRequested) {\n    phoneCall = {\n      ...phoneCall,\n      state: 'requested',\n      gAHash: Array.from(call.gAHash),\n    };\n  }\n\n  return phoneCall;\n}\n\nexport function buildApiCallDiscardReason(discardReason?: GramJs.TypePhoneCallDiscardReason) {\n  if (discardReason instanceof GramJs.PhoneCallDiscardReasonMissed) {\n    return 'missed';\n  } else if (discardReason instanceof GramJs.PhoneCallDiscardReasonBusy) {\n    return 'busy';\n  } else if (discardReason instanceof GramJs.PhoneCallDiscardReasonHangup) {\n    return 'hangup';\n  } else {\n    return 'disconnect';\n  }\n}\n\nfunction buildApiCallConnection(connection: GramJs.TypePhoneConnection): ApiPhoneCallConnection | undefined {\n  if (connection instanceof GramJs.PhoneConnectionWebrtc) {\n    const {\n      username, password, turn, stun, ip, ipv6, port,\n    } = connection;\n\n    return {\n      username,\n      password,\n      isTurn: turn,\n      isStun: stun,\n      ip,\n      ipv6,\n      port,\n    };\n  } else {\n    return undefined;\n  }\n}\n\nexport function buildApiCallProtocol(protocol: GramJs.PhoneCallProtocol): ApiCallProtocol {\n  const {\n    libraryVersions, minLayer, maxLayer, udpP2p, udpReflector,\n  } = protocol;\n\n  return {\n    libraryVersions,\n    minLayer,\n    maxLayer,\n    isUdpP2p: udpP2p,\n    isUdpReflector: udpReflector,\n  };\n}\n\nexport function buildCallProtocol() {\n  return new GramJs.PhoneCallProtocol({\n    libraryVersions: ['4.0.0'],\n    minLayer: 92,\n    maxLayer: 92,\n    udpReflector: true,\n    udpP2p: true,\n  });\n}\n","import { Api as GramJs } from '../../../lib/gramjs';\n\nimport type {\n  ApiAvailableReaction,\n  ApiPeerReaction,\n  ApiReaction,\n  ApiReactionCount,\n  ApiReactionEmoji,\n  ApiReactions,\n  ApiSavedReactionTag,\n} from '../../types';\n\nimport { buildApiDocument } from './messageContent';\nimport { getApiChatIdFromMtpPeer } from './peers';\n\nexport function buildMessageReactions(reactions: GramJs.MessageReactions): ApiReactions {\n  const {\n    recentReactions, results, canSeeList, reactionsAsTags,\n  } = reactions;\n\n  return {\n    areTags: reactionsAsTags,\n    canSeeList,\n    results: results.map(buildReactionCount).filter(Boolean).sort(reactionCountComparator),\n    recentReactions: recentReactions?.map(buildMessagePeerReaction).filter(Boolean),\n  };\n}\n\nfunction reactionCountComparator(a: ApiReactionCount, b: ApiReactionCount) {\n  const diff = b.count - a.count;\n  if (diff) return diff;\n  if (a.chosenOrder !== undefined && b.chosenOrder !== undefined) {\n    return a.chosenOrder - b.chosenOrder;\n  }\n  if (a.chosenOrder !== undefined) return 1;\n  if (b.chosenOrder !== undefined) return -1;\n  return 0;\n}\n\nexport function buildReactionCount(reactionCount: GramJs.ReactionCount): ApiReactionCount | undefined {\n  const { chosenOrder, count, reaction } = reactionCount;\n\n  const apiReaction = buildApiReaction(reaction);\n  if (!apiReaction) return undefined;\n\n  return {\n    chosenOrder,\n    count,\n    reaction: apiReaction,\n  };\n}\n\nexport function buildMessagePeerReaction(userReaction: GramJs.MessagePeerReaction): ApiPeerReaction | undefined {\n  const {\n    peerId, reaction, big, unread, date, my,\n  } = userReaction;\n\n  const apiReaction = buildApiReaction(reaction);\n  if (!apiReaction) return undefined;\n\n  return {\n    peerId: getApiChatIdFromMtpPeer(peerId),\n    reaction: apiReaction,\n    addedDate: date,\n    isUnread: unread,\n    isBig: big,\n    isOwn: my,\n  };\n}\n\nexport function buildApiReaction(reaction: GramJs.TypeReaction): ApiReaction | undefined {\n  if (reaction instanceof GramJs.ReactionEmoji) {\n    return {\n      emoticon: reaction.emoticon,\n    };\n  }\n\n  if (reaction instanceof GramJs.ReactionCustomEmoji) {\n    return {\n      documentId: reaction.documentId.toString(),\n    };\n  }\n\n  return undefined;\n}\n\nexport function buildApiSavedReactionTag(tag: GramJs.SavedReactionTag): ApiSavedReactionTag | undefined {\n  const { reaction, title, count } = tag;\n  const apiReaction = buildApiReaction(reaction);\n  if (!apiReaction) return undefined;\n\n  return {\n    reaction: apiReaction,\n    title,\n    count,\n  };\n}\n\nexport function buildApiAvailableReaction(availableReaction: GramJs.AvailableReaction): ApiAvailableReaction {\n  const {\n    selectAnimation, staticIcon, reaction, title, appearAnimation,\n    inactive, aroundAnimation, centerIcon, effectAnimation, activateAnimation,\n    premium,\n  } = availableReaction;\n\n  return {\n    selectAnimation: buildApiDocument(selectAnimation),\n    appearAnimation: buildApiDocument(appearAnimation),\n    activateAnimation: buildApiDocument(activateAnimation),\n    effectAnimation: buildApiDocument(effectAnimation),\n    staticIcon: buildApiDocument(staticIcon),\n    aroundAnimation: aroundAnimation ? buildApiDocument(aroundAnimation) : undefined,\n    centerIcon: centerIcon ? buildApiDocument(centerIcon) : undefined,\n    reaction: { emoticon: reaction } as ApiReactionEmoji,\n    title,\n    isInactive: inactive,\n    isPremium: premium,\n  };\n}\n","import type BigInt from 'big-integer';\nimport { Api as GramJs } from '../../../lib/gramjs';\n\nimport type {\n  ApiBotCommand,\n  ApiChat,\n  ApiChatAdminRights,\n  ApiChatBannedRights,\n  ApiChatFolder,\n  ApiChatInviteImporter,\n  ApiChatlistExportedInvite,\n  ApiChatlistInvite,\n  ApiChatMember,\n  ApiChatReactions,\n  ApiChatSettings,\n  ApiExportedInvite,\n  ApiRestrictionReason,\n  ApiSendAsPeerId,\n  ApiTopic,\n} from '../../types';\n\nimport { omitUndefined, pick, pickTruthy } from '../../../util/iteratees';\nimport { getServerTime, getServerTimeOffset } from '../../../util/serverTime';\nimport { buildApiUsernames } from './common';\nimport { omitVirtualClassFields } from './helpers';\nimport {\n  buildApiEmojiStatus,\n  buildApiPeerColor,\n  buildApiPeerId,\n  getApiChatIdFromMtpPeer,\n  isPeerChat,\n  isPeerUser,\n} from './peers';\nimport { buildApiReaction } from './reactions';\n\ntype PeerEntityApiChatFields = Omit<ApiChat, (\n  'id' | 'type' | 'title' |\n  'lastReadOutboxMessageId' | 'lastReadInboxMessageId' |\n  'unreadCount' | 'unreadMentionsCount' | 'isMuted'\n)>;\n\nfunction buildApiChatFieldsFromPeerEntity(\n  peerEntity: GramJs.TypeUser | GramJs.TypeChat,\n  isSupport = false,\n): PeerEntityApiChatFields {\n  const isMin = Boolean('min' in peerEntity && peerEntity.min);\n  const accessHash = ('accessHash' in peerEntity) ? String(peerEntity.accessHash) : undefined;\n  const hasVideoAvatar = 'photo' in peerEntity && peerEntity.photo && 'hasVideo' in peerEntity.photo\n    && peerEntity.photo.hasVideo;\n  const avatarHash = ('photo' in peerEntity) && peerEntity.photo ? buildAvatarHash(peerEntity.photo) : undefined;\n  const isSignaturesShown = Boolean('signatures' in peerEntity && peerEntity.signatures);\n  const hasPrivateLink = Boolean('hasLink' in peerEntity && peerEntity.hasLink);\n  const isScam = Boolean('scam' in peerEntity && peerEntity.scam);\n  const isFake = Boolean('fake' in peerEntity && peerEntity.fake);\n  const isJoinToSend = Boolean('joinToSend' in peerEntity && peerEntity.joinToSend);\n  const isJoinRequest = Boolean('joinRequest' in peerEntity && peerEntity.joinRequest);\n  const usernames = buildApiUsernames(peerEntity);\n  const isForum = Boolean('forum' in peerEntity && peerEntity.forum);\n  const areStoriesHidden = Boolean('storiesHidden' in peerEntity && peerEntity.storiesHidden);\n  const maxStoryId = 'storiesMaxId' in peerEntity ? peerEntity.storiesMaxId : undefined;\n  const storiesUnavailable = Boolean('storiesUnavailable' in peerEntity && peerEntity.storiesUnavailable);\n  const color = ('color' in peerEntity && peerEntity.color) ? buildApiPeerColor(peerEntity.color) : undefined;\n  const emojiStatus = ('emojiStatus' in peerEntity && peerEntity.emojiStatus)\n    ? buildApiEmojiStatus(peerEntity.emojiStatus) : undefined;\n\n  return omitUndefined({\n    isMin,\n    hasPrivateLink,\n    isSignaturesShown,\n    usernames,\n    accessHash,\n    hasVideoAvatar,\n    avatarHash,\n    ...('verified' in peerEntity && { isVerified: peerEntity.verified }),\n    ...('callActive' in peerEntity && { isCallActive: peerEntity.callActive }),\n    ...('callNotEmpty' in peerEntity && { isCallNotEmpty: peerEntity.callNotEmpty }),\n    ...('date' in peerEntity && { creationDate: peerEntity.date }),\n    ...('participantsCount' in peerEntity && peerEntity.participantsCount !== undefined && {\n      membersCount: peerEntity.participantsCount,\n    }),\n    ...('noforwards' in peerEntity && { isProtected: Boolean(peerEntity.noforwards) }),\n    isSupport: isSupport || undefined,\n    ...buildApiChatPermissions(peerEntity),\n    ...('creator' in peerEntity && { isCreator: peerEntity.creator }),\n    ...buildApiChatRestrictions(peerEntity),\n    ...buildApiChatMigrationInfo(peerEntity),\n    fakeType: isScam ? 'scam' : (isFake ? 'fake' : undefined),\n    color,\n    isJoinToSend,\n    isJoinRequest,\n    isForum,\n    areStoriesHidden,\n    maxStoryId,\n    hasStories: Boolean(maxStoryId) && !storiesUnavailable,\n    emojiStatus,\n  });\n}\n\nexport function buildApiChatFromDialog(\n  dialog: GramJs.Dialog,\n  peerEntity: GramJs.TypeUser | GramJs.TypeChat,\n): ApiChat {\n  const {\n    peer, folderId, unreadMark, unreadCount, unreadMentionsCount, unreadReactionsCount,\n    notifySettings: { silent, muteUntil },\n    readOutboxMaxId, readInboxMaxId, draft, viewForumAsMessages,\n  } = dialog;\n  const isMuted = silent || (typeof muteUntil === 'number' && getServerTime() < muteUntil);\n\n  return {\n    id: getApiChatIdFromMtpPeer(peer),\n    ...(folderId && { folderId }),\n    type: getApiChatTypeFromPeerEntity(peerEntity),\n    title: getApiChatTitleFromMtpPeer(peer, peerEntity),\n    lastReadOutboxMessageId: readOutboxMaxId,\n    lastReadInboxMessageId: readInboxMaxId,\n    unreadCount,\n    unreadMentionsCount,\n    unreadReactionsCount,\n    isMuted,\n    muteUntil,\n    ...(unreadMark && { hasUnreadMark: true }),\n    ...(draft instanceof GramJs.DraftMessage && { draftDate: draft.date }),\n    ...(viewForumAsMessages && { isForumAsMessages: true }),\n    ...buildApiChatFieldsFromPeerEntity(peerEntity),\n  };\n}\n\nexport function buildApiChatFromSavedDialog(\n  dialog: GramJs.SavedDialog,\n  peerEntity: GramJs.TypeUser | GramJs.TypeChat,\n): ApiChat {\n  const { peer } = dialog;\n\n  return {\n    id: getApiChatIdFromMtpPeer(peer),\n    type: getApiChatTypeFromPeerEntity(peerEntity),\n    title: getApiChatTitleFromMtpPeer(peer, peerEntity),\n    ...buildApiChatFieldsFromPeerEntity(peerEntity),\n  };\n}\n\nfunction buildApiChatPermissions(peerEntity: GramJs.TypeUser | GramJs.TypeChat): {\n  adminRights?: ApiChatAdminRights;\n  currentUserBannedRights?: ApiChatBannedRights;\n  defaultBannedRights?: ApiChatBannedRights;\n} {\n  if (!(peerEntity instanceof GramJs.Chat || peerEntity instanceof GramJs.Channel)) {\n    return {};\n  }\n\n  return {\n    adminRights: peerEntity.adminRights ? omitVirtualClassFields(peerEntity.adminRights) : undefined,\n    currentUserBannedRights: 'bannedRights' in peerEntity && peerEntity.bannedRights\n      ? omitVirtualClassFields(peerEntity.bannedRights)\n      : undefined,\n    defaultBannedRights: peerEntity.defaultBannedRights\n      ? omitVirtualClassFields(peerEntity.defaultBannedRights)\n      : undefined,\n  };\n}\n\nfunction buildApiChatRestrictions(peerEntity: GramJs.TypeUser | GramJs.TypeChat): {\n  isNotJoined?: boolean;\n  isForbidden?: boolean;\n  isRestricted?: boolean;\n  restrictionReason?: ApiRestrictionReason;\n} {\n  if (peerEntity instanceof GramJs.ChatForbidden) {\n    return {\n      isForbidden: true,\n    };\n  }\n\n  if (peerEntity instanceof GramJs.ChannelForbidden) {\n    return {\n      isRestricted: true,\n    };\n  }\n\n  const restrictions = {};\n\n  if ('restricted' in peerEntity) {\n    const restrictionReason = peerEntity.restricted\n      ? buildApiChatRestrictionReason(peerEntity.restrictionReason)\n      : undefined;\n\n    if (restrictionReason) {\n      Object.assign(restrictions, {\n        isRestricted: true,\n        restrictionReason,\n      });\n    }\n  }\n\n  if (peerEntity instanceof GramJs.Chat) {\n    Object.assign(restrictions, {\n      isNotJoined: peerEntity.left,\n    });\n  }\n\n  if (peerEntity instanceof GramJs.Channel) {\n    Object.assign(restrictions, {\n      // `left` is weirdly set to `true` on all channels never joined before\n      isNotJoined: peerEntity.left,\n    });\n  }\n\n  return restrictions;\n}\n\nfunction buildApiChatMigrationInfo(peerEntity: GramJs.TypeChat): {\n  migratedTo?: {\n    chatId: string;\n    accessHash?: string;\n  };\n} {\n  if (\n    'migratedTo' in peerEntity\n    && peerEntity.migratedTo\n    && !(peerEntity.migratedTo instanceof GramJs.InputChannelEmpty)\n  ) {\n    return {\n      migratedTo: {\n        chatId: getApiChatIdFromMtpPeer(peerEntity.migratedTo),\n        ...(peerEntity.migratedTo instanceof GramJs.InputChannel && {\n          accessHash: String(peerEntity.migratedTo.accessHash),\n        }),\n      },\n    };\n  }\n\n  return {};\n}\n\nfunction buildApiChatRestrictionReason(\n  restrictionReasons?: GramJs.RestrictionReason[],\n): ApiRestrictionReason | undefined {\n  if (!restrictionReasons) {\n    return undefined;\n  }\n\n  const targetReason = restrictionReasons.find(({ platform }) => platform === 'all');\n  return targetReason ? pick(targetReason, ['reason', 'text']) : undefined;\n}\n\nexport function buildApiChatFromPreview(\n  preview: GramJs.TypeChat | GramJs.TypeUser,\n  isSupport = false,\n): ApiChat | undefined {\n  if (preview instanceof GramJs.ChatEmpty || preview instanceof GramJs.UserEmpty) {\n    return undefined;\n  }\n  const id = buildApiPeerId(\n    preview.id,\n    preview instanceof GramJs.User ? 'user'\n      : (preview instanceof GramJs.Chat || preview instanceof GramJs.ChatForbidden) ? 'chat' : 'channel',\n  );\n\n  return {\n    id,\n    type: getApiChatTypeFromPeerEntity(preview),\n    title: preview instanceof GramJs.User ? getUserName(preview) : preview.title,\n    ...buildApiChatFieldsFromPeerEntity(preview, isSupport),\n  };\n}\n\nexport function getApiChatTypeFromPeerEntity(peerEntity: GramJs.TypeChat | GramJs.TypeUser) {\n  if (peerEntity instanceof GramJs.User || peerEntity instanceof GramJs.UserEmpty) {\n    return 'chatTypePrivate';\n  } else if (\n    peerEntity instanceof GramJs.Chat\n    || peerEntity instanceof GramJs.ChatForbidden\n    || peerEntity instanceof GramJs.ChatEmpty\n  ) {\n    return 'chatTypeBasicGroup';\n  } else {\n    return peerEntity.megagroup ? 'chatTypeSuperGroup' : 'chatTypeChannel';\n  }\n}\n\nexport function getPeerKey(peer: GramJs.TypePeer) {\n  if (isPeerUser(peer)) {\n    return `user${peer.userId}`;\n  } else if (isPeerChat(peer)) {\n    return `chat${peer.chatId}`;\n  } else {\n    return `chat${peer.channelId}`;\n  }\n}\n\nexport function getApiChatTitleFromMtpPeer(peer: GramJs.TypePeer, peerEntity: GramJs.User | GramJs.Chat) {\n  if (isPeerUser(peer)) {\n    return getUserName(peerEntity as GramJs.User);\n  } else {\n    return (peerEntity as GramJs.Chat).title;\n  }\n}\n\nfunction getUserName(user: GramJs.User) {\n  return user.firstName\n    ? `${user.firstName}${user.lastName ? ` ${user.lastName}` : ''}`\n    : (user.lastName || '');\n}\n\nexport function buildAvatarHash(photo: GramJs.TypeUserProfilePhoto | GramJs.TypeChatPhoto) {\n  if ('photoId' in photo) {\n    return String(photo.photoId);\n  }\n\n  return undefined;\n}\n\nexport function buildChatMember(\n  member: GramJs.TypeChatParticipant | GramJs.TypeChannelParticipant,\n): ApiChatMember | undefined {\n  const userId = (member instanceof GramJs.ChannelParticipantBanned || member instanceof GramJs.ChannelParticipantLeft)\n    ? getApiChatIdFromMtpPeer(member.peer)\n    : buildApiPeerId(member.userId, 'user');\n\n  return {\n    userId,\n    inviterId: 'inviterId' in member && member.inviterId\n      ? buildApiPeerId(member.inviterId as BigInt.BigInteger, 'user')\n      : undefined,\n    joinedDate: 'date' in member ? member.date : undefined,\n    kickedByUserId: 'kickedBy' in member && member.kickedBy ? buildApiPeerId(member.kickedBy, 'user') : undefined,\n    promotedByUserId: 'promotedBy' in member && member.promotedBy\n      ? buildApiPeerId(member.promotedBy, 'user')\n      : undefined,\n    bannedRights: 'bannedRights' in member ? omitVirtualClassFields(member.bannedRights) : undefined,\n    adminRights: 'adminRights' in member ? omitVirtualClassFields(member.adminRights) : undefined,\n    customTitle: 'rank' in member ? member.rank : undefined,\n    ...((member instanceof GramJs.ChannelParticipantAdmin || member instanceof GramJs.ChatParticipantAdmin) && {\n      isAdmin: true,\n    }),\n    ...((member instanceof GramJs.ChannelParticipantCreator || member instanceof GramJs.ChatParticipantCreator) && {\n      isOwner: true,\n    }),\n  };\n}\n\nexport function buildChatMembers(\n  participants: GramJs.TypeChatParticipants | GramJs.channels.ChannelParticipants,\n) {\n  // Duplicate code because of TS union-type shenanigans\n  if (participants instanceof GramJs.ChatParticipants) {\n    return participants.participants.map(buildChatMember).filter(Boolean);\n  }\n  if (participants instanceof GramJs.channels.ChannelParticipants) {\n    return participants.participants.map(buildChatMember).filter(Boolean);\n  }\n\n  return undefined;\n}\n\nexport function buildChatTypingStatus(\n  update: GramJs.UpdateUserTyping | GramJs.UpdateChatUserTyping | GramJs.UpdateChannelUserTyping,\n) {\n  let action: string = '';\n  let emoticon: string | undefined;\n  if (update.action instanceof GramJs.SendMessageCancelAction) {\n    return undefined;\n  } else if (update.action instanceof GramJs.SendMessageTypingAction) {\n    action = 'lng_user_typing';\n  } else if (update.action instanceof GramJs.SendMessageRecordVideoAction) {\n    action = 'lng_send_action_record_video';\n  } else if (update.action instanceof GramJs.SendMessageUploadVideoAction) {\n    action = 'lng_send_action_upload_video';\n  } else if (update.action instanceof GramJs.SendMessageRecordAudioAction) {\n    action = 'lng_send_action_record_audio';\n  } else if (update.action instanceof GramJs.SendMessageUploadAudioAction) {\n    action = 'lng_send_action_upload_audio';\n  } else if (update.action instanceof GramJs.SendMessageUploadPhotoAction) {\n    action = 'lng_send_action_upload_photo';\n  } else if (update.action instanceof GramJs.SendMessageUploadDocumentAction) {\n    action = 'lng_send_action_upload_file';\n  } else if (update.action instanceof GramJs.SendMessageGeoLocationAction) {\n    action = 'selecting a location to share';\n  } else if (update.action instanceof GramJs.SendMessageChooseContactAction) {\n    action = 'selecting a contact to share';\n  } else if (update.action instanceof GramJs.SendMessageGamePlayAction) {\n    action = 'lng_playing_game';\n  } else if (update.action instanceof GramJs.SendMessageRecordRoundAction) {\n    action = 'lng_send_action_record_round';\n  } else if (update.action instanceof GramJs.SendMessageUploadRoundAction) {\n    action = 'lng_send_action_upload_round';\n  } else if (update.action instanceof GramJs.SendMessageChooseStickerAction) {\n    action = 'lng_send_action_choose_sticker';\n  } else if (update.action instanceof GramJs.SpeakingInGroupCallAction) {\n    return undefined;\n  } else if (update.action instanceof GramJs.SendMessageEmojiInteractionSeen) {\n    action = 'lng_user_action_watching_animations';\n    emoticon = update.action.emoticon;\n  } else if (update.action instanceof GramJs.SendMessageEmojiInteraction) {\n    return undefined;\n  }\n\n  return {\n    action,\n    ...(emoticon && { emoji: emoticon }),\n    ...(!(update instanceof GramJs.UpdateUserTyping) && { userId: getApiChatIdFromMtpPeer(update.fromId) }),\n    timestamp: Date.now() + getServerTimeOffset() * 1000,\n  };\n}\n\nexport function buildApiChatFolder(filter: GramJs.DialogFilter | GramJs.DialogFilterChatlist): ApiChatFolder {\n  if (filter instanceof GramJs.DialogFilterChatlist) {\n    return {\n      ...pickTruthy(filter, [\n        'id', 'title', 'emoticon',\n      ]),\n      excludedChatIds: [],\n      includedChatIds: filter.includePeers.map(getApiChatIdFromMtpPeer).filter(Boolean),\n      pinnedChatIds: filter.pinnedPeers.map(getApiChatIdFromMtpPeer).filter(Boolean),\n      hasMyInvites: filter.hasMyInvites,\n      isChatList: true,\n    };\n  }\n\n  return {\n    ...pickTruthy(filter, [\n      'id', 'title', 'emoticon', 'contacts', 'nonContacts', 'groups', 'bots',\n      'excludeMuted', 'excludeRead', 'excludeArchived',\n    ]),\n    channels: filter.broadcasts,\n    pinnedChatIds: filter.pinnedPeers.map(getApiChatIdFromMtpPeer).filter(Boolean),\n    includedChatIds: filter.includePeers.map(getApiChatIdFromMtpPeer).filter(Boolean),\n    excludedChatIds: filter.excludePeers.map(getApiChatIdFromMtpPeer).filter(Boolean),\n  };\n}\n\nexport function buildApiChatFolderFromSuggested({\n  filter, description,\n}: {\n  filter: GramJs.TypeDialogFilter;\n  description: string;\n}): ApiChatFolder | undefined {\n  if (!(filter instanceof GramJs.DialogFilter || filter instanceof GramJs.DialogFilterChatlist)) return undefined;\n  return {\n    ...buildApiChatFolder(filter),\n    description,\n  };\n}\n\nexport function buildApiChatBotCommands(botInfos: GramJs.BotInfo[]) {\n  return botInfos.reduce((botCommands, botInfo) => {\n    const botId = buildApiPeerId(botInfo.userId!, 'user');\n\n    if (botInfo.commands) {\n      botCommands = botCommands.concat(botInfo.commands.map((mtpCommand) => ({\n        botId,\n        ...omitVirtualClassFields(mtpCommand),\n      })));\n    }\n\n    return botCommands;\n  }, [] as ApiBotCommand[]);\n}\n\nexport function buildApiExportedInvite(invite: GramJs.ChatInviteExported): ApiExportedInvite {\n  const {\n    revoked,\n    date,\n    expireDate,\n    link,\n    permanent,\n    startDate,\n    usage,\n    usageLimit,\n    requested,\n    requestNeeded,\n    title,\n    adminId,\n  } = invite;\n  return {\n    isRevoked: revoked,\n    date,\n    expireDate,\n    link,\n    isPermanent: permanent,\n    startDate,\n    usage,\n    usageLimit,\n    isRequestNeeded: requestNeeded,\n    requested,\n    title,\n    adminId: buildApiPeerId(adminId, 'user'),\n  };\n}\n\nexport function buildChatInviteImporter(importer: GramJs.ChatInviteImporter): ApiChatInviteImporter {\n  const {\n    userId,\n    date,\n    about,\n    requested,\n    viaChatlist,\n  } = importer;\n  return {\n    userId: buildApiPeerId(userId, 'user'),\n    date,\n    about,\n    isRequested: requested,\n    isFromChatList: viaChatlist,\n  };\n}\n\nexport function buildApiChatSettings({\n  autoarchived,\n  reportSpam,\n  addContact,\n  blockContact,\n}: GramJs.PeerSettings): ApiChatSettings {\n  return {\n    isAutoArchived: Boolean(autoarchived),\n    canReportSpam: Boolean(reportSpam),\n    canAddContact: Boolean(addContact),\n    canBlockContact: Boolean(blockContact),\n  };\n}\n\nexport function buildApiChatReactions(chatReactions?: GramJs.TypeChatReactions): ApiChatReactions | undefined {\n  if (chatReactions instanceof GramJs.ChatReactionsAll) {\n    return {\n      type: 'all',\n      areCustomAllowed: chatReactions.allowCustom,\n    };\n  }\n  if (chatReactions instanceof GramJs.ChatReactionsSome) {\n    return {\n      type: 'some',\n      allowed: chatReactions.reactions.map(buildApiReaction).filter(Boolean),\n    };\n  }\n\n  return undefined;\n}\n\nexport function buildApiSendAsPeerId(sendAs: GramJs.SendAsPeer): ApiSendAsPeerId {\n  return {\n    id: getApiChatIdFromMtpPeer(sendAs.peer),\n    isPremium: sendAs.premiumRequired,\n  };\n}\n\nexport function buildApiTopic(forumTopic: GramJs.TypeForumTopic): ApiTopic | undefined {\n  if (forumTopic instanceof GramJs.ForumTopicDeleted) {\n    return undefined;\n  }\n\n  const {\n    id,\n    my,\n    closed,\n    pinned,\n    hidden,\n    short,\n    date,\n    title,\n    iconColor,\n    iconEmojiId,\n    topMessage,\n    unreadCount,\n    unreadMentionsCount,\n    unreadReactionsCount,\n    fromId,\n    notifySettings: {\n      silent, muteUntil,\n    },\n  } = forumTopic;\n\n  return {\n    id,\n    isClosed: closed,\n    isPinned: pinned,\n    isHidden: hidden,\n    isOwner: my,\n    isMin: short,\n    date,\n    title,\n    iconColor,\n    iconEmojiId: iconEmojiId?.toString(),\n    lastMessageId: topMessage,\n    unreadCount,\n    unreadMentionsCount,\n    unreadReactionsCount,\n    fromId: getApiChatIdFromMtpPeer(fromId),\n    isMuted: silent || (typeof muteUntil === 'number' ? getServerTime() < muteUntil : undefined),\n    muteUntil,\n  };\n}\n\nexport function buildApiChatlistInvite(\n  invite: GramJs.chatlists.TypeChatlistInvite | undefined, slug: string,\n): ApiChatlistInvite | undefined {\n  if (invite instanceof GramJs.chatlists.ChatlistInvite) {\n    return {\n      slug,\n      title: invite.title,\n      emoticon: invite.emoticon,\n      peerIds: invite.peers.map(getApiChatIdFromMtpPeer).filter(Boolean),\n    };\n  }\n\n  if (invite instanceof GramJs.chatlists.ChatlistInviteAlready) {\n    return {\n      slug,\n      folderId: invite.filterId,\n      missingPeerIds: invite.missingPeers.map(getApiChatIdFromMtpPeer).filter(Boolean),\n      alreadyPeerIds: invite.alreadyPeers.map(getApiChatIdFromMtpPeer).filter(Boolean),\n    };\n  }\n\n  return undefined;\n}\n\nexport function buildApiChatlistExportedInvite(\n  invite: GramJs.TypeExportedChatlistInvite | undefined,\n): ApiChatlistExportedInvite | undefined {\n  if (!(invite instanceof GramJs.ExportedChatlistInvite)) return undefined;\n\n  const {\n    title,\n    url,\n    peers,\n  } = invite;\n\n  return {\n    title,\n    url,\n    peerIds: peers.map(getApiChatIdFromMtpPeer).filter(Boolean),\n  };\n}\n","/* eslint-disable no-bitwise */\n\n// Ref: https://github.com/telegramdesktop/tdesktop/blob/0743e71ab6b928d2ee5bae1aed991849b1e2b291/Telegram/SourceFiles/data/data_document.cpp#L1018\nexport function decodeWaveform(encoded5bit: Uint8Array) {\n  const bitsCount = encoded5bit.length * 8;\n  const valuesCount = Math.floor(bitsCount / 5);\n  if (!valuesCount) {\n    return [];\n  }\n\n  // Read each 5 bit of encoded5bit as 0-31 unsigned char.\n  // We count the index of the byte in which the desired 5-bit sequence starts.\n  // And then we read a uint16 starting from that byte to guarantee to get all of those 5 bits.\n  //\n  // BUT! if it is the last byte we have, we're not allowed to read a uint16 starting with it.\n  // Because it will be an overflow (we'll access one byte after the available memory).\n  // We see, that only the last 5 bits could start in the last available byte and be problematic.\n  // So we read in a general way all the entries in a general way except the last one.\n  const result = Array(valuesCount);\n  const bitsData = encoded5bit;\n  for (let i = 0, l = valuesCount - 1; i !== l; ++i) {\n    const byteIndex = Math.floor((i * 5) / 8);\n    const bitShift = Math.floor((i * 5) % 8);\n    const value = bitsData[byteIndex] + (bitsData[byteIndex + 1] << 8);\n    result[i] = ((value >> bitShift) & 0x1F);\n  }\n  const lastByteIndex = Math.floor(((valuesCount - 1) * 5) / 8);\n  const lastBitShift = Math.floor(((valuesCount - 1) * 5) % 8);\n  const lastValue = bitsData[lastByteIndex] + (bitsData[lastByteIndex + 1] << 8);\n  result[valuesCount - 1] = (lastValue >> lastBitShift) & 0x1F;\n\n  return result;\n}\n\nexport function interpolateArray(data: number[], fitCount: number) {\n  let peak = 0;\n  const newData = new Array(fitCount);\n  const springFactor = data.length / fitCount;\n  const leftFiller = data[0];\n  const rightFiller = data[data.length - 1];\n  for (let i = 0; i < fitCount; i++) {\n    const idx = Math.floor(i * springFactor);\n    const val = ((data[idx - 1] ?? leftFiller) + (data[idx] ?? leftFiller) + (data[idx + 1] ?? rightFiller)) / 3;\n    newData[i] = val;\n    if (peak < val) {\n      peak = val;\n    }\n  }\n  return { data: newData, peak };\n}\n","import BigInt from 'big-integer';\nimport { Api as GramJs } from '../../../lib/gramjs';\nimport { generateRandomBytes, readBigIntFromBuffer } from '../../../lib/gramjs/Helpers';\n\nimport type { ApiInputPrivacyRules, ApiPrivacyKey } from '../../../types';\nimport type {\n  ApiBotApp,\n  ApiChatAdminRights,\n  ApiChatBannedRights,\n  ApiChatFolder,\n  ApiChatReactions,\n  ApiFormattedText,\n  ApiGroupCall,\n  ApiInputReplyInfo,\n  ApiMessageEntity,\n  ApiNewPoll,\n  ApiPhoneCall,\n  ApiPhoto,\n  ApiPoll,\n  ApiReaction,\n  ApiReportReason,\n  ApiRequestInputInvoice,\n  ApiSendMessageAction,\n  ApiSticker,\n  ApiStory,\n  ApiStorySkipped,\n  ApiThemeParameters,\n  ApiVideo,\n} from '../../types';\nimport {\n  ApiMessageEntityTypes,\n} from '../../types';\n\nimport { CHANNEL_ID_LENGTH, DEFAULT_STATUS_ICON_ID } from '../../../config';\nimport { pick } from '../../../util/iteratees';\nimport { deserializeBytes } from '../helpers';\nimport localDb from '../localDb';\n\nconst LEGACY_CHANNEL_ID_MIN_LENGTH = 11; // Example: -1234567890\n\nfunction checkIfChannelId(id: string) {\n  if (id.length >= CHANNEL_ID_LENGTH) return id.startsWith('-100');\n  // LEGACY Unprefixed channel id\n  if (id.length === LEGACY_CHANNEL_ID_MIN_LENGTH && id.startsWith('-4')) return false;\n  return id.length >= LEGACY_CHANNEL_ID_MIN_LENGTH;\n}\n\nexport function getEntityTypeById(chatOrUserId: string) {\n  if (!chatOrUserId.startsWith('-')) {\n    return 'user';\n  } else if (checkIfChannelId(chatOrUserId)) {\n    return 'channel';\n  } else {\n    return 'chat';\n  }\n}\n\nexport function buildPeer(chatOrUserId: string): GramJs.TypePeer {\n  const type = getEntityTypeById(chatOrUserId);\n\n  if (type === 'user') {\n    return new GramJs.PeerUser({\n      userId: buildMtpPeerId(chatOrUserId, 'user'),\n    });\n  } else if (type === 'channel') {\n    return new GramJs.PeerChannel({\n      channelId: buildMtpPeerId(chatOrUserId, 'channel'),\n    });\n  } else {\n    return new GramJs.PeerChat({\n      chatId: buildMtpPeerId(chatOrUserId, 'chat'),\n    });\n  }\n}\n\nexport function buildInputPeer(chatOrUserId: string, accessHash?: string): GramJs.TypeInputPeer {\n  const type = getEntityTypeById(chatOrUserId);\n\n  if (type === 'user') {\n    return new GramJs.InputPeerUser({\n      userId: buildMtpPeerId(chatOrUserId, 'user'),\n      accessHash: BigInt(accessHash!),\n    });\n  } else if (type === 'channel') {\n    return new GramJs.InputPeerChannel({\n      channelId: buildMtpPeerId(chatOrUserId, 'channel'),\n      accessHash: BigInt(accessHash!),\n    });\n  } else {\n    return new GramJs.InputPeerChat({\n      chatId: buildMtpPeerId(chatOrUserId, 'chat'),\n    });\n  }\n}\n\nexport function buildInputPeerFromLocalDb(chatOrUserId: string): GramJs.TypeInputPeer | undefined {\n  const type = getEntityTypeById(chatOrUserId);\n  let accessHash: BigInt.BigInteger | undefined;\n\n  if (type === 'user') {\n    accessHash = localDb.users[chatOrUserId]?.accessHash;\n    if (!accessHash) {\n      return undefined;\n    }\n  } else if (type === 'channel') {\n    accessHash = (localDb.chats[chatOrUserId] as GramJs.Channel)?.accessHash;\n    if (!accessHash) {\n      return undefined;\n    }\n  }\n\n  return buildInputPeer(chatOrUserId, String(accessHash));\n}\n\nexport function buildInputEntity(chatOrUserId: string, accessHash?: string) {\n  const type = getEntityTypeById(chatOrUserId);\n\n  if (type === 'user') {\n    return new GramJs.InputUser({\n      userId: buildMtpPeerId(chatOrUserId, 'user'),\n      accessHash: BigInt(accessHash!),\n    });\n  } else if (type === 'channel') {\n    return new GramJs.InputChannel({\n      channelId: buildMtpPeerId(chatOrUserId, 'channel'),\n      accessHash: BigInt(accessHash!),\n    });\n  } else {\n    return buildMtpPeerId(chatOrUserId, 'chat');\n  }\n}\n\nexport function buildInputStickerSet(id: string, accessHash: string) {\n  return new GramJs.InputStickerSetID({\n    id: BigInt(id),\n    accessHash: BigInt(accessHash),\n  });\n}\n\nexport function buildInputStickerSetShortName(shortName: string) {\n  return new GramJs.InputStickerSetShortName({\n    shortName,\n  });\n}\n\nexport function buildInputDocument(media: ApiSticker | ApiVideo) {\n  const document = localDb.documents[media.id];\n\n  if (!document) {\n    return undefined;\n  }\n\n  return new GramJs.InputDocument(pick(document, [\n    'id',\n    'accessHash',\n    'fileReference',\n  ]));\n}\n\nexport function buildInputMediaDocument(media: ApiSticker | ApiVideo) {\n  const inputDocument = buildInputDocument(media);\n\n  if (!inputDocument) {\n    return undefined;\n  }\n\n  return new GramJs.InputMediaDocument({ id: inputDocument });\n}\n\nexport function buildInputPoll(pollParams: ApiNewPoll, randomId: BigInt.BigInteger) {\n  const { summary, quiz } = pollParams;\n\n  const poll = new GramJs.Poll({\n    id: randomId,\n    publicVoters: summary.isPublic,\n    question: summary.question,\n    answers: summary.answers.map(({ text, option }) => {\n      return new GramJs.PollAnswer({ text, option: deserializeBytes(option) });\n    }),\n    quiz: summary.quiz,\n    multipleChoice: summary.multipleChoice,\n  });\n\n  if (!quiz) {\n    return new GramJs.InputMediaPoll({ poll });\n  }\n\n  const correctAnswers = quiz.correctAnswers.map(deserializeBytes);\n  const { solution } = quiz;\n  const solutionEntities = quiz.solutionEntities ? quiz.solutionEntities.map(buildMtpMessageEntity) : [];\n\n  return new GramJs.InputMediaPoll({\n    poll,\n    correctAnswers,\n    ...(solution && {\n      solution,\n      solutionEntities,\n    }),\n  });\n}\n\nexport function buildInputPollFromExisting(poll: ApiPoll, shouldClose = false) {\n  return new GramJs.InputMediaPoll({\n    poll: new GramJs.Poll({\n      id: BigInt(poll.id),\n      publicVoters: poll.summary.isPublic,\n      question: poll.summary.question,\n      answers: poll.summary.answers.map(({ text, option }) => {\n        return new GramJs.PollAnswer({ text, option: deserializeBytes(option) });\n      }),\n      quiz: poll.summary.quiz,\n      multipleChoice: poll.summary.multipleChoice,\n      closeDate: poll.summary.closeDate,\n      closePeriod: poll.summary.closePeriod,\n      closed: shouldClose ? true : poll.summary.closed,\n    }),\n    correctAnswers: poll.results.results?.filter((o) => o.isCorrect).map((o) => deserializeBytes(o.option)),\n    solution: poll.results.solution,\n    solutionEntities: poll.results.solutionEntities?.map(buildMtpMessageEntity),\n  });\n}\n\nexport function buildFilterFromApiFolder(folder: ApiChatFolder): GramJs.DialogFilter | GramJs.DialogFilterChatlist {\n  const {\n    emoticon,\n    contacts,\n    nonContacts,\n    groups,\n    channels,\n    bots,\n    excludeArchived,\n    excludeMuted,\n    excludeRead,\n    pinnedChatIds,\n    includedChatIds,\n    excludedChatIds,\n  } = folder;\n\n  const pinnedPeers = pinnedChatIds\n    ? pinnedChatIds.map(buildInputPeerFromLocalDb).filter(Boolean)\n    : [];\n\n  const includePeers = includedChatIds\n    ? includedChatIds.map(buildInputPeerFromLocalDb).filter(Boolean)\n    : [];\n\n  const excludePeers = excludedChatIds\n    ? excludedChatIds.map(buildInputPeerFromLocalDb).filter(Boolean)\n    : [];\n\n  if (folder.isChatList) {\n    return new GramJs.DialogFilterChatlist({\n      id: folder.id,\n      title: folder.title,\n      emoticon: emoticon || undefined,\n      pinnedPeers,\n      includePeers,\n      hasMyInvites: folder.hasMyInvites,\n    });\n  }\n\n  return new GramJs.DialogFilter({\n    id: folder.id,\n    title: folder.title,\n    emoticon: emoticon || undefined,\n    contacts: contacts || undefined,\n    nonContacts: nonContacts || undefined,\n    groups: groups || undefined,\n    bots: bots || undefined,\n    excludeArchived: excludeArchived || undefined,\n    excludeMuted: excludeMuted || undefined,\n    excludeRead: excludeRead || undefined,\n    broadcasts: channels || undefined,\n    pinnedPeers,\n    includePeers,\n    excludePeers,\n  });\n}\n\nexport function buildInputStory(story: ApiStory | ApiStorySkipped) {\n  const peer = buildInputPeerFromLocalDb(story.peerId)!;\n  return new GramJs.InputMediaStory({\n    peer,\n    id: story.id,\n  });\n}\n\nexport function generateRandomBigInt() {\n  return readBigIntFromBuffer(generateRandomBytes(8), true, true);\n}\n\nexport function generateRandomInt() {\n  return readBigIntFromBuffer(generateRandomBytes(4), true, true).toJSNumber();\n}\n\nexport function buildMessageFromUpdate(\n  id: number,\n  chatId: string,\n  update: GramJs.UpdateShortSentMessage | GramJs.UpdateServiceNotification,\n) {\n  // This is not a proper message, but we only need these fields for downloading media through `localDb`.\n  return new GramJs.Message({\n    id,\n    peerId: buildPeer(chatId),\n    fromId: buildPeer(chatId),\n    media: update.media,\n  } as GramJs.Message);\n}\n\nexport function buildMtpMessageEntity(entity: ApiMessageEntity): GramJs.TypeMessageEntity {\n  const {\n    type, offset, length,\n  } = entity;\n\n  const user = 'userId' in entity ? localDb.users[entity.userId] : undefined;\n\n  switch (type) {\n    case ApiMessageEntityTypes.Bold:\n      return new GramJs.MessageEntityBold({ offset, length });\n    case ApiMessageEntityTypes.Italic:\n      return new GramJs.MessageEntityItalic({ offset, length });\n    case ApiMessageEntityTypes.Underline:\n      return new GramJs.MessageEntityUnderline({ offset, length });\n    case ApiMessageEntityTypes.Strike:\n      return new GramJs.MessageEntityStrike({ offset, length });\n    case ApiMessageEntityTypes.Code:\n      return new GramJs.MessageEntityCode({ offset, length });\n    case ApiMessageEntityTypes.Pre:\n      return new GramJs.MessageEntityPre({ offset, length, language: entity.language || '' });\n    case ApiMessageEntityTypes.Blockquote:\n      return new GramJs.MessageEntityBlockquote({ offset, length });\n    case ApiMessageEntityTypes.TextUrl:\n      return new GramJs.MessageEntityTextUrl({ offset, length, url: entity.url });\n    case ApiMessageEntityTypes.Url:\n      return new GramJs.MessageEntityUrl({ offset, length });\n    case ApiMessageEntityTypes.Hashtag:\n      return new GramJs.MessageEntityHashtag({ offset, length });\n    case ApiMessageEntityTypes.MentionName:\n      return new GramJs.InputMessageEntityMentionName({\n        offset,\n        length,\n        userId: new GramJs.InputUser({ userId: BigInt(user!.id), accessHash: user!.accessHash! }),\n      });\n    case ApiMessageEntityTypes.Spoiler:\n      return new GramJs.MessageEntitySpoiler({ offset, length });\n    case ApiMessageEntityTypes.CustomEmoji:\n      return new GramJs.MessageEntityCustomEmoji({ offset, length, documentId: BigInt(entity.documentId) });\n    default:\n      return new GramJs.MessageEntityUnknown({ offset, length });\n  }\n}\n\nexport function isMessageWithMedia(message: GramJs.Message | GramJs.UpdateServiceNotification) {\n  const { media } = message;\n  if (!media) {\n    return false;\n  }\n\n  return (\n    media instanceof GramJs.MessageMediaPhoto\n    || media instanceof GramJs.MessageMediaDocument\n    || (\n      media instanceof GramJs.MessageMediaWebPage\n      && media.webpage instanceof GramJs.WebPage\n      && (\n        media.webpage.photo instanceof GramJs.Photo || (\n          media.webpage.document instanceof GramJs.Document\n          && media.webpage.document.mimeType.startsWith('video')\n        )\n      )\n    ) || (\n      media instanceof GramJs.MessageMediaGame\n      && (media.game.document instanceof GramJs.Document || media.game.photo instanceof GramJs.Photo)\n    ) || (\n      media instanceof GramJs.MessageMediaInvoice && (media.photo || media.extendedMedia)\n    )\n  );\n}\n\nexport function isServiceMessageWithMedia(message: GramJs.MessageService) {\n  return 'photo' in message.action && message.action.photo instanceof GramJs.Photo;\n}\n\nexport function buildChatPhotoForLocalDb(photo: GramJs.TypePhoto) {\n  if (photo instanceof GramJs.PhotoEmpty) {\n    return new GramJs.ChatPhotoEmpty();\n  }\n\n  const { dcId, id: photoId } = photo;\n\n  return new GramJs.ChatPhoto({\n    dcId,\n    photoId,\n  });\n}\n\nexport function buildInputPhoto(photo: ApiPhoto) {\n  const localPhoto = localDb.photos[photo?.id];\n\n  if (!localPhoto) {\n    return undefined;\n  }\n\n  return new GramJs.InputPhoto(pick(localPhoto, [\n    'id',\n    'accessHash',\n    'fileReference',\n  ]));\n}\n\nexport function buildInputContact({\n  phone,\n  firstName,\n  lastName,\n}: {\n  phone: string;\n  firstName: string;\n  lastName: string;\n}) {\n  return new GramJs.InputPhoneContact({\n    clientId: BigInt(1),\n    phone,\n    firstName,\n    lastName,\n  });\n}\n\nexport function buildChatBannedRights(\n  bannedRights: ApiChatBannedRights,\n  untilDate = 0,\n) {\n  return new GramJs.ChatBannedRights({\n    ...bannedRights,\n    untilDate,\n  });\n}\n\nexport function buildChatAdminRights(\n  adminRights: ApiChatAdminRights,\n) {\n  return new GramJs.ChatAdminRights(adminRights);\n}\n\nexport function buildShippingInfo(info: GramJs.PaymentRequestedInfo) {\n  const { shippingAddress } = info;\n  return new GramJs.PaymentRequestedInfo({\n    ...info,\n    shippingAddress: shippingAddress\n      ? new GramJs.PostAddress(shippingAddress)\n      : undefined,\n  });\n}\n\nexport function buildInputPrivacyKey(privacyKey: ApiPrivacyKey) {\n  switch (privacyKey) {\n    case 'phoneNumber':\n      return new GramJs.InputPrivacyKeyPhoneNumber();\n\n    case 'addByPhone':\n      return new GramJs.InputPrivacyKeyAddedByPhone();\n\n    case 'lastSeen':\n      return new GramJs.InputPrivacyKeyStatusTimestamp();\n\n    case 'profilePhoto':\n      return new GramJs.InputPrivacyKeyProfilePhoto();\n\n    case 'forwards':\n      return new GramJs.InputPrivacyKeyForwards();\n\n    case 'chatInvite':\n      return new GramJs.InputPrivacyKeyChatInvite();\n\n    case 'phoneCall':\n      return new GramJs.InputPrivacyKeyPhoneCall();\n\n    case 'phoneP2P':\n      return new GramJs.InputPrivacyKeyPhoneP2P();\n\n    case 'voiceMessages':\n      return new GramJs.InputPrivacyKeyVoiceMessages();\n\n    case 'bio':\n      return new GramJs.InputPrivacyKeyAbout();\n  }\n\n  return undefined;\n}\n\nexport function buildInputReportReason(reason: ApiReportReason) {\n  switch (reason) {\n    case 'spam':\n      return new GramJs.InputReportReasonSpam();\n    case 'violence':\n      return new GramJs.InputReportReasonViolence();\n    case 'childAbuse':\n      return new GramJs.InputReportReasonChildAbuse();\n    case 'pornography':\n      return new GramJs.InputReportReasonPornography();\n    case 'copyright':\n      return new GramJs.InputReportReasonCopyright();\n    case 'fake':\n      return new GramJs.InputReportReasonFake();\n    case 'geoIrrelevant':\n      return new GramJs.InputReportReasonGeoIrrelevant();\n    case 'illegalDrugs':\n      return new GramJs.InputReportReasonIllegalDrugs();\n    case 'personalDetails':\n      return new GramJs.InputReportReasonPersonalDetails();\n    case 'other':\n      return new GramJs.InputReportReasonOther();\n  }\n\n  return undefined;\n}\n\nexport function buildSendMessageAction(action: ApiSendMessageAction) {\n  switch (action.type) {\n    case 'cancel':\n      return new GramJs.SendMessageCancelAction();\n    case 'typing':\n      return new GramJs.SendMessageTypingAction();\n    case 'recordAudio':\n      return new GramJs.SendMessageRecordAudioAction();\n    case 'chooseSticker':\n      return new GramJs.SendMessageChooseStickerAction();\n    case 'playingGame':\n      return new GramJs.SendMessageGamePlayAction();\n  }\n  return undefined;\n}\n\nexport function buildInputThemeParams(params: ApiThemeParameters) {\n  return new GramJs.DataJSON({\n    data: JSON.stringify(params),\n  });\n}\n\nexport function buildMtpPeerId(id: string, type: 'user' | 'chat' | 'channel') {\n  if (type === 'user') {\n    return BigInt(id);\n  }\n\n  if (type === 'channel') {\n    if (id.length === CHANNEL_ID_LENGTH) {\n      return BigInt(id.slice(4));\n    }\n\n    // LEGACY Unprefixed channel id\n    return BigInt(id.slice(1));\n  }\n\n  return BigInt(id.slice(1));\n}\n\nexport function buildInputGroupCall(groupCall: Partial<ApiGroupCall>) {\n  return new GramJs.InputGroupCall({\n    id: BigInt(groupCall.id!),\n    accessHash: BigInt(groupCall.accessHash!),\n  });\n}\n\nexport function buildInputPhoneCall({ id, accessHash }: ApiPhoneCall) {\n  return new GramJs.InputPhoneCall({\n    id: BigInt(id),\n    accessHash: BigInt(accessHash!),\n  });\n}\n\nexport function buildInputInvoice(invoice: ApiRequestInputInvoice) {\n  if ('slug' in invoice) {\n    return new GramJs.InputInvoiceSlug({\n      slug: invoice.slug,\n    });\n  } else {\n    return new GramJs.InputInvoiceMessage({\n      peer: buildInputPeer(invoice.chat.id, invoice.chat.accessHash),\n      msgId: invoice.messageId,\n    });\n  }\n}\n\nexport function buildInputReaction(reaction?: ApiReaction) {\n  if (reaction && 'emoticon' in reaction) {\n    return new GramJs.ReactionEmoji({\n      emoticon: reaction.emoticon,\n    });\n  }\n\n  if (reaction && 'documentId' in reaction) {\n    return new GramJs.ReactionCustomEmoji({\n      documentId: BigInt(reaction.documentId),\n    });\n  }\n\n  return new GramJs.ReactionEmpty();\n}\n\nexport function buildInputChatReactions(chatReactions?: ApiChatReactions) {\n  if (chatReactions?.type === 'all') {\n    return new GramJs.ChatReactionsAll({\n      allowCustom: chatReactions.areCustomAllowed,\n    });\n  }\n\n  if (chatReactions?.type === 'some') {\n    return new GramJs.ChatReactionsSome({\n      reactions: chatReactions.allowed.map(buildInputReaction),\n    });\n  }\n\n  return new GramJs.ChatReactionsNone();\n}\n\nexport function buildInputEmojiStatus(emojiStatus: ApiSticker, expires?: number) {\n  if (emojiStatus.id === DEFAULT_STATUS_ICON_ID) {\n    return new GramJs.EmojiStatusEmpty();\n  }\n\n  if (expires) {\n    return new GramJs.EmojiStatusUntil({\n      documentId: BigInt(emojiStatus.id),\n      until: expires,\n    });\n  }\n\n  return new GramJs.EmojiStatus({\n    documentId: BigInt(emojiStatus.id),\n  });\n}\n\nexport function buildInputTextWithEntities(formatted: ApiFormattedText) {\n  return new GramJs.TextWithEntities({\n    text: formatted.text,\n    entities: formatted.entities?.map(buildMtpMessageEntity) || [],\n  });\n}\n\nexport function buildInputBotApp(app: ApiBotApp) {\n  return new GramJs.InputBotAppID({\n    id: BigInt(app.id),\n    accessHash: BigInt(app.accessHash),\n  });\n}\n\nexport function buildInputReplyTo(replyInfo: ApiInputReplyInfo) {\n  if (replyInfo.type === 'story') {\n    return new GramJs.InputReplyToStory({\n      userId: buildInputPeerFromLocalDb(replyInfo.userId)!,\n      storyId: replyInfo.storyId,\n    });\n  }\n\n  if (replyInfo.type === 'message') {\n    const {\n      replyToMsgId, replyToTopId, replyToPeerId, quoteText,\n    } = replyInfo;\n    return new GramJs.InputReplyToMessage({\n      replyToMsgId,\n      topMsgId: replyToTopId,\n      replyToPeerId: replyToPeerId ? buildInputPeerFromLocalDb(replyToPeerId)! : undefined,\n      quoteText: quoteText?.text,\n      quoteEntities: quoteText?.entities?.map(buildMtpMessageEntity),\n    });\n  }\n\n  return undefined;\n}\n\nexport function buildInputPrivacyRules(\n  rules: ApiInputPrivacyRules,\n) {\n  const privacyRules: GramJs.TypeInputPrivacyRule[] = [];\n\n  if (rules.allowedUsers?.length) {\n    privacyRules.push(new GramJs.InputPrivacyValueAllowUsers({\n      users: rules.allowedUsers.map(({ id, accessHash }) => buildInputEntity(id, accessHash) as GramJs.InputUser),\n    }));\n  }\n  if (rules.allowedChats?.length) {\n    privacyRules.push(new GramJs.InputPrivacyValueAllowChatParticipants({\n      chats: rules.allowedChats.map(({ id, type }) => (\n        buildMtpPeerId(id, type === 'chatTypeBasicGroup' ? 'chat' : 'channel')\n      )),\n    }));\n  }\n  if (rules.blockedUsers?.length) {\n    privacyRules.push(new GramJs.InputPrivacyValueDisallowUsers({\n      users: rules.blockedUsers.map(({ id, accessHash }) => buildInputEntity(id, accessHash) as GramJs.InputUser),\n    }));\n  }\n  if (rules.blockedChats?.length) {\n    privacyRules.push(new GramJs.InputPrivacyValueDisallowChatParticipants({\n      chats: rules.blockedChats.map(({ id, type }) => (\n        buildMtpPeerId(id, type === 'chatTypeBasicGroup' ? 'chat' : 'channel')\n      )),\n    }));\n  }\n\n  if (!rules.isUnspecified) {\n    switch (rules.visibility) {\n      case 'everybody':\n        privacyRules.push(new GramJs.InputPrivacyValueAllowAll());\n        break;\n\n      case 'contacts':\n        privacyRules.push(new GramJs.InputPrivacyValueAllowContacts());\n        break;\n\n      case 'nonContacts':\n        privacyRules.push(new GramJs.InputPrivacyValueDisallowContacts());\n        break;\n\n      case 'nobody':\n        privacyRules.push(new GramJs.InputPrivacyValueDisallowAll());\n        break;\n    }\n  }\n\n  return privacyRules;\n}\n","import { Api as GramJs } from '../../../lib/gramjs';\n\nimport type { ApiDraft } from '../../../global/types';\nimport type {\n  ApiAction,\n  ApiAttachment,\n  ApiChat,\n  ApiContact,\n  ApiGroupCall,\n  ApiInputMessageReplyInfo,\n  ApiInputReplyInfo,\n  ApiKeyboardButton,\n  ApiMessage,\n  ApiMessageEntity,\n  ApiMessageForwardInfo,\n  ApiNewPoll,\n  ApiPeer,\n  ApiPhoto,\n  ApiReplyInfo,\n  ApiReplyKeyboard,\n  ApiSponsoredMessage,\n  ApiSponsoredWebPage,\n  ApiSticker,\n  ApiStory,\n  ApiStorySkipped,\n  ApiThreadInfo,\n  ApiVideo,\n  MediaContent,\n  PhoneCallAction,\n} from '../../types';\nimport {\n  ApiMessageEntityTypes, MAIN_THREAD_ID,\n} from '../../types';\n\nimport {\n  DELETED_COMMENTS_CHANNEL_ID,\n  SERVICE_NOTIFICATIONS_USER_ID,\n  SPONSORED_MESSAGE_CACHE_MS,\n  SUPPORTED_AUDIO_CONTENT_TYPES,\n  SUPPORTED_IMAGE_CONTENT_TYPES,\n  SUPPORTED_VIDEO_CONTENT_TYPES,\n} from '../../../config';\nimport { getEmojiOnlyCountForMessage } from '../../../global/helpers/getEmojiOnlyCountForMessage';\nimport { omitUndefined, pick } from '../../../util/iteratees';\nimport { getServerTime, getServerTimeOffset } from '../../../util/serverTime';\nimport { interpolateArray } from '../../../util/waveform';\nimport { buildPeer } from '../gramjsBuilders';\nimport {\n  addPhotoToLocalDb,\n  resolveMessageApiChatId,\n  serializeBytes,\n} from '../helpers';\nimport { buildApiBotApp } from './bots';\nimport { buildApiCallDiscardReason } from './calls';\nimport {\n  buildApiPhoto,\n} from './common';\nimport { buildMessageContent, buildMessageMediaContent, buildMessageTextContent } from './messageContent';\nimport { buildApiPeerId, getApiChatIdFromMtpPeer, isPeerUser } from './peers';\nimport { buildMessageReactions } from './reactions';\n\nconst LOCAL_MESSAGES_LIMIT = 1e6; // 1M\n\nconst LOCAL_MEDIA_UPLOADING_TEMP_ID = 'temp';\nconst INPUT_WAVEFORM_LENGTH = 63;\nconst MIN_SCHEDULED_PERIOD = 10;\n\nlet localMessageCounter = 0;\nfunction getNextLocalMessageId(lastMessageId = 0) {\n  return lastMessageId + (++localMessageCounter / LOCAL_MESSAGES_LIMIT);\n}\n\nlet currentUserId!: string;\n\nexport function setMessageBuilderCurrentUserId(_currentUserId: string) {\n  currentUserId = _currentUserId;\n}\n\nexport function buildApiSponsoredMessage(mtpMessage: GramJs.SponsoredMessage): ApiSponsoredMessage | undefined {\n  const {\n    fromId, message, entities, startParam, channelPost, chatInvite, chatInviteHash, randomId, recommended, sponsorInfo,\n    additionalInfo, showPeerPhoto, webpage, buttonText, app,\n  } = mtpMessage;\n  const chatId = fromId ? getApiChatIdFromMtpPeer(fromId) : undefined;\n  const chatInviteTitle = chatInvite\n    ? (chatInvite instanceof GramJs.ChatInvite\n      ? chatInvite.title\n      : !(chatInvite.chat instanceof GramJs.ChatEmpty) ? chatInvite.chat.title : undefined)\n    : undefined;\n\n  return {\n    randomId: serializeBytes(randomId),\n    isBot: fromId ? isPeerUser(fromId) : false,\n    text: buildMessageTextContent(message, entities),\n    expiresAt: Math.round(Date.now() / 1000) + SPONSORED_MESSAGE_CACHE_MS,\n    isRecommended: Boolean(recommended),\n    ...(webpage && { webPage: buildSponsoredWebPage(webpage) }),\n    ...(showPeerPhoto && { isAvatarShown: true }),\n    ...(chatId && { chatId }),\n    ...(chatInviteHash && { chatInviteHash }),\n    ...(chatInvite && { chatInviteTitle }),\n    ...(startParam && { startParam }),\n    ...(channelPost && { channelPostId: channelPost }),\n    ...(sponsorInfo && { sponsorInfo }),\n    ...(additionalInfo && { additionalInfo }),\n    ...(buttonText && { buttonText }),\n    ...(app && { botApp: buildApiBotApp(app) }),\n  };\n}\n\nexport function buildApiMessage(mtpMessage: GramJs.TypeMessage): ApiMessage | undefined {\n  const chatId = resolveMessageApiChatId(mtpMessage);\n  if (\n    !chatId\n    || !(mtpMessage instanceof GramJs.Message || mtpMessage instanceof GramJs.MessageService)) {\n    return undefined;\n  }\n\n  return buildApiMessageWithChatId(chatId, mtpMessage);\n}\n\nexport function buildApiMessageFromShort(mtpMessage: GramJs.UpdateShortMessage): ApiMessage {\n  const chatId = buildApiPeerId(mtpMessage.userId, 'user');\n\n  return buildApiMessageWithChatId(chatId, {\n    ...mtpMessage,\n    fromId: buildPeer(mtpMessage.out ? currentUserId : buildApiPeerId(mtpMessage.userId, 'user')),\n  });\n}\n\nexport function buildApiMessageFromShortChat(mtpMessage: GramJs.UpdateShortChatMessage): ApiMessage {\n  const chatId = buildApiPeerId(mtpMessage.chatId, 'chat');\n\n  return buildApiMessageWithChatId(chatId, {\n    ...mtpMessage,\n    fromId: buildPeer(buildApiPeerId(mtpMessage.fromId, 'user')),\n  });\n}\n\nexport function buildApiMessageFromNotification(\n  notification: GramJs.UpdateServiceNotification,\n  currentDate: number,\n): ApiMessage {\n  const localId = getNextLocalMessageId(currentDate);\n  const content = buildMessageContent(notification);\n\n  return {\n    id: localId,\n    chatId: SERVICE_NOTIFICATIONS_USER_ID,\n    date: notification.inboxDate || currentDate,\n    content,\n    isOutgoing: false,\n  };\n}\n\nexport type UniversalMessage = (\n  Pick<GramJs.Message & GramJs.MessageService, ('id' | 'date')>\n  & Pick<Partial<GramJs.Message & GramJs.MessageService>, (\n    'out' | 'message' | 'entities' | 'fromId' | 'peerId' | 'fwdFrom' | 'replyTo' | 'replyMarkup' | 'post' |\n    'media' | 'action' | 'views' | 'editDate' | 'editHide' | 'mediaUnread' | 'groupedId' | 'mentioned' | 'viaBotId' |\n    'replies' | 'fromScheduled' | 'postAuthor' | 'noforwards' | 'reactions' | 'forwards' | 'silent' | 'pinned' |\n    'savedPeerId'\n  )>\n);\n\nexport function buildApiMessageWithChatId(\n  chatId: string,\n  mtpMessage: UniversalMessage,\n): ApiMessage {\n  const fromId = mtpMessage.fromId ? getApiChatIdFromMtpPeer(mtpMessage.fromId) : undefined;\n  const peerId = mtpMessage.peerId ? getApiChatIdFromMtpPeer(mtpMessage.peerId) : undefined;\n  const isChatWithSelf = !fromId && chatId === currentUserId;\n  const isOutgoing = (mtpMessage.out && !mtpMessage.post) || (isChatWithSelf && !mtpMessage.fwdFrom);\n  const content = buildMessageContent(mtpMessage);\n  const action = mtpMessage.action\n    && buildAction(mtpMessage.action, fromId, peerId, Boolean(mtpMessage.post), isOutgoing);\n  if (action) {\n    content.action = action;\n  }\n  const isScheduled = mtpMessage.date > getServerTime() + MIN_SCHEDULED_PERIOD;\n\n  const isInvoiceMedia = mtpMessage.media instanceof GramJs.MessageMediaInvoice\n    && Boolean(mtpMessage.media.extendedMedia);\n\n  const isEdited = Boolean(mtpMessage.editDate) && !mtpMessage.editHide;\n  const {\n    inlineButtons, keyboardButtons, keyboardPlaceholder, isKeyboardSingleUse, isKeyboardSelective,\n  } = buildReplyButtons(mtpMessage, isInvoiceMedia) || {};\n  const forwardInfo = mtpMessage.fwdFrom && buildApiMessageForwardInfo(mtpMessage.fwdFrom, isChatWithSelf);\n  const { mediaUnread: isMediaUnread, postAuthor } = mtpMessage;\n  const groupedId = mtpMessage.groupedId && String(mtpMessage.groupedId);\n  const isInAlbum = Boolean(groupedId) && !(content.document || content.audio || content.sticker);\n  const shouldHideKeyboardButtons = mtpMessage.replyMarkup instanceof GramJs.ReplyKeyboardHide;\n  const isHideKeyboardSelective = mtpMessage.replyMarkup instanceof GramJs.ReplyKeyboardHide\n    && mtpMessage.replyMarkup.selective;\n  const isProtected = mtpMessage.noforwards || isInvoiceMedia;\n  const isForwardingAllowed = !mtpMessage.noforwards;\n  const emojiOnlyCount = getEmojiOnlyCountForMessage(content, groupedId);\n  const hasComments = mtpMessage.replies?.comments;\n\n  const savedPeerId = mtpMessage.savedPeerId && getApiChatIdFromMtpPeer(mtpMessage.savedPeerId);\n\n  return omitUndefined({\n    id: mtpMessage.id,\n    chatId,\n    isOutgoing,\n    content,\n    date: mtpMessage.date,\n    senderId: fromId || (mtpMessage.out && mtpMessage.post && currentUserId) || chatId,\n    viewsCount: mtpMessage.views,\n    forwardsCount: mtpMessage.forwards,\n    isScheduled,\n    isFromScheduled: mtpMessage.fromScheduled,\n    isSilent: mtpMessage.silent,\n    isPinned: mtpMessage.pinned,\n    reactions: mtpMessage.reactions && buildMessageReactions(mtpMessage.reactions),\n    emojiOnlyCount,\n    ...(mtpMessage.replyTo && { replyInfo: buildApiReplyInfo(mtpMessage.replyTo) }),\n    forwardInfo,\n    isEdited,\n    editDate: mtpMessage.editDate,\n    isMediaUnread,\n    hasUnreadMention: mtpMessage.mentioned && isMediaUnread,\n    isMentioned: mtpMessage.mentioned,\n    ...(groupedId && {\n      groupedId,\n      isInAlbum,\n    }),\n    inlineButtons,\n    ...(keyboardButtons && {\n      keyboardButtons, keyboardPlaceholder, isKeyboardSingleUse, isKeyboardSelective,\n    }),\n    ...(shouldHideKeyboardButtons && { shouldHideKeyboardButtons, isHideKeyboardSelective }),\n    ...(mtpMessage.viaBotId && { viaBotId: buildApiPeerId(mtpMessage.viaBotId, 'user') }),\n    postAuthorTitle: postAuthor,\n    isProtected,\n    isForwardingAllowed,\n    hasComments,\n    savedPeerId,\n  } satisfies ApiMessage);\n}\n\nexport function buildMessageDraft(draft: GramJs.TypeDraftMessage): ApiDraft | undefined {\n  if (draft instanceof GramJs.DraftMessageEmpty) {\n    return undefined;\n  }\n\n  const {\n    message, entities, replyTo, date,\n  } = draft;\n\n  const replyInfo = replyTo instanceof GramJs.InputReplyToMessage ? {\n    type: 'message',\n    replyToMsgId: replyTo.replyToMsgId,\n    replyToTopId: replyTo.topMsgId,\n    replyToPeerId: replyTo.replyToPeerId && getApiChatIdFromMtpPeer(replyTo.replyToPeerId),\n    quoteText: replyTo.quoteText ? buildMessageTextContent(replyTo.quoteText, replyTo.quoteEntities) : undefined,\n  } satisfies ApiInputMessageReplyInfo : undefined;\n\n  return {\n    text: message ? buildMessageTextContent(message, entities) : undefined,\n    replyInfo,\n    date,\n  };\n}\n\nfunction buildApiMessageForwardInfo(fwdFrom: GramJs.MessageFwdHeader, isChatWithSelf = false): ApiMessageForwardInfo {\n  const savedFromPeerId = fwdFrom.savedFromPeer && getApiChatIdFromMtpPeer(fwdFrom.savedFromPeer);\n  const fromId = fwdFrom.fromId && getApiChatIdFromMtpPeer(fwdFrom.fromId);\n\n  return {\n    date: fwdFrom.date,\n    savedDate: fwdFrom.savedDate,\n    isImported: fwdFrom.imported,\n    isChannelPost: Boolean(fwdFrom.channelPost),\n    channelPostId: fwdFrom.channelPost,\n    isLinkedChannelPost: Boolean(fwdFrom.channelPost && savedFromPeerId && !isChatWithSelf),\n    savedFromPeerId,\n    fromId,\n    fromChatId: fromId || savedFromPeerId,\n    fromMessageId: fwdFrom.savedFromMsgId || fwdFrom.channelPost,\n    hiddenUserName: fwdFrom.fromName,\n    postAuthorTitle: fwdFrom.postAuthor,\n  };\n}\n\nfunction buildApiReplyInfo(replyHeader: GramJs.TypeMessageReplyHeader): ApiReplyInfo | undefined {\n  if (replyHeader instanceof GramJs.MessageReplyStoryHeader) {\n    return {\n      type: 'story',\n      userId: replyHeader.userId.toString(),\n      storyId: replyHeader.storyId,\n    };\n  }\n\n  if (replyHeader instanceof GramJs.MessageReplyHeader) {\n    const {\n      replyFrom,\n      replyToMsgId,\n      replyToTopId,\n      replyMedia,\n      replyToPeerId,\n      forumTopic,\n      quote,\n      quoteText,\n      quoteEntities,\n    } = replyHeader;\n\n    return {\n      type: 'message',\n      replyToMsgId,\n      replyToTopId,\n      isForumTopic: forumTopic,\n      replyFrom: replyFrom && buildApiMessageForwardInfo(replyFrom),\n      replyToPeerId: replyToPeerId && getApiChatIdFromMtpPeer(replyToPeerId),\n      replyMedia: replyMedia && buildMessageMediaContent(replyMedia),\n      isQuote: quote,\n      quoteText: quoteText ? buildMessageTextContent(quoteText, quoteEntities) : undefined,\n    };\n  }\n\n  return undefined;\n}\n\nfunction buildAction(\n  action: GramJs.TypeMessageAction,\n  senderId: string | undefined,\n  targetPeerId: string | undefined,\n  isChannelPost: boolean,\n  isOutgoing: boolean,\n): ApiAction | undefined {\n  if (action instanceof GramJs.MessageActionEmpty) {\n    return undefined;\n  }\n\n  let phoneCall: PhoneCallAction | undefined;\n  let call: Partial<ApiGroupCall> | undefined;\n  let amount: number | undefined;\n  let currency: string | undefined;\n  let giftCryptoInfo: {\n    currency: string;\n    amount: string;\n  } | undefined;\n  let text: string;\n  const translationValues: string[] = [];\n  let type: ApiAction['type'] = 'other';\n  let photo: ApiPhoto | undefined;\n  let score: number | undefined;\n  let months: number | undefined;\n  let topicEmojiIconId: string | undefined;\n  let isTopicAction: boolean | undefined;\n  let slug: string | undefined;\n  let isGiveaway: boolean | undefined;\n  let isUnclaimed: boolean | undefined;\n  let pluralValue: number | undefined;\n\n  const targetUserIds = 'users' in action\n    ? action.users && action.users.map((id) => buildApiPeerId(id, 'user'))\n    : ('userId' in action && [buildApiPeerId(action.userId, 'user')]) || [];\n  let targetChatId: string | undefined;\n\n  if (action instanceof GramJs.MessageActionChatCreate) {\n    text = 'Notification.CreatedChatWithTitle';\n    translationValues.push('%action_origin%', action.title);\n    type = 'chatCreate';\n  } else if (action instanceof GramJs.MessageActionChatEditTitle) {\n    if (isChannelPost) {\n      text = 'Channel.MessageTitleUpdated';\n      translationValues.push(action.title);\n    } else {\n      text = 'Notification.ChangedGroupName';\n      translationValues.push('%action_origin%', action.title);\n    }\n  } else if (action instanceof GramJs.MessageActionChatEditPhoto) {\n    if (isChannelPost) {\n      text = 'Channel.MessagePhotoUpdated';\n    } else {\n      text = 'Notification.ChangedGroupPhoto';\n      translationValues.push('%action_origin%');\n    }\n  } else if (action instanceof GramJs.MessageActionChatDeletePhoto) {\n    if (isChannelPost) {\n      text = 'Channel.MessagePhotoRemoved';\n    } else {\n      text = 'Group.MessagePhotoRemoved';\n    }\n  } else if (action instanceof GramJs.MessageActionChatAddUser) {\n    if (!senderId || targetUserIds.includes(senderId)) {\n      text = 'Notification.JoinedChat';\n      translationValues.push('%target_user%');\n    } else {\n      text = 'Notification.Invited';\n      translationValues.push('%action_origin%', '%target_user%');\n    }\n  } else if (action instanceof GramJs.MessageActionChatDeleteUser) {\n    if (!senderId || targetUserIds.includes(senderId)) {\n      text = 'Notification.LeftChat';\n      translationValues.push('%target_user%');\n    } else {\n      text = 'Notification.Kicked';\n      translationValues.push('%action_origin%', '%target_user%');\n    }\n  } else if (action instanceof GramJs.MessageActionChatJoinedByLink) {\n    text = 'Notification.JoinedGroupByLink';\n    translationValues.push('%action_origin%');\n  } else if (action instanceof GramJs.MessageActionChannelCreate) {\n    text = 'Notification.CreatedChannel';\n  } else if (action instanceof GramJs.MessageActionChatMigrateTo) {\n    targetChatId = getApiChatIdFromMtpPeer(action);\n    text = 'Migrated to %target_chat%';\n    translationValues.push('%target_chat%');\n  } else if (action instanceof GramJs.MessageActionChannelMigrateFrom) {\n    targetChatId = getApiChatIdFromMtpPeer(action);\n    text = 'Migrated from %target_chat%';\n    translationValues.push('%target_chat%');\n  } else if (action instanceof GramJs.MessageActionPinMessage) {\n    text = 'Chat.Service.Group.UpdatedPinnedMessage1';\n    translationValues.push('%action_origin%', '%message%');\n  } else if (action instanceof GramJs.MessageActionHistoryClear) {\n    text = 'HistoryCleared';\n    type = 'historyClear';\n  } else if (action instanceof GramJs.MessageActionPhoneCall) {\n    const withDuration = Boolean(action.duration);\n    text = [\n      withDuration ? 'ChatList.Service' : 'Chat',\n      action.video ? 'VideoCall' : 'Call',\n      isOutgoing ? (withDuration ? 'outgoing' : 'Outgoing') : (withDuration ? 'incoming' : 'Incoming'),\n    ].join('.');\n\n    if (withDuration) {\n      const mins = Math.max(Math.round(action.duration! / 60), 1);\n      translationValues.push(`${mins} min${mins > 1 ? 's' : ''}`);\n    }\n\n    phoneCall = {\n      isOutgoing,\n      isVideo: action.video,\n      duration: action.duration,\n      reason: buildApiCallDiscardReason(action.reason),\n    };\n  } else if (action instanceof GramJs.MessageActionInviteToGroupCall) {\n    text = 'Notification.VoiceChatInvitation';\n    call = {\n      id: action.call.id.toString(),\n      accessHash: action.call.accessHash.toString(),\n    };\n    translationValues.push('%action_origin%', '%target_user%');\n  } else if (action instanceof GramJs.MessageActionContactSignUp) {\n    text = 'Notification.Joined';\n    translationValues.push('%action_origin%');\n    type = 'contactSignUp';\n  } else if (action instanceof GramJs.MessageActionPaymentSent) {\n    amount = Number(action.totalAmount);\n    currency = action.currency;\n    text = 'PaymentSuccessfullyPaid';\n    if (targetPeerId) {\n      targetUserIds.push(targetPeerId);\n    }\n    translationValues.push('%payment_amount%', '%target_user%', '%product%');\n  } else if (action instanceof GramJs.MessageActionGroupCall) {\n    if (action.duration) {\n      const mins = Math.max(Math.round(action.duration / 60), 1);\n      text = 'Notification.VoiceChatEnded';\n      translationValues.push(`${mins} min${mins > 1 ? 's' : ''}`);\n    } else {\n      text = 'Notification.VoiceChatStartedChannel';\n      call = {\n        id: action.call.id.toString(),\n        accessHash: action.call.accessHash.toString(),\n      };\n    }\n  } else if (action instanceof GramJs.MessageActionBotAllowed) {\n    if (action.domain) {\n      text = 'ActionBotAllowed';\n      translationValues.push(action.domain);\n    } else if (action.fromRequest) {\n      text = 'lng_action_webapp_bot_allowed';\n    } else {\n      text = 'ActionAttachMenuBotAllowed';\n    }\n  } else if (action instanceof GramJs.MessageActionCustomAction) {\n    text = action.message;\n  } else if (action instanceof GramJs.MessageActionChatJoinedByRequest) {\n    text = 'ChatService.UserJoinedGroupByRequest';\n    translationValues.push('%action_origin%');\n  } else if (action instanceof GramJs.MessageActionGameScore) {\n    text = senderId === currentUserId ? 'ActionYouScoredInGame' : 'ActionUserScoredInGame';\n    translationValues.push('%score%');\n    score = action.score;\n  } else if (action instanceof GramJs.MessageActionWebViewDataSent) {\n    text = 'Notification.WebAppSentData';\n    translationValues.push(action.text);\n  } else if (action instanceof GramJs.MessageActionGiftPremium) {\n    text = isOutgoing ? 'ActionGiftOutbound' : 'ActionGiftInbound';\n    if (isOutgoing) {\n      translationValues.push('%gift_payment_amount%');\n    } else {\n      translationValues.push('%action_origin%', '%gift_payment_amount%');\n    }\n    if (targetPeerId) {\n      targetUserIds.push(targetPeerId);\n    }\n    currency = action.currency;\n    if (action.cryptoCurrency) {\n      const cryptoAmountWithDecimals = action.cryptoAmount!.divide(1e7).toJSNumber() / 100;\n      giftCryptoInfo = {\n        currency: action.cryptoCurrency,\n        amount: cryptoAmountWithDecimals.toFixed(2),\n      };\n    }\n    amount = action.amount.toJSNumber();\n    months = action.months;\n  } else if (action instanceof GramJs.MessageActionTopicCreate) {\n    text = 'TopicWasCreatedAction';\n    type = 'topicCreate';\n    translationValues.push(action.title);\n  } else if (action instanceof GramJs.MessageActionTopicEdit) {\n    if (action.closed !== undefined) {\n      text = action.closed ? 'TopicWasClosedAction' : 'TopicWasReopenedAction';\n      translationValues.push('%action_origin%', '%action_topic%');\n    } else if (action.hidden !== undefined) {\n      text = action.hidden ? 'TopicHidden2' : 'TopicShown';\n    } else if (action.title) {\n      text = 'TopicRenamedTo';\n      translationValues.push('%action_origin%', action.title);\n    } else if (action.iconEmojiId) {\n      text = 'TopicWasIconChangedToAction';\n      translationValues.push('%action_origin%', '%action_topic_icon%');\n      topicEmojiIconId = action.iconEmojiId.toString();\n    } else {\n      text = 'ChatList.UnsupportedMessage';\n    }\n    isTopicAction = true;\n  } else if (action instanceof GramJs.MessageActionSuggestProfilePhoto) {\n    const isVideo = action.photo instanceof GramJs.Photo && action.photo.videoSizes?.length;\n    text = senderId === currentUserId\n      ? (isVideo ? 'ActionSuggestVideoFromYouDescription' : 'ActionSuggestPhotoFromYouDescription')\n      : (isVideo ? 'ActionSuggestVideoToYouDescription' : 'ActionSuggestPhotoToYouDescription');\n    type = 'suggestProfilePhoto';\n    translationValues.push('%target_user%');\n\n    if (targetPeerId) targetUserIds.push(targetPeerId);\n  } else if (action instanceof GramJs.MessageActionGiveawayLaunch) {\n    text = 'BoostingGiveawayJustStarted';\n    translationValues.push('%action_origin%');\n  } else if (action instanceof GramJs.MessageActionGiftCode) {\n    text = 'BoostingReceivedGiftNoName';\n    slug = action.slug;\n    months = action.months;\n    isGiveaway = Boolean(action.viaGiveaway);\n    isUnclaimed = Boolean(action.unclaimed);\n    if (action.boostPeer) {\n      targetChatId = getApiChatIdFromMtpPeer(action.boostPeer);\n    }\n  } else if (action instanceof GramJs.MessageActionGiveawayResults) {\n    if (!action.winnersCount) {\n      text = 'lng_action_giveaway_results_none';\n    } else if (action.unclaimedCount) {\n      text = 'lng_action_giveaway_results_some';\n    } else {\n      text = 'BoostingGiveawayServiceWinnersSelected';\n      translationValues.push('%amount%');\n      amount = action.winnersCount;\n      pluralValue = action.winnersCount;\n    }\n  } else {\n    text = 'ChatList.UnsupportedMessage';\n  }\n\n  if ('photo' in action && action.photo instanceof GramJs.Photo) {\n    addPhotoToLocalDb(action.photo);\n    photo = buildApiPhoto(action.photo);\n  }\n\n  return {\n    text,\n    type,\n    targetUserIds,\n    targetChatId,\n    photo, // TODO Only used internally now, will be used for the UI in future\n    amount,\n    currency,\n    giftCryptoInfo,\n    isGiveaway,\n    slug,\n    translationValues,\n    call,\n    phoneCall,\n    score,\n    months,\n    topicEmojiIconId,\n    isTopicAction,\n    isUnclaimed,\n    pluralValue,\n  };\n}\n\nfunction buildReplyButtons(message: UniversalMessage, shouldSkipBuyButton?: boolean): ApiReplyKeyboard | undefined {\n  const { replyMarkup, media } = message;\n\n  if (!(replyMarkup instanceof GramJs.ReplyKeyboardMarkup || replyMarkup instanceof GramJs.ReplyInlineMarkup)) {\n    return undefined;\n  }\n\n  const markup = replyMarkup.rows.map(({ buttons }) => {\n    return buttons.map((button): ApiKeyboardButton | undefined => {\n      const { text } = button;\n\n      if (button instanceof GramJs.KeyboardButton) {\n        return {\n          type: 'command',\n          text,\n        };\n      }\n\n      if (button instanceof GramJs.KeyboardButtonUrl) {\n        if (button.url.includes('?startgroup=')) {\n          return {\n            type: 'unsupported',\n            text,\n          };\n        }\n\n        return {\n          type: 'url',\n          text,\n          url: button.url,\n        };\n      }\n\n      if (button instanceof GramJs.KeyboardButtonCallback) {\n        if (button.requiresPassword) {\n          return {\n            type: 'unsupported',\n            text,\n          };\n        }\n\n        return {\n          type: 'callback',\n          text,\n          data: serializeBytes(button.data),\n        };\n      }\n\n      if (button instanceof GramJs.KeyboardButtonRequestPoll) {\n        return {\n          type: 'requestPoll',\n          text,\n          isQuiz: button.quiz,\n        };\n      }\n\n      if (button instanceof GramJs.KeyboardButtonRequestPhone) {\n        return {\n          type: 'requestPhone',\n          text,\n        };\n      }\n\n      if (button instanceof GramJs.KeyboardButtonBuy) {\n        if (media instanceof GramJs.MessageMediaInvoice && media.receiptMsgId) {\n          return {\n            type: 'receipt',\n            text: 'PaymentReceipt',\n            receiptMessageId: media.receiptMsgId,\n          };\n        }\n        if (shouldSkipBuyButton) return undefined;\n        return {\n          type: 'buy',\n          text,\n        };\n      }\n\n      if (button instanceof GramJs.KeyboardButtonGame) {\n        return {\n          type: 'game',\n          text,\n        };\n      }\n\n      if (button instanceof GramJs.KeyboardButtonSwitchInline) {\n        return {\n          type: 'switchBotInline',\n          text,\n          query: button.query,\n          isSamePeer: button.samePeer,\n        };\n      }\n\n      if (button instanceof GramJs.KeyboardButtonUserProfile) {\n        return {\n          type: 'userProfile',\n          text,\n          userId: button.userId.toString(),\n        };\n      }\n\n      if (button instanceof GramJs.KeyboardButtonSimpleWebView) {\n        return {\n          type: 'simpleWebView',\n          text,\n          url: button.url,\n        };\n      }\n\n      if (button instanceof GramJs.KeyboardButtonWebView) {\n        return {\n          type: 'webView',\n          text,\n          url: button.url,\n        };\n      }\n\n      if (button instanceof GramJs.KeyboardButtonUrlAuth) {\n        return {\n          type: 'urlAuth',\n          text,\n          url: button.url,\n          buttonId: button.buttonId,\n        };\n      }\n\n      return {\n        type: 'unsupported',\n        text,\n      };\n    }).filter(Boolean);\n  });\n\n  if (markup.every((row) => !row.length)) return undefined;\n\n  return {\n    [replyMarkup instanceof GramJs.ReplyKeyboardMarkup ? 'keyboardButtons' : 'inlineButtons']: markup,\n    ...(replyMarkup instanceof GramJs.ReplyKeyboardMarkup && {\n      keyboardPlaceholder: replyMarkup.placeholder,\n      isKeyboardSingleUse: replyMarkup.singleUse,\n      isKeyboardSelective: replyMarkup.selective,\n    }),\n  };\n}\n\nfunction buildNewPoll(poll: ApiNewPoll, localId: number) {\n  return {\n    poll: {\n      id: String(localId),\n      summary: pick(poll.summary, ['question', 'answers']),\n      results: {},\n    },\n  };\n}\n\nexport function buildLocalMessage(\n  chat: ApiChat,\n  lastMessageId?: number,\n  text?: string,\n  entities?: ApiMessageEntity[],\n  replyInfo?: ApiInputReplyInfo,\n  attachment?: ApiAttachment,\n  sticker?: ApiSticker,\n  gif?: ApiVideo,\n  poll?: ApiNewPoll,\n  contact?: ApiContact,\n  groupedId?: string,\n  scheduledAt?: number,\n  sendAs?: ApiPeer,\n  story?: ApiStory | ApiStorySkipped,\n): ApiMessage {\n  const localId = getNextLocalMessageId(lastMessageId);\n  const media = attachment && buildUploadingMedia(attachment);\n  const isChannel = chat.type === 'chatTypeChannel';\n\n  const resultReplyInfo = replyInfo && buildReplyInfo(replyInfo, chat.isForum);\n\n  const message = {\n    id: localId,\n    chatId: chat.id,\n    content: {\n      ...(text && {\n        text: {\n          text,\n          entities,\n        },\n      }),\n      ...media,\n      ...(sticker && { sticker }),\n      ...(gif && { video: gif }),\n      ...(poll && buildNewPoll(poll, localId)),\n      ...(contact && { contact }),\n      ...(story && { storyData: story }),\n    },\n    date: scheduledAt || Math.round(Date.now() / 1000) + getServerTimeOffset(),\n    isOutgoing: !isChannel,\n    senderId: sendAs?.id || currentUserId,\n    replyInfo: resultReplyInfo,\n    ...(groupedId && {\n      groupedId,\n      ...(media && (media.photo || media.video) && { isInAlbum: true }),\n    }),\n    ...(scheduledAt && { isScheduled: true }),\n    isForwardingAllowed: true,\n  } satisfies ApiMessage;\n\n  const emojiOnlyCount = getEmojiOnlyCountForMessage(message.content, message.groupedId);\n\n  return {\n    ...message,\n    ...(emojiOnlyCount && { emojiOnlyCount }),\n  };\n}\n\nexport function buildLocalForwardedMessage({\n  toChat,\n  toThreadId,\n  message,\n  scheduledAt,\n  noAuthors,\n  noCaptions,\n  isCurrentUserPremium,\n  lastMessageId,\n}: {\n  toChat: ApiChat;\n  toThreadId?: number;\n  message: ApiMessage;\n  scheduledAt?: number;\n  noAuthors?: boolean;\n  noCaptions?: boolean;\n  isCurrentUserPremium?: boolean;\n  lastMessageId?: number;\n}): ApiMessage {\n  const localId = getNextLocalMessageId(lastMessageId);\n  const {\n    content,\n    chatId: fromChatId,\n    id: fromMessageId,\n    senderId,\n    groupedId,\n    isInAlbum,\n  } = message;\n\n  const isAudio = content.audio;\n  const asIncomingInChatWithSelf = (\n    toChat.id === currentUserId && (fromChatId !== toChat.id || message.forwardInfo) && !isAudio\n  );\n  const shouldHideText = Object.keys(content).length > 1 && content.text && noCaptions;\n  const shouldDropCustomEmoji = !isCurrentUserPremium;\n  const strippedText = content.text?.entities && shouldDropCustomEmoji ? {\n    text: content.text.text,\n    entities: content.text.entities.filter((entity) => entity.type !== ApiMessageEntityTypes.CustomEmoji),\n  } : content.text;\n  const emojiOnlyCount = getEmojiOnlyCountForMessage(content, groupedId);\n\n  const updatedContent = {\n    ...content,\n    text: !shouldHideText ? strippedText : undefined,\n  };\n\n  // TODO Prepare reply info between forwarded messages locally, to prevent height jumps\n  const isToMainThread = toThreadId === MAIN_THREAD_ID;\n  const replyInfo: ApiReplyInfo | undefined = toThreadId && !isToMainThread ? {\n    type: 'message',\n    replyToMsgId: toThreadId,\n    replyToTopId: toThreadId,\n    isForumTopic: toChat.isForum || undefined,\n  } : undefined;\n\n  return {\n    id: localId,\n    chatId: toChat.id,\n    content: updatedContent,\n    date: scheduledAt || Math.round(Date.now() / 1000) + getServerTimeOffset(),\n    isOutgoing: !asIncomingInChatWithSelf && toChat.type !== 'chatTypeChannel',\n    senderId: currentUserId,\n    sendingState: 'messageSendingStatePending',\n    groupedId,\n    isInAlbum,\n    isForwardingAllowed: true,\n    replyInfo,\n    ...(toThreadId && toChat?.isForum && { isTopicReply: true }),\n\n    ...(emojiOnlyCount && { emojiOnlyCount }),\n    // Forward info doesn't get added when users forwards his own messages, also when forwarding audio\n    ...(message.chatId !== currentUserId && !isAudio && !noAuthors && {\n      forwardInfo: {\n        date: message.forwardInfo?.date || message.date,\n        savedDate: message.date,\n        isChannelPost: false,\n        fromChatId,\n        fromMessageId,\n        fromId: senderId,\n        savedFromPeerId: message.chatId,\n      },\n    }),\n    ...(message.chatId === currentUserId && !noAuthors && { forwardInfo: message.forwardInfo }),\n    ...(scheduledAt && { isScheduled: true }),\n  };\n}\n\nfunction buildReplyInfo(inputInfo: ApiInputReplyInfo, isForum?: boolean): ApiReplyInfo {\n  if (inputInfo.type === 'story') {\n    return {\n      type: 'story',\n      userId: inputInfo.userId,\n      storyId: inputInfo.storyId,\n    };\n  }\n\n  return {\n    type: 'message',\n    replyToMsgId: inputInfo.replyToMsgId,\n    replyToTopId: inputInfo.replyToTopId,\n    replyToPeerId: inputInfo.replyToPeerId,\n    quoteText: inputInfo.quoteText,\n    isForumTopic: isForum && inputInfo.replyToTopId ? true : undefined,\n    ...(Boolean(inputInfo.quoteText) && { isQuote: true }),\n  };\n}\n\nexport function buildUploadingMedia(\n  attachment: ApiAttachment,\n): MediaContent {\n  const {\n    filename: fileName,\n    blobUrl,\n    previewBlobUrl,\n    mimeType,\n    size,\n    audio,\n    shouldSendAsFile,\n    shouldSendAsSpoiler,\n    ttlSeconds,\n  } = attachment;\n\n  if (!shouldSendAsFile) {\n    if (attachment.quick) {\n      // TODO Handle GIF as video, but support playback in <video>\n      if (SUPPORTED_IMAGE_CONTENT_TYPES.has(mimeType)) {\n        const { width, height } = attachment.quick;\n        return {\n          photo: {\n            id: LOCAL_MEDIA_UPLOADING_TEMP_ID,\n            sizes: [],\n            thumbnail: { width, height, dataUri: previewBlobUrl || blobUrl },\n            blobUrl,\n            isSpoiler: shouldSendAsSpoiler,\n          },\n        };\n      }\n      if (SUPPORTED_VIDEO_CONTENT_TYPES.has(mimeType)) {\n        const { width, height, duration } = attachment.quick;\n        return {\n          video: {\n            id: LOCAL_MEDIA_UPLOADING_TEMP_ID,\n            mimeType,\n            duration: duration || 0,\n            fileName,\n            width,\n            height,\n            blobUrl,\n            ...(previewBlobUrl && { thumbnail: { width, height, dataUri: previewBlobUrl } }),\n            size,\n            isSpoiler: shouldSendAsSpoiler,\n          },\n        };\n      }\n    }\n    if (attachment.voice) {\n      const { duration, waveform } = attachment.voice;\n      const { data: inputWaveform } = interpolateArray(waveform, INPUT_WAVEFORM_LENGTH);\n      return {\n        voice: {\n          id: LOCAL_MEDIA_UPLOADING_TEMP_ID,\n          duration,\n          waveform: inputWaveform,\n        },\n        ttlSeconds,\n      };\n    }\n    if (SUPPORTED_AUDIO_CONTENT_TYPES.has(mimeType)) {\n      const { duration, performer, title } = audio || {};\n      return {\n        audio: {\n          id: LOCAL_MEDIA_UPLOADING_TEMP_ID,\n          mimeType,\n          fileName,\n          size,\n          duration: duration || 0,\n          title,\n          performer,\n        },\n      };\n    }\n  }\n  return {\n    document: {\n      mimeType,\n      fileName,\n      size,\n      ...(previewBlobUrl && { previewBlobUrl }),\n    },\n  };\n}\n\nexport function buildApiThreadInfoFromMessage(\n  mtpMessage: GramJs.TypeMessage,\n): ApiThreadInfo | undefined {\n  const chatId = resolveMessageApiChatId(mtpMessage);\n  if (\n    !chatId\n    || !(mtpMessage instanceof GramJs.Message)\n    || !mtpMessage.replies) {\n    return undefined;\n  }\n\n  return buildApiThreadInfo(mtpMessage.replies, mtpMessage.id, chatId);\n}\n\nexport function buildApiThreadInfo(\n  messageReplies: GramJs.TypeMessageReplies, messageId: number, chatId: string,\n): ApiThreadInfo | undefined {\n  const {\n    channelId, replies, maxId, readMaxId, recentRepliers, comments,\n  } = messageReplies;\n\n  const apiChannelId = channelId ? buildApiPeerId(channelId, 'channel') : undefined;\n  if (apiChannelId === DELETED_COMMENTS_CHANNEL_ID) {\n    return undefined;\n  }\n\n  const baseThreadInfo = {\n    messagesCount: replies,\n    ...(maxId && { lastMessageId: maxId }),\n    ...(readMaxId && { lastReadMessageId: readMaxId }),\n    ...(recentRepliers && { recentReplierIds: recentRepliers.map(getApiChatIdFromMtpPeer) }),\n  };\n\n  if (comments) {\n    return {\n      ...baseThreadInfo,\n      isCommentsInfo: true,\n      chatId: apiChannelId!,\n      originChannelId: chatId,\n      originMessageId: messageId,\n    };\n  }\n\n  return {\n    ...baseThreadInfo,\n    isCommentsInfo: false,\n    chatId,\n    threadId: messageId,\n  };\n}\n\nfunction buildSponsoredWebPage(webPage: GramJs.TypeSponsoredWebPage): ApiSponsoredWebPage {\n  let photo: ApiPhoto | undefined;\n  if (webPage.photo instanceof GramJs.Photo) {\n    addPhotoToLocalDb(webPage.photo);\n    photo = buildApiPhoto(webPage.photo);\n  }\n\n  return {\n    ...pick(webPage, [\n      'url',\n      'siteName',\n    ]),\n    photo,\n  };\n}\n","import { Api as GramJs } from '../../../lib/gramjs';\n\nimport type {\n  ApiPremiumGiftOption,\n  ApiUser,\n  ApiUserFullInfo,\n  ApiUserStatus,\n  ApiUserType,\n} from '../../types';\n\nimport { buildApiBotInfo } from './bots';\nimport { buildApiPhoto, buildApiUsernames } from './common';\nimport { buildApiEmojiStatus, buildApiPeerColor, buildApiPeerId } from './peers';\n\nexport function buildApiUserFullInfo(mtpUserFull: GramJs.users.UserFull): ApiUserFullInfo {\n  const {\n    fullUser: {\n      about, commonChatsCount, pinnedMsgId, botInfo, blocked,\n      profilePhoto, voiceMessagesForbidden, premiumGifts,\n      fallbackPhoto, personalPhoto, translationsDisabled, storiesPinnedAvailable,\n    },\n    users,\n  } = mtpUserFull;\n\n  const userId = buildApiPeerId(users[0].id, 'user');\n\n  return {\n    bio: about,\n    commonChatsCount,\n    pinnedMessageId: pinnedMsgId,\n    isBlocked: Boolean(blocked),\n    noVoiceMessages: voiceMessagesForbidden,\n    hasPinnedStories: Boolean(storiesPinnedAvailable),\n    isTranslationDisabled: translationsDisabled,\n    profilePhoto: profilePhoto instanceof GramJs.Photo ? buildApiPhoto(profilePhoto) : undefined,\n    fallbackPhoto: fallbackPhoto instanceof GramJs.Photo ? buildApiPhoto(fallbackPhoto) : undefined,\n    personalPhoto: personalPhoto instanceof GramJs.Photo ? buildApiPhoto(personalPhoto) : undefined,\n    ...(premiumGifts && { premiumGifts: premiumGifts.map((gift) => buildApiPremiumGiftOption(gift)) }),\n    ...(botInfo && { botInfo: buildApiBotInfo(botInfo, userId) }),\n  };\n}\n\nexport function buildApiUser(mtpUser: GramJs.TypeUser): ApiUser | undefined {\n  if (!(mtpUser instanceof GramJs.User)) {\n    return undefined;\n  }\n\n  const {\n    id, firstName, lastName, fake, scam, support, closeFriend, storiesUnavailable, storiesMaxId,\n  } = mtpUser;\n  const hasVideoAvatar = mtpUser.photo instanceof GramJs.UserProfilePhoto\n    ? Boolean(mtpUser.photo.hasVideo)\n    : undefined;\n  const avatarHash = mtpUser.photo instanceof GramJs.UserProfilePhoto\n    ? String(mtpUser.photo.photoId)\n    : undefined;\n  const userType = buildApiUserType(mtpUser);\n  const usernames = buildApiUsernames(mtpUser);\n  const emojiStatus = mtpUser.emojiStatus ? buildApiEmojiStatus(mtpUser.emojiStatus) : undefined;\n\n  return {\n    id: buildApiPeerId(id, 'user'),\n    isMin: Boolean(mtpUser.min),\n    fakeType: scam ? 'scam' : (fake ? 'fake' : undefined),\n    ...(mtpUser.self && { isSelf: true }),\n    isPremium: Boolean(mtpUser.premium),\n    ...(mtpUser.verified && { isVerified: true }),\n    ...(closeFriend && { isCloseFriend: true }),\n    ...(support && { isSupport: true }),\n    ...((mtpUser.contact || mtpUser.mutualContact) && { isContact: true }),\n    type: userType,\n    firstName,\n    lastName,\n    canEditBot: Boolean(mtpUser.botCanEdit),\n    ...(userType === 'userTypeBot' && { canBeInvitedToGroup: !mtpUser.botNochats }),\n    ...(usernames && { usernames }),\n    phoneNumber: mtpUser.phone || '',\n    noStatus: !mtpUser.status,\n    ...(mtpUser.accessHash && { accessHash: String(mtpUser.accessHash) }),\n    ...(avatarHash && { avatarHash }),\n    emojiStatus,\n    hasVideoAvatar,\n    areStoriesHidden: Boolean(mtpUser.storiesHidden),\n    maxStoryId: storiesMaxId,\n    hasStories: Boolean(storiesMaxId) && !storiesUnavailable,\n    ...(mtpUser.bot && mtpUser.botInlinePlaceholder && { botPlaceholder: mtpUser.botInlinePlaceholder }),\n    ...(mtpUser.bot && mtpUser.botAttachMenu && { isAttachBot: mtpUser.botAttachMenu }),\n    color: mtpUser.color && buildApiPeerColor(mtpUser.color),\n  };\n}\n\nfunction buildApiUserType(user: GramJs.User): ApiUserType {\n  if (user.bot) {\n    return 'userTypeBot';\n  }\n  if (user.deleted) {\n    return 'userTypeDeleted';\n  }\n\n  return 'userTypeRegular';\n}\n\nexport function buildApiUserStatus(mtpStatus?: GramJs.TypeUserStatus): ApiUserStatus {\n  if (!mtpStatus || mtpStatus instanceof GramJs.UserStatusEmpty) {\n    return { type: 'userStatusEmpty' };\n  } else if (mtpStatus instanceof GramJs.UserStatusOnline) {\n    return { type: 'userStatusOnline', expires: mtpStatus.expires };\n  } else if (mtpStatus instanceof GramJs.UserStatusOffline) {\n    return { type: 'userStatusOffline', wasOnline: mtpStatus.wasOnline };\n  } else if (mtpStatus instanceof GramJs.UserStatusRecently) {\n    return { type: 'userStatusRecently', isReadDateRestrictedByMe: mtpStatus.byMe };\n  } else if (mtpStatus instanceof GramJs.UserStatusLastWeek) {\n    return { type: 'userStatusLastWeek', isReadDateRestrictedByMe: mtpStatus.byMe };\n  } else {\n    return { type: 'userStatusLastMonth', isReadDateRestrictedByMe: mtpStatus.byMe };\n  }\n}\n\nexport function buildApiUsersAndStatuses(mtpUsers: GramJs.TypeUser[]) {\n  const userStatusesById: Record<string, ApiUserStatus> = {};\n  const usersById: Record<string, ApiUser> = {};\n\n  mtpUsers.forEach((mtpUser) => {\n    const user = buildApiUser(mtpUser);\n    if (!user) {\n      return;\n    }\n\n    const duplicateUser = usersById[user.id];\n    if (!duplicateUser || duplicateUser.isMin) {\n      usersById[user.id] = user;\n    }\n\n    if ('status' in mtpUser) {\n      userStatusesById[user.id] = buildApiUserStatus(mtpUser.status);\n    }\n  });\n\n  return { users: Object.values(usersById), userStatusesById };\n}\n\nexport function buildApiPremiumGiftOption(option: GramJs.TypePremiumGiftOption): ApiPremiumGiftOption {\n  const {\n    months, currency, amount, botUrl,\n  } = option;\n\n  return {\n    months,\n    currency,\n    amount: amount.toJSNumber(),\n    botUrl,\n  };\n}\n","import { Api as GramJs } from '../../../lib/gramjs';\n\nimport type { ApiPrivacyKey } from '../../../types';\nimport type {\n  ApiConfig, ApiCountry, ApiLangString,\n  ApiPeerColors,\n  ApiSession, ApiUrlAuthResult, ApiWallpaper, ApiWebSession,\n} from '../../types';\n\nimport { buildCollectionByCallback, omit, pick } from '../../../util/iteratees';\nimport { getServerTime } from '../../../util/serverTime';\nimport { addUserToLocalDb } from '../helpers';\nimport { omitVirtualClassFields } from './helpers';\nimport { buildApiDocument } from './messageContent';\nimport { buildApiPeerId, getApiChatIdFromMtpPeer } from './peers';\nimport { buildApiReaction } from './reactions';\nimport { buildApiUser } from './users';\n\nexport function buildApiWallpaper(wallpaper: GramJs.TypeWallPaper): ApiWallpaper | undefined {\n  if (wallpaper instanceof GramJs.WallPaperNoFile) {\n    // TODO: Plain color wallpapers\n    return undefined;\n  }\n\n  const { slug } = wallpaper;\n\n  const document = buildApiDocument(wallpaper.document);\n\n  if (!document) {\n    return undefined;\n  }\n\n  return {\n    slug,\n    document,\n  };\n}\n\nexport function buildApiSession(session: GramJs.Authorization): ApiSession {\n  return {\n    isCurrent: Boolean(session.current),\n    isOfficialApp: Boolean(session.officialApp),\n    isPasswordPending: Boolean(session.passwordPending),\n    hash: String(session.hash),\n    areCallsEnabled: !session.callRequestsDisabled,\n    areSecretChatsEnabled: !session.encryptedRequestsDisabled,\n    isUnconfirmed: session.unconfirmed,\n    ...pick(session, [\n      'deviceModel', 'platform', 'systemVersion', 'appName', 'appVersion', 'dateCreated', 'dateActive',\n      'ip', 'country', 'region',\n    ]),\n  };\n}\n\nexport function buildApiWebSession(session: GramJs.WebAuthorization): ApiWebSession {\n  return {\n    hash: String(session.hash),\n    botId: buildApiPeerId(session.botId, 'user'),\n    ...pick(session, [\n      'platform', 'browser', 'dateCreated', 'dateActive', 'ip', 'region', 'domain',\n    ]),\n  };\n}\n\nexport function buildPrivacyKey(key: GramJs.TypePrivacyKey): ApiPrivacyKey | undefined {\n  switch (key.className) {\n    case 'PrivacyKeyPhoneNumber':\n      return 'phoneNumber';\n    case 'PrivacyKeyAddedByPhone':\n      return 'addByPhone';\n    case 'PrivacyKeyStatusTimestamp':\n      return 'lastSeen';\n    case 'PrivacyKeyProfilePhoto':\n      return 'profilePhoto';\n    case 'PrivacyKeyPhoneCall':\n      return 'phoneCall';\n    case 'PrivacyKeyPhoneP2P':\n      return 'phoneP2P';\n    case 'PrivacyKeyForwards':\n      return 'forwards';\n    case 'PrivacyKeyVoiceMessages':\n      return 'voiceMessages';\n    case 'PrivacyKeyChatInvite':\n      return 'chatInvite';\n  }\n\n  return undefined;\n}\n\nexport function buildApiNotifyException(\n  notifySettings: GramJs.TypePeerNotifySettings, peer: GramJs.TypePeer,\n) {\n  const {\n    silent, muteUntil, showPreviews, otherSound,\n  } = notifySettings;\n\n  const hasSound = Boolean(otherSound && !(otherSound instanceof GramJs.NotificationSoundNone));\n\n  return {\n    chatId: getApiChatIdFromMtpPeer(peer),\n    isMuted: silent || (typeof muteUntil === 'number' && getServerTime() < muteUntil),\n    ...(!hasSound && { isSilent: true }),\n    ...(showPreviews !== undefined && { shouldShowPreviews: Boolean(showPreviews) }),\n    muteUntil,\n  };\n}\n\nexport function buildApiNotifyExceptionTopic(\n  notifySettings: GramJs.TypePeerNotifySettings, peer: GramJs.TypePeer, topicId: number,\n) {\n  const {\n    silent, muteUntil, showPreviews, otherSound,\n  } = notifySettings;\n\n  const hasSound = Boolean(otherSound && !(otherSound instanceof GramJs.NotificationSoundNone));\n\n  return {\n    chatId: getApiChatIdFromMtpPeer(peer),\n    topicId,\n    isMuted: silent || (typeof muteUntil === 'number' && getServerTime() < muteUntil),\n    ...(!hasSound && { isSilent: true }),\n    ...(showPreviews !== undefined && { shouldShowPreviews: Boolean(showPreviews) }),\n    muteUntil,\n  };\n}\n\nfunction buildApiCountry(country: GramJs.help.Country, code: GramJs.help.CountryCode) {\n  const {\n    hidden, iso2, defaultName, name,\n  } = country;\n  const { countryCode, prefixes, patterns } = code || {};\n\n  return {\n    isHidden: hidden,\n    iso2,\n    defaultName,\n    name,\n    countryCode,\n    prefixes,\n    patterns,\n  };\n}\n\nexport function buildApiCountryList(countries: GramJs.help.Country[]) {\n  const nonHiddenCountries = countries.filter(({ hidden }) => !hidden);\n  const listByCode = nonHiddenCountries\n    .map((country) => (\n      country.countryCodes.map((code) => buildApiCountry(country, code))\n    ))\n    .flat()\n    .sort((a: ApiCountry, b: ApiCountry) => (\n      a.name ? a.name.localeCompare(b.name!) : a.defaultName.localeCompare(b.defaultName)\n    ));\n\n  const generalList = nonHiddenCountries\n    .map((country) => buildApiCountry(country, country.countryCodes[0]))\n    .sort((a, b) => (\n      a.name ? a.name.localeCompare(b.name!) : a.defaultName.localeCompare(b.defaultName)\n    ));\n\n  return {\n    phoneCodes: listByCode,\n    general: generalList,\n  };\n}\n\nexport function buildJson(json: GramJs.TypeJSONValue): any {\n  if (json instanceof GramJs.JsonNull) return undefined;\n  if (json instanceof GramJs.JsonString\n    || json instanceof GramJs.JsonBool\n    || json instanceof GramJs.JsonNumber) return json.value;\n  if (json instanceof GramJs.JsonArray) return json.value.map(buildJson);\n\n  return json.value.reduce((acc: Record<string, any>, el) => {\n    acc[el.key] = buildJson(el.value);\n    return acc;\n  }, {});\n}\n\nexport function buildApiUrlAuthResult(result: GramJs.TypeUrlAuthResult): ApiUrlAuthResult | undefined {\n  if (result instanceof GramJs.UrlAuthResultRequest) {\n    const { bot, domain, requestWriteAccess } = result;\n    const user = buildApiUser(bot);\n    if (!user) return undefined;\n\n    addUserToLocalDb(bot);\n\n    return {\n      type: 'request',\n      domain,\n      shouldRequestWriteAccess: requestWriteAccess,\n      bot: user,\n    };\n  }\n\n  if (result instanceof GramJs.UrlAuthResultAccepted) {\n    return {\n      type: 'accepted',\n      url: result.url,\n    };\n  }\n\n  if (result instanceof GramJs.UrlAuthResultDefault) {\n    return {\n      type: 'default',\n    };\n  }\n  return undefined;\n}\n\nexport function buildApiConfig(config: GramJs.Config): ApiConfig {\n  const defaultReaction = config.reactionsDefault && buildApiReaction(config.reactionsDefault);\n  return {\n    expiresAt: config.expires,\n    gifSearchUsername: config.gifSearchUsername,\n    defaultReaction,\n    maxGroupSize: config.chatSizeMax,\n    autologinToken: config.autologinToken,\n  };\n}\n\nexport function buildLangPack(mtpLangPack: GramJs.LangPackDifference) {\n  return mtpLangPack.strings.reduce<Record<string, ApiLangString | undefined>>((acc, mtpString) => {\n    acc[mtpString.key] = buildLangPackString(mtpString);\n    return acc;\n  }, {});\n}\n\nexport function buildLangPackString(mtpString: GramJs.TypeLangPackString) {\n  return mtpString instanceof GramJs.LangPackString\n    ? mtpString.value\n    : mtpString instanceof GramJs.LangPackStringPluralized\n      ? omit(omitVirtualClassFields(mtpString), ['key'])\n      : undefined;\n}\n\nfunction buildApiPeerColorSet(colorSet: GramJs.help.TypePeerColorSet) {\n  if (colorSet instanceof GramJs.help.PeerColorSet) {\n    return colorSet.colors.map((color) => `#${color.toString(16).padStart(6, '0')}`);\n  }\n  return undefined;\n}\n\nexport function buildApiPeerColors(wrapper: GramJs.help.TypePeerColors): ApiPeerColors['general'] | undefined {\n  if (!(wrapper instanceof GramJs.help.PeerColors)) return undefined;\n\n  return buildCollectionByCallback(wrapper.colors, (color) => {\n    return [color.colorId, {\n      isHidden: color.hidden,\n      colors: color.colors && buildApiPeerColorSet(color.colors),\n      darkColors: color.darkColors && buildApiPeerColorSet(color.darkColors),\n    }];\n  });\n}\n","import { Api as GramJs } from '../../../lib/gramjs';\n\nimport type {\n  ApiMediaArea,\n  ApiMediaAreaCoordinates,\n  ApiStealthMode,\n  ApiStoryForwardInfo,\n  ApiStoryView,\n  ApiStoryViews,\n  ApiTypeStory,\n  ApiTypeStoryView,\n  MediaContent,\n} from '../../types';\n\nimport { buildCollectionByCallback, omitUndefined } from '../../../util/iteratees';\nimport { buildPrivacyRules } from './common';\nimport { buildGeoPoint, buildMessageMediaContent, buildMessageTextContent } from './messageContent';\nimport { buildApiMessage } from './messages';\nimport { buildApiPeerId, getApiChatIdFromMtpPeer } from './peers';\nimport { buildApiReaction, buildReactionCount } from './reactions';\n\nexport function buildApiStory(peerId: string, story: GramJs.TypeStoryItem): ApiTypeStory {\n  if (story instanceof GramJs.StoryItemDeleted) {\n    return {\n      id: story.id,\n      peerId,\n      isDeleted: true,\n    };\n  }\n\n  if (story instanceof GramJs.StoryItemSkipped) {\n    const {\n      id, date, expireDate, closeFriends,\n    } = story;\n\n    return {\n      id,\n      peerId,\n      ...(closeFriends && { isForCloseFriends: true }),\n      date,\n      expireDate,\n    };\n  }\n\n  const {\n    edited, pinned, expireDate, id, date, caption,\n    entities, media, privacy, views,\n    public: isPublic, noforwards, closeFriends, contacts, selectedContacts,\n    mediaAreas, sentReaction, out, fwdFrom,\n  } = story;\n\n  const content: MediaContent = {\n    ...buildMessageMediaContent(media),\n  };\n\n  if (caption) {\n    content.text = buildMessageTextContent(caption, entities);\n  }\n\n  return {\n    id,\n    peerId,\n    date,\n    expireDate,\n    content,\n    ...(isPublic && { isPublic }),\n    ...(edited && { isEdited: true }),\n    ...(pinned && { isPinned: true }),\n    ...(contacts && { isForContacts: true }),\n    ...(selectedContacts && { isForSelectedContacts: true }),\n    ...(closeFriends && { isForCloseFriends: true }),\n    ...(noforwards && { noForwards: true }),\n    ...(views && { views: buildApiStoryViews(views) }),\n    ...(out && { isOut: true }),\n    ...(privacy && { visibility: buildPrivacyRules(privacy) }),\n    ...(mediaAreas && { mediaAreas: mediaAreas.map(buildApiMediaArea).filter(Boolean) }),\n    ...(sentReaction && { sentReaction: buildApiReaction(sentReaction) }),\n    ...(fwdFrom && { forwardInfo: buildApiStoryForwardInfo(fwdFrom) }),\n  };\n}\n\nfunction buildApiStoryViews(views: GramJs.TypeStoryViews): ApiStoryViews | undefined {\n  return {\n    viewsCount: views.viewsCount,\n    forwardsCount: views.forwardsCount,\n    reactionsCount: views.reactionsCount,\n    ...(views?.reactions && { reactions: views.reactions.map(buildReactionCount).filter(Boolean) }),\n    ...(views?.recentViewers && {\n      recentViewerIds: views.recentViewers.map((viewerId) => buildApiPeerId(viewerId, 'user')),\n    }),\n  };\n}\n\nexport function buildApiStoryView(view: GramJs.TypeStoryView): ApiTypeStoryView | undefined {\n  const {\n    blockedMyStoriesFrom, blocked,\n  } = view;\n\n  if (view instanceof GramJs.StoryView) {\n    return omitUndefined<ApiStoryView>({\n      type: 'user',\n      peerId: buildApiPeerId(view.userId, 'user'),\n      date: view.date,\n      reaction: view.reaction && buildApiReaction(view.reaction),\n      areStoriesBlocked: blocked || blockedMyStoriesFrom,\n      isUserBlocked: blocked,\n    });\n  }\n\n  if (view instanceof GramJs.StoryViewPublicForward) {\n    const message = buildApiMessage(view.message);\n    if (!message) return undefined;\n    return {\n      type: 'forward',\n      peerId: message.chatId,\n      messageId: message.id,\n      message,\n      date: message.date,\n      areStoriesBlocked: blocked || blockedMyStoriesFrom,\n      isUserBlocked: blocked,\n    };\n  }\n\n  if (view instanceof GramJs.StoryViewPublicRepost) {\n    const peerId = getApiChatIdFromMtpPeer(view.peerId);\n    const story = buildApiStory(peerId, view.story);\n    if (!('content' in story)) return undefined;\n\n    return {\n      type: 'repost',\n      peerId,\n      storyId: view.story.id,\n      date: story.date,\n      story,\n      areStoriesBlocked: blocked || blockedMyStoriesFrom,\n      isUserBlocked: blocked,\n    };\n  }\n\n  return undefined;\n}\n\nexport function buildApiStealthMode(stealthMode: GramJs.TypeStoriesStealthMode): ApiStealthMode {\n  return {\n    activeUntil: stealthMode.activeUntilDate,\n    cooldownUntil: stealthMode.cooldownUntilDate,\n  };\n}\n\nfunction buildApiMediaAreaCoordinates(coordinates: GramJs.TypeMediaAreaCoordinates): ApiMediaAreaCoordinates {\n  const {\n    x, y, w, h, rotation,\n  } = coordinates;\n\n  return {\n    x,\n    y,\n    width: w,\n    height: h,\n    rotation,\n  };\n}\n\nexport function buildApiMediaArea(area: GramJs.TypeMediaArea): ApiMediaArea | undefined {\n  if (area instanceof GramJs.MediaAreaVenue) {\n    const { geo, title, coordinates } = area;\n    const point = buildGeoPoint(geo);\n\n    if (!point) return undefined;\n\n    return {\n      type: 'venue',\n      coordinates: buildApiMediaAreaCoordinates(coordinates),\n      geo: point,\n      title,\n    };\n  }\n\n  if (area instanceof GramJs.MediaAreaGeoPoint) {\n    const { geo, coordinates } = area;\n    const point = buildGeoPoint(geo);\n\n    if (!point) return undefined;\n\n    return {\n      type: 'geoPoint',\n      coordinates: buildApiMediaAreaCoordinates(coordinates),\n      geo: point,\n    };\n  }\n\n  if (area instanceof GramJs.MediaAreaSuggestedReaction) {\n    const {\n      coordinates, reaction, dark, flipped,\n    } = area;\n\n    const apiReaction = buildApiReaction(reaction);\n    if (!apiReaction) return undefined;\n\n    return {\n      type: 'suggestedReaction',\n      coordinates: buildApiMediaAreaCoordinates(coordinates),\n      reaction: apiReaction,\n      ...(dark && { isDark: true }),\n      ...(flipped && { isFlipped: true }),\n    };\n  }\n\n  if (area instanceof GramJs.MediaAreaChannelPost) {\n    const { coordinates, channelId, msgId } = area;\n\n    return {\n      type: 'channelPost',\n      coordinates: buildApiMediaAreaCoordinates(coordinates),\n      channelId: buildApiPeerId(channelId, 'channel'),\n      messageId: msgId,\n    };\n  }\n\n  return undefined;\n}\n\nexport function buildApiPeerStories(peerStories: GramJs.PeerStories) {\n  const peerId = getApiChatIdFromMtpPeer(peerStories.peer);\n\n  return buildCollectionByCallback(peerStories.stories, (story) => [story.id, buildApiStory(peerId, story)]);\n}\n\nexport function buildApiStoryForwardInfo(forwardHeader: GramJs.TypeStoryFwdHeader): ApiStoryForwardInfo {\n  const {\n    from, fromName, storyId, modified,\n  } = forwardHeader;\n\n  return {\n    storyId,\n    fromPeerId: from && getApiChatIdFromMtpPeer(from),\n    fromName,\n    isModified: modified,\n  };\n}\n","import type { OnApiUpdate } from '../types';\n\nimport { MAX_INT_32 } from '../../config';\nimport { getServerTime } from '../../util/serverTime';\n\ntype UnmuteQueueItem = { chatId: string; topicId?: number; muteUntil: number };\nconst unmuteTimers = new Map<string, any>();\nconst unmuteQueue: Array<UnmuteQueueItem> = [];\nconst scheduleUnmute = (item: UnmuteQueueItem, onUpdate: NoneToVoidFunction) => {\n  const id = item.topicId ? `${item.chatId}-${item.topicId}` : item.chatId;\n  if (unmuteTimers.has(id)) {\n    clearTimeout(unmuteTimers.get(id));\n    unmuteTimers.delete(id);\n  }\n  if (item.muteUntil === MAX_INT_32 || item.muteUntil <= getServerTime()) return;\n  unmuteQueue.push(item);\n  unmuteQueue.sort((a, b) => b.muteUntil - a.muteUntil);\n  const next = unmuteQueue.pop();\n  if (!next) return;\n  const timer = setTimeout(() => {\n    onUpdate();\n    if (unmuteQueue.length) {\n      const afterNext = unmuteQueue.pop();\n      if (afterNext) scheduleUnmute(afterNext, onUpdate);\n    }\n  }, (item.muteUntil - getServerTime()) * 1000);\n  unmuteTimers.set(id, timer);\n};\n\nexport function scheduleMutedChatUpdate(chatId: string, muteUntil = 0, onUpdate: OnApiUpdate) {\n  scheduleUnmute({\n    chatId,\n    muteUntil,\n  }, () => onUpdate({\n    '@type': 'updateNotifyExceptions',\n    chatId,\n    isMuted: false,\n  }));\n}\n\nexport function scheduleMutedTopicUpdate(chatId: string, topicId: number, muteUntil = 0, onUpdate: OnApiUpdate) {\n  scheduleUnmute({\n    chatId,\n    topicId,\n    muteUntil,\n  }, () => onUpdate({\n    '@type': 'updateTopicNotifyExceptions',\n    chatId,\n    topicId,\n    isMuted: false,\n  }));\n}\n","/* eslint-disable max-classes-per-file */\nimport type { BigInteger } from 'big-integer';\n\nexport class LocalUpdatePts {\n  constructor(public pts: number, public ptsCount: number) {}\n}\n\nexport class LocalUpdateChannelPts {\n  constructor(public channelId: BigInteger, public pts: number, public ptsCount: number) {}\n}\n\nexport type UpdatePts = LocalUpdatePts | LocalUpdateChannelPts;\n\nexport function buildLocalUpdatePts(pts: number, ptsCount: number, channelId?: BigInteger) {\n  return channelId ? new LocalUpdateChannelPts(channelId, pts, ptsCount) : new LocalUpdatePts(pts, ptsCount);\n}\n","import { Api as GramJs, connection } from '../../../lib/gramjs';\n\nimport type { GroupCallConnectionData } from '../../../lib/secret-sauce';\nimport type {\n  ApiMessage, ApiMessageExtendedMediaPreview, ApiStory, ApiStorySkipped,\n  ApiUpdate, ApiUpdateConnectionStateType, MediaContent, OnApiUpdate,\n} from '../../types';\n\nimport { DEBUG, GENERAL_TOPIC_ID } from '../../../config';\nimport { compact, omit, pick } from '../../../util/iteratees';\nimport { getServerTimeOffset, setServerTimeOffset } from '../../../util/serverTime';\nimport { buildApiBotMenuButton } from '../apiBuilders/bots';\nimport {\n  buildApiGroupCall,\n  buildApiGroupCallParticipant,\n  buildPhoneCall,\n  getGroupCallId,\n} from '../apiBuilders/calls';\nimport {\n  buildApiChatFolder,\n  buildApiChatFromPreview,\n  buildApiChatSettings,\n  buildAvatarHash,\n  buildChatMember,\n  buildChatMembers,\n  buildChatTypingStatus,\n} from '../apiBuilders/chats';\nimport { buildApiPhoto, buildApiUsernames, buildPrivacyRules } from '../apiBuilders/common';\nimport { omitVirtualClassFields } from '../apiBuilders/helpers';\nimport {\n  buildApiMessageExtendedMediaPreview,\n  buildMessageMediaContent,\n  buildPoll,\n  buildPollResults,\n} from '../apiBuilders/messageContent';\nimport {\n  buildApiMessage,\n  buildApiMessageFromNotification,\n  buildApiMessageFromShort,\n  buildApiMessageFromShortChat,\n  buildApiThreadInfoFromMessage,\n  buildMessageDraft,\n} from '../apiBuilders/messages';\nimport {\n  buildApiNotifyException,\n  buildApiNotifyExceptionTopic,\n  buildPrivacyKey,\n} from '../apiBuilders/misc';\nimport { buildApiEmojiStatus, buildApiPeerId, getApiChatIdFromMtpPeer } from '../apiBuilders/peers';\nimport {\n  buildApiReaction,\n  buildMessageReactions,\n} from '../apiBuilders/reactions';\nimport { buildApiStealthMode, buildApiStory } from '../apiBuilders/stories';\nimport { buildApiEmojiInteraction, buildStickerSet } from '../apiBuilders/symbols';\nimport {\n  buildApiUser,\n  buildApiUserStatus,\n} from '../apiBuilders/users';\nimport {\n  buildChatPhotoForLocalDb,\n  buildMessageFromUpdate,\n  isMessageWithMedia,\n} from '../gramjsBuilders';\nimport {\n  addEntitiesToLocalDb,\n  addMessageToLocalDb,\n  addPhotoToLocalDb,\n  addStoryToLocalDb,\n  isChatFolder,\n  log,\n  resolveMessageApiChatId,\n  serializeBytes,\n  swapLocalInvoiceMedia,\n} from '../helpers';\nimport localDb from '../localDb';\nimport { scheduleMutedChatUpdate, scheduleMutedTopicUpdate } from '../scheduleUnmute';\n\nimport { LocalUpdateChannelPts, LocalUpdatePts, type UpdatePts } from './UpdatePts';\n\nexport type Update = (\n  (GramJs.TypeUpdate | GramJs.TypeUpdates) & { _entities?: (GramJs.TypeUser | GramJs.TypeChat)[] }\n) | typeof connection.UpdateConnectionState | UpdatePts;\n\nconst DELETE_MISSING_CHANNEL_MESSAGE_DELAY = 1000;\n\nlet onUpdate: OnApiUpdate;\n\nexport function init(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nconst sentMessageIds = new Set();\n\nexport function dispatchUserAndChatUpdates(entities: (GramJs.TypeUser | GramJs.TypeChat)[]) {\n  entities\n    .filter((e) => e instanceof GramJs.User)\n    .map(buildApiUser)\n    .forEach((user) => {\n      if (!user) {\n        return;\n      }\n\n      onUpdate({\n        '@type': 'updateUser',\n        id: user.id,\n        user,\n      });\n    });\n\n  entities\n    .filter((e) => (\n      e instanceof GramJs.Chat || e instanceof GramJs.ChatForbidden\n      || e instanceof GramJs.Channel || e instanceof GramJs.ChannelForbidden\n    ))\n    .map((e) => buildApiChatFromPreview(e))\n    .forEach((chat) => {\n      if (!chat) {\n        return;\n      }\n\n      onUpdate({\n        '@type': 'updateChat',\n        id: chat.id,\n        chat,\n      });\n    });\n}\n\nexport function dispatchThreadInfoUpdates(messages: (GramJs.TypeMessage | undefined)[]) {\n  const threadInfoUpdates = compact(messages).map(buildApiThreadInfoFromMessage).filter(Boolean);\n  if (!threadInfoUpdates.length) return;\n\n  onUpdate({\n    '@type': 'updateThreadInfos',\n    threadInfoUpdates,\n  });\n}\n\nexport function sendUpdate(update: ApiUpdate) {\n  onUpdate(update);\n}\n\nexport function updater(update: Update) {\n  if (update instanceof connection.UpdateServerTimeOffset) {\n    setServerTimeOffset(update.timeOffset);\n\n    onUpdate({\n      '@type': 'updateServerTimeOffset',\n      serverTimeOffset: update.timeOffset,\n    });\n  } else if (update instanceof connection.UpdateConnectionState) {\n    let connectionState: ApiUpdateConnectionStateType;\n\n    switch (update.state) {\n      case connection.UpdateConnectionState.disconnected:\n        connectionState = 'connectionStateConnecting';\n        break;\n      case connection.UpdateConnectionState.broken:\n        connectionState = 'connectionStateBroken';\n        break;\n      case connection.UpdateConnectionState.connected:\n      default:\n        connectionState = 'connectionStateReady';\n        break;\n    }\n\n    onUpdate({\n      '@type': 'updateConnectionState',\n      connectionState,\n    });\n\n    // Messages\n  } else if (\n    update instanceof GramJs.UpdateNewMessage\n    || update instanceof GramJs.UpdateNewScheduledMessage\n    || update instanceof GramJs.UpdateNewChannelMessage\n    || update instanceof GramJs.UpdateShortChatMessage\n    || update instanceof GramJs.UpdateShortMessage\n  ) {\n    let message: ApiMessage | undefined;\n    let shouldForceReply: boolean | undefined;\n\n    // eslint-disable-next-line no-underscore-dangle\n    const entities = update._entities;\n    if (entities) {\n      addEntitiesToLocalDb(entities);\n      dispatchUserAndChatUpdates(entities);\n    }\n\n    if (update instanceof GramJs.UpdateShortChatMessage) {\n      message = buildApiMessageFromShortChat(update);\n    } else if (update instanceof GramJs.UpdateShortMessage) {\n      message = buildApiMessageFromShort(update);\n    } else {\n      // TODO Remove if proven not reproducing\n      if (update.message instanceof GramJs.MessageEmpty) {\n        if (DEBUG) {\n          // eslint-disable-next-line no-console\n          console.error('Unexpected update:', update.className, update);\n        }\n\n        return;\n      }\n\n      if ((update.message instanceof GramJs.Message && isMessageWithMedia(update.message))\n      || (update.message instanceof GramJs.MessageService\n          && update.message.action instanceof GramJs.MessageActionSuggestProfilePhoto)\n      ) {\n        addMessageToLocalDb(update.message);\n      }\n\n      message = buildApiMessage(update.message)!;\n      dispatchThreadInfoUpdates([update.message]);\n\n      shouldForceReply = 'replyMarkup' in update.message\n        && update.message?.replyMarkup instanceof GramJs.ReplyKeyboardForceReply\n        && (!update.message.replyMarkup.selective || message.isMentioned);\n    }\n\n    if (update instanceof GramJs.UpdateNewScheduledMessage) {\n      onUpdate({\n        '@type': sentMessageIds.has(message.id) ? 'updateScheduledMessage' : 'newScheduledMessage',\n        id: message.id,\n        chatId: message.chatId,\n        message,\n      });\n    } else {\n      // We don't have preview for action or 'via bot' messages, so `newMessage` update here is required\n      const hasLocalCopy = sentMessageIds.has(message.id) && !message.viaBotId && !message.content.action;\n      onUpdate({\n        '@type': hasLocalCopy ? 'updateMessage' : 'newMessage',\n        id: message.id,\n        chatId: message.chatId,\n        message,\n        shouldForceReply,\n      });\n    }\n\n    // Some updates to a Chat/Channel don't have a dedicated update class.\n    // We can get info on some updates from Service Messages.\n    if (update.message instanceof GramJs.MessageService) {\n      const { action } = update.message;\n\n      if (action instanceof GramJs.MessageActionPaymentSent) {\n        onUpdate({\n          '@type': 'updatePaymentStateCompleted',\n          slug: action.invoiceSlug,\n        });\n      } else if (action instanceof GramJs.MessageActionChatEditTitle) {\n        onUpdate({\n          '@type': 'updateChat',\n          id: message.chatId,\n          chat: {\n            title: action.title,\n          },\n        });\n      } else if (action instanceof GramJs.MessageActionChatEditPhoto) {\n        const photo = buildChatPhotoForLocalDb(action.photo);\n        const avatarHash = buildAvatarHash(photo);\n\n        const localDbChatId = resolveMessageApiChatId(update.message)!;\n        if (localDb.chats[localDbChatId]) {\n          localDb.chats[localDbChatId].photo = photo;\n        }\n        addPhotoToLocalDb(action.photo);\n\n        if (avatarHash) {\n          onUpdate({\n            '@type': 'updateChat',\n            id: message.chatId,\n            chat: {\n              avatarHash,\n            },\n            ...(action.photo instanceof GramJs.Photo && { newProfilePhoto: buildApiPhoto(action.photo) }),\n          });\n        }\n      } else if (action instanceof GramJs.MessageActionChatDeletePhoto) {\n        const localDbChatId = resolveMessageApiChatId(update.message)!;\n        if (localDb.chats[localDbChatId]) {\n          localDb.chats[localDbChatId].photo = new GramJs.ChatPhotoEmpty();\n        }\n\n        onUpdate({\n          '@type': 'updateChat',\n          id: message.chatId,\n          chat: { avatarHash: undefined },\n        });\n      } else if (action instanceof GramJs.MessageActionChatDeleteUser) {\n        // eslint-disable-next-line no-underscore-dangle\n        if (update._entities && update._entities.some((e): e is GramJs.User => (\n          e instanceof GramJs.User && Boolean(e.self) && e.id === action.userId\n        ))) {\n          onUpdate({\n            '@type': 'updateChat',\n            id: message.chatId,\n            chat: {\n              isForbidden: true,\n              isNotJoined: true,\n            },\n          });\n        }\n      } else if (action instanceof GramJs.MessageActionChatAddUser) {\n        // eslint-disable-next-line no-underscore-dangle\n        if (update._entities && update._entities.some((e): e is GramJs.User => (\n          e instanceof GramJs.User && Boolean(e.self) && action.users.includes(e.id)\n        ))) {\n          onUpdate({\n            '@type': 'updateChatJoin',\n            id: message.chatId,\n          });\n        }\n      } else if (action instanceof GramJs.MessageActionGroupCall) {\n        if (!action.duration && action.call) {\n          onUpdate({\n            '@type': 'updateGroupCallChatId',\n            chatId: message.chatId,\n            call: {\n              id: action.call.id.toString(),\n              accessHash: action.call.accessHash.toString(),\n            },\n          });\n        }\n      } else if (action instanceof GramJs.MessageActionTopicEdit) {\n        const replyTo = update.message.replyTo instanceof GramJs.MessageReplyHeader\n          ? update.message.replyTo\n          : undefined;\n        const {\n          replyToMsgId, replyToTopId, forumTopic: isTopicReply,\n        } = replyTo || {};\n        const topicId = !isTopicReply ? GENERAL_TOPIC_ID : replyToTopId || replyToMsgId || GENERAL_TOPIC_ID;\n\n        onUpdate({\n          '@type': 'updateTopic',\n          chatId: getApiChatIdFromMtpPeer(update.message.peerId!),\n          topicId,\n        });\n      } else if (action instanceof GramJs.MessageActionTopicCreate) {\n        onUpdate({\n          '@type': 'updateTopics',\n          chatId: getApiChatIdFromMtpPeer(update.message.peerId!),\n        });\n      }\n    }\n  } else if (\n    update instanceof GramJs.UpdateEditMessage\n    || update instanceof GramJs.UpdateEditChannelMessage\n  ) {\n    // TODO Remove if proven not reproducing\n    if (update.message instanceof GramJs.MessageEmpty) {\n      if (DEBUG) {\n        // eslint-disable-next-line no-console\n        console.error('Unexpected update:', update.className, update);\n      }\n\n      return;\n    }\n\n    if (update.message instanceof GramJs.Message && isMessageWithMedia(update.message)) {\n      addMessageToLocalDb(update.message);\n    }\n\n    // Workaround for a weird server behavior when own message is marked as incoming\n    const message = omit(buildApiMessage(update.message)!, ['isOutgoing']);\n    dispatchThreadInfoUpdates([update.message]);\n\n    onUpdate({\n      '@type': 'updateMessage',\n      id: message.id,\n      chatId: message.chatId,\n      message,\n    });\n  } else if (update instanceof GramJs.UpdateMessageReactions) {\n    onUpdate({\n      '@type': 'updateMessageReactions',\n      id: update.msgId,\n      chatId: getApiChatIdFromMtpPeer(update.peer),\n      reactions: buildMessageReactions(update.reactions),\n    });\n  } else if (update instanceof GramJs.UpdateMessageExtendedMedia) {\n    let media: MediaContent | undefined;\n    if (update.extendedMedia instanceof GramJs.MessageExtendedMedia) {\n      media = buildMessageMediaContent(update.extendedMedia.media);\n    }\n\n    let preview: ApiMessageExtendedMediaPreview | undefined;\n    if (update.extendedMedia instanceof GramJs.MessageExtendedMediaPreview) {\n      preview = buildApiMessageExtendedMediaPreview(update.extendedMedia);\n    }\n\n    if (!media && !preview) return;\n\n    const chatId = getApiChatIdFromMtpPeer(update.peer);\n\n    swapLocalInvoiceMedia(chatId, update.msgId, update.extendedMedia);\n\n    onUpdate({\n      '@type': 'updateMessageExtendedMedia',\n      id: update.msgId,\n      chatId,\n      media,\n      preview,\n    });\n  } else if (update instanceof GramJs.UpdateDeleteMessages) {\n    onUpdate({\n      '@type': 'deleteMessages',\n      ids: update.messages,\n    });\n  } else if (update instanceof GramJs.UpdateDeleteScheduledMessages) {\n    onUpdate({\n      '@type': 'deleteScheduledMessages',\n      ids: update.messages,\n      chatId: getApiChatIdFromMtpPeer(update.peer),\n    });\n  } else if (update instanceof GramJs.UpdateDeleteChannelMessages) {\n    const chatId = buildApiPeerId(update.channelId, 'channel');\n    const ids = update.messages;\n    const existingIds = ids.filter((id) => localDb.messages[`${chatId}-${id}`]);\n    const missingIds = ids.filter((id) => !localDb.messages[`${chatId}-${id}`]);\n    const profilePhotoIds = ids.map((id) => {\n      const message = localDb.messages[`${chatId}-${id}`];\n\n      return message && message instanceof GramJs.MessageService && 'photo' in message.action\n        ? String(message.action.photo.id)\n        : undefined;\n    }).filter(Boolean);\n\n    if (existingIds.length) {\n      onUpdate({\n        '@type': 'deleteMessages',\n        ids: existingIds,\n        chatId,\n      });\n    }\n\n    if (profilePhotoIds.length) {\n      onUpdate({\n        '@type': 'deleteProfilePhotos',\n        ids: profilePhotoIds,\n        chatId,\n      });\n    }\n\n    // For some reason delete message update sometimes comes before new message update\n    if (missingIds.length) {\n      setTimeout(() => {\n        onUpdate({\n          '@type': 'deleteMessages',\n          ids: missingIds,\n          chatId,\n        });\n      }, DELETE_MISSING_CHANNEL_MESSAGE_DELAY);\n    }\n  } else if (update instanceof GramJs.UpdateServiceNotification) {\n    if (update.popup) {\n      onUpdate({\n        '@type': 'error',\n        error: {\n          message: update.message,\n        },\n      });\n    } else {\n      const currentDate = Date.now() / 1000 + getServerTimeOffset();\n      const message = buildApiMessageFromNotification(update, currentDate);\n\n      if (isMessageWithMedia(update)) {\n        addMessageToLocalDb(buildMessageFromUpdate(message.id, message.chatId, update));\n      }\n\n      onUpdate({\n        '@type': 'updateServiceNotification',\n        message,\n      });\n    }\n  } else if (update instanceof GramJs.UpdateMessageID || update instanceof GramJs.UpdateShortSentMessage) {\n    sentMessageIds.add(update.id);\n  } else if (update instanceof GramJs.UpdateReadMessagesContents) {\n    onUpdate({\n      '@type': 'updateCommonBoxMessages',\n      ids: update.messages,\n      messageUpdate: {\n        hasUnreadMention: false,\n        isMediaUnread: false,\n      },\n    });\n  } else if (update instanceof GramJs.UpdateChannelReadMessagesContents) {\n    onUpdate({\n      '@type': 'updateChannelMessages',\n      channelId: buildApiPeerId(update.channelId, 'channel'),\n      ids: update.messages,\n      messageUpdate: {\n        hasUnreadMention: false,\n        isMediaUnread: false,\n      },\n    });\n  } else if (update instanceof GramJs.UpdateMessagePoll) {\n    const { pollId, poll, results } = update;\n    if (poll) {\n      const apiPoll = buildPoll(poll, results);\n\n      onUpdate({\n        '@type': 'updateMessagePoll',\n        pollId: String(pollId),\n        pollUpdate: apiPoll,\n      });\n    } else {\n      const pollResults = buildPollResults(results);\n      onUpdate({\n        '@type': 'updateMessagePoll',\n        pollId: String(pollId),\n        pollUpdate: { results: pollResults },\n      });\n    }\n  } else if (update instanceof GramJs.UpdateMessagePollVote) {\n    onUpdate({\n      '@type': 'updateMessagePollVote',\n      pollId: String(update.pollId),\n      peerId: getApiChatIdFromMtpPeer(update.peer),\n      options: update.options.map(serializeBytes),\n    });\n  } else if (update instanceof GramJs.UpdateChannelMessageViews) {\n    onUpdate({\n      '@type': 'updateMessage',\n      chatId: buildApiPeerId(update.channelId, 'channel'),\n      id: update.id,\n      message: { viewsCount: update.views },\n    });\n\n    // Chats\n  } else if (update instanceof GramJs.UpdateReadHistoryInbox) {\n    onUpdate({\n      '@type': 'updateChatInbox',\n      id: getApiChatIdFromMtpPeer(update.peer),\n      chat: {\n        lastReadInboxMessageId: update.maxId,\n        unreadCount: update.stillUnreadCount,\n      },\n    });\n  } else if (update instanceof GramJs.UpdateReadHistoryOutbox) {\n    onUpdate({\n      '@type': 'updateChat',\n      id: getApiChatIdFromMtpPeer(update.peer),\n      chat: {\n        lastReadOutboxMessageId: update.maxId,\n      },\n    });\n  } else if (update instanceof GramJs.UpdateReadChannelInbox) {\n    onUpdate({\n      '@type': 'updateChat',\n      id: buildApiPeerId(update.channelId, 'channel'),\n      chat: {\n        lastReadInboxMessageId: update.maxId,\n        unreadCount: update.stillUnreadCount,\n      },\n    });\n  } else if (update instanceof GramJs.UpdateReadChannelOutbox) {\n    onUpdate({\n      '@type': 'updateChat',\n      id: buildApiPeerId(update.channelId, 'channel'),\n      chat: {\n        lastReadOutboxMessageId: update.maxId,\n      },\n    });\n  } else if (update instanceof GramJs.UpdateReadChannelDiscussionInbox) {\n    onUpdate({\n      '@type': 'updateThreadInfos',\n      threadInfoUpdates: [{\n        chatId: buildApiPeerId(update.channelId, 'channel'),\n        threadId: update.topMsgId,\n        lastReadInboxMessageId: update.readMaxId,\n      }],\n    });\n  } else if (update instanceof GramJs.UpdateReadChannelDiscussionOutbox) {\n    onUpdate({\n      '@type': 'updateChat',\n      id: buildApiPeerId(update.channelId, 'channel'),\n      chat: {\n        lastReadOutboxMessageId: update.readMaxId,\n      },\n    });\n  } else if (\n    update instanceof GramJs.UpdateDialogPinned\n    && update.peer instanceof GramJs.DialogPeer\n  ) {\n    onUpdate({\n      '@type': 'updateChatPinned',\n      id: getApiChatIdFromMtpPeer(update.peer.peer),\n      isPinned: update.pinned || false,\n    });\n  } else if (update instanceof GramJs.UpdatePinnedDialogs) {\n    const ids = update.order\n      ? update.order\n        .filter((dp): dp is GramJs.DialogPeer => dp instanceof GramJs.DialogPeer)\n        .map((dp) => getApiChatIdFromMtpPeer(dp.peer))\n      : [];\n\n    onUpdate({\n      '@type': 'updatePinnedChatIds',\n      ids,\n      folderId: update.folderId || undefined,\n    });\n  } else if (\n    update instanceof GramJs.UpdateSavedDialogPinned\n    && update.peer instanceof GramJs.DialogPeer\n  ) {\n    onUpdate({\n      '@type': 'updateSavedDialogPinned',\n      id: getApiChatIdFromMtpPeer(update.peer.peer),\n      isPinned: update.pinned || false,\n    });\n  } else if (update instanceof GramJs.UpdatePinnedSavedDialogs) {\n    const ids = update.order\n      ? update.order\n        .filter((dp): dp is GramJs.DialogPeer => dp instanceof GramJs.DialogPeer)\n        .map((dp) => getApiChatIdFromMtpPeer(dp.peer))\n      : [];\n\n    onUpdate({\n      '@type': 'updatePinnedSavedDialogIds',\n      ids,\n    });\n  } else if (update instanceof GramJs.UpdateFolderPeers) {\n    update.folderPeers.forEach((folderPeer) => {\n      const { folderId, peer } = folderPeer;\n\n      onUpdate({\n        '@type': 'updateChatListType',\n        id: getApiChatIdFromMtpPeer(peer),\n        folderId,\n      });\n    });\n  } else if (update instanceof GramJs.UpdateDialogFilter) {\n    const { id, filter } = update;\n    const folder = isChatFolder(filter) ? buildApiChatFolder(filter) : undefined;\n\n    onUpdate({\n      '@type': 'updateChatFolder',\n      id,\n      folder,\n    });\n  } else if (update instanceof GramJs.UpdateDialogFilterOrder) {\n    onUpdate({\n      '@type': 'updateChatFoldersOrder',\n      orderedIds: update.order,\n    });\n  } else if (update instanceof GramJs.UpdateChatParticipants) {\n    const replacedMembers = buildChatMembers(update.participants);\n\n    onUpdate({\n      '@type': 'updateChatMembers',\n      id: buildApiPeerId(update.participants.chatId, 'chat'),\n      replacedMembers,\n    });\n  } else if (update instanceof GramJs.UpdateChatParticipantAdd) {\n    const addedMember = buildChatMember(\n      pick(update, ['userId', 'inviterId', 'date']) as GramJs.ChatParticipant,\n    );\n\n    onUpdate({\n      '@type': 'updateChatMembers',\n      id: buildApiPeerId(update.chatId, 'chat'),\n      addedMember,\n    });\n  } else if (update instanceof GramJs.UpdateChatParticipantDelete) {\n    onUpdate({\n      '@type': 'updateChatMembers',\n      id: buildApiPeerId(update.chatId, 'chat'),\n      deletedMemberId: buildApiPeerId(update.userId, 'user'),\n    });\n  } else if (\n    update instanceof GramJs.UpdatePinnedMessages\n    || update instanceof GramJs.UpdatePinnedChannelMessages\n  ) {\n    const chatId = update instanceof GramJs.UpdatePinnedMessages\n      ? getApiChatIdFromMtpPeer(update.peer)\n      : buildApiPeerId(update.channelId, 'channel');\n\n    onUpdate({\n      '@type': 'updatePinnedIds',\n      chatId,\n      messageIds: update.messages,\n      isPinned: update.pinned,\n    });\n  } else if (\n    update instanceof GramJs.UpdateNotifySettings\n    && update.peer instanceof GramJs.NotifyPeer\n  ) {\n    const payload = buildApiNotifyException(update.notifySettings, update.peer.peer);\n    scheduleMutedChatUpdate(payload.chatId, payload.muteUntil, onUpdate);\n    onUpdate({\n      '@type': 'updateNotifyExceptions',\n      ...payload,\n    });\n  } else if (\n    update instanceof GramJs.UpdateNotifySettings\n    && update.peer instanceof GramJs.NotifyForumTopic\n  ) {\n    const payload = buildApiNotifyExceptionTopic(\n      update.notifySettings, update.peer.peer, update.peer.topMsgId,\n    );\n    scheduleMutedTopicUpdate(payload.chatId, payload.topicId, payload.muteUntil, onUpdate);\n    onUpdate({\n      '@type': 'updateTopicNotifyExceptions',\n      ...payload,\n    });\n  } else if (\n    update instanceof GramJs.UpdateUserTyping\n    || update instanceof GramJs.UpdateChatUserTyping\n  ) {\n    const id = update instanceof GramJs.UpdateUserTyping\n      ? buildApiPeerId(update.userId, 'user')\n      : buildApiPeerId(update.chatId, 'chat');\n\n    if (update.action instanceof GramJs.SendMessageEmojiInteraction) {\n      onUpdate({\n        '@type': 'updateStartEmojiInteraction',\n        id,\n        emoji: update.action.emoticon,\n        messageId: update.action.msgId,\n        interaction: buildApiEmojiInteraction(JSON.parse(update.action.interaction.data)),\n      });\n    } else {\n      onUpdate({\n        '@type': 'updateChatTypingStatus',\n        id,\n        typingStatus: buildChatTypingStatus(update),\n      });\n    }\n  } else if (update instanceof GramJs.UpdateChannelUserTyping) {\n    const id = buildApiPeerId(update.channelId, 'channel');\n\n    onUpdate({\n      '@type': 'updateChatTypingStatus',\n      id,\n      threadId: update.topMsgId,\n      typingStatus: buildChatTypingStatus(update),\n    });\n  } else if (update instanceof GramJs.UpdateChannel) {\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    const { _entities } = update;\n    if (!_entities) {\n      return;\n    }\n\n    const channel = _entities.find((e): e is GramJs.Channel | GramJs.ChannelForbidden => (\n      e instanceof GramJs.Channel || e instanceof GramJs.ChannelForbidden\n    ));\n\n    if (channel instanceof GramJs.Channel) {\n      const chat = buildApiChatFromPreview(channel);\n      if (chat) {\n        onUpdate({\n          '@type': 'updateChat',\n          id: chat.id,\n          chat,\n        });\n\n        onUpdate({\n          '@type': chat.isNotJoined ? 'updateChatLeave' : 'updateChatJoin',\n          id: buildApiPeerId(update.channelId, 'channel'),\n        });\n      }\n    } else if (channel instanceof GramJs.ChannelForbidden) {\n      const chatId = buildApiPeerId(update.channelId, 'channel');\n\n      onUpdate({\n        '@type': 'updateChat',\n        id: chatId,\n        chat: {\n          isRestricted: true,\n        },\n      });\n\n      onUpdate({\n        '@type': 'updateChatLeave',\n        id: chatId,\n      });\n    } else if (_entities.length === 0) {\n      // The link to the discussion group may have been changed.\n      // No corresponding update available at this moment https://core.telegram.org/type/Updates\n      onUpdate({\n        '@type': 'resetMessages',\n        id: buildApiPeerId(update.channelId, 'channel'),\n      });\n    }\n  } else if (\n    update instanceof GramJs.UpdateDialogUnreadMark\n    && update.peer instanceof GramJs.DialogPeer\n  ) {\n    onUpdate({\n      '@type': 'updateChat',\n      id: getApiChatIdFromMtpPeer(update.peer.peer),\n      chat: {\n        hasUnreadMark: update.unread,\n      },\n    });\n  } else if (update instanceof GramJs.UpdateChatDefaultBannedRights) {\n    onUpdate({\n      '@type': 'updateChat',\n      id: getApiChatIdFromMtpPeer(update.peer),\n      chat: {\n        defaultBannedRights: omitVirtualClassFields(update.defaultBannedRights),\n      },\n    });\n\n    // Users\n  } else if (update instanceof GramJs.UpdateUserStatus) {\n    onUpdate({\n      '@type': 'updateUserStatus',\n      userId: buildApiPeerId(update.userId, 'user'),\n      status: buildApiUserStatus(update.status),\n    });\n  } else if (update instanceof GramJs.UpdateUser) {\n    onUpdate({\n      '@type': 'updateRequestUserUpdate',\n      id: buildApiPeerId(update.userId, 'user'),\n    });\n  } else if (update instanceof GramJs.UpdateUserEmojiStatus) {\n    const emojiStatus = buildApiEmojiStatus(update.emojiStatus);\n    onUpdate({\n      '@type': 'updateUserEmojiStatus',\n      userId: buildApiPeerId(update.userId, 'user'),\n      emojiStatus,\n    });\n  } else if (update instanceof GramJs.UpdateUserName) {\n    const apiUserId = buildApiPeerId(update.userId, 'user');\n    const updatedUser = localDb.users[apiUserId];\n\n    const user = updatedUser?.mutualContact && !updatedUser.self\n      ? pick(update, [])\n      : pick(update, ['firstName', 'lastName']);\n\n    const usernames = buildApiUsernames(update);\n\n    onUpdate({\n      '@type': 'updateUser',\n      id: apiUserId,\n      user: {\n        ...user,\n        usernames,\n      },\n    });\n  } else if (update instanceof GramJs.UpdateUserPhone) {\n    const { userId, phone } = update;\n\n    onUpdate({\n      '@type': 'updateUser',\n      id: buildApiPeerId(userId, 'user'),\n      user: { phoneNumber: phone },\n    });\n  } else if (update instanceof GramJs.UpdatePeerSettings) {\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    const { _entities, settings } = update;\n    if (!_entities) {\n      return;\n    }\n\n    if (_entities?.length) {\n      _entities\n        .filter((e) => e instanceof GramJs.User && !e.contact)\n        .forEach((user) => {\n          onUpdate({\n            '@type': 'deleteContact',\n            id: buildApiPeerId(user.id, 'user'),\n          });\n        });\n\n      _entities\n        .filter((e) => e instanceof GramJs.User && e.contact)\n        .map(buildApiUser)\n        .forEach((user) => {\n          if (!user) {\n            return;\n          }\n\n          onUpdate({\n            '@type': 'updateUser',\n            id: user.id,\n            user: {\n              ...user,\n              ...(settings && { settings: buildApiChatSettings(settings) }),\n            },\n          });\n        });\n    }\n\n    // Settings\n  } else if (update instanceof GramJs.UpdateNotifySettings) {\n    const {\n      notifySettings: {\n        showPreviews, silent, muteUntil,\n      },\n      peer: { className },\n    } = update;\n\n    const peerType = className === 'NotifyUsers'\n      ? 'contact'\n      : (className === 'NotifyChats'\n        ? 'group'\n        : (className === 'NotifyBroadcasts'\n          ? 'broadcast'\n          : undefined\n        )\n      );\n\n    if (!peerType) {\n      return;\n    }\n\n    onUpdate({\n      '@type': 'updateNotifySettings',\n      peerType,\n      isSilent: Boolean(silent\n        || (typeof muteUntil === 'number' && Date.now() + getServerTimeOffset() * 1000 < muteUntil * 1000)),\n      shouldShowPreviews: Boolean(showPreviews),\n    });\n  } else if (update instanceof GramJs.UpdatePeerBlocked) {\n    onUpdate({\n      '@type': 'updatePeerBlocked',\n      id: getApiChatIdFromMtpPeer(update.peerId),\n      isBlocked: update.blocked,\n      isBlockedFromStories: update.blockedMyStoriesFrom,\n    });\n  } else if (update instanceof GramJs.UpdatePrivacy) {\n    const key = buildPrivacyKey(update.key);\n    if (key) {\n      onUpdate({\n        '@type': 'updatePrivacy',\n        key,\n        rules: buildPrivacyRules(update.rules),\n      });\n    }\n\n    // Misc\n  } else if (update instanceof GramJs.UpdateDraftMessage) {\n    onUpdate({\n      '@type': 'draftMessage',\n      chatId: getApiChatIdFromMtpPeer(update.peer),\n      threadId: update.topMsgId,\n      draft: buildMessageDraft(update.draft),\n    });\n  } else if (update instanceof GramJs.UpdateContactsReset) {\n    onUpdate({ '@type': 'updateResetContactList' });\n  } else if (update instanceof GramJs.UpdateFavedStickers) {\n    onUpdate({ '@type': 'updateFavoriteStickers' });\n  } else if (update instanceof GramJs.UpdateRecentStickers) {\n    onUpdate({ '@type': 'updateRecentStickers' });\n  } else if (update instanceof GramJs.UpdateRecentReactions) {\n    onUpdate({ '@type': 'updateRecentReactions' });\n  } else if (update instanceof GramJs.UpdateSavedReactionTags) {\n    onUpdate({ '@type': 'updateSavedReactionTags' });\n  } else if (update instanceof GramJs.UpdateMoveStickerSetToTop) {\n    if (!update.masks) {\n      onUpdate({\n        '@type': 'updateMoveStickerSetToTop',\n        isCustomEmoji: update.emojis,\n        id: update.stickerset.toString(),\n      });\n    }\n  } else if (update instanceof GramJs.UpdateStickerSets) {\n    onUpdate({ '@type': 'updateStickerSets' });\n  } else if (update instanceof GramJs.UpdateStickerSetsOrder) {\n    if (!update.masks) {\n      onUpdate({\n        '@type': 'updateStickerSetsOrder',\n        order: update.order.map((n) => n.toString()),\n        isCustomEmoji: update.emojis,\n      });\n    }\n  } else if (update instanceof GramJs.UpdateNewStickerSet) {\n    if (update.stickerset instanceof GramJs.messages.StickerSet) {\n      const stickerSet = buildStickerSet(update.stickerset.set);\n      onUpdate({\n        '@type': 'updateStickerSet',\n        id: stickerSet.id,\n        stickerSet,\n      });\n    }\n  } else if (update instanceof GramJs.UpdateSavedGifs) {\n    onUpdate({ '@type': 'updateSavedGifs' });\n  } else if (update instanceof GramJs.UpdateGroupCall) {\n    // eslint-disable-next-line no-underscore-dangle\n    const entities = update._entities;\n    if (entities) {\n      addEntitiesToLocalDb(entities);\n      dispatchUserAndChatUpdates(entities);\n    }\n\n    onUpdate({\n      '@type': 'updateGroupCall',\n      call: buildApiGroupCall(update.call),\n    });\n  } else if (update instanceof GramJs.UpdateGroupCallConnection) {\n    onUpdate({\n      '@type': 'updateGroupCallConnection',\n      data: JSON.parse(update.params.data) as GroupCallConnectionData,\n      presentation: Boolean(update.presentation),\n    });\n  } else if (update instanceof GramJs.UpdateGroupCallParticipants) {\n    // eslint-disable-next-line no-underscore-dangle\n    const entities = update._entities;\n    if (entities) {\n      addEntitiesToLocalDb(entities);\n      dispatchUserAndChatUpdates(entities);\n    }\n\n    onUpdate({\n      '@type': 'updateGroupCallParticipants',\n      groupCallId: getGroupCallId(update.call),\n      participants: update.participants.map(buildApiGroupCallParticipant),\n    });\n  } else if (update instanceof GramJs.UpdatePendingJoinRequests) {\n    // eslint-disable-next-line no-underscore-dangle\n    const entities = update._entities;\n    if (entities) {\n      addEntitiesToLocalDb(entities);\n      dispatchUserAndChatUpdates(entities);\n    }\n\n    onUpdate({\n      '@type': 'updatePendingJoinRequests',\n      chatId: getApiChatIdFromMtpPeer(update.peer),\n      recentRequesterIds: update.recentRequesters.map((id) => buildApiPeerId(id, 'user')),\n      requestsPending: update.requestsPending,\n    });\n  } else if (update instanceof GramJs.UpdatePhoneCall) {\n    // eslint-disable-next-line no-underscore-dangle\n    const entities = update._entities;\n    if (entities) {\n      addEntitiesToLocalDb(entities);\n      dispatchUserAndChatUpdates(entities);\n    }\n\n    onUpdate({\n      '@type': 'updatePhoneCall',\n      call: buildPhoneCall(update.phoneCall),\n    });\n  } else if (update instanceof GramJs.UpdatePhoneCallSignalingData) {\n    onUpdate({\n      '@type': 'updatePhoneCallSignalingData',\n      callId: update.phoneCallId.toString(),\n      data: Array.from(update.data),\n    });\n  } else if (update instanceof GramJs.UpdateWebViewResultSent) {\n    const { queryId } = update;\n\n    onUpdate({\n      '@type': 'updateWebViewResultSent',\n      queryId: queryId.toString(),\n    });\n  } else if (update instanceof GramJs.UpdateBotMenuButton) {\n    const {\n      botId,\n      button,\n    } = update;\n\n    const id = buildApiPeerId(botId, 'user');\n\n    onUpdate({\n      '@type': 'updateBotMenuButton',\n      botId: id,\n      button: buildApiBotMenuButton(button),\n    });\n  } else if (update instanceof GramJs.UpdateTranscribedAudio) {\n    // eslint-disable-next-line no-underscore-dangle\n    const entities = update._entities;\n    if (entities) {\n      addEntitiesToLocalDb(entities);\n      dispatchUserAndChatUpdates(entities);\n    }\n\n    onUpdate({\n      '@type': 'updateTranscribedAudio',\n      transcriptionId: update.transcriptionId.toString(),\n      text: update.text,\n      isPending: update.pending,\n    });\n  } else if (update instanceof GramJs.UpdateConfig) {\n    // eslint-disable-next-line no-underscore-dangle\n    const entities = update._entities;\n    if (entities) {\n      addEntitiesToLocalDb(entities);\n      dispatchUserAndChatUpdates(entities);\n    }\n    onUpdate({ '@type': 'updateConfig' });\n  } else if (update instanceof GramJs.UpdateChannelPinnedTopic) {\n    onUpdate({\n      '@type': 'updatePinnedTopic',\n      chatId: buildApiPeerId(update.channelId, 'channel'),\n      topicId: update.topicId,\n      isPinned: Boolean(update.pinned),\n    });\n  } else if (update instanceof GramJs.UpdateChannelPinnedTopics) {\n    onUpdate({\n      '@type': 'updatePinnedTopicsOrder',\n      chatId: buildApiPeerId(update.channelId, 'channel'),\n      order: update.order || [],\n    });\n  } else if (update instanceof GramJs.UpdateRecentEmojiStatuses) {\n    onUpdate({ '@type': 'updateRecentEmojiStatuses' });\n  } else if (update instanceof GramJs.UpdateStory) {\n    // eslint-disable-next-line no-underscore-dangle\n    const entities = update._entities;\n    if (entities) {\n      addEntitiesToLocalDb(entities);\n      dispatchUserAndChatUpdates(entities);\n    }\n\n    const { story } = update;\n    const peerId = getApiChatIdFromMtpPeer(update.peer);\n    addStoryToLocalDb(story, peerId);\n\n    if (story instanceof GramJs.StoryItemDeleted) {\n      onUpdate({\n        '@type': 'deleteStory',\n        peerId,\n        storyId: story.id,\n      });\n    } else {\n      onUpdate({\n        '@type': 'updateStory',\n        peerId,\n        story: buildApiStory(peerId, story) as ApiStory | ApiStorySkipped,\n      });\n    }\n  } else if (update instanceof GramJs.UpdateReadStories) {\n    onUpdate({\n      '@type': 'updateReadStories',\n      peerId: getApiChatIdFromMtpPeer(update.peer),\n      lastReadId: update.maxId,\n    });\n  } else if (update instanceof GramJs.UpdateSentStoryReaction) {\n    onUpdate({\n      '@type': 'updateSentStoryReaction',\n      peerId: getApiChatIdFromMtpPeer(update.peer),\n      storyId: update.storyId,\n      reaction: buildApiReaction(update.reaction),\n    });\n  } else if (update instanceof GramJs.UpdateStoriesStealthMode) {\n    onUpdate({\n      '@type': 'updateStealthMode',\n      stealthMode: buildApiStealthMode(update.stealthMode),\n    });\n  } else if (update instanceof GramJs.UpdateAttachMenuBots) {\n    onUpdate({\n      '@type': 'updateAttachMenuBots',\n    });\n  } else if (update instanceof GramJs.UpdateNewAuthorization) {\n    onUpdate({\n      '@type': 'updateNewAuthorization',\n      hash: update.hash.toString(),\n      date: update.date,\n      device: update.device,\n      location: update.location,\n      isUnconfirmed: update.unconfirmed,\n    });\n  } else if (update instanceof GramJs.UpdateChannelViewForumAsMessages) {\n    onUpdate({\n      '@type': 'updateViewForumAsMessages',\n      chatId: buildApiPeerId(update.channelId, 'channel'),\n      isEnabled: update.enabled ? true : undefined,\n    });\n  } else if (update instanceof LocalUpdatePts || update instanceof LocalUpdateChannelPts) {\n    // Do nothing, handled on the manager side\n  } else if (DEBUG) {\n    const params = typeof update === 'object' && 'className' in update ? update.className : update;\n    log('UNEXPECTED UPDATE', params);\n  }\n}\n","import { errors } from '../../../lib/gramjs';\n\nimport type {\n  ApiUpdateAuthorizationState,\n  ApiUpdateAuthorizationStateType,\n  ApiUser,\n  ApiUserFullInfo,\n  OnApiUpdate,\n} from '../../types';\n\nimport { DEBUG } from '../../../config';\n\nconst ApiErrors: { [k: string]: string } = {\n  PHONE_NUMBER_INVALID: 'Invalid phone number.',\n  PHONE_CODE_INVALID: 'Invalid code.',\n  PASSWORD_HASH_INVALID: 'Incorrect password.',\n  PHONE_PASSWORD_FLOOD: 'Limit exceeded. Please try again later.',\n  PHONE_NUMBER_BANNED: 'This phone number is banned.',\n};\n\nconst authController: {\n  resolve?: Function;\n  reject?: Function;\n} = {};\n\nlet onUpdate: OnApiUpdate;\n\nexport function init(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nexport function onWebAuthTokenFailed() {\n  onUpdate({\n    '@type': 'updateWebAuthTokenFailed',\n  });\n}\n\nexport function onRequestPhoneNumber() {\n  onUpdate(buildAuthStateUpdate('authorizationStateWaitPhoneNumber'));\n\n  return new Promise<string>((resolve, reject) => {\n    authController.resolve = resolve;\n    authController.reject = reject;\n  });\n}\n\nexport function onRequestCode(isCodeViaApp = false) {\n  onUpdate({\n    ...buildAuthStateUpdate('authorizationStateWaitCode'),\n    isCodeViaApp,\n  });\n\n  return new Promise<string>((resolve, reject) => {\n    authController.resolve = resolve;\n    authController.reject = reject;\n  });\n}\n\nexport function onRequestPassword(hint?: string, noReset?: boolean) {\n  onUpdate({\n    ...buildAuthStateUpdate('authorizationStateWaitPassword'),\n    hint,\n    noReset,\n  });\n\n  return new Promise<string>((resolve) => {\n    authController.resolve = resolve;\n  });\n}\n\nexport function onRequestRegistration() {\n  onUpdate(buildAuthStateUpdate('authorizationStateWaitRegistration'));\n\n  return new Promise<[string, string?]>((resolve) => {\n    authController.resolve = resolve;\n  });\n}\n\nexport function onRequestQrCode(qrCode: { token: Buffer; expires: number }) {\n  onUpdate({\n    ...buildAuthStateUpdate('authorizationStateWaitQrCode'),\n    qrCode: {\n      token: btoa(String.fromCharCode(...qrCode.token)).replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=+$/, ''),\n      expires: qrCode.expires,\n    },\n  });\n\n  return new Promise<void>((resolve, reject) => {\n    authController.reject = reject;\n  });\n}\n\nexport function onAuthError(err: Error) {\n  let message: string;\n\n  if (err instanceof errors.FloodWaitError) {\n    const hours = Math.ceil(Number(err.seconds) / 60 / 60);\n    message = `Too many attempts. Try again in ${hours > 1 ? `${hours} hours` : 'an hour'}`;\n  } else {\n    message = ApiErrors[err.message];\n  }\n\n  if (!message) {\n    message = 'Unexpected Error';\n\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.error(err);\n    }\n  }\n\n  onUpdate({\n    '@type': 'updateAuthorizationError',\n    message,\n  });\n}\n\nexport function onAuthReady() {\n  onUpdate(buildAuthStateUpdate('authorizationStateReady'));\n}\n\nexport function onCurrentUserUpdate(currentUser: ApiUser, currentUserFullInfo: ApiUserFullInfo) {\n  onUpdate({\n    '@type': 'updateCurrentUser',\n    currentUser,\n    currentUserFullInfo,\n  });\n}\n\nexport function buildAuthStateUpdate(authorizationState: ApiUpdateAuthorizationStateType): ApiUpdateAuthorizationState {\n  return {\n    '@type': 'updateAuthorizationState',\n    authorizationState,\n  };\n}\n\nexport function provideAuthPhoneNumber(phoneNumber: string) {\n  if (!authController.resolve) {\n    return;\n  }\n\n  authController.resolve(phoneNumber);\n}\n\nexport function provideAuthCode(code: string) {\n  if (!authController.resolve) {\n    return;\n  }\n\n  authController.resolve(code);\n}\n\nexport function provideAuthPassword(password: string) {\n  if (!authController.resolve) {\n    return;\n  }\n\n  authController.resolve(password);\n}\n\nexport function provideAuthRegistration(registration: { firstName: string; lastName: string }) {\n  const { firstName, lastName } = registration;\n\n  if (!authController.resolve) {\n    return;\n  }\n\n  authController.resolve([firstName, lastName]);\n}\n\nexport function restartAuth() {\n  if (!authController.reject) {\n    return;\n  }\n\n  authController.reject(new Error('RESTART_AUTH'));\n}\n\nexport function restartAuthWithQr() {\n  if (!authController.reject) {\n    return;\n  }\n\n  authController.reject(new Error('RESTART_AUTH_WITH_QR'));\n}\n","export default class SortedQueue<T> {\n  private queue: T[];\n\n  constructor(private comparator: (a: T, b: T) => number) {\n    this.queue = [];\n  }\n\n  add(item: T): void {\n    const index = this.binarySearch(item);\n    this.queue.splice(index, 0, item);\n  }\n\n  pop(): T | undefined {\n    return this.queue.shift();\n  }\n\n  get size(): number {\n    return this.queue.length;\n  }\n\n  clear(): void {\n    this.queue = [];\n  }\n\n  private binarySearch(item: T): number {\n    let left = 0;\n    let right = this.queue.length;\n\n    while (left < right) {\n      const middle = Math.floor((left + right) / 2);\n      const comparison = this.comparator(item, this.queue[middle]);\n\n      if (comparison === 0) {\n        return middle;\n      } else if (comparison > 0) {\n        left = middle + 1;\n      } else {\n        right = middle;\n      }\n    }\n\n    return left;\n  }\n}\n","import { Api as GramJs } from '../../../lib/gramjs';\nimport { UpdateConnectionState, UpdateServerTimeOffset } from '../../../lib/gramjs/network';\n\nimport type { ApiChat } from '../../types';\nimport type { invokeRequest } from '../methods/client';\nimport type { Update } from './updater';\n\nimport { DEBUG } from '../../../config';\nimport SortedQueue from '../../../util/SortedQueue';\nimport { buildApiPeerId } from '../apiBuilders/peers';\nimport { buildInputEntity, buildMtpPeerId } from '../gramjsBuilders';\nimport { addEntitiesToLocalDb } from '../helpers';\nimport localDb from '../localDb';\nimport { dispatchUserAndChatUpdates, sendUpdate, updater } from './updater';\n\nimport { buildLocalUpdatePts, type UpdatePts } from './UpdatePts';\n\nexport type State = {\n  seq: number;\n  date: number;\n  pts: number;\n  qts: number;\n};\ntype SeqUpdate = (GramJs.Updates | GramJs.UpdatesCombined) & { _isFromDifference?: true };\ntype PtsUpdate = ((GramJs.TypeUpdate & { pts: number }) | UpdatePts) & { _isFromDifference?: true };\n\nconst COMMON_BOX_QUEUE_ID = '0';\nconst CHANNEL_DIFFERENCE_LIMIT = 1000;\nconst UPDATE_WAIT_TIMEOUT = 500;\n\nlet invoke: typeof invokeRequest;\nlet isInited = false;\n\nlet seqTimeout: ReturnType<typeof setTimeout> | undefined;\nconst PTS_TIMEOUTS = new Map<string, ReturnType<typeof setTimeout>>();\n\nconst SEQ_QUEUE = new SortedQueue<SeqUpdate>(seqComparator);\nconst PTS_QUEUE = new Map<string, SortedQueue<PtsUpdate>>();\n\nexport async function init(invokeReq: typeof invokeRequest) {\n  invoke = invokeReq;\n\n  await loadRemoteState();\n  isInited = true;\n\n  scheduleGetDifference();\n}\n\nexport function applyState(state: State) {\n  localDb.commonBoxState.seq = state.seq;\n  localDb.commonBoxState.date = state.date;\n  localDb.commonBoxState.pts = state.pts;\n  localDb.commonBoxState.qts = state.qts;\n}\n\nexport function processUpdate(update: Update, isFromDifference?: boolean, shouldOnlySave?: boolean) {\n  if (update instanceof UpdateConnectionState) {\n    if (update.state === UpdateConnectionState.connected && isInited) {\n      scheduleGetDifference();\n    }\n\n    updater(update);\n    return;\n  }\n\n  if (update instanceof UpdateServerTimeOffset) {\n    updater(update);\n    return;\n  }\n\n  if (localDb.commonBoxState.seq === undefined) {\n    // Drop updates received before first sync\n    return;\n  }\n\n  if (update instanceof GramJs.Updates || update instanceof GramJs.UpdatesCombined) {\n    if (isFromDifference) {\n      // eslint-disable-next-line no-underscore-dangle\n      (update as SeqUpdate)._isFromDifference = true;\n    }\n\n    saveSeqUpdate(update, shouldOnlySave);\n    return;\n  }\n\n  if ('pts' in update) {\n    if (update instanceof GramJs.UpdateChannelTooLong) {\n      getChannelDifference(getUpdateChannelId(update));\n      return;\n    }\n    if (isFromDifference) {\n      // eslint-disable-next-line no-underscore-dangle\n      (update as PtsUpdate)._isFromDifference = true;\n    }\n    savePtsUpdate(update, shouldOnlySave);\n    return;\n  }\n\n  updater(update);\n}\n\nexport function updateChannelState(channelId: string, pts: number) {\n  const channel = localDb.chats[channelId];\n  if (!(channel instanceof GramJs.Channel)) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.error(`[UpdateManager] Channel ${channelId} not found in localDb`);\n    }\n    return;\n  }\n\n  const currentState = localDb.channelPtsById[channelId];\n\n  if (currentState && currentState < pts) {\n    scheduleGetChannelDifference(channelId);\n    return;\n  }\n\n  localDb.channelPtsById[channelId] = pts;\n}\n\nfunction applyUpdate(updateObject: SeqUpdate | PtsUpdate) {\n  if ('seq' in updateObject && updateObject.seq) {\n    localDb.commonBoxState.seq = updateObject.seq;\n    localDb.commonBoxState.date = updateObject.date;\n  }\n\n  if ('qts' in updateObject) {\n    localDb.commonBoxState.qts = updateObject.qts;\n  }\n\n  if ('pts' in updateObject) {\n    const channelId = getUpdateChannelId(updateObject);\n    if (channelId !== COMMON_BOX_QUEUE_ID) {\n      localDb.channelPtsById[channelId] = updateObject.pts;\n    } else {\n      localDb.commonBoxState.pts = updateObject.pts;\n    }\n  }\n\n  if (updateObject instanceof GramJs.UpdatesCombined || updateObject instanceof GramJs.Updates) {\n    const entities = updateObject.users.concat(updateObject.chats);\n\n    updateObject.updates.forEach((update) => {\n      if (entities) {\n        // eslint-disable-next-line no-underscore-dangle\n        (update as any)._entities = entities;\n      }\n\n      processUpdate(update);\n    });\n  } else {\n    updater(updateObject);\n  }\n}\n\nfunction saveSeqUpdate(update: GramJs.Updates | GramJs.UpdatesCombined, shouldOnlySave?: boolean) {\n  SEQ_QUEUE.add(update);\n\n  if (!shouldOnlySave) popSeqQueue();\n}\n\nfunction savePtsUpdate(update: PtsUpdate, shouldOnlySave?: boolean) {\n  const channelId = getUpdateChannelId(update);\n\n  const ptsQueue = PTS_QUEUE.get(channelId) || new SortedQueue<PtsUpdate>(ptsComparator);\n  ptsQueue.add(update);\n\n  PTS_QUEUE.set(channelId, ptsQueue);\n\n  if (!shouldOnlySave) popPtsQueue(channelId);\n}\n\nfunction popSeqQueue() {\n  if (!SEQ_QUEUE.size) return;\n\n  const update = SEQ_QUEUE.pop()!;\n  const localSeq = localDb.commonBoxState.seq;\n  const seqStart = 'seqStart' in update ? update.seqStart : update.seq;\n\n  // eslint-disable-next-line no-underscore-dangle\n  if (seqStart === 0 || (update._isFromDifference && seqStart >= localSeq + 1)) {\n    applyUpdate(update);\n  } else if (seqStart === localSeq + 1) {\n    clearTimeout(seqTimeout);\n    seqTimeout = undefined;\n\n    applyUpdate(update);\n  } else if (seqStart > localSeq + 1) {\n    SEQ_QUEUE.add(update); // Return update to queue\n    scheduleGetDifference();\n    return; // Prevent endless loop\n  }\n\n  popSeqQueue();\n}\n\nfunction popPtsQueue(channelId: string) {\n  const ptsQueue = PTS_QUEUE.get(channelId);\n  if (!ptsQueue?.size) return;\n\n  const update = ptsQueue.pop()!;\n  const localPts = channelId === COMMON_BOX_QUEUE_ID ? localDb.commonBoxState.pts : localDb.channelPtsById[channelId];\n  const pts = update.pts;\n  const ptsCount = getPtsCount(update);\n\n  // Sometimes server sends updates for channels that are opened in other clients. We ignore them\n  if (localPts === undefined) {\n    if (DEBUG) {\n      // Uncomment to debug missing updates\n      // eslint-disable-next-line no-console\n      // console.error('[UpdateManager] Got pts update without local state', channelId);\n    }\n    return;\n  }\n\n  // eslint-disable-next-line no-underscore-dangle\n  if (update._isFromDifference && pts >= localPts + ptsCount) {\n    applyUpdate(update);\n  } else if (pts === localPts + ptsCount) {\n    clearTimeout(PTS_TIMEOUTS.get(channelId));\n    PTS_TIMEOUTS.delete(channelId);\n\n    applyUpdate(update);\n  } else if (pts > localPts + ptsCount) {\n    ptsQueue.add(update); // Return update to queue\n    if (channelId === COMMON_BOX_QUEUE_ID) {\n      scheduleGetDifference();\n    } else {\n      scheduleGetChannelDifference(channelId);\n    }\n    return; // Prevent endless loop\n  }\n\n  popPtsQueue(channelId);\n}\n\nexport function scheduleGetChannelDifference(channelId: string) {\n  if (PTS_TIMEOUTS.has(channelId)) return;\n\n  const timeout = setTimeout(async () => {\n    await getChannelDifference(channelId);\n    PTS_TIMEOUTS.delete(channelId);\n  }, UPDATE_WAIT_TIMEOUT);\n  PTS_TIMEOUTS.set(channelId, timeout);\n}\n\nfunction scheduleGetDifference() {\n  if (seqTimeout) return;\n\n  seqTimeout = setTimeout(async () => {\n    await getDifference();\n    seqTimeout = undefined;\n  }, UPDATE_WAIT_TIMEOUT);\n}\n\nfunction getUpdateChannelId(update: Update) {\n  if ('channelId' in update && 'pts' in update) {\n    return buildApiPeerId(update.channelId, 'channel');\n  }\n\n  if (update instanceof GramJs.UpdateNewChannelMessage || update instanceof GramJs.UpdateEditChannelMessage) {\n    const peer = update.message.peerId as GramJs.PeerChannel;\n    return buildApiPeerId(peer.channelId, 'channel');\n  }\n\n  return COMMON_BOX_QUEUE_ID;\n}\n\nexport async function getDifference() {\n  if (!isInited) {\n    throw new Error('UpdatesManager not initialized');\n  }\n\n  if (!localDb.commonBoxState?.date) {\n    forceSync();\n    return;\n  }\n\n  sendUpdate({\n    '@type': 'updateFetchingDifference',\n    isFetching: true,\n  });\n\n  const response = await invoke(new GramJs.updates.GetDifference({\n    pts: localDb.commonBoxState.pts,\n    date: localDb.commonBoxState.date,\n    qts: localDb.commonBoxState.qts,\n  }));\n\n  if (!response || response instanceof GramJs.updates.DifferenceTooLong) {\n    forceSync();\n    return;\n  }\n\n  if (response instanceof GramJs.updates.DifferenceEmpty) {\n    localDb.commonBoxState.seq = response.seq;\n    localDb.commonBoxState.date = response.date;\n    sendUpdate({\n      '@type': 'updateFetchingDifference',\n      isFetching: false,\n    });\n    return;\n  }\n\n  processDifference(response);\n\n  const newState = response instanceof GramJs.updates.DifferenceSlice ? response.intermediateState : response.state;\n  applyState(newState);\n\n  if (response instanceof GramJs.updates.DifferenceSlice) {\n    getDifference();\n    return;\n  }\n\n  sendUpdate({\n    '@type': 'updateFetchingDifference',\n    isFetching: false,\n  });\n}\n\nasync function getChannelDifference(channelId: string) {\n  const channel = localDb.chats[channelId];\n  if (!channel || !(channel instanceof GramJs.Channel) || !channel.accessHash || !localDb.channelPtsById[channelId]) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.error('[UpdateManager] Channel for difference not found', channelId, channel);\n    }\n    return;\n  }\n\n  const response = await invoke(new GramJs.updates.GetChannelDifference({\n    channel: buildInputEntity(channelId, channel.accessHash.toString()) as GramJs.InputChannel,\n    pts: localDb.channelPtsById[channelId],\n    filter: new GramJs.ChannelMessagesFilterEmpty(),\n    limit: CHANNEL_DIFFERENCE_LIMIT,\n  }));\n\n  if (!response) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('[UpdatesManager] Failed to get ChannelDifference', channelId, channel);\n    }\n    return;\n  }\n\n  if (response instanceof GramJs.updates.ChannelDifferenceTooLong) {\n    forceSync();\n    return;\n  }\n\n  localDb.channelPtsById[channelId] = response.pts;\n\n  if (response instanceof GramJs.updates.ChannelDifferenceEmpty) {\n    popPtsQueue(channelId); // Continue processing updates in queue\n    return;\n  }\n\n  processDifference(response, channelId);\n\n  if (!response.final) {\n    getChannelDifference(channelId);\n  }\n}\n\nfunction forceSync() {\n  reset();\n\n  sendUpdate({\n    '@type': 'requestSync',\n  });\n\n  loadRemoteState();\n}\n\nexport function reset() {\n  PTS_QUEUE.clear();\n  SEQ_QUEUE.clear();\n\n  clearTimeout(seqTimeout);\n  seqTimeout = undefined;\n\n  PTS_TIMEOUTS.forEach((timeout) => {\n    clearTimeout(timeout);\n  });\n  PTS_TIMEOUTS.clear();\n\n  localDb.commonBoxState = {};\n\n  Object.keys(localDb.channelPtsById).forEach((channelId) => {\n    localDb.channelPtsById[channelId] = 0;\n  });\n\n  isInited = false;\n}\n\nexport function processAffectedHistory(\n  chat: ApiChat, affected: GramJs.messages.AffectedMessages | GramJs.messages.AffectedHistory,\n) {\n  const isChannel = chat.type === 'chatTypeChannel' || chat.type === 'chatTypeSuperGroup';\n  const channeId = isChannel ? buildMtpPeerId(chat.id, 'channel') : undefined;\n  const update = buildLocalUpdatePts(affected.pts, affected.ptsCount, channeId);\n\n  processUpdate(update);\n}\n\nasync function loadRemoteState() {\n  const remoteState = await invoke(new GramJs.updates.GetState());\n  if (!remoteState) return;\n\n  applyState(remoteState);\n\n  isInited = true;\n}\n\nfunction processDifference(\n  difference: GramJs.updates.Difference | GramJs.updates.DifferenceSlice | GramJs.updates.ChannelDifference,\n  channelId?: string,\n) {\n  difference.newMessages.forEach((message) => {\n    updater(new GramJs.UpdateNewMessage({\n      message,\n      pts: 0,\n      ptsCount: 0,\n    }));\n  });\n\n  addEntitiesToLocalDb(difference.users);\n  addEntitiesToLocalDb(difference.chats);\n\n  dispatchUserAndChatUpdates(difference.users);\n  dispatchUserAndChatUpdates(difference.chats);\n\n  // Ignore `pts`/`seq` holes when applying updates from difference\n  // BUT, if we got an `UpdateChannelTooLong`, make sure to process other updates after receiving `ChannelDifference`\n  const channelTooLongIds = new Set<string>();\n\n  difference.otherUpdates.forEach((update) => {\n    const updateChannelId = getUpdateChannelId(update);\n\n    if (update instanceof GramJs.UpdateChannelTooLong) {\n      channelTooLongIds.add(getUpdateChannelId(update));\n    }\n\n    const shouldApplyImmediately = !channelTooLongIds.has(updateChannelId);\n    processUpdate(update, shouldApplyImmediately, !shouldApplyImmediately);\n  });\n\n  // Continue processing updates in queues\n  if (channelId) {\n    popPtsQueue(channelId);\n  } else {\n    popSeqQueue();\n  }\n}\n\nfunction getPtsCount(update: PtsUpdate) {\n  return 'ptsCount' in update ? update.ptsCount : 0;\n}\n\nfunction seqComparator(a: SeqUpdate, b: SeqUpdate) {\n  const seqA = 'seqStart' in a ? a.seqStart : a.seq;\n  const seqB = 'seqStart' in b ? b.seqStart : b.seq;\n\n  return seqA - seqB;\n}\n\nfunction ptsComparator(a: PtsUpdate, b: PtsUpdate) {\n  const diff = a.pts - b.pts;\n  if (diff !== 0) {\n    return diff;\n  }\n\n  return getPtsCount(b) - getPtsCount(a);\n}\n","import { ELECTRON_HOST_URL, IS_PACKAGED_ELECTRON } from '../config';\n\n// eslint-disable-next-line no-restricted-globals\nconst cacheApi = self.caches;\n\nlet isSupported: boolean | undefined;\n\nexport async function isCacheApiSupported() {\n  if (!cacheApi) return false;\n\n  isSupported = isSupported ?? await cacheApi.has('test').then(() => true).catch(() => false);\n  return isSupported;\n}\n\nexport enum Type {\n  Text,\n  Blob,\n  Json,\n  ArrayBuffer,\n}\n\nexport async function fetch(\n  cacheName: string, key: string, type: Type, isHtmlAllowed = false,\n) {\n  if (!cacheApi) {\n    return undefined;\n  }\n\n  try {\n    // To avoid the error \"Request scheme 'webdocument' is unsupported\"\n    const request = IS_PACKAGED_ELECTRON\n      ? `${ELECTRON_HOST_URL}/${key.replace(/:/g, '_')}`\n      : new Request(key.replace(/:/g, '_'));\n    const cache = await cacheApi.open(cacheName);\n    const response = await cache.match(request);\n    if (!response) {\n      return undefined;\n    }\n\n    const contentType = response.headers.get('Content-Type');\n\n    switch (type) {\n      case Type.Text:\n        return await response.text();\n      case Type.Blob: {\n        // Ignore deprecated data-uri avatars\n        if (key.startsWith('avatar') && contentType && contentType.startsWith('text')) {\n          return undefined;\n        }\n\n        const blob = await response.blob();\n        const shouldRecreate = !blob.type || (!isHtmlAllowed && blob.type.includes('html'));\n        // iOS Safari fails to preserve `type` in cache\n        let resolvedType = blob.type || contentType;\n\n        if (!(shouldRecreate && resolvedType)) {\n          return blob;\n        }\n\n        // Prevent HTML-in-video attacks (for files that were cached before fix)\n        if (!isHtmlAllowed) {\n          resolvedType = resolvedType.replace(/html/gi, '');\n        }\n\n        return new Blob([blob], { type: resolvedType });\n      }\n      case Type.Json:\n        return await response.json();\n      case Type.ArrayBuffer:\n        return await response.arrayBuffer();\n      default:\n        return undefined;\n    }\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.warn(err);\n    return undefined;\n  }\n}\n\nexport async function save(cacheName: string, key: string, data: AnyLiteral | Blob | ArrayBuffer | string) {\n  if (!cacheApi) {\n    return false;\n  }\n\n  try {\n    const cacheData = typeof data === 'string' || data instanceof Blob || data instanceof ArrayBuffer\n      ? data\n      : JSON.stringify(data);\n    // To avoid the error \"Request scheme 'webdocument' is unsupported\"\n    const request = IS_PACKAGED_ELECTRON\n      ? `${ELECTRON_HOST_URL}/${key.replace(/:/g, '_')}`\n      : new Request(key.replace(/:/g, '_'));\n    const response = new Response(cacheData);\n    const cache = await cacheApi.open(cacheName);\n    await cache.put(request, response);\n    return true;\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.warn(err);\n    return false;\n  }\n}\n\nexport async function remove(cacheName: string, key: string) {\n  try {\n    if (!cacheApi) {\n      return undefined;\n    }\n\n    const cache = await cacheApi.open(cacheName);\n    return await cache.delete(key);\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.warn(err);\n    return undefined;\n  }\n}\n\nexport async function clear(cacheName: string) {\n  try {\n    if (!cacheApi) {\n      return undefined;\n    }\n\n    return await cacheApi.delete(cacheName);\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.warn(err);\n    return undefined;\n  }\n}\n","import { Api as GramJs } from '../../../lib/gramjs';\n\nimport type { TelegramClient } from '../../../lib/gramjs';\nimport type { ApiOnProgress, ApiParsedMedia } from '../../types';\nimport {\n  ApiMediaFormat,\n} from '../../types';\n\nimport {\n  DOWNLOAD_WORKERS,\n  MEDIA_CACHE_DISABLED,\n  MEDIA_CACHE_MAX_BYTES,\n  MEDIA_CACHE_NAME,\n  MEDIA_CACHE_NAME_AVATARS,\n} from '../../../config';\nimport * as cacheApi from '../../../util/cacheApi';\nimport { getEntityTypeById } from '../gramjsBuilders';\nimport localDb from '../localDb';\n\nconst MEDIA_ENTITY_TYPES = new Set([\n  'msg', 'sticker', 'gif', 'wallpaper', 'photo', 'webDocument', 'document', 'videoAvatar',\n]);\n\nconst JPEG_SIZE_TYPES = new Set(['s', 'm', 'x', 'y', 'w', 'a', 'b', 'c', 'd']);\n\nexport default async function downloadMedia(\n  {\n    url, mediaFormat, start, end, isHtmlAllowed,\n  }: {\n    url: string; mediaFormat: ApiMediaFormat; start?: number; end?: number; isHtmlAllowed?: boolean;\n  },\n  client: TelegramClient,\n  onProgress?: ApiOnProgress,\n) {\n  const {\n    data, mimeType, fullSize,\n  } = await download(url, client, onProgress, start, end, isHtmlAllowed) || {};\n\n  if (!data) {\n    return undefined;\n  }\n\n  const parsed = await parseMedia(data, mediaFormat, mimeType);\n  if (!parsed) {\n    return undefined;\n  }\n\n  const canCache = mediaFormat !== ApiMediaFormat.Progressive && (\n    mediaFormat !== ApiMediaFormat.BlobUrl || (parsed as Blob).size <= MEDIA_CACHE_MAX_BYTES\n  );\n\n  if (!MEDIA_CACHE_DISABLED && cacheApi && canCache) {\n    const cacheName = url.startsWith('avatar') ? MEDIA_CACHE_NAME_AVATARS : MEDIA_CACHE_NAME;\n    void cacheApi.save(cacheName, url, parsed);\n  }\n\n  const dataBlob = mediaFormat === ApiMediaFormat.Progressive ? '' : parsed as string | Blob;\n  const arrayBuffer = mediaFormat === ApiMediaFormat.Progressive ? parsed as ArrayBuffer : undefined;\n\n  return {\n    dataBlob,\n    arrayBuffer,\n    mimeType,\n    fullSize,\n  };\n}\n\nexport type EntityType = (\n  'msg' | 'sticker' | 'wallpaper' | 'gif' | 'channel' | 'chat' | 'user' | 'photo' | 'stickerSet' | 'webDocument' |\n  'document' | 'staticMap' | 'videoAvatar'\n);\n\nasync function download(\n  url: string,\n  client: TelegramClient,\n  onProgress?: ApiOnProgress,\n  start?: number,\n  end?: number,\n  isHtmlAllowed?: boolean,\n) {\n  const parsed = parseMediaUrl(url);\n\n  if (!parsed) return undefined;\n\n  const {\n    entityType, entityId, sizeType, params, mediaMatchType,\n  } = parsed;\n\n  if (entityType === 'staticMap') {\n    const accessHash = entityId;\n    const parsedParams = new URLSearchParams(params);\n    const long = parsedParams.get('long');\n    const lat = parsedParams.get('lat');\n    const w = parsedParams.get('w');\n    const h = parsedParams.get('h');\n    const zoom = parsedParams.get('zoom');\n    const scale = parsedParams.get('scale');\n    const accuracyRadius = parsedParams.get('accuracy_radius');\n\n    const data = await client.downloadStaticMap(accessHash, long, lat, w, h, zoom, scale, accuracyRadius);\n    return {\n      mimeType: 'image/png',\n      data,\n    };\n  }\n\n  let entity: (\n    GramJs.User | GramJs.Chat | GramJs.Channel | GramJs.Photo |\n    GramJs.Message | GramJs.MessageService |\n    GramJs.Document | GramJs.StickerSet | GramJs.TypeWebDocument | undefined\n  );\n\n  switch (entityType) {\n    case 'channel':\n    case 'chat':\n      entity = localDb.chats[entityId];\n      break;\n    case 'user':\n      entity = localDb.users[entityId];\n      break;\n    case 'msg':\n      entity = localDb.messages[entityId];\n      break;\n    case 'sticker':\n    case 'gif':\n    case 'wallpaper':\n      entity = localDb.documents[entityId];\n      break;\n    case 'videoAvatar':\n    case 'photo':\n      entity = localDb.photos[entityId];\n      break;\n    case 'stickerSet':\n      entity = localDb.stickerSets[entityId];\n      break;\n    case 'webDocument':\n      entity = localDb.webDocuments[entityId];\n      break;\n    case 'document':\n      entity = localDb.documents[entityId];\n      break;\n  }\n\n  if (!entity) {\n    return undefined;\n  }\n\n  if (MEDIA_ENTITY_TYPES.has(entityType)) {\n    const data = await client.downloadMedia(entity, {\n      sizeType, start, end, progressCallback: onProgress, workers: DOWNLOAD_WORKERS,\n    });\n    let mimeType;\n    let fullSize;\n\n    if (entity instanceof GramJs.MessageService && entity.action instanceof GramJs.MessageActionSuggestProfilePhoto) {\n      mimeType = 'image/jpeg';\n    } else if (entity instanceof GramJs.Message) {\n      mimeType = getMessageMediaMimeType(entity, sizeType);\n      if (entity.media instanceof GramJs.MessageMediaDocument && entity.media.document instanceof GramJs.Document) {\n        fullSize = entity.media.document.size.toJSNumber();\n      }\n      if (entity.media instanceof GramJs.MessageMediaWebPage\n        && entity.media.webpage instanceof GramJs.WebPage\n        && entity.media.webpage.document instanceof GramJs.Document) {\n        fullSize = entity.media.webpage.document.size.toJSNumber();\n      }\n    } else if (entity instanceof GramJs.Photo) {\n      if (entityType === 'videoAvatar') {\n        mimeType = 'video/mp4';\n      } else {\n        mimeType = 'image/jpeg';\n      }\n    } else if (entityType === 'sticker' && sizeType) {\n      mimeType = 'image/webp';\n    } else if (entityType === 'webDocument') {\n      mimeType = (entity as GramJs.TypeWebDocument).mimeType;\n      fullSize = (entity as GramJs.TypeWebDocument).size;\n    } else {\n      if (JPEG_SIZE_TYPES.has(sizeType || '')) {\n        mimeType = 'image/jpeg';\n      } else {\n        mimeType = (entity as GramJs.Document).mimeType;\n      }\n      fullSize = (entity as GramJs.Document).size.toJSNumber();\n    }\n\n    // Prevent HTML-in-video attacks\n    if (!isHtmlAllowed && mimeType) {\n      mimeType = mimeType.replace(/html/gi, '');\n    }\n\n    return { mimeType, data, fullSize };\n  } else if (entityType === 'stickerSet') {\n    const data = await client.downloadStickerSetThumb(entity);\n    const mimeType = getMimeType(data);\n\n    return { mimeType, data };\n  } else {\n    const data = await client.downloadProfilePhoto(entity, mediaMatchType === 'profile');\n    const mimeType = getMimeType(data);\n\n    return { mimeType, data };\n  }\n}\n\nfunction getMessageMediaMimeType(message: GramJs.Message, sizeType?: string) {\n  if (!message || !message.media) {\n    return undefined;\n  }\n\n  if (message.media instanceof GramJs.MessageMediaPhoto) {\n    return 'image/jpeg';\n  }\n\n  if (message.media instanceof GramJs.MessageMediaGeo\n    || message.media instanceof GramJs.MessageMediaVenue\n    || message.media instanceof GramJs.MessageMediaGeoLive) {\n    return 'image/png';\n  }\n\n  if (message.media instanceof GramJs.MessageMediaDocument) {\n    const document = message.media.document;\n    if (document instanceof GramJs.Document) {\n      if (sizeType) {\n        return document.attributes.some((a) => a instanceof GramJs.DocumentAttributeSticker)\n          ? 'image/webp'\n          : 'image/jpeg';\n      }\n\n      return document.mimeType;\n    }\n  }\n\n  if (message.media instanceof GramJs.MessageMediaWebPage\n    && message.media.webpage instanceof GramJs.WebPage\n    && message.media.webpage.document instanceof GramJs.Document) {\n    if (sizeType) {\n      return 'image/jpeg';\n    }\n\n    return message.media.webpage.document.mimeType;\n  }\n\n  return undefined;\n}\n\n// eslint-disable-next-line no-async-without-await/no-async-without-await\nasync function parseMedia(\n  data: Buffer, mediaFormat: ApiMediaFormat, mimeType?: string,\n): Promise<ApiParsedMedia | undefined> {\n  switch (mediaFormat) {\n    case ApiMediaFormat.BlobUrl:\n      return new Blob([data], { type: mimeType });\n    case ApiMediaFormat.Text:\n      return data.toString();\n    case ApiMediaFormat.Progressive:\n    case ApiMediaFormat.DownloadUrl:\n      return data.buffer;\n  }\n\n  return undefined;\n}\n\nfunction getMimeType(data: Uint8Array, fallbackMimeType = 'image/jpeg') {\n  if (data.length < 4) {\n    return fallbackMimeType;\n  }\n\n  let type = fallbackMimeType;\n  const signature = data.subarray(0, 4).reduce((result, byte) => result + byte.toString(16), '');\n\n  // https://en.wikipedia.org/wiki/List_of_file_signatures\n  switch (signature) {\n    case '89504e47':\n      type = 'image/png';\n      break;\n    case '47494638':\n      type = 'image/gif';\n      break;\n    case 'ffd8ffe0':\n    case 'ffd8ffe1':\n    case 'ffd8ffe2':\n    case 'ffd8ffe3':\n    case 'ffd8ffe8':\n      type = 'image/jpeg';\n      break;\n    case '52494646':\n      // In our case only webp is expected\n      type = 'image/webp';\n      break;\n  }\n\n  return type;\n}\n\nexport function parseMediaUrl(url: string) {\n  const mediaMatch = url.startsWith('staticMap')\n    ? url.match(/(staticMap):([0-9-]+)(\\?.+)/)\n    : url.startsWith('webDocument')\n      ? url.match(/(webDocument):(.+)/)\n      : url.match(\n        // eslint-disable-next-line max-len\n        /(avatar|profile|photo|msg|stickerSet|sticker|wallpaper|gif|document|videoAvatar)([-\\d\\w./]+)(?::\\d+)?(\\?size=\\w+)?/,\n      );\n  if (!mediaMatch) {\n    return undefined;\n  }\n\n  const mediaMatchType = mediaMatch[1];\n  const entityId: string | number = mediaMatch[2];\n\n  let entityType: EntityType;\n  const params = mediaMatch[3];\n  const sizeType = params?.replace('?size=', '') || undefined;\n\n  if (mediaMatch[1] === 'avatar' || mediaMatch[1] === 'profile') {\n    entityType = getEntityTypeById(entityId);\n  } else {\n    entityType = mediaMatch[1] as EntityType;\n  }\n\n  return {\n    mediaMatchType,\n    entityType,\n    entityId,\n    sizeType,\n    params,\n  };\n}\n","import type { ThreadId } from '../../types';\n\nexport class ChatAbortController extends AbortController {\n  private threads = new Map<ThreadId, AbortController>();\n\n  public getThreadSignal(threadId: ThreadId): AbortSignal {\n    let controller = this.threads.get(threadId);\n    if (!controller) {\n      controller = new AbortController();\n      this.threads.set(threadId, controller);\n    }\n    return controller.signal;\n  }\n\n  public abortThread(threadId: ThreadId, reason?: string): void {\n    this.threads.get(threadId)?.abort(reason);\n    this.threads.delete(threadId);\n  }\n\n  public abort(reason?: string): void {\n    super.abort(reason);\n    this.threads.forEach((controller) => controller.abort(reason));\n    this.threads.clear();\n  }\n}\n","import {\n  Api as GramJs,\n  sessions,\n} from '../../../lib/gramjs';\nimport type { TwoFaParams } from '../../../lib/gramjs/client/2fa';\nimport TelegramClient from '../../../lib/gramjs/client/TelegramClient';\nimport { Logger as GramJsLogger } from '../../../lib/gramjs/extensions/index';\n\nimport type { ThreadId } from '../../../types';\nimport type {\n  ApiInitialArgs,\n  ApiMediaFormat,\n  ApiOnProgress,\n  ApiSessionData,\n  OnApiUpdate,\n} from '../../types';\n\nimport {\n  APP_CODE_NAME,\n  DEBUG, DEBUG_GRAMJS, IS_TEST, UPLOAD_WORKERS,\n} from '../../../config';\nimport { pause } from '../../../util/schedulers';\nimport { setMessageBuilderCurrentUserId } from '../apiBuilders/messages';\nimport { buildApiPeerId } from '../apiBuilders/peers';\nimport { buildApiUser, buildApiUserFullInfo } from '../apiBuilders/users';\nimport { buildInputPeerFromLocalDb } from '../gramjsBuilders';\nimport {\n  addEntitiesToLocalDb,\n  addMessageToLocalDb, addStoryToLocalDb, addUserToLocalDb, isResponseUpdate, log,\n} from '../helpers';\nimport localDb, { clearLocalDb } from '../localDb';\nimport {\n  getDifference,\n  init as initUpdatesManager,\n  processUpdate,\n  reset as resetUpdatesManager,\n  scheduleGetChannelDifference,\n  updateChannelState,\n} from '../updates/updateManager';\nimport {\n  onAuthError, onAuthReady, onCurrentUserUpdate, onRequestCode, onRequestPassword, onRequestPhoneNumber,\n  onRequestQrCode, onRequestRegistration, onWebAuthTokenFailed,\n} from './auth';\nimport downloadMediaWithClient, { parseMediaUrl } from './media';\n\nimport { ChatAbortController } from '../ChatAbortController';\n\nconst DEFAULT_USER_AGENT = 'Unknown UserAgent';\nconst DEFAULT_PLATFORM = 'Unknown platform';\n\nGramJsLogger.setLevel(DEBUG_GRAMJS ? 'debug' : 'warn');\n\nconst gramJsUpdateEventBuilder = { build: (update: object) => update };\n\nconst CHAT_ABORT_CONTROLLERS = new Map<string, ChatAbortController>();\nconst ABORT_CONTROLLERS = new Map<string, AbortController>();\n\nlet onUpdate: OnApiUpdate;\nlet client: TelegramClient;\nlet currentUserId: string | undefined;\n\nexport async function init(_onUpdate: OnApiUpdate, initialArgs: ApiInitialArgs) {\n  if (DEBUG) {\n    // eslint-disable-next-line no-console\n    console.log('>>> START INIT API');\n  }\n\n  onUpdate = _onUpdate;\n\n  const {\n    userAgent, platform, sessionData, isTest, isWebmSupported, maxBufferSize, webAuthToken, dcId,\n    mockScenario, shouldForceHttpTransport, shouldAllowHttpTransport,\n    shouldDebugExportedSenders,\n  } = initialArgs;\n  const session = new sessions.CallbackSession(sessionData, onSessionUpdate);\n\n  // eslint-disable-next-line no-restricted-globals\n  (self as any).isWebmSupported = isWebmSupported;\n  // eslint-disable-next-line no-restricted-globals\n  (self as any).maxBufferSize = maxBufferSize;\n\n  client = new TelegramClient(\n    session,\n    process.env.TELEGRAM_API_ID,\n    process.env.TELEGRAM_API_HASH,\n    {\n      deviceModel: navigator.userAgent || userAgent || DEFAULT_USER_AGENT,\n      systemVersion: platform || DEFAULT_PLATFORM,\n      appVersion: `${APP_VERSION} ${APP_CODE_NAME}`,\n      useWSS: true,\n      additionalDcsDisabled: IS_TEST,\n      shouldDebugExportedSenders,\n      shouldForceHttpTransport,\n      shouldAllowHttpTransport,\n      testServers: isTest,\n      dcId,\n    } as any,\n  );\n\n  client.addEventHandler(handleGramJsUpdate, gramJsUpdateEventBuilder);\n\n  try {\n    if (DEBUG) {\n      log('CONNECTING');\n\n      // eslint-disable-next-line no-restricted-globals\n      (self as any).invoke = invokeRequest;\n      // eslint-disable-next-line no-restricted-globals\n      (self as any).GramJs = GramJs;\n    }\n\n    try {\n      client.setPingCallback(getDifference);\n      await client.start({\n        phoneNumber: onRequestPhoneNumber,\n        phoneCode: onRequestCode,\n        password: onRequestPassword,\n        firstAndLastNames: onRequestRegistration,\n        qrCode: onRequestQrCode,\n        onError: onAuthError,\n        initialMethod: platform === 'iOS' || platform === 'Android' ? 'phoneNumber' : 'qrCode',\n        shouldThrowIfUnauthorized: Boolean(sessionData),\n        webAuthToken,\n        webAuthTokenFailed: onWebAuthTokenFailed,\n        mockScenario,\n      });\n    } catch (err: any) {\n      // eslint-disable-next-line no-console\n      console.error(err);\n\n      if (err.message !== 'Disconnect' && err.message !== 'Cannot send requests while disconnected') {\n        onUpdate({\n          '@type': 'updateConnectionState',\n          connectionState: 'connectionStateBroken',\n        });\n\n        return;\n      }\n    }\n\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.log('>>> FINISH INIT API');\n      log('CONNECTED');\n    }\n\n    onAuthReady();\n    onSessionUpdate(session.getSessionData());\n    onUpdate({ '@type': 'updateApiReady' });\n\n    initUpdatesManager(invokeRequest);\n\n    void fetchCurrentUser();\n  } catch (err) {\n    if (DEBUG) {\n      log('CONNECTING ERROR', err);\n    }\n\n    throw err;\n  }\n}\n\nexport function setIsPremium({ isPremium }: { isPremium: boolean }) {\n  client.setIsPremium(isPremium);\n}\n\nconst LOG_OUT_TIMEOUT = 2500;\nexport async function destroy(noLogOut = false, noClearLocalDb = false) {\n  if (!noLogOut && client.isConnected()) {\n    await Promise.race([\n      invokeRequest(new GramJs.auth.LogOut()),\n      pause(LOG_OUT_TIMEOUT),\n    ]);\n  }\n\n  if (!noClearLocalDb) {\n    clearLocalDb();\n    resetUpdatesManager();\n  }\n\n  await client.destroy();\n}\n\nexport async function disconnect() {\n  await client.disconnect();\n}\n\nexport function getClient() {\n  return client;\n}\n\nfunction onSessionUpdate(sessionData: ApiSessionData) {\n  onUpdate({\n    '@type': 'updateSession',\n    sessionData,\n  });\n}\n\ntype UpdateConfig = GramJs.UpdateConfig & { _entities?: (GramJs.TypeUser | GramJs.TypeChat)[] };\n\nexport function handleGramJsUpdate(update: any) {\n  processUpdate(update);\n\n  if (update instanceof GramJs.UpdatesTooLong) {\n    void handleTerminatedSession();\n  } else {\n    const updates = 'updates' in update ? update.updates : [update];\n    updates.forEach((nestedUpdate: any) => {\n      if (!(nestedUpdate instanceof GramJs.UpdateConfig)) return;\n      // eslint-disable-next-line no-underscore-dangle\n      const currentUser = (nestedUpdate as UpdateConfig)._entities\n        ?.find((entity) => entity instanceof GramJs.User && buildApiPeerId(entity.id, 'user') === currentUserId);\n      if (!(currentUser instanceof GramJs.User)) return;\n\n      setIsPremium({ isPremium: Boolean(currentUser.premium) });\n    });\n  }\n}\n\ntype InvokeRequestParams = {\n  shouldThrow?: boolean;\n  shouldIgnoreUpdates?: boolean;\n  dcId?: number;\n  shouldIgnoreErrors?: boolean;\n  abortControllerChatId?: string;\n  abortControllerThreadId?: ThreadId;\n  abortControllerGroup?: 'call';\n  shouldRetryOnTimeout?: boolean;\n};\n\nexport async function invokeRequest<T extends GramJs.AnyRequest>(\n  request: T,\n  params?: InvokeRequestParams & { shouldReturnTrue?: false },\n): Promise<T['__response'] | undefined>;\n\nexport async function invokeRequest<T extends GramJs.AnyRequest>(\n  request: T,\n  params?: InvokeRequestParams & { shouldReturnTrue: true },\n): Promise<true | undefined>;\n\nexport async function invokeRequest<T extends GramJs.AnyRequest>(\n  request: T,\n  params: InvokeRequestParams & { shouldReturnTrue?: boolean } = {},\n) {\n  const {\n    shouldThrow, shouldIgnoreUpdates, dcId, shouldIgnoreErrors, abortControllerChatId, abortControllerThreadId,\n    shouldRetryOnTimeout, abortControllerGroup,\n  } = params;\n  const shouldReturnTrue = Boolean(params.shouldReturnTrue);\n\n  let abortSignal: AbortSignal | undefined;\n  if (abortControllerChatId) {\n    let controller = CHAT_ABORT_CONTROLLERS.get(abortControllerChatId);\n    if (!controller) {\n      controller = new ChatAbortController();\n      CHAT_ABORT_CONTROLLERS.set(abortControllerChatId, controller);\n    }\n\n    abortSignal = abortControllerThreadId ? controller.getThreadSignal(abortControllerThreadId) : controller.signal;\n  }\n\n  if (abortControllerGroup) {\n    let controller = ABORT_CONTROLLERS.get(abortControllerGroup);\n    if (!controller) {\n      controller = new AbortController();\n      ABORT_CONTROLLERS.set(abortControllerGroup, controller);\n    }\n    abortSignal = controller.signal;\n  }\n\n  try {\n    if (DEBUG) {\n      log('INVOKE', request.className);\n    }\n\n    const result = await client.invoke(request, dcId, abortSignal, shouldRetryOnTimeout);\n\n    if (DEBUG) {\n      log('RESPONSE', request.className, result);\n    }\n\n    if (!shouldIgnoreUpdates && isResponseUpdate(result)) {\n      processUpdate(result);\n    }\n\n    return shouldReturnTrue ? result && true : result;\n  } catch (err: any) {\n    if (shouldIgnoreErrors) return undefined;\n    if (DEBUG) {\n      log('INVOKE ERROR', request.className);\n      // eslint-disable-next-line no-console\n      console.debug('invokeRequest failed with payload', request);\n      // eslint-disable-next-line no-console\n      console.error(err);\n    }\n\n    if (shouldThrow) {\n      throw err;\n    }\n\n    dispatchErrorUpdate(err, request);\n\n    return undefined;\n  }\n}\n\nexport function invokeRequestBeacon<T extends GramJs.AnyRequest>(\n  request: T,\n  dcId?: number,\n) {\n  if (DEBUG) {\n    log('BEACON', request.className);\n  }\n\n  client.invokeBeacon(request, dcId);\n}\n\nexport async function downloadMedia(\n  args: {\n    url: string; mediaFormat: ApiMediaFormat; start?: number; end?: number; isHtmlAllowed?: boolean;\n  },\n  onProgress?: ApiOnProgress,\n) {\n  try {\n    return (await downloadMediaWithClient(args, client, onProgress));\n  } catch (err: any) {\n    if (err.message.startsWith('FILE_REFERENCE')) {\n      const isFileReferenceRepaired = await repairFileReference({ url: args.url });\n      if (isFileReferenceRepaired) {\n        return downloadMediaWithClient(args, client, onProgress);\n      }\n\n      if (DEBUG) {\n        // eslint-disable-next-line no-console\n        console.error('Failed to repair file reference', args.url);\n      }\n    }\n\n    throw err;\n  }\n}\n\nexport function uploadFile(file: File, onProgress?: ApiOnProgress) {\n  return client.uploadFile({ file, onProgress, workers: UPLOAD_WORKERS });\n}\n\nexport function updateTwoFaSettings(params: TwoFaParams) {\n  return client.updateTwoFaSettings(params);\n}\n\nexport function getTmpPassword(currentPassword: string, ttl?: number) {\n  return client.getTmpPassword(currentPassword, ttl);\n}\n\nexport function abortChatRequests(params: { chatId: string; threadId?: ThreadId }) {\n  const { chatId, threadId } = params;\n  const controller = CHAT_ABORT_CONTROLLERS.get(chatId);\n  if (!threadId) {\n    controller?.abort('Chat change');\n    CHAT_ABORT_CONTROLLERS.delete(chatId);\n    return;\n  }\n\n  controller?.abortThread(threadId, 'Thread change');\n}\n\nexport function abortRequestGroup(group: string) {\n  ABORT_CONTROLLERS.get(group)?.abort();\n  ABORT_CONTROLLERS.delete(group);\n}\n\nexport async function fetchCurrentUser() {\n  const userFull = await invokeRequest(new GramJs.users.GetFullUser({\n    id: new GramJs.InputUserSelf(),\n  }));\n\n  if (!userFull || !(userFull.users[0] instanceof GramJs.User)) {\n    return;\n  }\n\n  const user = userFull.users[0];\n\n  if (user.photo instanceof GramJs.Photo) {\n    localDb.photos[user.photo.id.toString()] = user.photo;\n  }\n  addUserToLocalDb(user);\n  const currentUserFullInfo = buildApiUserFullInfo(userFull);\n  const currentUser = buildApiUser(user)!;\n\n  setMessageBuilderCurrentUserId(currentUser.id);\n  onCurrentUserUpdate(currentUser, currentUserFullInfo);\n\n  currentUserId = currentUser.id;\n  setIsPremium({ isPremium: Boolean(currentUser.isPremium) });\n}\n\nexport function dispatchErrorUpdate<T extends GramJs.AnyRequest>(err: Error, request: T) {\n  const isSlowMode = err.message.startsWith('A wait of') && (\n    request instanceof GramJs.messages.SendMessage\n    || request instanceof GramJs.messages.SendMedia\n    || request instanceof GramJs.messages.SendMultiMedia\n  );\n\n  const { message } = err;\n\n  onUpdate({\n    '@type': 'error',\n    error: {\n      message,\n      isSlowMode,\n      hasErrorKey: true,\n    },\n  });\n}\n\nasync function handleTerminatedSession() {\n  try {\n    await invokeRequest(new GramJs.users.GetFullUser({\n      id: new GramJs.InputUserSelf(),\n    }), {\n      shouldThrow: true,\n    });\n  } catch (err: any) {\n    if (err.message === 'AUTH_KEY_UNREGISTERED' || err.message === 'SESSION_REVOKED') {\n      onUpdate({\n        '@type': 'updateConnectionState',\n        connectionState: 'connectionStateBroken',\n      });\n    }\n  }\n}\n\nexport async function repairFileReference({\n  url,\n}: {\n  url: string;\n}) {\n  const parsed = parseMediaUrl(url);\n\n  if (!parsed) return undefined;\n\n  const {\n    entityType, entityId, mediaMatchType,\n  } = parsed;\n\n  if (mediaMatchType === 'document' || mediaMatchType === 'photo') {\n    const entity = mediaMatchType === 'document' ? localDb.documents[entityId] : localDb.photos[entityId];\n    if (!entity.storyData) return false;\n    const peer = buildInputPeerFromLocalDb(entity.storyData.peerId);\n    if (!peer) return false;\n\n    const result = await invokeRequest(new GramJs.stories.GetStoriesByID({\n      peer,\n      id: [entity.storyData.id],\n    }));\n    if (!result) return false;\n\n    addEntitiesToLocalDb(result.users);\n    result.stories.forEach((story) => addStoryToLocalDb(story, entity.storyData!.peerId));\n    return true;\n  }\n\n  if (entityType === 'msg') {\n    const entity = localDb.messages[entityId]!;\n    const messageId = entity.id;\n\n    const peer = 'channelId' in entity.peerId ? new GramJs.InputChannel({\n      channelId: entity.peerId.channelId,\n      accessHash: (localDb.chats[buildApiPeerId(entity.peerId.channelId, 'channel')] as GramJs.Channel).accessHash!,\n    }) : undefined;\n    const result = await invokeRequest(\n      peer\n        ? new GramJs.channels.GetMessages({\n          channel: peer,\n          id: [new GramJs.InputMessageID({ id: messageId })],\n        })\n        : new GramJs.messages.GetMessages({\n          id: [new GramJs.InputMessageID({ id: messageId })],\n        }),\n    );\n\n    if (!result || result instanceof GramJs.messages.MessagesNotModified) return false;\n\n    if (peer && 'pts' in result) {\n      updateChannelState(buildApiPeerId(peer.channelId, 'channel'), result.pts);\n    }\n\n    const message = result.messages[0];\n    if (message instanceof GramJs.MessageEmpty) return false;\n    addEntitiesToLocalDb(result.users);\n    addEntitiesToLocalDb(result.chats);\n    addMessageToLocalDb(message);\n    return true;\n  }\n\n  return false;\n}\n\nexport function setForceHttpTransport(forceHttpTransport: boolean) {\n  client.setForceHttpTransport(forceHttpTransport);\n}\n\nexport function setAllowHttpTransport(allowHttpTransport: boolean) {\n  client.setAllowHttpTransport(allowHttpTransport);\n}\n\nexport function setShouldDebugExportedSenders(value: boolean) {\n  client.setShouldDebugExportedSenders(value);\n}\n\nexport function requestChannelDifference(channelId: string) {\n  scheduleGetChannelDifference(channelId);\n}\n","import BigInt from 'big-integer';\nimport { Api as GramJs } from '../../../lib/gramjs';\n\nimport type {\n  ApiBotApp,\n  ApiChat,\n  ApiInputMessageReplyInfo,\n  ApiPeer,\n  ApiThemeParameters,\n  ApiUser,\n  OnApiUpdate,\n} from '../../types';\n\nimport { WEB_APP_PLATFORM } from '../../../config';\nimport { buildCollectionByKey } from '../../../util/iteratees';\nimport {\n  buildApiAttachBot,\n  buildApiBotInlineMediaResult,\n  buildApiBotInlineResult,\n  buildApiMessagesBotApp,\n  buildBotSwitchPm,\n  buildBotSwitchWebview,\n} from '../apiBuilders/bots';\nimport { buildApiChatFromPreview } from '../apiBuilders/chats';\nimport { omitVirtualClassFields } from '../apiBuilders/helpers';\nimport { buildApiUrlAuthResult } from '../apiBuilders/misc';\nimport { buildApiUser } from '../apiBuilders/users';\nimport {\n  buildInputBotApp,\n  buildInputEntity,\n  buildInputPeer,\n  buildInputReplyTo,\n  buildInputThemeParams,\n  generateRandomBigInt,\n} from '../gramjsBuilders';\nimport { addEntitiesToLocalDb, addUserToLocalDb, deserializeBytes } from '../helpers';\nimport localDb from '../localDb';\nimport { invokeRequest } from './client';\n\nlet onUpdate: OnApiUpdate;\n\nexport function init(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nexport async function answerCallbackButton({\n  chatId, accessHash, messageId, data, isGame,\n}: {\n  chatId: string; accessHash?: string; messageId: number; data?: string; isGame?: boolean;\n}) {\n  const result = await invokeRequest(new GramJs.messages.GetBotCallbackAnswer({\n    peer: buildInputPeer(chatId, accessHash),\n    msgId: messageId,\n    data: data ? deserializeBytes(data) : undefined,\n    game: isGame || undefined,\n  }));\n\n  return result ? omitVirtualClassFields(result) : undefined;\n}\n\nexport async function fetchTopInlineBots() {\n  const topPeers = await invokeRequest(new GramJs.contacts.GetTopPeers({\n    botsInline: true,\n  }));\n\n  if (!(topPeers instanceof GramJs.contacts.TopPeers)) {\n    return undefined;\n  }\n\n  const users = topPeers.users.map(buildApiUser).filter(Boolean);\n  const ids = users.map(({ id }) => id);\n\n  return {\n    ids,\n    users,\n  };\n}\n\nexport async function fetchInlineBot({ username }: { username: string }) {\n  const resolvedPeer = await invokeRequest(new GramJs.contacts.ResolveUsername({ username }));\n\n  if (\n    !resolvedPeer\n    || !(\n      resolvedPeer.users[0] instanceof GramJs.User\n      && resolvedPeer.users[0].bot\n      && resolvedPeer.users[0].botInlinePlaceholder\n    )\n  ) {\n    return undefined;\n  }\n\n  addUserToLocalDb(resolvedPeer.users[0]);\n\n  return {\n    user: buildApiUser(resolvedPeer.users[0]),\n    chat: buildApiChatFromPreview(resolvedPeer.users[0]),\n  };\n}\n\nexport async function fetchInlineBotResults({\n  bot, chat, query, offset = '',\n}: {\n  bot: ApiUser; chat: ApiChat; query: string; offset?: string;\n}) {\n  const result = await invokeRequest(new GramJs.messages.GetInlineBotResults({\n    bot: buildInputPeer(bot.id, bot.accessHash),\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    query,\n    offset,\n  }));\n\n  if (!result) {\n    return undefined;\n  }\n\n  addEntitiesToLocalDb(result.users);\n\n  return {\n    isGallery: Boolean(result.gallery),\n    help: bot.botPlaceholder,\n    nextOffset: getInlineBotResultsNextOffset(bot.usernames![0].username, result.nextOffset),\n    switchPm: buildBotSwitchPm(result.switchPm),\n    switchWebview: buildBotSwitchWebview(result.switchWebview),\n    users: result.users.map(buildApiUser).filter(Boolean),\n    results: processInlineBotResult(String(result.queryId), result.results),\n    cacheTime: result.cacheTime,\n  };\n}\n\nexport async function sendInlineBotResult({\n  chat, replyInfo, resultId, queryId, sendAs, isSilent, scheduleDate,\n}: {\n  chat: ApiChat;\n  replyInfo?: ApiInputMessageReplyInfo;\n  resultId: string;\n  queryId: string;\n  sendAs?: ApiPeer;\n  isSilent?: boolean;\n  scheduleDate?: number;\n}) {\n  const randomId = generateRandomBigInt();\n\n  await invokeRequest(new GramJs.messages.SendInlineBotResult({\n    clearDraft: true,\n    randomId,\n    queryId: BigInt(queryId),\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    id: resultId,\n    scheduleDate,\n    replyTo: replyInfo && buildInputReplyTo(replyInfo),\n    ...(isSilent && { silent: true }),\n    ...(sendAs && { sendAs: buildInputPeer(sendAs.id, sendAs.accessHash) }),\n  }));\n}\n\nexport async function startBot({\n  bot, startParam,\n}: {\n  bot: ApiUser;\n  startParam?: string;\n}) {\n  const randomId = generateRandomBigInt();\n\n  await invokeRequest(new GramJs.messages.StartBot({\n    bot: buildInputPeer(bot.id, bot.accessHash),\n    peer: buildInputPeer(bot.id, bot.accessHash),\n    randomId,\n    startParam,\n  }));\n}\n\nexport async function requestWebView({\n  isSilent,\n  peer,\n  bot,\n  url,\n  startParam,\n  replyInfo,\n  theme,\n  sendAs,\n  isFromBotMenu,\n}: {\n  isSilent?: boolean;\n  peer: ApiPeer;\n  bot: ApiUser;\n  url?: string;\n  startParam?: string;\n  replyInfo?: ApiInputMessageReplyInfo;\n  theme?: ApiThemeParameters;\n  sendAs?: ApiPeer;\n  isFromBotMenu?: boolean;\n}) {\n  const result = await invokeRequest(new GramJs.messages.RequestWebView({\n    silent: isSilent || undefined,\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    bot: buildInputPeer(bot.id, bot.accessHash),\n    url,\n    startParam,\n    themeParams: theme ? buildInputThemeParams(theme) : undefined,\n    fromBotMenu: isFromBotMenu || undefined,\n    platform: WEB_APP_PLATFORM,\n    replyTo: replyInfo && buildInputReplyTo(replyInfo),\n    ...(sendAs && { sendAs: buildInputPeer(sendAs.id, sendAs.accessHash) }),\n  }));\n\n  if (result instanceof GramJs.WebViewResultUrl) {\n    return {\n      url: result.url,\n      queryId: result.queryId.toString(),\n    };\n  }\n\n  return undefined;\n}\n\nexport async function requestSimpleWebView({\n  bot,\n  url,\n  theme,\n  startParam,\n  isFromSwitchWebView,\n  isFromSideMenu,\n}: {\n  bot: ApiUser;\n  url?: string;\n  theme?: ApiThemeParameters;\n  startParam?: string;\n  isFromSwitchWebView?: boolean;\n  isFromSideMenu?: boolean;\n}) {\n  const result = await invokeRequest(new GramJs.messages.RequestSimpleWebView({\n    url,\n    bot: buildInputPeer(bot.id, bot.accessHash),\n    themeParams: theme ? buildInputThemeParams(theme) : undefined,\n    platform: WEB_APP_PLATFORM,\n    startParam,\n    fromSwitchWebview: isFromSwitchWebView || undefined,\n    fromSideMenu: isFromSideMenu || undefined,\n  }));\n\n  return result?.url;\n}\n\nexport async function fetchBotApp({\n  bot,\n  appName,\n}: {\n  bot: ApiUser;\n  appName: string;\n}) {\n  const result = await invokeRequest(new GramJs.messages.GetBotApp({\n    app: new GramJs.InputBotAppShortName({\n      botId: buildInputEntity(bot.id, bot.accessHash) as GramJs.InputUser,\n      shortName: appName,\n    }),\n  }));\n\n  if (!result || result instanceof GramJs.BotAppNotModified) {\n    return undefined;\n  }\n\n  return buildApiMessagesBotApp(result);\n}\n\nexport async function requestAppWebView({\n  peer,\n  app,\n  startParam,\n  theme,\n  isWriteAllowed,\n}: {\n  peer: ApiPeer;\n  app: ApiBotApp;\n  startParam?: string;\n  theme?: ApiThemeParameters;\n  isWriteAllowed?: boolean;\n}) {\n  const result = await invokeRequest(new GramJs.messages.RequestAppWebView({\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    app: buildInputBotApp(app),\n    startParam,\n    themeParams: theme ? buildInputThemeParams(theme) : undefined,\n    platform: WEB_APP_PLATFORM,\n    writeAllowed: isWriteAllowed || undefined,\n  }));\n\n  return result?.url;\n}\n\nexport function prolongWebView({\n  isSilent,\n  peer,\n  bot,\n  queryId,\n  replyInfo,\n  sendAs,\n}: {\n  isSilent?: boolean;\n  peer: ApiPeer;\n  bot: ApiUser;\n  queryId: string;\n  replyInfo?: ApiInputMessageReplyInfo;\n  sendAs?: ApiPeer;\n}) {\n  return invokeRequest(new GramJs.messages.ProlongWebView({\n    silent: isSilent || undefined,\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    bot: buildInputPeer(bot.id, bot.accessHash),\n    queryId: BigInt(queryId),\n    replyTo: replyInfo && buildInputReplyTo(replyInfo),\n    ...(sendAs && { sendAs: buildInputPeer(sendAs.id, sendAs.accessHash) }),\n  }));\n}\n\nexport async function sendWebViewData({\n  bot, buttonText, data,\n}: {\n  bot: ApiUser;\n  buttonText: string;\n  data: string;\n}) {\n  const randomId = generateRandomBigInt();\n  await invokeRequest(new GramJs.messages.SendWebViewData({\n    bot: buildInputPeer(bot.id, bot.accessHash),\n    buttonText,\n    data,\n    randomId,\n  }));\n}\n\nexport async function loadAttachBots({\n  hash,\n}: {\n  hash?: string;\n}) {\n  const result = await invokeRequest(new GramJs.messages.GetAttachMenuBots({\n    hash: hash ? BigInt(hash) : undefined,\n  }));\n\n  if (result instanceof GramJs.AttachMenuBots) {\n    addEntitiesToLocalDb(result.users);\n    return {\n      hash: result.hash.toString(),\n      bots: buildCollectionByKey(result.bots.map(buildApiAttachBot), 'id'),\n      users: result.users.map(buildApiUser).filter(Boolean),\n    };\n  }\n  return undefined;\n}\n\nexport async function loadAttachBot({\n  bot,\n}: {\n  bot: ApiUser;\n}) {\n  const result = await invokeRequest(new GramJs.messages.GetAttachMenuBot({\n    bot: buildInputPeer(bot.id, bot.accessHash),\n  }));\n\n  if (result instanceof GramJs.AttachMenuBotsBot) {\n    addEntitiesToLocalDb(result.users);\n    return {\n      bot: buildApiAttachBot(result.bot),\n      users: result.users.map(buildApiUser).filter(Boolean),\n    };\n  }\n  return undefined;\n}\n\nexport function toggleAttachBot({\n  bot,\n  isWriteAllowed,\n  isEnabled,\n}: {\n  bot: ApiUser;\n  isWriteAllowed?: boolean;\n  isEnabled: boolean;\n}) {\n  return invokeRequest(new GramJs.messages.ToggleBotInAttachMenu({\n    bot: buildInputPeer(bot.id, bot.accessHash),\n    writeAllowed: isWriteAllowed || undefined,\n    enabled: isEnabled,\n  }));\n}\n\nexport async function requestBotUrlAuth({\n  chat, buttonId, messageId,\n}: {\n  chat: ApiChat;\n  buttonId: number;\n  messageId: number;\n}) {\n  const result = await invokeRequest(new GramJs.messages.RequestUrlAuth({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    buttonId,\n    msgId: messageId,\n  }));\n\n  if (!result) return undefined;\n\n  const authResult = buildApiUrlAuthResult(result);\n  if (authResult?.type === 'request') {\n    onUpdate({\n      '@type': 'updateUser',\n      id: authResult.bot.id,\n      user: authResult.bot,\n    });\n  }\n  return authResult;\n}\n\nexport async function acceptBotUrlAuth({\n  chat,\n  messageId,\n  buttonId,\n  isWriteAllowed,\n}: {\n  chat: ApiChat;\n  messageId: number;\n  buttonId: number;\n  isWriteAllowed?: boolean;\n}) {\n  const result = await invokeRequest(new GramJs.messages.AcceptUrlAuth({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    msgId: messageId,\n    buttonId,\n    writeAllowed: isWriteAllowed || undefined,\n  }));\n\n  if (!result) return undefined;\n\n  const authResult = buildApiUrlAuthResult(result);\n  if (authResult?.type === 'request') {\n    onUpdate({\n      '@type': 'updateUser',\n      id: authResult.bot.id,\n      user: authResult.bot,\n    });\n  }\n  return authResult;\n}\n\nexport async function requestLinkUrlAuth({ url }: { url: string }) {\n  const result = await invokeRequest(new GramJs.messages.RequestUrlAuth({\n    url,\n  }));\n\n  if (!result) return undefined;\n\n  const authResult = buildApiUrlAuthResult(result);\n  if (authResult?.type === 'request') {\n    onUpdate({\n      '@type': 'updateUser',\n      id: authResult.bot.id,\n      user: authResult.bot,\n    });\n  }\n  return authResult;\n}\n\nexport async function acceptLinkUrlAuth({ url, isWriteAllowed }: { url: string; isWriteAllowed?: boolean }) {\n  const result = await invokeRequest(new GramJs.messages.AcceptUrlAuth({\n    url,\n    writeAllowed: isWriteAllowed || undefined,\n  }));\n\n  if (!result) return undefined;\n\n  const authResult = buildApiUrlAuthResult(result);\n  if (authResult?.type === 'request') {\n    onUpdate({\n      '@type': 'updateUser',\n      id: authResult.bot.id,\n      user: authResult.bot,\n    });\n  }\n  return authResult;\n}\n\nexport function fetchBotCanSendMessage({ bot } : { bot: ApiUser }) {\n  return invokeRequest(new GramJs.bots.CanSendMessage({\n    bot: buildInputEntity(bot.id, bot.accessHash) as GramJs.InputUser,\n  }));\n}\n\nexport function allowBotSendMessages({ bot } : { bot: ApiUser }) {\n  return invokeRequest(new GramJs.bots.AllowSendMessage({\n    bot: buildInputEntity(bot.id, bot.accessHash) as GramJs.InputUser,\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport async function invokeWebViewCustomMethod({\n  bot,\n  customMethod,\n  parameters,\n}: {\n  bot: ApiUser;\n  customMethod: string;\n  parameters: string;\n}): Promise<{\n    result: object;\n  } | {\n    error: string;\n  }> {\n  try {\n    const result = await invokeRequest(new GramJs.bots.InvokeWebViewCustomMethod({\n      bot: buildInputPeer(bot.id, bot.accessHash),\n      params: new GramJs.DataJSON({\n        data: parameters,\n      }),\n      customMethod,\n    }), {\n      shouldThrow: true,\n    });\n\n    return {\n      result: JSON.parse(result!.data),\n    };\n  } catch (e) {\n    const error = e as Error;\n    return {\n      error: error.message,\n    };\n  }\n}\n\nfunction processInlineBotResult(queryId: string, results: GramJs.TypeBotInlineResult[]) {\n  return results.map((result) => {\n    if (result instanceof GramJs.BotInlineMediaResult) {\n      if (result.document instanceof GramJs.Document) {\n        addDocumentToLocalDb(result.document);\n      }\n\n      if (result.photo instanceof GramJs.Photo) {\n        addPhotoToLocalDb(result.photo);\n      }\n\n      return buildApiBotInlineMediaResult(result, queryId);\n    }\n\n    if (result.thumb) {\n      addWebDocumentToLocalDb(result.thumb);\n    }\n\n    return buildApiBotInlineResult(result, queryId);\n  });\n}\n\nfunction getInlineBotResultsNextOffset(username: string, nextOffset?: string) {\n  return username === 'gif' && nextOffset === '0' ? '' : nextOffset;\n}\n\nfunction addDocumentToLocalDb(document: GramJs.Document) {\n  localDb.documents[String(document.id)] = document;\n}\n\nfunction addPhotoToLocalDb(photo: GramJs.Photo) {\n  localDb.photos[String(photo.id)] = photo;\n}\n\nfunction addWebDocumentToLocalDb(webDocument: GramJs.TypeWebDocument) {\n  localDb.webDocuments[webDocument.url] = webDocument;\n}\n\nexport function setBotInfo({\n  bot,\n  langCode,\n  name,\n  about,\n  description,\n}: {\n  bot: ApiUser;\n  langCode: string;\n  name?: string;\n  about?: string;\n  description?: string;\n}) {\n  return invokeRequest(new GramJs.bots.SetBotInfo({\n    bot: buildInputPeer(bot.id, bot.accessHash),\n    langCode,\n    name: name || '',\n    about: about || '',\n    description: description || '',\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n","import BigInt from 'big-integer';\nimport { Api as GramJs } from '../../../lib/gramjs';\n\nimport type { JoinGroupCallPayload } from '../../../lib/secret-sauce';\nimport type {\n  ApiChat, ApiGroupCall, ApiPhoneCall,\n  ApiUser, OnApiUpdate,\n} from '../../types';\n\nimport { GROUP_CALL_PARTICIPANTS_LIMIT } from '../../../config';\nimport {\n  buildApiGroupCall,\n  buildApiGroupCallParticipant, buildCallProtocol,\n  buildPhoneCall,\n} from '../apiBuilders/calls';\nimport { buildApiChatFromPreview } from '../apiBuilders/chats';\nimport { buildApiUser } from '../apiBuilders/users';\nimport {\n  buildInputGroupCall, buildInputPeer, buildInputPhoneCall, generateRandomInt,\n} from '../gramjsBuilders';\nimport { addEntitiesToLocalDb } from '../helpers';\nimport { invokeRequest, invokeRequestBeacon } from './client';\n\nlet onUpdate: OnApiUpdate;\n\nexport function init(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nexport async function getGroupCall({\n  call,\n}: {\n  call: Partial<ApiGroupCall>;\n}) {\n  const result = await invokeRequest(new GramJs.phone.GetGroupCall({\n    call: buildInputGroupCall(call),\n  }));\n\n  if (!result) {\n    return undefined;\n  }\n\n  addEntitiesToLocalDb(result.users);\n  addEntitiesToLocalDb(result.chats);\n\n  const users = result.users.map(buildApiUser).filter(Boolean);\n  const chats = result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean);\n\n  return {\n    groupCall: buildApiGroupCall(result.call),\n    users,\n    chats,\n  };\n}\n\nexport function discardGroupCall({\n  call,\n}: {\n  call: ApiGroupCall;\n}) {\n  return invokeRequest(new GramJs.phone.DiscardGroupCall({\n    call: buildInputGroupCall(call),\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport function editGroupCallParticipant({\n  call, participant, muted, presentationPaused, videoStopped, videoPaused, volume,\n  raiseHand,\n}: {\n  call: ApiGroupCall; participant: ApiUser; muted?: boolean; presentationPaused?: boolean;\n  videoStopped?: boolean; videoPaused?: boolean; raiseHand?: boolean; volume?: number;\n}) {\n  return invokeRequest(new GramJs.phone.EditGroupCallParticipant({\n    call: buildInputGroupCall(call),\n    participant: buildInputPeer(participant.id, participant.accessHash),\n    ...(videoStopped !== undefined && { videoStopped }),\n    ...(videoPaused !== undefined && { videoPaused }),\n    ...(muted !== undefined && { muted }),\n    ...(presentationPaused !== undefined && { presentationPaused }),\n    ...(raiseHand !== undefined && { raiseHand }),\n    ...(volume !== undefined && { volume }),\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport function editGroupCallTitle({\n  groupCall, title,\n}: {\n  groupCall: ApiGroupCall; title: string;\n}) {\n  return invokeRequest(new GramJs.phone.EditGroupCallTitle({\n    title,\n    call: buildInputGroupCall(groupCall),\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport async function exportGroupCallInvite({\n  call, canSelfUnmute,\n}: {\n  call: ApiGroupCall; canSelfUnmute: boolean;\n}) {\n  const result = await invokeRequest(new GramJs.phone.ExportGroupCallInvite({\n    canSelfUnmute: canSelfUnmute || undefined,\n    call: buildInputGroupCall(call),\n  }));\n\n  if (!result) {\n    return undefined;\n  }\n\n  return result.link;\n}\n\nexport async function fetchGroupCallParticipants({\n  call, offset,\n}: {\n  call: ApiGroupCall; offset?: string;\n}) {\n  const result = await invokeRequest(new GramJs.phone.GetGroupParticipants({\n    call: buildInputGroupCall(call),\n    ids: [],\n    sources: [],\n    offset: offset || '',\n    limit: GROUP_CALL_PARTICIPANTS_LIMIT,\n  }));\n\n  if (!result) {\n    return undefined;\n  }\n\n  addEntitiesToLocalDb(result.users);\n  addEntitiesToLocalDb(result.chats);\n\n  const users = result.users.map(buildApiUser).filter(Boolean);\n  const chats = result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean);\n\n  onUpdate({\n    '@type': 'updateGroupCallParticipants',\n    groupCallId: call.id,\n    participants: result.participants.map(buildApiGroupCallParticipant),\n    nextOffset: result.nextOffset,\n  });\n\n  return {\n    users, chats,\n  };\n}\n\nexport function leaveGroupCall({\n  call, isPageUnload,\n}: {\n  call: ApiGroupCall; isPageUnload?: boolean;\n}) {\n  const request = new GramJs.phone.LeaveGroupCall({\n    call: buildInputGroupCall(call),\n  });\n\n  if (isPageUnload) {\n    invokeRequestBeacon(request);\n    return;\n  }\n\n  invokeRequest(request, {\n    shouldReturnTrue: true,\n  });\n}\n\nexport async function joinGroupCall({\n  call, inviteHash, params,\n}: {\n  call: ApiGroupCall; inviteHash?: string; params: JoinGroupCallPayload;\n}) {\n  const result = await invokeRequest(new GramJs.phone.JoinGroupCall({\n    call: buildInputGroupCall(call),\n    joinAs: new GramJs.InputPeerSelf(),\n    muted: true,\n    videoStopped: true,\n    params: new GramJs.DataJSON({\n      data: JSON.stringify(params),\n    }),\n    inviteHash,\n  }), {\n    shouldRetryOnTimeout: true,\n    abortControllerGroup: 'call',\n  });\n\n  if (!result) return undefined;\n\n  if (result instanceof GramJs.Updates) {\n    const update = result.updates.find((u) => u instanceof GramJs.UpdateGroupCall);\n    if (!(update instanceof GramJs.UpdateGroupCall)) return undefined;\n\n    return buildApiGroupCall(update.call);\n  }\n\n  return undefined;\n}\n\nexport async function createGroupCall({\n  peer,\n}: {\n  peer: ApiChat;\n}) {\n  const randomId = generateRandomInt();\n  const result = await invokeRequest(new GramJs.phone.CreateGroupCall({\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    randomId,\n  }));\n\n  if (!result) return undefined;\n\n  if (result instanceof GramJs.Updates) {\n    const update = result.updates[0];\n    if (update instanceof GramJs.UpdateGroupCall) {\n      return buildApiGroupCall(update.call);\n    }\n  }\n\n  return undefined;\n}\n\nexport function joinGroupCallPresentation({\n  call, params,\n}: {\n  call: ApiGroupCall; params: JoinGroupCallPayload;\n}) {\n  return invokeRequest(new GramJs.phone.JoinGroupCallPresentation({\n    call: buildInputGroupCall(call),\n    params: new GramJs.DataJSON({\n      data: JSON.stringify(params),\n    }),\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport function toggleGroupCallStartSubscription({\n  call, subscribed,\n}: {\n  call: ApiGroupCall; subscribed: boolean;\n}) {\n  return invokeRequest(new GramJs.phone.ToggleGroupCallStartSubscription({\n    call: buildInputGroupCall(call),\n    subscribed,\n  }), {\n    shouldReturnTrue: true,\n    shouldIgnoreErrors: true,\n  });\n}\n\nexport function leaveGroupCallPresentation({\n  call,\n}: {\n  call: ApiGroupCall;\n}) {\n  return invokeRequest(new GramJs.phone.LeaveGroupCallPresentation({\n    call: buildInputGroupCall(call),\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport async function getDhConfig() {\n  const dhConfig = await invokeRequest(new GramJs.messages.GetDhConfig({}));\n\n  if (!dhConfig || dhConfig instanceof GramJs.messages.DhConfigNotModified) return undefined;\n\n  return {\n    g: dhConfig.g,\n    p: Array.from(dhConfig.p),\n    random: Array.from(dhConfig.random),\n  };\n}\n\nexport function discardCall({\n  call, isBusy, isPageUnload,\n}: {\n  call: ApiPhoneCall; isBusy?: boolean; isPageUnload?: boolean;\n}) {\n  const request = new GramJs.phone.DiscardCall({\n    peer: buildInputPhoneCall(call),\n    reason: isBusy ? new GramJs.PhoneCallDiscardReasonBusy() : new GramJs.PhoneCallDiscardReasonHangup(),\n  });\n\n  if (isPageUnload) {\n    invokeRequestBeacon(request);\n    return;\n  }\n\n  invokeRequest(request, {\n    shouldReturnTrue: true,\n  });\n}\n\nexport async function requestCall({\n  user, gAHash, isVideo,\n}: {\n  user: ApiUser; gAHash: number[]; isVideo?: boolean;\n}) {\n  const result = await invokeRequest(new GramJs.phone.RequestCall({\n    randomId: generateRandomInt(),\n    userId: buildInputPeer(user.id, user.accessHash),\n    gAHash: Buffer.from(gAHash),\n    ...(isVideo && { video: true }),\n    protocol: buildCallProtocol(),\n  }));\n\n  if (!result) {\n    return undefined;\n  }\n\n  const call = buildPhoneCall(result.phoneCall);\n\n  onUpdate({\n    '@type': 'updatePhoneCall',\n    call,\n  });\n\n  addEntitiesToLocalDb(result.users);\n\n  return {\n    users: result.users.map(buildApiUser).filter(Boolean),\n  };\n}\n\nexport function setCallRating({\n  call, rating, comment,\n}: {\n  call: ApiPhoneCall; rating: number; comment: string;\n}) {\n  return invokeRequest(new GramJs.phone.SetCallRating({\n    rating,\n    peer: buildInputPhoneCall(call),\n    comment,\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport function receivedCall({\n  call,\n}: {\n  call: ApiPhoneCall;\n}) {\n  return invokeRequest(new GramJs.phone.ReceivedCall({\n    peer: buildInputPhoneCall(call),\n  }));\n}\n\nexport async function acceptCall({\n  call, gB,\n}: {\n  call: ApiPhoneCall; gB: number[];\n}) {\n  const result = await invokeRequest(new GramJs.phone.AcceptCall({\n    peer: buildInputPhoneCall(call),\n    gB: Buffer.from(gB),\n    protocol: buildCallProtocol(),\n  }));\n\n  if (!result) {\n    return undefined;\n  }\n\n  call = buildPhoneCall(result.phoneCall);\n\n  onUpdate({\n    '@type': 'updatePhoneCall',\n    call,\n  });\n\n  addEntitiesToLocalDb(result.users);\n\n  return {\n    users: result.users.map(buildApiUser).filter(Boolean),\n  };\n}\n\nexport async function confirmCall({\n  call, gA, keyFingerprint,\n}: {\n  call: ApiPhoneCall; gA: number[]; keyFingerprint: string;\n}) {\n  const result = await invokeRequest(new GramJs.phone.ConfirmCall({\n    peer: buildInputPhoneCall(call),\n    gA: Buffer.from(gA),\n    keyFingerprint: BigInt(keyFingerprint),\n    protocol: buildCallProtocol(),\n  }));\n\n  if (!result) {\n    return undefined;\n  }\n\n  call = buildPhoneCall(result.phoneCall);\n\n  onUpdate({\n    '@type': 'updatePhoneCall',\n    call,\n  });\n\n  addEntitiesToLocalDb(result.users);\n\n  return {\n    users: result.users.map(buildApiUser).filter(Boolean),\n  };\n}\n\nexport function sendSignalingData({\n  data, call,\n}: {\n  data: number[]; call: ApiPhoneCall;\n}) {\n  return invokeRequest(new GramJs.phone.SendSignalingData({\n    data: Buffer.from(data),\n    peer: buildInputPhoneCall(call),\n  }));\n}\n","import BigInt from 'big-integer';\nimport { Api as GramJs } from '../../../lib/gramjs';\n\nimport type { ApiDraft } from '../../../global/types';\nimport type {\n  ApiChat,\n  ApiChatAdminRights,\n  ApiChatBannedRights,\n  ApiChatFolder,\n  ApiChatFullInfo,\n  ApiChatReactions,\n  ApiGroupCall,\n  ApiMessage,\n  ApiPeer,\n  ApiPhoto,\n  ApiTopic,\n  ApiUser,\n  ApiUserStatus,\n  OnApiUpdate,\n} from '../../types';\n\nimport {\n  ALL_FOLDER_ID,\n  ARCHIVED_FOLDER_ID,\n  DEBUG,\n  GENERAL_TOPIC_ID,\n  GLOBAL_SEARCH_CONTACTS_LIMIT,\n  MAX_INT_32,\n  MEMBERS_LOAD_SLICE,\n  SERVICE_NOTIFICATIONS_USER_ID,\n  TOPICS_SLICE,\n} from '../../../config';\nimport { buildCollectionByKey } from '../../../util/iteratees';\nimport {\n  buildApiChatBotCommands,\n  buildApiChatFolder,\n  buildApiChatFolderFromSuggested,\n  buildApiChatFromDialog,\n  buildApiChatFromPreview,\n  buildApiChatFromSavedDialog,\n  buildApiChatlistExportedInvite,\n  buildApiChatlistInvite,\n  buildApiChatReactions,\n  buildApiChatSettings,\n  buildApiTopic,\n  buildChatMembers,\n  getPeerKey,\n} from '../apiBuilders/chats';\nimport { buildApiPhoto } from '../apiBuilders/common';\nimport { buildApiMessage, buildMessageDraft } from '../apiBuilders/messages';\nimport { buildApiPeerId, getApiChatIdFromMtpPeer } from '../apiBuilders/peers';\nimport { buildStickerSet } from '../apiBuilders/symbols';\nimport { buildApiUser, buildApiUsersAndStatuses } from '../apiBuilders/users';\nimport {\n  buildChatAdminRights,\n  buildChatBannedRights,\n  buildFilterFromApiFolder,\n  buildInputChatReactions,\n  buildInputEntity,\n  buildInputPeer,\n  buildInputPhoto,\n  buildInputReplyTo,\n  buildMtpMessageEntity,\n  generateRandomBigInt,\n  isMessageWithMedia,\n} from '../gramjsBuilders';\nimport {\n  addEntitiesToLocalDb,\n  addMessageToLocalDb,\n  addPhotoToLocalDb,\n  isChatFolder,\n} from '../helpers';\nimport localDb from '../localDb';\nimport { scheduleMutedChatUpdate } from '../scheduleUnmute';\nimport {\n  applyState, processAffectedHistory, processUpdate, updateChannelState,\n} from '../updates/updateManager';\nimport { dispatchThreadInfoUpdates } from '../updates/updater';\nimport { invokeRequest, uploadFile } from './client';\n\ntype FullChatData = {\n  fullInfo: ApiChatFullInfo;\n  users?: ApiUser[];\n  userStatusesById: { [userId: string]: ApiUserStatus };\n  groupCall?: Partial<ApiGroupCall>;\n  membersCount?: number;\n  isForumAsMessages?: true;\n};\n\ntype ChatListData = {\n  chatIds: string[];\n  chats: ApiChat[];\n  users: ApiUser[];\n  userStatusesById: Record<string, ApiUserStatus>;\n  draftsById: Record<string, ApiDraft>;\n  orderedPinnedIds: string[] | undefined;\n  totalChatCount: number;\n  messages: ApiMessage[];\n  lastMessageByChatId: Record<string, number>;\n};\n\nlet onUpdate: OnApiUpdate;\n\nexport function init(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nexport async function fetchChats({\n  limit,\n  offsetDate,\n  archived,\n  withPinned,\n  lastLocalServiceMessageId,\n}: {\n  limit: number;\n  offsetDate?: number;\n  archived?: boolean;\n  withPinned?: boolean;\n  lastLocalServiceMessageId?: number;\n}): Promise<ChatListData | undefined> {\n  const result = await invokeRequest(new GramJs.messages.GetDialogs({\n    offsetPeer: new GramJs.InputPeerEmpty(),\n    limit,\n    offsetDate,\n    ...(withPinned && { excludePinned: true }),\n  }));\n  const resultPinned = withPinned\n    ? await invokeRequest(new GramJs.messages.GetPinnedDialogs({\n      folderId: archived ? ARCHIVED_FOLDER_ID : undefined,\n    }))\n    : undefined;\n\n  if (!result || result instanceof GramJs.messages.DialogsNotModified) {\n    return undefined;\n  }\n\n  if (resultPinned) {\n    dispatchThreadInfoUpdates(resultPinned.messages);\n    updateLocalDb(resultPinned);\n  }\n  dispatchThreadInfoUpdates(result.messages);\n  updateLocalDb(result);\n\n  const messages = (resultPinned ? resultPinned.messages : [])\n    .concat(result.messages)\n    .map(buildApiMessage)\n    .filter(Boolean);\n\n  const peersByKey = preparePeers(result);\n  if (resultPinned) {\n    Object.assign(peersByKey, preparePeers(resultPinned, peersByKey));\n  }\n\n  const chats: ApiChat[] = [];\n  const draftsById: Record<string, ApiDraft> = {};\n\n  const dialogs = (resultPinned ? resultPinned.dialogs : []).concat(result.dialogs);\n\n  const orderedPinnedIds: string[] = [];\n  const lastMessageByChatId: Record<string, number> = {};\n\n  dialogs.forEach((dialog) => {\n    if (\n      !(dialog instanceof GramJs.Dialog)\n      // This request can return dialogs not belonging to specified folder\n      || (!archived && dialog.folderId === ARCHIVED_FOLDER_ID)\n      || (archived && dialog.folderId !== ARCHIVED_FOLDER_ID)\n    ) {\n      return;\n    }\n\n    const peerEntity = peersByKey[getPeerKey(dialog.peer)];\n    const chat = buildApiChatFromDialog(dialog, peerEntity);\n    lastMessageByChatId[chat.id] = dialog.topMessage;\n\n    if (dialog.pts) {\n      updateChannelState(chat.id, dialog.pts);\n    }\n\n    if (\n      chat.id === SERVICE_NOTIFICATIONS_USER_ID\n      && lastLocalServiceMessageId\n      && (lastLocalServiceMessageId > dialog.topMessage)\n    ) {\n      lastMessageByChatId[chat.id] = lastLocalServiceMessageId;\n    }\n\n    chat.isListed = true;\n\n    chats.push(chat);\n\n    scheduleMutedChatUpdate(chat.id, chat.muteUntil, onUpdate);\n\n    if (withPinned && dialog.pinned) {\n      orderedPinnedIds.push(chat.id);\n    }\n\n    if (dialog.draft) {\n      const draft = buildMessageDraft(dialog.draft);\n      if (draft) {\n        draftsById[chat.id] = draft;\n      }\n    }\n  });\n\n  const chatIds = chats.map((chat) => chat.id);\n\n  const { users, userStatusesById } = buildApiUsersAndStatuses((resultPinned?.users || []).concat(result.users));\n\n  let totalChatCount: number;\n  if (result instanceof GramJs.messages.DialogsSlice) {\n    totalChatCount = result.count;\n  } else {\n    totalChatCount = chatIds.length;\n  }\n\n  return {\n    chatIds,\n    chats,\n    users,\n    userStatusesById,\n    draftsById,\n    orderedPinnedIds: withPinned ? orderedPinnedIds : undefined,\n    totalChatCount,\n    lastMessageByChatId,\n    messages,\n  };\n}\n\nexport async function fetchSavedChats({\n  limit,\n  offsetDate,\n  withPinned,\n}: {\n  limit: number;\n  offsetDate?: number;\n  withPinned?: boolean;\n}): Promise<ChatListData | undefined> {\n  const result = await invokeRequest(new GramJs.messages.GetSavedDialogs({\n    offsetPeer: new GramJs.InputPeerEmpty(),\n    limit,\n    offsetDate,\n    ...(withPinned && { excludePinned: true }),\n  }));\n  const resultPinned = withPinned\n    ? await invokeRequest(new GramJs.messages.GetPinnedSavedDialogs())\n    : undefined;\n\n  if (!result || result instanceof GramJs.messages.SavedDialogsNotModified) {\n    return undefined;\n  }\n\n  const hasPinned = resultPinned && !(resultPinned instanceof GramJs.messages.SavedDialogsNotModified);\n\n  if (hasPinned) {\n    updateLocalDb(resultPinned);\n  }\n  updateLocalDb(result);\n\n  dispatchThreadInfoUpdates(result.messages);\n\n  const messages = (hasPinned ? resultPinned.messages : [])\n    .concat(result.messages)\n    .map(buildApiMessage)\n    .filter(Boolean);\n\n  const peersByKey = preparePeers(result);\n  if (hasPinned) {\n    Object.assign(peersByKey, preparePeers(resultPinned, peersByKey));\n  }\n\n  const dialogs = (hasPinned ? resultPinned.dialogs : []).concat(result.dialogs);\n\n  const chatIds: string[] = [];\n  const orderedPinnedIds: string[] = [];\n  const lastMessageByChatId: Record<string, number> = {};\n\n  const chats: ApiChat[] = [];\n\n  dialogs.forEach((dialog) => {\n    const peerEntity = peersByKey[getPeerKey(dialog.peer)];\n    const chat = buildApiChatFromSavedDialog(dialog, peerEntity);\n    const chatId = getApiChatIdFromMtpPeer(dialog.peer);\n\n    chatIds.push(chatId);\n    if (withPinned && dialog.pinned) {\n      orderedPinnedIds.push(chatId);\n    }\n\n    lastMessageByChatId[chatId] = dialog.topMessage;\n\n    chats.push(chat);\n  });\n\n  const { users, userStatusesById } = buildApiUsersAndStatuses((hasPinned ? resultPinned.users : [])\n    .concat(result.users));\n\n  let totalChatCount: number;\n  if (result instanceof GramJs.messages.SavedDialogsSlice) {\n    totalChatCount = result.count;\n  } else {\n    totalChatCount = chatIds.length;\n  }\n\n  return {\n    chatIds,\n    chats,\n    users,\n    userStatusesById,\n    orderedPinnedIds: withPinned ? orderedPinnedIds : undefined,\n    totalChatCount,\n    lastMessageByChatId,\n    messages,\n    draftsById: {},\n  };\n}\n\nexport function fetchFullChat(chat: ApiChat) {\n  const { id, accessHash, adminRights } = chat;\n\n  const input = buildInputEntity(id, accessHash);\n\n  return input instanceof GramJs.InputChannel\n    ? getFullChannelInfo(id, accessHash!, adminRights)\n    : getFullChatInfo(id);\n}\n\nexport async function fetchChatSettings(chat: ApiChat) {\n  const { id, accessHash } = chat;\n\n  const result = await invokeRequest(new GramJs.messages.GetPeerSettings({\n    peer: buildInputPeer(id, accessHash),\n  }), {\n    abortControllerChatId: id,\n  });\n\n  if (!result) {\n    return undefined;\n  }\n\n  addEntitiesToLocalDb(result.users);\n\n  return {\n    users: result.users.map(buildApiUser).filter(Boolean),\n    settings: buildApiChatSettings(result.settings),\n  };\n}\n\nexport async function searchChats({ query }: { query: string }) {\n  const result = await invokeRequest(new GramJs.contacts.Search({ q: query, limit: GLOBAL_SEARCH_CONTACTS_LIMIT }));\n  if (!result) {\n    return undefined;\n  }\n\n  updateLocalDb(result);\n\n  const accountPeerIds = result.myResults.map(getApiChatIdFromMtpPeer);\n  const allChats = result.chats.concat(result.users)\n    .map((user) => buildApiChatFromPreview(user))\n    .filter(Boolean);\n  const allUsers = result.users.map(buildApiUser).filter((user) => Boolean(user) && !user.isSelf) as ApiUser[];\n\n  return {\n    accountChats: allChats.filter((r) => accountPeerIds.includes(r.id)),\n    accountUsers: allUsers.filter((u) => accountPeerIds.includes(u.id)),\n    globalChats: allChats.filter((r) => !accountPeerIds.includes(r.id)),\n    globalUsers: allUsers.filter((u) => !accountPeerIds.includes(u.id)),\n  };\n}\n\nexport async function fetchChat({\n  type, user,\n}: {\n  type: 'user' | 'self' | 'support'; user?: ApiUser;\n}) {\n  let mtpUser: GramJs.User | undefined;\n\n  if (type === 'self' || type === 'user') {\n    const result = await invokeRequest(new GramJs.users.GetUsers({\n      id: [\n        type === 'user' && user\n          ? buildInputEntity(user.id, user.accessHash) as GramJs.InputUser\n          : new GramJs.InputUserSelf(),\n      ],\n    }));\n    if (!result || !result.length) {\n      return undefined;\n    }\n\n    [mtpUser] = result;\n  } else if (type === 'support') {\n    const result = await invokeRequest(new GramJs.help.GetSupport());\n    if (!result || !result.user) {\n      return undefined;\n    }\n\n    mtpUser = result.user;\n  }\n\n  const chat = buildApiChatFromPreview(mtpUser!, type === 'support');\n  if (!chat) {\n    return undefined;\n  }\n\n  onUpdate({\n    '@type': 'updateChat',\n    id: chat.id,\n    chat,\n  });\n\n  return { chatId: chat.id };\n}\n\nexport async function requestChatUpdate({\n  chat,\n  lastLocalMessage,\n  noLastMessage,\n}: {\n  chat: ApiChat; lastLocalMessage?: ApiMessage; noLastMessage?: boolean;\n}) {\n  const { id, accessHash } = chat;\n\n  const result = await invokeRequest(new GramJs.messages.GetPeerDialogs({\n    peers: [new GramJs.InputDialogPeer({\n      peer: buildInputPeer(id, accessHash),\n    })],\n  }));\n\n  if (!result) {\n    return;\n  }\n\n  const dialog = result.dialogs[0];\n  if (!dialog || !(dialog instanceof GramJs.Dialog)) {\n    return;\n  }\n\n  const peersByKey = preparePeers(result);\n  const peerEntity = peersByKey[getPeerKey(dialog.peer)];\n  if (!peerEntity) {\n    return;\n  }\n\n  updateLocalDb(result);\n\n  const lastRemoteMessage = buildApiMessage(result.messages[0]);\n  dispatchThreadInfoUpdates(result.messages);\n\n  const lastMessage = lastLocalMessage && (!lastRemoteMessage || (lastLocalMessage.date > lastRemoteMessage.date))\n    ? lastLocalMessage\n    : lastRemoteMessage;\n\n  const chatUpdate = buildApiChatFromDialog(dialog, peerEntity);\n\n  onUpdate({\n    '@type': 'updateChat',\n    id,\n    chat: chatUpdate,\n  });\n\n  if (!noLastMessage && lastMessage) {\n    onUpdate({\n      '@type': 'updateChatLastMessage',\n      id,\n      lastMessage,\n    });\n  }\n\n  applyState(result.state);\n\n  scheduleMutedChatUpdate(chatUpdate.id, chatUpdate.muteUntil, onUpdate);\n}\n\nexport function saveDraft({\n  chat,\n  draft,\n}: {\n  chat: ApiChat;\n  draft?: ApiDraft;\n}) {\n  return invokeRequest(new GramJs.messages.SaveDraft({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    message: draft?.text?.text || '',\n    entities: draft?.text?.entities?.map(buildMtpMessageEntity),\n    replyTo: draft?.replyInfo && buildInputReplyTo(draft.replyInfo),\n  }));\n}\n\nasync function getFullChatInfo(chatId: string): Promise<FullChatData | undefined> {\n  const result = await invokeRequest(new GramJs.messages.GetFullChat({\n    chatId: buildInputEntity(chatId) as BigInt.BigInteger,\n  }));\n\n  if (!result || !(result.fullChat instanceof GramJs.ChatFull)) {\n    return undefined;\n  }\n\n  updateLocalDb(result);\n\n  const {\n    about,\n    participants,\n    exportedInvite,\n    botInfo,\n    call,\n    availableReactions,\n    recentRequesters,\n    requestsPending,\n    chatPhoto,\n    translationsDisabled,\n  } = result.fullChat;\n\n  if (chatPhoto instanceof GramJs.Photo) {\n    localDb.photos[chatPhoto.id.toString()] = chatPhoto;\n  }\n\n  const members = buildChatMembers(participants);\n  const adminMembers = members ? members.filter(({ isAdmin, isOwner }) => isAdmin || isOwner) : undefined;\n  const botCommands = botInfo ? buildApiChatBotCommands(botInfo) : undefined;\n  const inviteLink = exportedInvite instanceof GramJs.ChatInviteExported ? exportedInvite.link : undefined;\n  const { users, userStatusesById } = buildApiUsersAndStatuses(result.users);\n\n  return {\n    fullInfo: {\n      ...(chatPhoto instanceof GramJs.Photo && { profilePhoto: buildApiPhoto(chatPhoto) }),\n      about,\n      members,\n      adminMembersById: adminMembers ? buildCollectionByKey(adminMembers, 'userId') : undefined,\n      canViewMembers: true,\n      botCommands,\n      inviteLink,\n      groupCallId: call?.id.toString(),\n      enabledReactions: buildApiChatReactions(availableReactions),\n      requestsPending,\n      recentRequesterIds: recentRequesters?.map((userId) => buildApiPeerId(userId, 'user')),\n      isTranslationDisabled: translationsDisabled,\n    },\n    users,\n    userStatusesById,\n    groupCall: call ? {\n      chatId,\n      isLoaded: false,\n      id: call.id.toString(),\n      accessHash: call.accessHash.toString(),\n      connectionState: 'disconnected',\n      participantsCount: 0,\n      version: 0,\n      participants: {},\n    } : undefined,\n    membersCount: members?.length,\n  };\n}\n\nasync function getFullChannelInfo(\n  id: string,\n  accessHash: string,\n  adminRights?: ApiChatAdminRights,\n): Promise<FullChatData | undefined> {\n  const result = await invokeRequest(new GramJs.channels.GetFullChannel({\n    channel: buildInputEntity(id, accessHash) as GramJs.InputChannel,\n  }));\n\n  if (!result || !(result.fullChat instanceof GramJs.ChannelFull)) {\n    return undefined;\n  }\n\n  const {\n    about,\n    onlineCount,\n    exportedInvite,\n    slowmodeSeconds,\n    slowmodeNextSendDate,\n    migratedFromChatId,\n    migratedFromMaxId,\n    canViewParticipants,\n    canViewStats,\n    linkedChatId,\n    hiddenPrehistory,\n    call,\n    botInfo,\n    availableReactions,\n    defaultSendAs,\n    requestsPending,\n    recentRequesters,\n    statsDc,\n    participantsCount,\n    stickerset,\n    chatPhoto,\n    participantsHidden,\n    translationsDisabled,\n    storiesPinnedAvailable,\n    viewForumAsMessages,\n  } = result.fullChat;\n\n  if (chatPhoto instanceof GramJs.Photo) {\n    localDb.photos[chatPhoto.id.toString()] = chatPhoto;\n  }\n\n  const inviteLink = exportedInvite instanceof GramJs.ChatInviteExported\n    ? exportedInvite.link\n    : undefined;\n\n  const { members, users, userStatusesById } = (canViewParticipants && await fetchMembers(id, accessHash)) || {};\n  const { members: kickedMembers, users: bannedUsers, userStatusesById: bannedStatusesById } = (\n    canViewParticipants && adminRights && await fetchMembers(id, accessHash, 'kicked')\n  ) || {};\n  const { members: adminMembers, users: adminUsers, userStatusesById: adminStatusesById } = (\n    canViewParticipants && await fetchMembers(id, accessHash, 'admin')\n  ) || {};\n  const botCommands = botInfo ? buildApiChatBotCommands(botInfo) : undefined;\n\n  if (result?.chats?.length > 1) {\n    updateLocalDb(result);\n\n    const [, mtpLinkedChat] = result.chats;\n    const chat = buildApiChatFromPreview(mtpLinkedChat);\n    if (chat) {\n      onUpdate({\n        '@type': 'updateChat',\n        id: chat.id,\n        chat,\n      });\n    }\n  }\n\n  if (result.fullChat.pts) {\n    updateChannelState(id, result.fullChat.pts);\n  }\n\n  const statusesById = {\n    ...userStatusesById,\n    ...bannedStatusesById,\n    ...adminStatusesById,\n  };\n\n  return {\n    fullInfo: {\n      ...(chatPhoto instanceof GramJs.Photo && { profilePhoto: buildApiPhoto(chatPhoto) }),\n      about,\n      onlineCount,\n      inviteLink,\n      slowMode: slowmodeSeconds ? {\n        seconds: slowmodeSeconds,\n        nextSendDate: slowmodeNextSendDate,\n      } : undefined,\n      migratedFrom: migratedFromChatId ? {\n        chatId: buildApiPeerId(migratedFromChatId, 'chat'),\n        maxMessageId: migratedFromMaxId,\n      } : undefined,\n      canViewMembers: canViewParticipants,\n      canViewStatistics: canViewStats,\n      isPreHistoryHidden: hiddenPrehistory,\n      members,\n      kickedMembers,\n      adminMembersById: adminMembers ? buildCollectionByKey(adminMembers, 'userId') : undefined,\n      groupCallId: call ? String(call.id) : undefined,\n      linkedChatId: linkedChatId ? buildApiPeerId(linkedChatId, 'channel') : undefined,\n      botCommands,\n      enabledReactions: buildApiChatReactions(availableReactions),\n      sendAsId: defaultSendAs ? getApiChatIdFromMtpPeer(defaultSendAs) : undefined,\n      requestsPending,\n      recentRequesterIds: recentRequesters?.map((userId) => buildApiPeerId(userId, 'user')),\n      statisticsDcId: statsDc,\n      stickerSet: stickerset ? buildStickerSet(stickerset) : undefined,\n      areParticipantsHidden: participantsHidden,\n      isTranslationDisabled: translationsDisabled,\n      hasPinnedStories: Boolean(storiesPinnedAvailable),\n    },\n    users: [...(users || []), ...(bannedUsers || []), ...(adminUsers || [])],\n    userStatusesById: statusesById,\n    groupCall: call ? {\n      chatId: id,\n      isLoaded: false,\n      id: call.id.toString(),\n      accessHash: call?.accessHash.toString(),\n      participants: {},\n      version: 0,\n      participantsCount: 0,\n      connectionState: 'disconnected',\n    } : undefined,\n    membersCount: participantsCount,\n    ...(viewForumAsMessages && { isForumAsMessages: true }),\n  };\n}\n\nexport async function updateChatMutedState({\n  chat, isMuted, muteUntil = 0,\n}: {\n  chat: ApiChat; isMuted: boolean; muteUntil?: number;\n}) {\n  if (isMuted && !muteUntil) {\n    muteUntil = MAX_INT_32;\n  }\n  await invokeRequest(new GramJs.account.UpdateNotifySettings({\n    peer: new GramJs.InputNotifyPeer({\n      peer: buildInputPeer(chat.id, chat.accessHash),\n    }),\n    settings: new GramJs.InputPeerNotifySettings({ muteUntil }),\n  }));\n\n  onUpdate({\n    '@type': 'updateNotifyExceptions',\n    chatId: chat.id,\n    isMuted,\n  });\n\n  void requestChatUpdate({\n    chat,\n    noLastMessage: true,\n  });\n}\n\nexport async function updateTopicMutedState({\n  chat, topicId, isMuted, muteUntil = 0,\n}: {\n  chat: ApiChat; topicId: number; isMuted: boolean; muteUntil?: number;\n}) {\n  if (isMuted && !muteUntil) {\n    muteUntil = MAX_INT_32;\n  }\n  await invokeRequest(new GramJs.account.UpdateNotifySettings({\n    peer: new GramJs.InputNotifyForumTopic({\n      peer: buildInputPeer(chat.id, chat.accessHash),\n      topMsgId: topicId,\n    }),\n    settings: new GramJs.InputPeerNotifySettings({ muteUntil }),\n  }));\n\n  onUpdate({\n    '@type': 'updateTopicNotifyExceptions',\n    chatId: chat.id,\n    topicId,\n    isMuted,\n  });\n\n  // TODO[forums] Request forum topic thread update\n}\n\nexport async function createChannel({\n  title, about = '', users,\n}: {\n  title: string; about?: string; users?: ApiUser[];\n}) {\n  const result = await invokeRequest(new GramJs.channels.CreateChannel({\n    broadcast: true,\n    title,\n    about,\n  }), {\n    shouldThrow: true,\n  });\n\n  // `createChannel` can return a lot of different update types according to docs,\n  // but currently channel creation returns only `Updates` type.\n  // Errors are added to catch unexpected cases in future testing\n  if (!(result instanceof GramJs.Updates)) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.error('Unexpected channel creation update', result);\n    }\n    return undefined;\n  }\n\n  const newChannel = result.chats[0];\n  if (!newChannel || !(newChannel instanceof GramJs.Channel)) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.error('Created channel not found', result);\n    }\n    return undefined;\n  }\n\n  const channel = buildApiChatFromPreview(newChannel)!;\n\n  let restrictedUserIds: string[] | undefined;\n\n  if (users?.length) {\n    try {\n      const updates = await invokeRequest(new GramJs.channels.InviteToChannel({\n        channel: buildInputEntity(channel.id, channel.accessHash) as GramJs.InputChannel,\n        users: users.map(({ id, accessHash }) => buildInputEntity(id, accessHash)) as GramJs.InputUser[],\n      }), {\n        shouldIgnoreUpdates: true,\n        shouldThrow: true,\n      });\n      if (updates) {\n        processUpdate(updates);\n        restrictedUserIds = handleUserPrivacyRestrictedUpdates(updates);\n      }\n    } catch (err) {\n      if ((err as Error).message === 'USER_PRIVACY_RESTRICTED') {\n        restrictedUserIds = users.map(({ id }) => id);\n      } else {\n        onUpdate({\n          '@type': 'error',\n          error: {\n            message: (err as Error).message,\n          },\n        });\n      }\n    }\n  }\n\n  return { channel, restrictedUserIds };\n}\n\nexport function joinChannel({\n  channelId, accessHash,\n}: {\n  channelId: string; accessHash: string;\n}) {\n  return invokeRequest(new GramJs.channels.JoinChannel({\n    channel: buildInputEntity(channelId, accessHash) as GramJs.InputChannel,\n  }), {\n    shouldReturnTrue: true,\n    shouldThrow: true,\n  });\n}\n\nexport function deleteChatUser({\n  chat, user,\n}: {\n  chat: ApiChat; user: ApiUser;\n}) {\n  if (chat.type !== 'chatTypeBasicGroup') return undefined;\n  return invokeRequest(new GramJs.messages.DeleteChatUser({\n    chatId: buildInputEntity(chat.id, chat.accessHash) as BigInt.BigInteger,\n    userId: buildInputEntity(user.id, user.accessHash) as GramJs.InputUser,\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport function deleteChat({\n  chatId,\n}: {\n  chatId: string;\n}) {\n  return invokeRequest(new GramJs.messages.DeleteChat({\n    chatId: buildInputEntity(chatId) as BigInt.BigInteger,\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport function leaveChannel({\n  channelId, accessHash,\n}: {\n  channelId: string; accessHash: string;\n}) {\n  return invokeRequest(new GramJs.channels.LeaveChannel({\n    channel: buildInputEntity(channelId, accessHash) as GramJs.InputChannel,\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport function deleteChannel({\n  channelId, accessHash,\n}: {\n  channelId: string; accessHash: string;\n}) {\n  return invokeRequest(new GramJs.channels.DeleteChannel({\n    channel: buildInputEntity(channelId, accessHash) as GramJs.InputChannel,\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport async function createGroupChat({\n  title, users,\n}: {\n  title: string; users: ApiUser[];\n}) {\n  const result = await invokeRequest(new GramJs.messages.CreateChat({\n    title,\n    users: users.map(({ id, accessHash }) => buildInputEntity(id, accessHash)) as GramJs.InputUser[],\n  }), {\n    shouldIgnoreUpdates: true,\n    shouldThrow: true,\n  });\n\n  // `createChat` can return a lot of different update types according to docs,\n  // but currently chat creation returns only `Updates` type.\n  // Errors are added to catch unexpected cases in future testing\n  if (!(result instanceof GramJs.Updates)) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.error('Unexpected chat creation update', result);\n    }\n    return undefined;\n  }\n  processUpdate(result);\n  const restrictedUserIds = handleUserPrivacyRestrictedUpdates(result);\n\n  const newChat = result.chats[0];\n  if (!newChat || !(newChat instanceof GramJs.Chat)) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.error('Created chat not found', result);\n    }\n    return undefined;\n  }\n\n  return { chat: buildApiChatFromPreview(newChat), restrictedUserIds };\n}\n\nexport async function editChatPhoto({\n  chatId, accessHash, photo,\n}: {\n  chatId: string; accessHash?: string; photo?: File | ApiPhoto;\n}) {\n  const inputEntity = buildInputEntity(chatId, accessHash);\n  let inputPhoto: GramJs.TypeInputChatPhoto;\n  if (photo instanceof File) {\n    const uploadedPhoto = await uploadFile(photo);\n    inputPhoto = new GramJs.InputChatUploadedPhoto({\n      file: uploadedPhoto,\n    });\n  } else if (photo) {\n    const photoId = buildInputPhoto(photo);\n    if (!photoId) return false;\n    inputPhoto = new GramJs.InputChatPhoto({\n      id: photoId,\n    });\n  } else {\n    inputPhoto = new GramJs.InputChatPhotoEmpty();\n  }\n  return invokeRequest(\n    inputEntity instanceof GramJs.InputChannel\n      ? new GramJs.channels.EditPhoto({\n        channel: inputEntity as GramJs.InputChannel,\n        photo: inputPhoto,\n      })\n      : new GramJs.messages.EditChatPhoto({\n        chatId: inputEntity as BigInt.BigInteger,\n        photo: inputPhoto,\n      }),\n    {\n      shouldReturnTrue: true,\n    },\n  );\n}\n\nexport async function toggleChatPinned({\n  chat,\n  shouldBePinned,\n}: {\n  chat: ApiChat;\n  shouldBePinned: boolean;\n}) {\n  const { id, accessHash } = chat;\n\n  const isActionSuccessful = await invokeRequest(new GramJs.messages.ToggleDialogPin({\n    peer: new GramJs.InputDialogPeer({\n      peer: buildInputPeer(id, accessHash),\n    }),\n    pinned: shouldBePinned || undefined,\n  }));\n\n  if (isActionSuccessful) {\n    onUpdate({\n      '@type': 'updateChatPinned',\n      id: chat.id,\n      isPinned: shouldBePinned,\n    });\n  }\n}\n\nexport async function toggleSavedDialogPinned({\n  chat, shouldBePinned,\n}: {\n  chat: ApiChat;\n  shouldBePinned: boolean;\n}) {\n  const { id, accessHash } = chat;\n\n  const isActionSuccessful = await invokeRequest(new GramJs.messages.ToggleSavedDialogPin({\n    peer: new GramJs.InputDialogPeer({\n      peer: buildInputPeer(id, accessHash),\n    }),\n    pinned: shouldBePinned || undefined,\n  }));\n\n  if (isActionSuccessful) {\n    onUpdate({\n      '@type': 'updateSavedDialogPinned',\n      id: chat.id,\n      isPinned: shouldBePinned,\n    });\n  }\n}\n\nexport function toggleChatArchived({\n  chat, folderId,\n}: {\n  chat: ApiChat; folderId: number;\n}) {\n  const { id, accessHash } = chat;\n\n  return invokeRequest(new GramJs.folders.EditPeerFolders({\n    folderPeers: [new GramJs.InputFolderPeer({\n      peer: buildInputPeer(id, accessHash),\n      folderId,\n    })],\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport async function fetchChatFolders() {\n  const result = await invokeRequest(new GramJs.messages.GetDialogFilters());\n\n  if (!result) {\n    return undefined;\n  }\n\n  const defaultFolderPosition = result.findIndex((folder) => folder instanceof GramJs.DialogFilterDefault);\n  const dialogFilters = result.filter(isChatFolder);\n  const orderedIds = dialogFilters.map(({ id }) => id);\n  if (defaultFolderPosition !== -1) {\n    orderedIds.splice(defaultFolderPosition, 0, ALL_FOLDER_ID);\n  }\n  return {\n    byId: buildCollectionByKey(\n      dialogFilters\n        .map(buildApiChatFolder), 'id',\n    ) as Record<number, ApiChatFolder>,\n    orderedIds,\n  };\n}\n\nexport async function fetchRecommendedChatFolders() {\n  const results = await invokeRequest(new GramJs.messages.GetSuggestedDialogFilters());\n\n  if (!results) {\n    return undefined;\n  }\n\n  return results.map(buildApiChatFolderFromSuggested).filter(Boolean);\n}\n\nexport async function editChatFolder({\n  id,\n  folderUpdate,\n}: {\n  id: number;\n  folderUpdate: ApiChatFolder;\n}) {\n  // Telegram ignores excluded chats if they also present in the included list\n  folderUpdate.excludedChatIds = folderUpdate.excludedChatIds.filter((chatId) => {\n    return !folderUpdate.includedChatIds.includes(chatId);\n  });\n\n  const filter = buildFilterFromApiFolder(folderUpdate);\n\n  const isActionSuccessful = await invokeRequest(new GramJs.messages.UpdateDialogFilter({\n    id,\n    filter,\n  }));\n\n  if (isActionSuccessful) {\n    onUpdate({\n      '@type': 'updateChatFolder',\n      id,\n      folder: folderUpdate,\n    });\n  }\n}\n\nexport async function deleteChatFolder(id: number) {\n  const isActionSuccessful = await invokeRequest(new GramJs.messages.UpdateDialogFilter({\n    id,\n    filter: undefined,\n  }));\n  const recommendedChatFolders = await fetchRecommendedChatFolders();\n\n  if (isActionSuccessful) {\n    onUpdate({\n      '@type': 'updateChatFolder',\n      id,\n      folder: undefined,\n    });\n  }\n  if (recommendedChatFolders) {\n    onUpdate({\n      '@type': 'updateRecommendedChatFolders',\n      folders: recommendedChatFolders,\n    });\n  }\n}\n\nexport function sortChatFolders(ids: number[]) {\n  return invokeRequest(new GramJs.messages.UpdateDialogFiltersOrder({\n    order: ids,\n  }));\n}\n\nexport async function toggleDialogUnread({\n  chat, hasUnreadMark,\n}: {\n  chat: ApiChat; hasUnreadMark: boolean | undefined;\n}) {\n  const { id, accessHash } = chat;\n\n  const isActionSuccessful = await invokeRequest(new GramJs.messages.MarkDialogUnread({\n    peer: new GramJs.InputDialogPeer({\n      peer: buildInputPeer(id, accessHash),\n    }),\n    unread: hasUnreadMark || undefined,\n  }));\n\n  if (isActionSuccessful) {\n    onUpdate({\n      '@type': 'updateChat',\n      id: chat.id,\n      chat: { hasUnreadMark },\n    });\n  }\n}\n\nexport async function getChatByPhoneNumber(phoneNumber: string) {\n  const result = await invokeRequest(new GramJs.contacts.ResolvePhone({\n    phone: phoneNumber,\n  }));\n\n  return processResolvedPeer(result);\n}\n\nexport async function getChatByUsername(username: string) {\n  const result = await invokeRequest(new GramJs.contacts.ResolveUsername({\n    username,\n  }));\n\n  return processResolvedPeer(result);\n}\n\nfunction processResolvedPeer(result?: GramJs.contacts.TypeResolvedPeer) {\n  if (!result) {\n    return undefined;\n  }\n\n  const { users, chats } = result;\n\n  const chat = chats.length\n    ? buildApiChatFromPreview(chats[0])\n    : buildApiChatFromPreview(users[0]);\n\n  if (!chat) {\n    return undefined;\n  }\n\n  updateLocalDb(result);\n\n  return {\n    chat,\n    user: buildApiUser(users[0]),\n  };\n}\n\nexport function togglePreHistoryHidden({\n  chat, isEnabled,\n}: { chat: ApiChat; isEnabled: boolean }) {\n  const { id, accessHash } = chat;\n  const channel = buildInputEntity(id, accessHash);\n\n  return invokeRequest(new GramJs.channels.TogglePreHistoryHidden({\n    channel: channel as GramJs.InputChannel,\n    enabled: isEnabled,\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport function updateChatDefaultBannedRights({\n  chat, bannedRights,\n}: { chat: ApiChat; bannedRights: ApiChatBannedRights }) {\n  const { id, accessHash } = chat;\n  const peer = buildInputPeer(id, accessHash);\n\n  return invokeRequest(new GramJs.messages.EditChatDefaultBannedRights({\n    peer,\n    bannedRights: buildChatBannedRights(bannedRights),\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport function updateChatMemberBannedRights({\n  chat, user, bannedRights, untilDate,\n}: { chat: ApiChat; user: ApiUser; bannedRights: ApiChatBannedRights; untilDate?: number }) {\n  const channel = buildInputEntity(chat.id, chat.accessHash) as GramJs.InputChannel;\n  const participant = buildInputPeer(user.id, user.accessHash) as GramJs.InputUser;\n\n  return invokeRequest(new GramJs.channels.EditBanned({\n    channel,\n    participant,\n    bannedRights: buildChatBannedRights(bannedRights, untilDate),\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport function updateChatAdmin({\n  chat, user, adminRights, customTitle = '',\n}: { chat: ApiChat; user: ApiUser; adminRights: ApiChatAdminRights; customTitle?: string }) {\n  const channel = buildInputEntity(chat.id, chat.accessHash) as GramJs.InputChannel;\n  const userId = buildInputEntity(user.id, user.accessHash) as GramJs.InputUser;\n\n  return invokeRequest(new GramJs.channels.EditAdmin({\n    channel,\n    userId,\n    adminRights: buildChatAdminRights(adminRights),\n    rank: customTitle,\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport async function updateChatTitle(chat: ApiChat, title: string) {\n  const inputEntity = buildInputEntity(chat.id, chat.accessHash);\n  await invokeRequest(\n    inputEntity instanceof GramJs.InputChannel\n      ? new GramJs.channels.EditTitle({\n        channel: inputEntity as GramJs.InputChannel,\n        title,\n      }) : new GramJs.messages.EditChatTitle({\n        chatId: inputEntity as BigInt.BigInteger,\n        title,\n      }),\n    {\n      shouldReturnTrue: true,\n    },\n  );\n}\n\nexport async function updateChatAbout(chat: ApiChat, about: string) {\n  const result = await invokeRequest(new GramJs.messages.EditChatAbout({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    about,\n  }));\n\n  if (!result) {\n    return;\n  }\n\n  onUpdate({\n    '@type': 'updateChatFullInfo',\n    id: chat.id,\n    fullInfo: {\n      about,\n    },\n  });\n}\n\nexport function toggleSignatures({\n  chat, isEnabled,\n}: { chat: ApiChat; isEnabled: boolean }) {\n  const { id, accessHash } = chat;\n  const channel = buildInputEntity(id, accessHash);\n\n  return invokeRequest(new GramJs.channels.ToggleSignatures({\n    channel: channel as GramJs.InputChannel,\n    enabled: isEnabled,\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\ntype ChannelMembersFilter =\n  'kicked'\n  | 'admin'\n  | 'recent';\n\nexport async function fetchMembers(\n  chatId: string,\n  accessHash: string,\n  memberFilter: ChannelMembersFilter = 'recent',\n  offset?: number,\n) {\n  let filter: GramJs.TypeChannelParticipantsFilter;\n\n  switch (memberFilter) {\n    case 'kicked':\n      filter = new GramJs.ChannelParticipantsKicked({ q: '' });\n      break;\n    case 'admin':\n      filter = new GramJs.ChannelParticipantsAdmins();\n      break;\n    default:\n      filter = new GramJs.ChannelParticipantsRecent();\n      break;\n  }\n\n  const result = await invokeRequest(new GramJs.channels.GetParticipants({\n    channel: buildInputEntity(chatId, accessHash) as GramJs.InputChannel,\n    filter,\n    offset,\n    limit: MEMBERS_LOAD_SLICE,\n  }), {\n    abortControllerChatId: chatId,\n  });\n\n  if (!result || result instanceof GramJs.channels.ChannelParticipantsNotModified) {\n    return undefined;\n  }\n\n  updateLocalDb(result);\n  const { users, userStatusesById } = buildApiUsersAndStatuses(result.users);\n\n  return {\n    members: buildChatMembers(result),\n    users,\n    userStatusesById,\n  };\n}\n\nexport async function fetchGroupsForDiscussion() {\n  const result = await invokeRequest(new GramJs.channels.GetGroupsForDiscussion());\n\n  if (!result) {\n    return undefined;\n  }\n\n  updateLocalDb(result);\n\n  return result.chats.map((chat) => buildApiChatFromPreview(chat));\n}\n\nexport function setDiscussionGroup({\n  channel,\n  chat,\n}: {\n  channel: ApiChat;\n  chat?: ApiChat;\n}) {\n  return invokeRequest(new GramJs.channels.SetDiscussionGroup({\n    broadcast: buildInputPeer(channel.id, channel.accessHash),\n    group: chat ? buildInputPeer(chat.id, chat.accessHash) : new GramJs.InputChannelEmpty(),\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport async function migrateChat(chat: ApiChat) {\n  const result = await invokeRequest(\n    new GramJs.messages.MigrateChat({ chatId: buildInputEntity(chat.id) as BigInt.BigInteger }),\n    {\n      shouldThrow: true,\n    },\n  );\n\n  // `migrateChat` can return a lot of different update types according to docs,\n  // but currently chat migrations returns only `Updates` type.\n  // Errors are added to catch unexpected cases in future testing\n  if (!result || !(result instanceof GramJs.Updates)) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.error('Unexpected channel creation update', result);\n    }\n\n    return undefined;\n  }\n\n  updateLocalDb(result);\n\n  const newChannelId = result.updates\n    .find((update): update is GramJs.UpdateChannel => update instanceof GramJs.UpdateChannel)!.channelId;\n\n  const newChannel = result.chats.find((c) => (\n    c instanceof GramJs.Channel && c.id.toString() === newChannelId.toString()\n  ))!;\n\n  return buildApiChatFromPreview(newChannel);\n}\n\nexport async function openChatByInvite(hash: string) {\n  const result = await invokeRequest(new GramJs.messages.CheckChatInvite({ hash }));\n\n  if (!result) {\n    return undefined;\n  }\n\n  let chat: ApiChat | undefined;\n\n  if (result instanceof GramJs.ChatInvite) {\n    const {\n      photo, participantsCount, title, channel, requestNeeded, about, megagroup,\n    } = result;\n\n    if (photo instanceof GramJs.Photo) {\n      addPhotoToLocalDb(result.photo);\n    }\n\n    onUpdate({\n      '@type': 'showInvite',\n      data: {\n        title,\n        about,\n        hash,\n        participantsCount,\n        isChannel: channel && !megagroup,\n        isRequestNeeded: requestNeeded,\n        ...(photo instanceof GramJs.Photo && { photo: buildApiPhoto(photo) }),\n      },\n    });\n  } else {\n    chat = buildApiChatFromPreview(result.chat);\n\n    if (chat) {\n      onUpdate({\n        '@type': 'updateChat',\n        id: chat.id,\n        chat,\n      });\n    }\n  }\n\n  if (!chat) {\n    return undefined;\n  }\n\n  return { chatId: chat.id };\n}\n\nexport async function addChatMembers(chat: ApiChat, users: ApiUser[]) {\n  try {\n    if (chat.type === 'chatTypeChannel' || chat.type === 'chatTypeSuperGroup') {\n      try {\n        const updates = await invokeRequest(new GramJs.channels.InviteToChannel({\n          channel: buildInputEntity(chat.id, chat.accessHash) as GramJs.InputChannel,\n          users: users.map((user) => buildInputEntity(user.id, user.accessHash)) as GramJs.InputUser[],\n        }), {\n          shouldIgnoreUpdates: true,\n          shouldThrow: true,\n        });\n        if (updates) {\n          processUpdate(updates);\n          return handleUserPrivacyRestrictedUpdates(updates);\n        }\n      } catch (err) {\n        if ((err as Error).message === 'USER_PRIVACY_RESTRICTED') {\n          return users.map(({ id }) => id);\n        }\n        throw err;\n      }\n    }\n\n    const addChatUsersResult = await Promise.all(\n      users.map(async (user) => {\n        try {\n          const updates = await invokeRequest(new GramJs.messages.AddChatUser({\n            chatId: buildInputEntity(chat.id) as BigInt.BigInteger,\n            userId: buildInputEntity(user.id, user.accessHash) as GramJs.InputUser,\n          }), {\n            shouldIgnoreUpdates: true,\n            shouldThrow: true,\n          });\n          if (updates) {\n            processUpdate(updates);\n            return handleUserPrivacyRestrictedUpdates(updates);\n          }\n          return undefined;\n        } catch (err) {\n          if ((err as Error).message === 'USER_PRIVACY_RESTRICTED') {\n            return [user.id];\n          }\n          throw err;\n        }\n      }),\n    );\n    if (addChatUsersResult) {\n      return addChatUsersResult.flat().filter(Boolean);\n    }\n  } catch (err) {\n    onUpdate({\n      '@type': 'error',\n      error: {\n        message: (err as Error).message,\n      },\n    });\n  }\n  return undefined;\n}\n\nexport function deleteChatMember(chat: ApiChat, user: ApiUser) {\n  if (chat.type === 'chatTypeChannel' || chat.type === 'chatTypeSuperGroup') {\n    return updateChatMemberBannedRights({\n      chat,\n      user,\n      bannedRights: {\n        viewMessages: true,\n        sendMessages: true,\n        sendMedia: true,\n        sendStickers: true,\n        sendGifs: true,\n        sendGames: true,\n        sendInline: true,\n        embedLinks: true,\n        sendPolls: true,\n        changeInfo: true,\n        inviteUsers: true,\n        pinMessages: true,\n        manageTopics: true,\n        sendPhotos: true,\n        sendVideos: true,\n        sendRoundvideos: true,\n        sendAudios: true,\n        sendVoices: true,\n        sendDocs: true,\n        sendPlain: true,\n      },\n      untilDate: MAX_INT_32,\n    });\n  } else {\n    return invokeRequest(new GramJs.messages.DeleteChatUser({\n      chatId: buildInputEntity(chat.id) as BigInt.BigInteger,\n      userId: buildInputEntity(user.id, user.accessHash) as GramJs.InputUser,\n    }), {\n      shouldReturnTrue: true,\n    });\n  }\n}\n\nexport function toggleJoinToSend(chat: ApiChat, isEnabled: boolean) {\n  return invokeRequest(new GramJs.channels.ToggleJoinToSend({\n    channel: buildInputEntity(chat.id, chat.accessHash) as GramJs.InputChannel,\n    enabled: isEnabled,\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport function toggleJoinRequest(chat: ApiChat, isEnabled: boolean) {\n  return invokeRequest(new GramJs.channels.ToggleJoinRequest({\n    channel: buildInputEntity(chat.id, chat.accessHash) as GramJs.InputChannel,\n    enabled: isEnabled,\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nfunction preparePeers(\n  result: GramJs.messages.Dialogs | GramJs.messages.DialogsSlice | GramJs.messages.PeerDialogs |\n  GramJs.messages.SavedDialogs | GramJs.messages.SavedDialogsSlice,\n  currentStore?: Record<string, GramJs.TypeChat | GramJs.TypeUser>,\n) {\n  const store: Record<string, GramJs.TypeChat | GramJs.TypeUser> = {};\n\n  result.chats?.forEach((chat) => {\n    const key = `chat${chat.id}`;\n\n    if (currentStore?.[key] && 'min' in chat && chat.min) {\n      return;\n    }\n\n    store[key] = chat;\n  });\n\n  result.users?.forEach((user) => {\n    const key = `user${user.id}`;\n\n    if (currentStore?.[key] && 'min' in user && user.min) {\n      return;\n    }\n\n    store[key] = user;\n  });\n\n  return store;\n}\n\nfunction updateLocalDb(result: (\n  GramJs.messages.Dialogs | GramJs.messages.DialogsSlice | GramJs.messages.PeerDialogs |\n  GramJs.messages.SavedDialogs | GramJs.messages.SavedDialogsSlice |\n  GramJs.messages.ChatFull | GramJs.contacts.Found |\n  GramJs.contacts.ResolvedPeer | GramJs.channels.ChannelParticipants |\n  GramJs.messages.Chats | GramJs.messages.ChatsSlice | GramJs.TypeUpdates | GramJs.messages.ForumTopics\n)) {\n  if ('users' in result) {\n    addEntitiesToLocalDb(result.users);\n  }\n\n  if ('chats' in result) {\n    addEntitiesToLocalDb(result.chats);\n  }\n\n  if ('messages' in result) {\n    result.messages.forEach((message) => {\n      if (message instanceof GramJs.Message && isMessageWithMedia(message)) {\n        addMessageToLocalDb(message);\n      }\n    });\n  }\n}\n\nexport async function importChatInvite({ hash }: { hash: string }) {\n  const updates = await invokeRequest(new GramJs.messages.ImportChatInvite({ hash }));\n  if (!(updates instanceof GramJs.Updates) || !updates.chats.length) {\n    return undefined;\n  }\n\n  return buildApiChatFromPreview(updates.chats[0]);\n}\n\nexport function setChatEnabledReactions({\n  chat, enabledReactions,\n}: {\n  chat: ApiChat; enabledReactions?: ApiChatReactions;\n}) {\n  return invokeRequest(new GramJs.messages.SetChatAvailableReactions({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    availableReactions: buildInputChatReactions(enabledReactions),\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport function toggleIsProtected({\n  chat, isProtected,\n}: { chat: ApiChat; isProtected: boolean }) {\n  const { id, accessHash } = chat;\n\n  return invokeRequest(new GramJs.messages.ToggleNoForwards({\n    peer: buildInputPeer(id, accessHash),\n    enabled: isProtected,\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport function toggleParticipantsHidden({\n  chat, isEnabled,\n}: { chat: ApiChat; isEnabled: boolean }) {\n  const { id, accessHash } = chat;\n\n  return invokeRequest(new GramJs.channels.ToggleParticipantsHidden({\n    channel: buildInputPeer(id, accessHash),\n    enabled: isEnabled,\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport function toggleForum({\n  chat, isEnabled,\n}: { chat: ApiChat; isEnabled: boolean }) {\n  const { id, accessHash } = chat;\n\n  return invokeRequest(new GramJs.channels.ToggleForum({\n    channel: buildInputPeer(id, accessHash),\n    enabled: isEnabled,\n  }), {\n    shouldReturnTrue: true,\n    shouldThrow: true,\n  });\n}\n\nexport async function createTopic({\n  chat, title, iconColor, iconEmojiId, sendAs,\n}: {\n  chat: ApiChat;\n  title: string;\n  iconColor?: number;\n  iconEmojiId?: string;\n  sendAs?: ApiPeer;\n}) {\n  const { id, accessHash } = chat;\n\n  const updates = await invokeRequest(new GramJs.channels.CreateForumTopic({\n    channel: buildInputPeer(id, accessHash),\n    title,\n    iconColor,\n    iconEmojiId: iconEmojiId ? BigInt(iconEmojiId) : undefined,\n    sendAs: sendAs ? buildInputPeer(sendAs.id, sendAs.accessHash) : undefined,\n    randomId: generateRandomBigInt(),\n  }));\n\n  if (!(updates instanceof GramJs.Updates) || !updates.updates.length) {\n    return undefined;\n  }\n\n  // Finding topic id in updates\n  return updates.updates?.find((update): update is GramJs.UpdateMessageID => (\n    update instanceof GramJs.UpdateMessageID\n  ))?.id;\n}\n\nexport async function fetchTopics({\n  chat, query, offsetTopicId, offsetId, offsetDate, limit = TOPICS_SLICE,\n}: {\n  chat: ApiChat;\n  query?: string;\n  offsetTopicId?: number;\n  offsetId?: number;\n  offsetDate?: number;\n  limit?: number;\n}): Promise<{\n    topics: ApiTopic[];\n    messages: ApiMessage[];\n    users: ApiUser[];\n    chats: ApiChat[];\n    count: number;\n    shouldOrderByCreateDate?: boolean;\n    draftsById: Record<number, ReturnType<typeof buildMessageDraft>>;\n    readInboxMessageIdByTopicId: Record<number, number>;\n  } | undefined> {\n  const { id, accessHash } = chat;\n\n  const result = await invokeRequest(new GramJs.channels.GetForumTopics({\n    channel: buildInputPeer(id, accessHash),\n    limit,\n    q: query,\n    offsetTopic: offsetTopicId,\n    offsetId,\n    offsetDate,\n  }));\n\n  if (!result) return undefined;\n\n  updateLocalDb(result);\n\n  const { count, orderByCreateDate } = result;\n\n  const topics = result.topics.map(buildApiTopic).filter(Boolean);\n  const messages = result.messages.map(buildApiMessage).filter(Boolean);\n  dispatchThreadInfoUpdates(result.messages);\n  const users = result.users.map(buildApiUser).filter(Boolean);\n  const chats = result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean);\n  const draftsById = result.topics.reduce((acc, topic) => {\n    if (topic instanceof GramJs.ForumTopic && topic.draft) {\n      acc[topic.id] = buildMessageDraft(topic.draft);\n    }\n    return acc;\n  }, {} as Record<number, ReturnType<typeof buildMessageDraft>>);\n  const readInboxMessageIdByTopicId = result.topics.reduce((acc, topic) => {\n    if (topic instanceof GramJs.ForumTopic && topic.readInboxMaxId) {\n      acc[topic.id] = topic.readInboxMaxId;\n    }\n    return acc;\n  }, {} as Record<number, number>);\n\n  return {\n    topics,\n    messages,\n    users,\n    chats,\n    // Include general topic\n    count: count + 1,\n    shouldOrderByCreateDate: orderByCreateDate,\n    draftsById,\n    readInboxMessageIdByTopicId,\n  };\n}\n\nexport async function fetchTopicById({\n  chat, topicId,\n}: {\n  chat: ApiChat;\n  topicId: number;\n}): Promise<{\n    topic: ApiTopic;\n    messages: ApiMessage[];\n    users: ApiUser[];\n    chats: ApiChat[];\n  } | undefined> {\n  const { id, accessHash } = chat;\n\n  const result = await invokeRequest(new GramJs.channels.GetForumTopicsByID({\n    channel: buildInputPeer(id, accessHash),\n    topics: [topicId],\n  }));\n\n  if (!result?.topics.length || !(result.topics[0] instanceof GramJs.ForumTopic)) {\n    return undefined;\n  }\n\n  updateLocalDb(result);\n\n  const messages = result.messages.map(buildApiMessage).filter(Boolean);\n  dispatchThreadInfoUpdates(result.messages);\n  const users = result.users.map(buildApiUser).filter(Boolean);\n  const chats = result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean);\n\n  return {\n    topic: buildApiTopic(result.topics[0])!,\n    messages,\n    users,\n    chats,\n  };\n}\n\nexport async function deleteTopic({\n  chat, topicId,\n}: {\n  chat: ApiChat;\n  topicId: number;\n}) {\n  const { id, accessHash } = chat;\n\n  const result = await invokeRequest(new GramJs.channels.DeleteTopicHistory({\n    channel: buildInputPeer(id, accessHash),\n    topMsgId: topicId,\n  }));\n\n  if (!result) return;\n\n  processAffectedHistory(chat, result);\n\n  if (result.offset) {\n    await deleteTopic({ chat, topicId });\n  }\n}\n\nexport function togglePinnedTopic({\n  chat, topicId, isPinned,\n}: {\n  chat: ApiChat;\n  topicId: number;\n  isPinned: boolean;\n}) {\n  const { id, accessHash } = chat;\n\n  return invokeRequest(new GramJs.channels.UpdatePinnedForumTopic({\n    channel: buildInputPeer(id, accessHash),\n    topicId,\n    pinned: isPinned,\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport function editTopic({\n  chat, topicId, title, iconEmojiId, isClosed, isHidden,\n}: {\n  chat: ApiChat;\n  topicId: number;\n  title?: string;\n  iconEmojiId?: string;\n  isClosed?: boolean;\n  isHidden?: boolean;\n}) {\n  const { id, accessHash } = chat;\n\n  return invokeRequest(new GramJs.channels.EditForumTopic({\n    channel: buildInputPeer(id, accessHash),\n    topicId,\n    title,\n    iconEmojiId: topicId !== GENERAL_TOPIC_ID && iconEmojiId ? BigInt(iconEmojiId) : undefined,\n    closed: isClosed,\n    hidden: isHidden,\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport async function checkChatlistInvite({\n  slug,\n}: {\n  slug: string;\n}) {\n  const result = await invokeRequest(new GramJs.chatlists.CheckChatlistInvite({\n    slug,\n  }));\n\n  const invite = buildApiChatlistInvite(result, slug);\n\n  if (!result || !invite) return undefined;\n\n  updateLocalDb(result);\n\n  return {\n    invite,\n    users: result.users.map(buildApiUser).filter(Boolean),\n    chats: result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean),\n  };\n}\n\nexport function joinChatlistInvite({\n  slug,\n  peers,\n}: {\n  slug: string;\n  peers: ApiChat[];\n}) {\n  return invokeRequest(new GramJs.chatlists.JoinChatlistInvite({\n    slug,\n    peers: peers.map((peer) => buildInputPeer(peer.id, peer.accessHash)),\n  }), {\n    shouldReturnTrue: true,\n    shouldThrow: true,\n  });\n}\n\nexport async function fetchLeaveChatlistSuggestions({\n  folderId,\n}: {\n  folderId: number;\n}) {\n  const result = await invokeRequest(new GramJs.chatlists.GetLeaveChatlistSuggestions({\n    chatlist: new GramJs.InputChatlistDialogFilter({\n      filterId: folderId,\n    }),\n  }));\n\n  if (!result) return undefined;\n\n  return result.map(getApiChatIdFromMtpPeer);\n}\n\nexport function leaveChatlist({\n  folderId,\n  peers,\n}: {\n  folderId: number;\n  peers: ApiChat[];\n}) {\n  return invokeRequest(new GramJs.chatlists.LeaveChatlist({\n    chatlist: new GramJs.InputChatlistDialogFilter({\n      filterId: folderId,\n    }),\n    peers: peers.map((peer) => buildInputPeer(peer.id, peer.accessHash)),\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport async function createChalistInvite({\n  folderId, title, peers,\n}: {\n  folderId: number;\n  title?: string;\n  peers: ApiPeer[];\n}) {\n  const result = await invokeRequest(new GramJs.chatlists.ExportChatlistInvite({\n    chatlist: new GramJs.InputChatlistDialogFilter({\n      filterId: folderId,\n    }),\n    title: title || '',\n    peers: peers.map((peer) => buildInputPeer(peer.id, peer.accessHash)),\n  }), {\n    shouldThrow: true,\n  });\n\n  if (!result || result.filter instanceof GramJs.DialogFilterDefault) return undefined;\n\n  return {\n    filter: buildApiChatFolder(result.filter),\n    invite: buildApiChatlistExportedInvite(result.invite),\n  };\n}\n\nexport function deleteChatlistInvite({\n  folderId, slug,\n}: {\n  folderId: number;\n  slug: string;\n}) {\n  return invokeRequest(new GramJs.chatlists.DeleteExportedInvite({\n    chatlist: new GramJs.InputChatlistDialogFilter({\n      filterId: folderId,\n    }),\n    slug,\n  }));\n}\n\nexport async function editChatlistInvite({\n  folderId, slug, title, peers,\n}: {\n  folderId: number;\n  slug: string;\n  title?: string;\n  peers: ApiPeer[];\n}) {\n  const result = await invokeRequest(new GramJs.chatlists.EditExportedInvite({\n    chatlist: new GramJs.InputChatlistDialogFilter({\n      filterId: folderId,\n    }),\n    slug,\n    title,\n    peers: peers.map((peer) => buildInputPeer(peer.id, peer.accessHash)),\n  }), {\n    shouldThrow: true,\n  });\n  if (!result) return undefined;\n\n  return buildApiChatlistExportedInvite(result);\n}\n\nexport async function fetchChatlistInvites({\n  folderId,\n}: {\n  folderId: number;\n}) {\n  const result = await invokeRequest(new GramJs.chatlists.GetExportedInvites({\n    chatlist: new GramJs.InputChatlistDialogFilter({\n      filterId: folderId,\n    }),\n  }));\n\n  if (!result) return undefined;\n\n  updateLocalDb(result);\n\n  return {\n    invites: result.invites.map(buildApiChatlistExportedInvite).filter(Boolean),\n    users: result.users.map(buildApiUser).filter(Boolean),\n    chats: result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean),\n  };\n}\n\nexport function togglePeerTranslations({\n  chat, isEnabled,\n}: {\n  chat: ApiChat;\n  isEnabled: boolean;\n}) {\n  return invokeRequest(new GramJs.messages.TogglePeerTranslations({\n    disabled: isEnabled ? undefined : true,\n    peer: buildInputPeer(chat.id, chat.accessHash),\n  }));\n}\n\nexport function setViewForumAsMessages({ chat, isEnabled }: { chat: ApiChat; isEnabled: boolean }) {\n  const { id, accessHash } = chat;\n  const channel = buildInputEntity(id, accessHash);\n\n  return invokeRequest(new GramJs.channels.ToggleViewForumAsMessages({\n    channel: channel as GramJs.InputChannel,\n    enabled: Boolean(isEnabled),\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport async function fetchChannelRecommendations({ chat }: { chat: ApiChat }) {\n  const { id, accessHash } = chat;\n  const channel = buildInputEntity(id, accessHash);\n\n  const result = await invokeRequest(new GramJs.channels.GetChannelRecommendations({\n    channel: channel as GramJs.InputChannel,\n  }));\n  if (!result) {\n    return undefined;\n  }\n\n  updateLocalDb(result);\n\n  return {\n    similarChannels: result?.chats\n      .map((_chat) => buildApiChatFromPreview(_chat))\n      .filter(Boolean),\n    count:\n      result instanceof GramJs.messages.ChatsSlice ? result.count : undefined,\n  };\n}\n\nfunction handleUserPrivacyRestrictedUpdates(updates: GramJs.TypeUpdates) {\n  if (!(updates instanceof GramJs.Updates) && !(updates instanceof GramJs.UpdatesCombined)) {\n    return undefined;\n  }\n\n  const eligibleUpdates = updates\n    .updates\n    .filter(\n      (u): u is GramJs.UpdateGroupInvitePrivacyForbidden => {\n        return u instanceof GramJs.UpdateGroupInvitePrivacyForbidden;\n      },\n    );\n\n  if (eligibleUpdates.length === 0) {\n    return undefined;\n  }\n\n  return eligibleUpdates\n    .map((u) => buildApiPeerId(u.userId, 'user'));\n}\n","import BigInt from 'big-integer';\nimport { Api as GramJs } from '../../../lib/gramjs';\n\nimport type {\n  ApiPeer, ApiPhoto, ApiReportReason,\n} from '../../types';\n\nimport { buildInputPeer, buildInputPhoto, buildInputReportReason } from '../gramjsBuilders';\nimport { invokeRequest } from './client';\n\nexport async function reportPeer({\n  peer,\n  reason,\n  description,\n}: {\n  peer: ApiPeer; reason: ApiReportReason; description?: string;\n}) {\n  const result = await invokeRequest(new GramJs.account.ReportPeer({\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    reason: buildInputReportReason(reason),\n    message: description,\n  }));\n\n  return result;\n}\n\nexport async function reportProfilePhoto({\n  peer,\n  photo,\n  reason,\n  description,\n}: {\n  peer: ApiPeer; photo: ApiPhoto; reason: ApiReportReason; description?: string;\n}) {\n  const photoId = buildInputPhoto(photo);\n  if (!photoId) return undefined;\n\n  const result = await invokeRequest(new GramJs.account.ReportProfilePhoto({\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    photoId,\n    reason: buildInputReportReason(reason),\n    message: description,\n  }));\n\n  return result;\n}\n\nexport async function changeSessionSettings({\n  hash, areCallsEnabled, areSecretChatsEnabled, isConfirmed,\n}: {\n  hash: string; areCallsEnabled?: boolean; areSecretChatsEnabled?: boolean; isConfirmed?: boolean;\n}) {\n  const result = await invokeRequest(new GramJs.account.ChangeAuthorizationSettings({\n    hash: BigInt(hash),\n    ...(areCallsEnabled !== undefined ? { callRequestsDisabled: !areCallsEnabled } : undefined),\n    ...(areSecretChatsEnabled !== undefined ? { encryptedRequestsDisabled: !areSecretChatsEnabled } : undefined),\n    ...(isConfirmed && { confirmed: isConfirmed }),\n  }));\n\n  return result;\n}\n\nexport async function changeSessionTtl({\n  days,\n}: {\n  days: number;\n}) {\n  const result = await invokeRequest(new GramJs.account.SetAuthorizationTTL({\n    authorizationTtlDays: days,\n  }));\n\n  return result;\n}\n","import { CONTENT_TYPES_WITH_PREVIEW } from '../config';\nimport { pause } from './schedulers';\n\n// Polyfill for Safari: `File` is not available in web worker\nif (typeof File === 'undefined') {\n  // eslint-disable-next-line no-global-assign, no-restricted-globals, func-names\n  self.File = class extends Blob {\n    name: string;\n\n    constructor(fileBits: BlobPart[], fileName: string, options?: FilePropertyBag) {\n      if (options) {\n        const { type, ...rest } = options;\n        super(fileBits, { type });\n        Object.assign(this, rest);\n      } else {\n        super(fileBits);\n      }\n\n      this.name = fileName;\n    }\n  } as typeof File;\n}\n\nexport function dataUriToBlob(dataUri: string) {\n  const arr = dataUri.split(',');\n  const mime = arr[0].match(/:(.*?);/)![1];\n  const bstr = atob(arr[1]);\n  let n = bstr.length;\n  const u8arr = new Uint8Array(n);\n\n  while (n--) {\n    u8arr[n] = bstr.charCodeAt(n);\n  }\n\n  return new Blob([u8arr], { type: mime });\n}\n\nexport function blobToDataUri(blob: Blob): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n\n    reader.onload = (e: ProgressEvent<FileReader>) => {\n      const { result } = e.target || {};\n      if (typeof result === 'string') {\n        resolve(result);\n      }\n\n      reject(new Error('Failed to read blob'));\n    };\n\n    reader.onerror = reject;\n    reader.readAsDataURL(blob);\n  });\n}\n\nexport function blobToFile(blob: Blob, fileName: string) {\n  return new File([blob], fileName, {\n    lastModified: Date.now(),\n    type: blob.type,\n  });\n}\n\nexport function preloadImage(url: string): Promise<HTMLImageElement> {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.onload = () => resolve(img);\n    img.onerror = reject;\n    img.src = url;\n  });\n}\n\nexport function preloadVideo(url: string): Promise<HTMLVideoElement> {\n  return new Promise((resolve, reject) => {\n    const video = document.createElement('video');\n    video.volume = 0;\n    video.onloadedmetadata = () => resolve(video);\n    video.onerror = reject;\n    video.src = url;\n  });\n}\n\nexport async function createPosterForVideo(url: string): Promise<string | undefined> {\n  try {\n    const video = await preloadVideo(url);\n\n    return await Promise.race([\n      pause(2000) as Promise<undefined>,\n      new Promise<string | undefined>((resolve, reject) => {\n        video.onseeked = () => {\n          if (!video.videoWidth || !video.videoHeight) {\n            resolve(undefined);\n          }\n\n          const canvas = document.createElement('canvas');\n          canvas.width = video.videoWidth;\n          canvas.height = video.videoHeight;\n          const ctx = canvas.getContext('2d')!;\n          ctx.drawImage(video, 0, 0);\n\n          canvas.toBlob((blob) => {\n            resolve(blob ? URL.createObjectURL(blob) : undefined);\n          });\n        };\n        video.onerror = reject;\n        video.currentTime = Math.min(video.duration, 1);\n      }),\n    ]);\n  } catch (e) {\n    return undefined;\n  }\n}\n\nexport async function fetchBlob(blobUrl: string) {\n  const response = await fetch(blobUrl);\n  return response.blob();\n}\n\nexport async function fetchFile(blobUrl: string, fileName: string) {\n  const blob = await fetchBlob(blobUrl);\n  return blobToFile(blob, fileName);\n}\n\nexport function imgToCanvas(img: HTMLImageElement) {\n  const canvas = document.createElement('canvas');\n  canvas.width = img.width;\n  canvas.height = img.height;\n\n  const ctx = canvas.getContext('2d')!;\n  ctx.drawImage(img, 0, 0);\n\n  return canvas;\n}\n\nexport function hasPreview(file: File) {\n  return CONTENT_TYPES_WITH_PREVIEW.has(file.type);\n}\n\nexport function validateFiles(files: File[] | FileList | null): File[] | undefined {\n  if (!files?.length) {\n    return undefined;\n  }\n  return Array.from(files).map(fixMovMime).filter((file) => file.size);\n}\n\n// .mov MIME type not reported sometimes https://developer.mozilla.org/en-US/docs/Web/API/File/type#sect1\nfunction fixMovMime(file: File) {\n  const ext = file.name.split('.').pop()!;\n  if (!file.type && ext.toLowerCase() === 'mov') {\n    return new File([file], file.name, { type: 'video/quicktime' });\n  }\n  return file;\n}\n","import { Api as GramJs } from '../../../lib/gramjs';\n\nimport type { ThreadId } from '../../../types';\nimport type {\n  ApiAttachment,\n  ApiChat,\n  ApiContact,\n  ApiFormattedText,\n  ApiGlobalMessageSearchType,\n  ApiInputReplyInfo,\n  ApiMessage,\n  ApiMessageEntity,\n  ApiMessageSearchType,\n  ApiNewPoll,\n  ApiOnProgress,\n  ApiPeer,\n  ApiPoll,\n  ApiReaction,\n  ApiReportReason,\n  ApiSendMessageAction,\n  ApiSticker,\n  ApiStory,\n  ApiStorySkipped,\n  ApiVideo,\n  MediaContent,\n  OnApiUpdate,\n} from '../../types';\nimport { MAIN_THREAD_ID, MESSAGE_DELETED } from '../../types';\n\nimport {\n  ALL_FOLDER_ID,\n  API_GENERAL_ID_LIMIT,\n  DEBUG,\n  GIF_MIME_TYPE,\n  MAX_INT_32,\n  MENTION_UNREAD_SLICE,\n  PINNED_MESSAGES_LIMIT,\n  REACTION_UNREAD_SLICE,\n  SUPPORTED_IMAGE_CONTENT_TYPES,\n  SUPPORTED_VIDEO_CONTENT_TYPES,\n} from '../../../config';\nimport { getEmojiOnlyCountForMessage } from '../../../global/helpers/getEmojiOnlyCountForMessage';\nimport { fetchFile } from '../../../util/files';\nimport { compact, split } from '../../../util/iteratees';\nimport { getMessageKey } from '../../../util/messageKey';\nimport { getServerTimeOffset } from '../../../util/serverTime';\nimport { interpolateArray } from '../../../util/waveform';\nimport { buildApiChatFromPreview, buildApiSendAsPeerId } from '../apiBuilders/chats';\nimport { buildApiFormattedText } from '../apiBuilders/common';\nimport { buildMessageMediaContent, buildMessageTextContent, buildWebPage } from '../apiBuilders/messageContent';\nimport {\n  buildApiMessage,\n  buildApiSponsoredMessage,\n  buildApiThreadInfo,\n  buildLocalForwardedMessage,\n  buildLocalMessage,\n  buildUploadingMedia,\n} from '../apiBuilders/messages';\nimport { getApiChatIdFromMtpPeer } from '../apiBuilders/peers';\nimport { buildApiUser } from '../apiBuilders/users';\nimport {\n  buildInputEntity,\n  buildInputMediaDocument,\n  buildInputPeer,\n  buildInputPoll,\n  buildInputPollFromExisting,\n  buildInputReaction,\n  buildInputReplyTo,\n  buildInputReportReason,\n  buildInputStory,\n  buildInputTextWithEntities,\n  buildMessageFromUpdate,\n  buildMtpMessageEntity,\n  buildSendMessageAction,\n  generateRandomBigInt,\n  getEntityTypeById,\n  isMessageWithMedia,\n  isServiceMessageWithMedia,\n} from '../gramjsBuilders';\nimport {\n  addEntitiesToLocalDb,\n  addMessageToLocalDb,\n  deserializeBytes,\n} from '../helpers';\nimport { processAffectedHistory, updateChannelState } from '../updates/updateManager';\nimport { dispatchThreadInfoUpdates } from '../updates/updater';\nimport { requestChatUpdate } from './chats';\nimport { handleGramJsUpdate, invokeRequest, uploadFile } from './client';\n\nconst FAST_SEND_TIMEOUT = 1000;\nconst INPUT_WAVEFORM_LENGTH = 63;\n\ntype TranslateTextParams = ({\n  text: ApiFormattedText[];\n} | {\n  chat: ApiChat;\n  messageIds: number[];\n}) & {\n  toLanguageCode: string;\n};\n\nlet onUpdate: OnApiUpdate;\n\nexport function init(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nexport async function fetchMessages({\n  chat,\n  threadId,\n  offsetId,\n  isSavedDialog,\n  ...pagination\n}: {\n  chat: ApiChat;\n  threadId?: ThreadId;\n  offsetId?: number;\n  isSavedDialog?: boolean;\n  addOffset?: number;\n  limit: number;\n}) {\n  const RequestClass = threadId === MAIN_THREAD_ID\n    ? GramJs.messages.GetHistory : isSavedDialog\n      ? GramJs.messages.GetSavedHistory : GramJs.messages.GetReplies;\n  let result;\n\n  try {\n    result = await invokeRequest(new RequestClass({\n      peer: buildInputPeer(chat.id, chat.accessHash),\n      ...(threadId !== MAIN_THREAD_ID && !isSavedDialog && {\n        msgId: Number(threadId),\n      }),\n      ...(offsetId && {\n        // Workaround for local message IDs overflowing some internal `Buffer` range check\n        offsetId: Math.min(offsetId, MAX_INT_32),\n      }),\n      ...pagination,\n    }), {\n      shouldThrow: true,\n      abortControllerChatId: chat.id,\n      abortControllerThreadId: threadId,\n    });\n  } catch (err: any) {\n    if (err.message === 'CHANNEL_PRIVATE') {\n      onUpdate({\n        '@type': 'updateChat',\n        id: chat.id,\n        chat: {\n          isRestricted: true,\n        },\n      });\n    }\n  }\n\n  if (\n    !result\n    || result instanceof GramJs.messages.MessagesNotModified\n    || !result.messages\n  ) {\n    return undefined;\n  }\n\n  updateLocalDb(result);\n\n  const messages = result.messages.map(buildApiMessage).filter(Boolean);\n  const users = result.users.map(buildApiUser).filter(Boolean);\n  const chats = result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean);\n  dispatchThreadInfoUpdates(result.messages);\n\n  return {\n    messages,\n    users,\n    chats,\n  };\n}\n\nexport async function fetchMessage({ chat, messageId }: { chat: ApiChat; messageId: number }) {\n  const isChannel = getEntityTypeById(chat.id) === 'channel';\n\n  let result;\n  try {\n    result = await invokeRequest(\n      isChannel\n        ? new GramJs.channels.GetMessages({\n          channel: buildInputEntity(chat.id, chat.accessHash) as GramJs.InputChannel,\n          id: [new GramJs.InputMessageID({ id: messageId })],\n        })\n        : new GramJs.messages.GetMessages({\n          id: [new GramJs.InputMessageID({ id: messageId })],\n        }),\n      {\n        shouldThrow: true,\n        abortControllerChatId: chat.id,\n      },\n    );\n  } catch (err: any) {\n    const { message } = err;\n\n    // When fetching messages for the bot @replies, there may be situations when the user was banned\n    // in the comment group or this group was deleted\n    if (message !== 'CHANNEL_PRIVATE') {\n      onUpdate({\n        '@type': 'error',\n        error: {\n          message,\n          isSlowMode: false,\n          hasErrorKey: true,\n        },\n      });\n    }\n  }\n\n  if (!result || result instanceof GramJs.messages.MessagesNotModified) {\n    return undefined;\n  }\n\n  if ('pts' in result) {\n    updateChannelState(chat.id, result.pts);\n  }\n\n  const mtpMessage = result.messages[0];\n  if (!mtpMessage) {\n    return undefined;\n  }\n\n  if (mtpMessage instanceof GramJs.MessageEmpty) {\n    return MESSAGE_DELETED;\n  }\n\n  const message = mtpMessage && buildApiMessage(mtpMessage);\n  dispatchThreadInfoUpdates([mtpMessage]);\n\n  if (!message) {\n    return undefined;\n  }\n\n  if (mtpMessage instanceof GramJs.Message) {\n    addMessageToLocalDb(mtpMessage);\n  }\n\n  const users = result.users.map(buildApiUser).filter(Boolean);\n\n  return { message, users };\n}\n\nlet mediaQueue = Promise.resolve();\n\nexport function sendMessage(\n  {\n    chat,\n    lastMessageId,\n    text,\n    entities,\n    replyInfo,\n    attachment,\n    sticker,\n    story,\n    gif,\n    poll,\n    contact,\n    isSilent,\n    scheduledAt,\n    groupedId,\n    noWebPage,\n    sendAs,\n    shouldUpdateStickerSetOrder,\n    wasDrafted,\n  }: {\n    chat: ApiChat;\n    lastMessageId?: number;\n    text?: string;\n    entities?: ApiMessageEntity[];\n    replyInfo?: ApiInputReplyInfo;\n    attachment?: ApiAttachment;\n    sticker?: ApiSticker;\n    story?: ApiStory | ApiStorySkipped;\n    gif?: ApiVideo;\n    poll?: ApiNewPoll;\n    contact?: ApiContact;\n    isSilent?: boolean;\n    scheduledAt?: number;\n    groupedId?: string;\n    noWebPage?: boolean;\n    sendAs?: ApiPeer;\n    shouldUpdateStickerSetOrder?: boolean;\n    wasDrafted?: boolean;\n  },\n  onProgress?: ApiOnProgress,\n) {\n  const localMessage = buildLocalMessage(\n    chat,\n    lastMessageId,\n    text,\n    entities,\n    replyInfo,\n    attachment,\n    sticker,\n    gif,\n    poll,\n    contact,\n    groupedId,\n    scheduledAt,\n    sendAs,\n    story,\n  );\n\n  onUpdate({\n    '@type': localMessage.isScheduled ? 'newScheduledMessage' : 'newMessage',\n    id: localMessage.id,\n    chatId: chat.id,\n    message: localMessage,\n    wasDrafted,\n  });\n\n  // This is expected to arrive after `updateMessageSendSucceeded` which replaces the local ID,\n  // so in most cases this will be simply ignored\n  const timeout = setTimeout(() => {\n    onUpdate({\n      '@type': localMessage.isScheduled ? 'updateScheduledMessage' : 'updateMessage',\n      id: localMessage.id,\n      chatId: chat.id,\n      message: {\n        sendingState: 'messageSendingStatePending',\n      },\n    });\n  }, FAST_SEND_TIMEOUT);\n\n  const randomId = generateRandomBigInt();\n\n  if (groupedId) {\n    return sendGroupedMedia({\n      chat,\n      text,\n      entities,\n      replyInfo,\n      attachment: attachment!,\n      groupedId,\n      isSilent,\n      scheduledAt,\n    }, randomId, localMessage, onProgress);\n  }\n\n  const messagePromise = (async () => {\n    let media: GramJs.TypeInputMedia | undefined;\n    if (attachment) {\n      try {\n        media = await uploadMedia(localMessage, attachment, onProgress!);\n      } catch (err) {\n        if (DEBUG) {\n          // eslint-disable-next-line no-console\n          console.warn(err);\n        }\n\n        await mediaQueue;\n\n        return;\n      }\n    } else if (sticker) {\n      media = buildInputMediaDocument(sticker);\n    } else if (gif) {\n      media = buildInputMediaDocument(gif);\n    } else if (poll) {\n      media = buildInputPoll(poll, randomId);\n    } else if (story) {\n      media = buildInputStory(story);\n    } else if (contact) {\n      media = new GramJs.InputMediaContact({\n        phoneNumber: contact.phoneNumber,\n        firstName: contact.firstName,\n        lastName: contact.lastName,\n        vcard: '',\n      });\n    }\n\n    const RequestClass = media ? GramJs.messages.SendMedia : GramJs.messages.SendMessage;\n\n    try {\n      const update = await invokeRequest(new RequestClass({\n        clearDraft: true,\n        message: text || '',\n        entities: entities ? entities.map(buildMtpMessageEntity) : undefined,\n        peer: buildInputPeer(chat.id, chat.accessHash),\n        randomId,\n        replyTo: replyInfo && buildInputReplyTo(replyInfo),\n        ...(isSilent && { silent: isSilent }),\n        ...(scheduledAt && { scheduleDate: scheduledAt }),\n        ...(media && { media }),\n        ...(noWebPage && { noWebpage: noWebPage }),\n        ...(sendAs && { sendAs: buildInputPeer(sendAs.id, sendAs.accessHash) }),\n        ...(shouldUpdateStickerSetOrder && { updateStickersetsOrder: shouldUpdateStickerSetOrder }),\n      }), {\n        shouldThrow: true,\n        shouldIgnoreUpdates: true,\n      });\n      if (update) handleLocalMessageUpdate(localMessage, update);\n    } catch (error: any) {\n      onUpdate({\n        '@type': 'updateMessageSendFailed',\n        chatId: chat.id,\n        localId: localMessage.id,\n        error: error.message,\n      });\n      clearTimeout(timeout);\n    }\n  })();\n\n  return messagePromise;\n}\n\nconst groupedUploads: Record<string, {\n  counter: number;\n  singleMediaByIndex: Record<number, GramJs.InputSingleMedia>;\n  localMessages: Record<string, ApiMessage>;\n}> = {};\n\nfunction sendGroupedMedia(\n  {\n    chat,\n    text,\n    entities,\n    replyInfo,\n    attachment,\n    groupedId,\n    isSilent,\n    scheduledAt,\n    sendAs,\n  }: {\n    chat: ApiChat;\n    text?: string;\n    entities?: ApiMessageEntity[];\n    replyInfo?: ApiInputReplyInfo;\n    attachment: ApiAttachment;\n    groupedId: string;\n    isSilent?: boolean;\n    scheduledAt?: number;\n    sendAs?: ApiPeer;\n  },\n  randomId: GramJs.long,\n  localMessage: ApiMessage,\n  onProgress?: ApiOnProgress,\n) {\n  let groupIndex = -1;\n  if (!groupedUploads[groupedId]) {\n    groupedUploads[groupedId] = {\n      counter: 0,\n      singleMediaByIndex: {},\n      localMessages: {},\n    };\n  }\n\n  groupIndex = groupedUploads[groupedId].counter++;\n\n  const prevMediaQueue = mediaQueue;\n  mediaQueue = (async () => {\n    let media;\n    try {\n      media = await uploadMedia(localMessage, attachment, onProgress!);\n    } catch (err) {\n      if (DEBUG) {\n        // eslint-disable-next-line no-console\n        console.warn(err);\n      }\n\n      groupedUploads[groupedId].counter--;\n\n      await prevMediaQueue;\n\n      return;\n    }\n\n    const inputMedia = await fetchInputMedia(\n      buildInputPeer(chat.id, chat.accessHash),\n      media as GramJs.InputMediaUploadedPhoto | GramJs.InputMediaUploadedDocument,\n    );\n\n    await prevMediaQueue;\n\n    if (!inputMedia) {\n      groupedUploads[groupedId].counter--;\n\n      if (DEBUG) {\n        // eslint-disable-next-line no-console\n        console.warn('Failed to upload grouped media');\n      }\n\n      return;\n    }\n\n    groupedUploads[groupedId].singleMediaByIndex[groupIndex] = new GramJs.InputSingleMedia({\n      media: inputMedia,\n      randomId,\n      message: text || '',\n      entities: entities ? entities.map(buildMtpMessageEntity) : undefined,\n    });\n    groupedUploads[groupedId].localMessages[randomId.toString()] = localMessage;\n\n    if (Object.keys(groupedUploads[groupedId].singleMediaByIndex).length < groupedUploads[groupedId].counter) {\n      return;\n    }\n\n    const { singleMediaByIndex, localMessages } = groupedUploads[groupedId];\n    delete groupedUploads[groupedId];\n\n    const update = await invokeRequest(new GramJs.messages.SendMultiMedia({\n      clearDraft: true,\n      peer: buildInputPeer(chat.id, chat.accessHash),\n      multiMedia: Object.values(singleMediaByIndex), // Object keys are usually ordered\n      replyTo: replyInfo && buildInputReplyTo(replyInfo),\n      ...(isSilent && { silent: isSilent }),\n      ...(scheduledAt && { scheduleDate: scheduledAt }),\n      ...(sendAs && { sendAs: buildInputPeer(sendAs.id, sendAs.accessHash) }),\n    }), {\n      shouldIgnoreUpdates: true,\n    });\n\n    if (update) handleMultipleLocalMessagesUpdate(localMessages, update);\n  })();\n\n  return mediaQueue;\n}\n\nasync function fetchInputMedia(\n  peer: GramJs.TypeInputPeer,\n  uploadedMedia: GramJs.InputMediaUploadedPhoto | GramJs.InputMediaUploadedDocument,\n) {\n  const messageMedia = await invokeRequest(new GramJs.messages.UploadMedia({\n    peer,\n    media: uploadedMedia,\n  }));\n  const isSpoiler = uploadedMedia.spoiler;\n\n  if ((\n    messageMedia instanceof GramJs.MessageMediaPhoto\n    && messageMedia.photo\n    && messageMedia.photo instanceof GramJs.Photo)\n  ) {\n    const { photo: { id, accessHash, fileReference } } = messageMedia;\n\n    return new GramJs.InputMediaPhoto({\n      id: new GramJs.InputPhoto({ id, accessHash, fileReference }),\n      spoiler: isSpoiler,\n    });\n  }\n\n  if ((\n    messageMedia instanceof GramJs.MessageMediaDocument\n    && messageMedia.document\n    && messageMedia.document instanceof GramJs.Document)\n  ) {\n    const { document: { id, accessHash, fileReference } } = messageMedia;\n\n    return new GramJs.InputMediaDocument({\n      id: new GramJs.InputDocument({ id, accessHash, fileReference }),\n      spoiler: isSpoiler,\n    });\n  }\n\n  return undefined;\n}\n\nexport async function editMessage({\n  chat,\n  message,\n  text,\n  entities,\n  attachment,\n  noWebPage,\n}: {\n  chat: ApiChat;\n  message: ApiMessage;\n  text: string;\n  entities?: ApiMessageEntity[];\n  attachment?: ApiAttachment;\n  noWebPage?: boolean;\n}, onProgress?: ApiOnProgress) {\n  const isScheduled = message.date * 1000 > Date.now() + getServerTimeOffset() * 1000;\n\n  const media = attachment && buildUploadingMedia(attachment);\n\n  const newContent = {\n    ...(media || message.content),\n    ...(text && {\n      text: {\n        text,\n        entities,\n      },\n    }),\n  };\n\n  const messageUpdate: Partial<ApiMessage> = {\n    ...message,\n    content: newContent,\n    emojiOnlyCount: getEmojiOnlyCountForMessage(newContent, message.groupedId),\n  };\n\n  onUpdate({\n    '@type': isScheduled ? 'updateScheduledMessage' : 'updateMessage',\n    id: message.id,\n    chatId: chat.id,\n    message: messageUpdate,\n  });\n\n  try {\n    let mediaUpdate: GramJs.TypeInputMedia | undefined;\n    if (attachment) {\n      mediaUpdate = await uploadMedia(message, attachment, onProgress!);\n    }\n\n    const mtpEntities = entities && entities.map(buildMtpMessageEntity);\n\n    await invokeRequest(new GramJs.messages.EditMessage({\n      message: text || '',\n      entities: mtpEntities,\n      media: mediaUpdate,\n      peer: buildInputPeer(chat.id, chat.accessHash),\n      id: message.id,\n      ...(isScheduled && { scheduleDate: message.date }),\n      ...(noWebPage && { noWebpage: noWebPage }),\n    }), { shouldThrow: true });\n  } catch (err) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn(err);\n    }\n\n    const { message: messageErr } = err as Error;\n\n    onUpdate({\n      '@type': 'error',\n      error: {\n        message: messageErr,\n        hasErrorKey: true,\n      },\n    });\n\n    // Rollback changes\n    onUpdate({\n      '@type': isScheduled ? 'updateScheduledMessage' : 'updateMessage',\n      id: message.id,\n      chatId: chat.id,\n      message,\n    });\n  }\n}\n\nexport async function rescheduleMessage({\n  chat,\n  message,\n  scheduledAt,\n}: {\n  chat: ApiChat;\n  message: ApiMessage;\n  scheduledAt: number;\n}) {\n  await invokeRequest(new GramJs.messages.EditMessage({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    id: message.id,\n    scheduleDate: scheduledAt,\n  }));\n}\n\nasync function uploadMedia(message: ApiMessage, attachment: ApiAttachment, onProgress: ApiOnProgress) {\n  const {\n    filename, blobUrl, mimeType, quick, voice, audio, previewBlobUrl, shouldSendAsFile, shouldSendAsSpoiler, ttlSeconds,\n  } = attachment;\n\n  const patchedOnProgress: ApiOnProgress = (progress) => {\n    if (onProgress.isCanceled) {\n      patchedOnProgress.isCanceled = true;\n    } else {\n      onProgress(progress, getMessageKey(message));\n    }\n  };\n\n  const fetchAndUpload = async (url: string, progressCallback?: (progress: number) => void) => {\n    const file = await fetchFile(url, filename);\n    return uploadFile(file, progressCallback);\n  };\n\n  const isVideo = SUPPORTED_VIDEO_CONTENT_TYPES.has(mimeType);\n  const shouldUploadThumb = audio || isVideo || shouldSendAsFile;\n\n  const [inputFile, thumb] = await Promise.all(compact([\n    fetchAndUpload(blobUrl, patchedOnProgress),\n    shouldUploadThumb && previewBlobUrl && fetchAndUpload(previewBlobUrl),\n  ]));\n\n  const attributes: GramJs.TypeDocumentAttribute[] = [new GramJs.DocumentAttributeFilename({ fileName: filename })];\n  if (!shouldSendAsFile) {\n    if (quick) {\n      if (SUPPORTED_IMAGE_CONTENT_TYPES.has(mimeType) && mimeType !== GIF_MIME_TYPE) {\n        return new GramJs.InputMediaUploadedPhoto({\n          file: inputFile,\n          spoiler: shouldSendAsSpoiler,\n        });\n      }\n\n      if (isVideo) {\n        const { width, height, duration } = quick;\n        if (duration !== undefined) {\n          attributes.push(new GramJs.DocumentAttributeVideo({\n            duration,\n            w: width,\n            h: height,\n            supportsStreaming: true,\n          }));\n        }\n      }\n    }\n\n    if (audio) {\n      const { duration, title, performer } = audio;\n      attributes.push(new GramJs.DocumentAttributeAudio({\n        duration,\n        title,\n        performer,\n      }));\n    }\n\n    if (voice) {\n      const { duration, waveform } = voice;\n      const { data: inputWaveform } = interpolateArray(waveform, INPUT_WAVEFORM_LENGTH);\n      attributes.push(new GramJs.DocumentAttributeAudio({\n        voice: true,\n        duration,\n        waveform: Buffer.from(inputWaveform),\n      }));\n    }\n  }\n\n  return new GramJs.InputMediaUploadedDocument({\n    file: inputFile,\n    mimeType,\n    attributes,\n    thumb,\n    forceFile: shouldSendAsFile,\n    spoiler: shouldSendAsSpoiler,\n    ttlSeconds,\n  });\n}\n\nexport async function pinMessage({\n  chat, messageId, isUnpin, isOneSide, isSilent,\n}: { chat: ApiChat; messageId: number; isUnpin: boolean; isOneSide?: boolean; isSilent?: boolean }) {\n  await invokeRequest(new GramJs.messages.UpdatePinnedMessage({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    id: messageId,\n    ...(isUnpin && { unpin: true }),\n    ...(isOneSide && { pmOneside: true }),\n    ...(isSilent && { silent: true }),\n  }));\n}\n\nexport async function unpinAllMessages({ chat, threadId }: { chat: ApiChat; threadId?: ThreadId }) {\n  const result = await invokeRequest(new GramJs.messages.UnpinAllMessages({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    ...(threadId && { topMsgId: Number(threadId) }),\n  }));\n\n  if (!result) return;\n\n  processAffectedHistory(chat, result);\n\n  if (result.offset) {\n    await unpinAllMessages({ chat, threadId });\n  }\n}\n\nexport async function deleteMessages({\n  chat, messageIds, shouldDeleteForAll,\n}: {\n  chat: ApiChat; messageIds: number[]; shouldDeleteForAll?: boolean;\n}) {\n  const isChannel = getEntityTypeById(chat.id) === 'channel';\n\n  const result = await invokeRequest(\n    isChannel\n      ? new GramJs.channels.DeleteMessages({\n        channel: buildInputEntity(chat.id, chat.accessHash) as GramJs.InputChannel,\n        id: messageIds,\n      })\n      : new GramJs.messages.DeleteMessages({\n        id: messageIds,\n        ...(shouldDeleteForAll && { revoke: true }),\n      }),\n  );\n\n  if (!result) {\n    return;\n  }\n\n  processAffectedHistory(chat, result);\n\n  onUpdate({\n    '@type': 'deleteMessages',\n    ids: messageIds,\n    ...(isChannel && { chatId: chat.id }),\n  });\n}\n\nexport function deleteScheduledMessages({\n  chat, messageIds,\n}: {\n  chat: ApiChat; messageIds: number[];\n}) {\n  invokeRequest(new GramJs.messages.DeleteScheduledMessages({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    id: messageIds,\n  }));\n}\n\nexport async function deleteHistory({\n  chat, shouldDeleteForAll,\n}: {\n  chat: ApiChat; shouldDeleteForAll?: boolean; maxId?: number;\n}) {\n  const isChannel = getEntityTypeById(chat.id) === 'channel';\n  const result = await invokeRequest(\n    isChannel\n      ? new GramJs.channels.DeleteHistory({\n        channel: buildInputEntity(chat.id, chat.accessHash) as GramJs.InputChannel,\n      })\n      : new GramJs.messages.DeleteHistory({\n        peer: buildInputPeer(chat.id, chat.accessHash),\n        ...(shouldDeleteForAll && { revoke: true }),\n        ...(!shouldDeleteForAll && { just_clear: true }),\n      }),\n  );\n\n  if (!result) {\n    return;\n  }\n\n  if ('offset' in result) {\n    processAffectedHistory(chat, result);\n\n    if (result.offset) {\n      await deleteHistory({ chat, shouldDeleteForAll });\n      return;\n    }\n  }\n\n  onUpdate({\n    '@type': 'deleteHistory',\n    chatId: chat.id,\n  });\n}\n\nexport async function deleteSavedHistory({\n  chat,\n}: {\n  chat: ApiChat;\n}) {\n  const result = await invokeRequest(new GramJs.messages.DeleteSavedHistory({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n  }));\n\n  if (!result) {\n    return;\n  }\n\n  processAffectedHistory(chat, result);\n\n  if (result.offset) {\n    await deleteSavedHistory({ chat });\n    return;\n  }\n\n  onUpdate({\n    '@type': 'deleteSavedHistory',\n    chatId: chat.id,\n  });\n}\n\nexport async function reportMessages({\n  peer, messageIds, reason, description,\n}: {\n  peer: ApiPeer; messageIds: number[]; reason: ApiReportReason; description?: string;\n}) {\n  const result = await invokeRequest(new GramJs.messages.Report({\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    id: messageIds,\n    reason: buildInputReportReason(reason),\n    message: description,\n  }));\n\n  return result;\n}\n\nexport async function sendMessageAction({\n  peer, threadId, action,\n}: {\n  peer: ApiPeer; threadId?: ThreadId; action: ApiSendMessageAction;\n}) {\n  const gramAction = buildSendMessageAction(action);\n  if (!gramAction) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('Unsupported message action', action);\n    }\n    return undefined;\n  }\n\n  try {\n    const result = await invokeRequest(new GramJs.messages.SetTyping({\n      peer: buildInputPeer(peer.id, peer.accessHash),\n      topMsgId: Number(threadId),\n      action: gramAction,\n    }), {\n      shouldThrow: true,\n      abortControllerChatId: peer.id,\n      abortControllerThreadId: threadId,\n    });\n    return result;\n  } catch (error) {\n    // Prevent error from being displayed in UI\n  }\n  return undefined;\n}\n\nexport async function markMessageListRead({\n  chat, threadId, maxId = 0,\n}: {\n  chat: ApiChat; threadId: ThreadId; maxId?: number;\n}) {\n  const isChannel = getEntityTypeById(chat.id) === 'channel';\n\n  // Workaround for local message IDs overflowing some internal `Buffer` range check\n  const fixedMaxId = Math.min(maxId, MAX_INT_32);\n  if (isChannel && threadId === MAIN_THREAD_ID) {\n    await invokeRequest(new GramJs.channels.ReadHistory({\n      channel: buildInputEntity(chat.id, chat.accessHash) as GramJs.InputChannel,\n      maxId: fixedMaxId,\n    }));\n  } else if (isChannel) {\n    await invokeRequest(new GramJs.messages.ReadDiscussion({\n      peer: buildInputPeer(chat.id, chat.accessHash),\n      msgId: Number(threadId),\n      readMaxId: fixedMaxId,\n    }));\n  } else {\n    const result = await invokeRequest(new GramJs.messages.ReadHistory({\n      peer: buildInputPeer(chat.id, chat.accessHash),\n      maxId: fixedMaxId,\n    }));\n\n    if (result) {\n      processAffectedHistory(chat, result);\n    }\n  }\n\n  if (threadId === MAIN_THREAD_ID) {\n    void requestChatUpdate({ chat, noLastMessage: true });\n  }\n}\n\nexport async function markMessagesRead({\n  chat, messageIds,\n}: {\n  chat: ApiChat; messageIds: number[];\n}) {\n  const isChannel = getEntityTypeById(chat.id) === 'channel';\n\n  const result = await invokeRequest(\n    isChannel\n      ? new GramJs.channels.ReadMessageContents({\n        channel: buildInputEntity(chat.id, chat.accessHash) as GramJs.InputChannel,\n        id: messageIds,\n      })\n      : new GramJs.messages.ReadMessageContents({\n        id: messageIds,\n      }),\n  );\n\n  if (!result) {\n    return;\n  }\n\n  if (result !== true) {\n    processAffectedHistory(chat, result);\n  }\n\n  onUpdate({\n    ...(isChannel ? {\n      '@type': 'updateChannelMessages',\n      channelId: chat.id,\n    } : {\n      '@type': 'updateCommonBoxMessages',\n    }),\n    ids: messageIds,\n    messageUpdate: {\n      hasUnreadMention: false,\n      isMediaUnread: false,\n    },\n  });\n}\n\nexport async function fetchMessageViews({\n  chat, ids, shouldIncrement,\n}: {\n  chat: ApiChat;\n  ids: number[];\n  shouldIncrement?: boolean;\n}) {\n  const chunks = split(ids, API_GENERAL_ID_LIMIT);\n  const results = await Promise.all(chunks.map((chunkIds) => (\n    invokeRequest(new GramJs.messages.GetMessagesViews({\n      peer: buildInputPeer(chat.id, chat.accessHash),\n      id: chunkIds,\n      increment: shouldIncrement,\n    }))\n  )));\n\n  if (!results || results.find((result) => !result)) return undefined;\n\n  const viewsList = results.flatMap((result) => result!.views);\n  const users = results.flatMap((result) => result!.users);\n  const chats = results.flatMap((result) => result!.chats);\n\n  const viewsInfo = ids.map((id, index) => {\n    const { views, forwards, replies } = viewsList[index];\n    return {\n      id,\n      views,\n      forwards,\n      threadInfo: replies ? buildApiThreadInfo(replies, id, chat.id) : undefined,\n    };\n  });\n\n  return {\n    viewsInfo,\n    users: users.map(buildApiUser).filter(Boolean),\n    chats: chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean),\n  };\n}\n\nexport async function fetchDiscussionMessage({\n  chat, messageId,\n}: {\n  chat: ApiChat;\n  messageId: number;\n}) {\n  const [result, replies] = await Promise.all([\n    invokeRequest(new GramJs.messages.GetDiscussionMessage({\n      peer: buildInputPeer(chat.id, chat.accessHash),\n      msgId: messageId,\n    }), {\n      abortControllerChatId: chat.id,\n      abortControllerThreadId: messageId,\n    }),\n    fetchMessages({\n      chat,\n      threadId: messageId,\n      offsetId: 1,\n      addOffset: -1,\n      limit: 1,\n    }),\n  ]);\n\n  if (!result || !replies) return undefined;\n\n  updateLocalDb(result);\n\n  const chats = result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean)\n    .concat(replies.chats);\n  const users = result.users.map(buildApiUser).filter(Boolean)\n    .concat(replies.users);\n  const topMessages = result.messages.map(buildApiMessage).filter(Boolean);\n  const messages = topMessages.concat(replies.messages);\n  const threadId = result.messages[result.messages.length - 1]?.id;\n\n  if (!threadId) return undefined;\n\n  dispatchThreadInfoUpdates(result.messages);\n\n  const {\n    unreadCount, maxId, readInboxMaxId, readOutboxMaxId,\n  } = result;\n\n  return {\n    chats,\n    users,\n    messages,\n    topMessages,\n    unreadCount,\n    threadId,\n    lastReadInboxMessageId: readInboxMaxId,\n    lastReadOutboxMessageId: readOutboxMaxId,\n    lastMessageId: maxId,\n    chatId: topMessages[0]?.chatId,\n    firstMessageId: replies.messages[0]?.id,\n  };\n}\n\nexport async function searchMessagesLocal({\n  chat, isSavedDialog, savedTag, type, query, threadId, minDate, maxDate, ...pagination\n}: {\n  chat: ApiChat;\n  isSavedDialog?: boolean;\n  savedTag?: ApiReaction;\n  type?: ApiMessageSearchType | ApiGlobalMessageSearchType;\n  query?: string;\n  threadId?: ThreadId;\n  offsetId?: number;\n  addOffset?: number;\n  limit: number;\n  minDate?: number;\n  maxDate?: number;\n}) {\n  let filter;\n  switch (type) {\n    case 'media':\n      filter = new GramJs.InputMessagesFilterPhotoVideo();\n      break;\n    case 'documents':\n      filter = new GramJs.InputMessagesFilterDocument();\n      break;\n    case 'links':\n      filter = new GramJs.InputMessagesFilterUrl();\n      break;\n    case 'audio':\n      filter = new GramJs.InputMessagesFilterMusic();\n      break;\n    case 'voice':\n      filter = new GramJs.InputMessagesFilterRoundVoice();\n      break;\n    case 'profilePhoto':\n      filter = new GramJs.InputMessagesFilterChatPhotos();\n      break;\n    case 'text':\n    default: {\n      filter = new GramJs.InputMessagesFilterEmpty();\n    }\n  }\n\n  const peer = buildInputPeer(chat.id, chat.accessHash);\n\n  const result = await invokeRequest(new GramJs.messages.Search({\n    peer: isSavedDialog ? new GramJs.InputPeerSelf() : peer,\n    savedPeerId: isSavedDialog ? peer : undefined,\n    savedReaction: savedTag && [buildInputReaction(savedTag)],\n    topMsgId: threadId !== MAIN_THREAD_ID && !isSavedDialog ? Number(threadId) : undefined,\n    filter,\n    q: query || '',\n    minDate,\n    maxDate,\n    ...pagination,\n  }), {\n    abortControllerChatId: chat.id,\n    abortControllerThreadId: threadId,\n  });\n\n  if (\n    !result\n    || result instanceof GramJs.messages.MessagesNotModified\n    || !result.messages\n  ) {\n    return undefined;\n  }\n\n  updateLocalDb(result);\n\n  const chats = result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean);\n  const users = result.users.map(buildApiUser).filter(Boolean);\n  const messages = result.messages.map(buildApiMessage).filter(Boolean);\n  dispatchThreadInfoUpdates(result.messages);\n\n  let totalCount = messages.length;\n  let nextOffsetId: number | undefined;\n  if (result instanceof GramJs.messages.MessagesSlice || result instanceof GramJs.messages.ChannelMessages) {\n    totalCount = result.count;\n\n    if (messages.length) {\n      nextOffsetId = messages[messages.length - 1].id;\n    }\n  }\n\n  return {\n    chats,\n    users,\n    messages,\n    totalCount,\n    nextOffsetId,\n  };\n}\n\nexport async function searchMessagesGlobal({\n  query, offsetRate = 0, limit, type = 'text', minDate, maxDate,\n}: {\n  query: string;\n  offsetRate?: number;\n  limit: number;\n  type?: ApiGlobalMessageSearchType;\n  minDate?: number;\n  maxDate?: number;\n}) {\n  let filter;\n  switch (type) {\n    case 'media':\n      filter = new GramJs.InputMessagesFilterPhotoVideo();\n      break;\n    case 'documents':\n      filter = new GramJs.InputMessagesFilterDocument();\n      break;\n    case 'links':\n      filter = new GramJs.InputMessagesFilterUrl();\n      break;\n    case 'audio':\n      filter = new GramJs.InputMessagesFilterMusic();\n      break;\n    case 'voice':\n      filter = new GramJs.InputMessagesFilterRoundVoice();\n      break;\n    case 'text':\n    default: {\n      if (!query && !(maxDate && minDate)) {\n        return undefined;\n      }\n\n      filter = new GramJs.InputMessagesFilterEmpty();\n    }\n  }\n\n  const result = await invokeRequest(new GramJs.messages.SearchGlobal({\n    q: query,\n    offsetRate,\n    offsetPeer: new GramJs.InputPeerEmpty(),\n    limit,\n    filter,\n    folderId: ALL_FOLDER_ID,\n    minDate,\n    maxDate,\n  }));\n\n  if (\n    !result\n    || result instanceof GramJs.messages.MessagesNotModified\n    || !result.messages\n  ) {\n    return undefined;\n  }\n\n  updateLocalDb({\n    chats: result.chats,\n    users: result.users,\n    messages: result.messages,\n  } as GramJs.messages.Messages);\n\n  const chats = result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean);\n  const users = result.users.map(buildApiUser).filter(Boolean);\n  const messages = result.messages.map(buildApiMessage).filter(Boolean);\n  dispatchThreadInfoUpdates(result.messages);\n\n  let totalCount = messages.length;\n  let nextRate: number | undefined;\n  if (result instanceof GramJs.messages.MessagesSlice || result instanceof GramJs.messages.ChannelMessages) {\n    totalCount = result.count;\n\n    if (messages.length) {\n      nextRate = messages[messages.length - 1].id;\n    }\n  }\n\n  return {\n    messages,\n    users,\n    chats,\n    totalCount,\n    nextRate: 'nextRate' in result && result.nextRate ? result.nextRate : nextRate,\n  };\n}\n\nexport async function fetchWebPagePreview({\n  text,\n}: {\n  text: ApiFormattedText;\n}) {\n  const textWithEntities = buildInputTextWithEntities(text);\n  const preview = await invokeRequest(new GramJs.messages.GetWebPagePreview({\n    message: textWithEntities.text,\n    entities: textWithEntities.entities,\n  }));\n\n  return preview && buildWebPage(preview);\n}\n\nexport async function sendPollVote({\n  chat, messageId, options,\n}: {\n  chat: ApiChat;\n  messageId: number;\n  options: string[];\n}) {\n  const { id, accessHash } = chat;\n\n  await invokeRequest(new GramJs.messages.SendVote({\n    peer: buildInputPeer(id, accessHash),\n    msgId: messageId,\n    options: options.map(deserializeBytes),\n  }));\n}\n\nexport async function closePoll({\n  chat, messageId, poll,\n}: {\n  chat: ApiChat;\n  messageId: number;\n  poll: ApiPoll;\n}) {\n  const { id, accessHash } = chat;\n\n  await invokeRequest(new GramJs.messages.EditMessage({\n    peer: buildInputPeer(id, accessHash),\n    id: messageId,\n    media: buildInputPollFromExisting(poll, true),\n  }));\n}\n\nexport async function loadPollOptionResults({\n  chat, messageId, option, offset, limit, shouldResetVoters,\n}: {\n  chat: ApiChat;\n  messageId: number;\n  option?: string;\n  offset?: string;\n  limit?: number;\n  shouldResetVoters?: boolean;\n}) {\n  const { id, accessHash } = chat;\n\n  const result = await invokeRequest(new GramJs.messages.GetPollVotes({\n    peer: buildInputPeer(id, accessHash),\n    id: messageId,\n    ...(option && { option: deserializeBytes(option) }),\n    ...(offset && { offset }),\n    ...(limit && { limit }),\n  }));\n\n  if (!result) {\n    return undefined;\n  }\n\n  updateLocalDb({\n    chats: result.chats,\n    users: result.users,\n    messages: [] as GramJs.Message[],\n  } as GramJs.messages.Messages);\n\n  const users = result.users.map(buildApiUser).filter(Boolean);\n  const chats = result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean);\n  const votes = result.votes.map((vote) => ({\n    peerId: getApiChatIdFromMtpPeer(vote.peer),\n    date: vote.date,\n  }));\n\n  return {\n    count: result.count,\n    votes,\n    chats,\n    users,\n    nextOffset: result.nextOffset,\n    shouldResetVoters,\n  };\n}\n\nexport async function fetchExtendedMedia({\n  chat, ids,\n}: {\n  chat: ApiChat;\n  ids: number[];\n}) {\n  await invokeRequest(new GramJs.messages.GetExtendedMedia({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    id: ids,\n  }));\n}\n\nexport async function forwardMessages({\n  fromChat,\n  toChat,\n  toThreadId,\n  messages,\n  isSilent,\n  scheduledAt,\n  sendAs,\n  withMyScore,\n  noAuthors,\n  noCaptions,\n  isCurrentUserPremium,\n  wasDrafted,\n  lastMessageId,\n}: {\n  fromChat: ApiChat;\n  toChat: ApiChat;\n  toThreadId?: ThreadId;\n  messages: ApiMessage[];\n  isSilent?: boolean;\n  scheduledAt?: number;\n  sendAs?: ApiPeer;\n  withMyScore?: boolean;\n  noAuthors?: boolean;\n  noCaptions?: boolean;\n  isCurrentUserPremium?: boolean;\n  wasDrafted?: boolean;\n  lastMessageId?: number;\n}) {\n  const messageIds = messages.map(({ id }) => id);\n  const randomIds = messages.map(generateRandomBigInt);\n  const localMessages: Record<string, ApiMessage> = {};\n\n  messages.forEach((message, index) => {\n    const localMessage = buildLocalForwardedMessage({\n      toChat,\n      toThreadId: Number(toThreadId),\n      message,\n      scheduledAt,\n      noAuthors,\n      noCaptions,\n      isCurrentUserPremium,\n      lastMessageId,\n    });\n    localMessages[randomIds[index].toString()] = localMessage;\n\n    onUpdate({\n      '@type': localMessage.isScheduled ? 'newScheduledMessage' : 'newMessage',\n      id: localMessage.id,\n      chatId: toChat.id,\n      message: localMessage,\n      wasDrafted,\n    });\n  });\n\n  try {\n    const update = await invokeRequest(new GramJs.messages.ForwardMessages({\n      fromPeer: buildInputPeer(fromChat.id, fromChat.accessHash),\n      toPeer: buildInputPeer(toChat.id, toChat.accessHash),\n      randomId: randomIds,\n      id: messageIds,\n      withMyScore: withMyScore || undefined,\n      silent: isSilent || undefined,\n      dropAuthor: noAuthors || undefined,\n      dropMediaCaptions: noCaptions || undefined,\n      ...(toThreadId && { topMsgId: Number(toThreadId) }),\n      ...(scheduledAt && { scheduleDate: scheduledAt }),\n      ...(sendAs && { sendAs: buildInputPeer(sendAs.id, sendAs.accessHash) }),\n    }), {\n      shouldThrow: true,\n      shouldIgnoreUpdates: true,\n    });\n    if (update) handleMultipleLocalMessagesUpdate(localMessages, update);\n  } catch (error: any) {\n    Object.values(localMessages).forEach((localMessage) => {\n      onUpdate({\n        '@type': 'updateMessageSendFailed',\n        chatId: toChat.id,\n        localId: localMessage.id,\n        error: error.message,\n      });\n    });\n  }\n}\n\nexport async function findFirstMessageIdAfterDate({\n  chat,\n  timestamp,\n}: {\n  chat: ApiChat;\n  timestamp: number;\n}) {\n  const result = await invokeRequest(new GramJs.messages.GetHistory({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    offsetDate: timestamp,\n    addOffset: -1,\n    limit: 1,\n  }));\n\n  if (\n    !result\n    || result instanceof GramJs.messages.MessagesNotModified\n    || !result.messages || !result.messages.length\n  ) {\n    return undefined;\n  }\n\n  return result.messages[0].id;\n}\n\nexport async function fetchScheduledHistory({ chat }: { chat: ApiChat }) {\n  const { id, accessHash } = chat;\n\n  const result = await invokeRequest(new GramJs.messages.GetScheduledHistory({\n    peer: buildInputPeer(id, accessHash),\n  }), {\n    abortControllerChatId: id,\n  });\n\n  if (\n    !result\n    || result instanceof GramJs.messages.MessagesNotModified\n    || !result.messages\n  ) {\n    return undefined;\n  }\n\n  updateLocalDb(result);\n\n  const messages = result.messages.map(buildApiMessage).filter(Boolean);\n  dispatchThreadInfoUpdates(result.messages);\n\n  return {\n    messages,\n  };\n}\n\nexport async function sendScheduledMessages({ chat, ids }: { chat: ApiChat; ids: number[] }) {\n  const { id, accessHash } = chat;\n\n  await invokeRequest(new GramJs.messages.SendScheduledMessages({\n    peer: buildInputPeer(id, accessHash),\n    id: ids,\n  }));\n}\n\nfunction updateLocalDb(result: (\n  GramJs.messages.MessagesSlice | GramJs.messages.Messages | GramJs.messages.ChannelMessages |\n  GramJs.messages.DiscussionMessage | GramJs.messages.SponsoredMessages\n)) {\n  addEntitiesToLocalDb(result.users);\n  addEntitiesToLocalDb(result.chats);\n\n  result.messages.forEach((message) => {\n    if ((message instanceof GramJs.Message && isMessageWithMedia(message))\n      || (message instanceof GramJs.MessageService && isServiceMessageWithMedia(message))\n    ) {\n      addMessageToLocalDb(message);\n    }\n  });\n}\n\nexport async function fetchPinnedMessages({ chat, threadId }: { chat: ApiChat; threadId: ThreadId }) {\n  const result = await invokeRequest(new GramJs.messages.Search(\n    {\n      peer: buildInputPeer(chat.id, chat.accessHash),\n      filter: new GramJs.InputMessagesFilterPinned(),\n      q: '',\n      limit: PINNED_MESSAGES_LIMIT,\n      topMsgId: Number(threadId),\n    },\n  ), {\n    abortControllerChatId: chat.id,\n    abortControllerThreadId: threadId,\n  });\n\n  if (\n    !result\n    || result instanceof GramJs.messages.MessagesNotModified\n    || !result.messages\n  ) {\n    return undefined;\n  }\n\n  updateLocalDb(result);\n\n  const chats = result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean);\n  const users = result.users.map(buildApiUser).filter(Boolean);\n  const messages = result.messages.map(buildApiMessage).filter(Boolean);\n  dispatchThreadInfoUpdates(result.messages);\n\n  return {\n    messages,\n    users,\n    chats,\n  };\n}\n\nexport async function fetchSeenBy({ chat, messageId }: { chat: ApiChat; messageId: number }) {\n  const result = await invokeRequest(new GramJs.messages.GetMessageReadParticipants({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    msgId: messageId,\n  }));\n\n  return result\n    ? result.reduce((acc, readDate) => {\n      acc[readDate.userId.toString()] = readDate.date;\n\n      return acc;\n    }, {} as Record<string, number>)\n    : undefined;\n}\n\nexport async function fetchSendAs({\n  chat,\n}: {\n  chat: ApiChat;\n}) {\n  const result = await invokeRequest(new GramJs.channels.GetSendAs({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n  }), {\n    shouldIgnoreErrors: true,\n    abortControllerChatId: chat.id,\n  });\n\n  if (!result) {\n    return undefined;\n  }\n\n  addEntitiesToLocalDb(result.users);\n  addEntitiesToLocalDb(result.chats);\n\n  const users = result.users.map(buildApiUser).filter(Boolean);\n  const chats = result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean);\n\n  return {\n    users,\n    chats,\n    sendAs: result.peers.map(buildApiSendAsPeerId),\n  };\n}\n\nexport function saveDefaultSendAs({\n  sendAs, chat,\n}: {\n  sendAs: ApiPeer; chat: ApiChat;\n}) {\n  return invokeRequest(new GramJs.messages.SaveDefaultSendAs({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    sendAs: buildInputPeer(sendAs.id, sendAs.accessHash),\n  }));\n}\n\nexport async function fetchSponsoredMessages({ chat }: { chat: ApiChat }) {\n  const result = await invokeRequest(new GramJs.channels.GetSponsoredMessages({\n    channel: buildInputPeer(chat.id, chat.accessHash),\n  }));\n\n  if (!result || result instanceof GramJs.messages.SponsoredMessagesEmpty || !result.messages.length) {\n    return undefined;\n  }\n\n  updateLocalDb(result);\n\n  const messages = result.messages.map(buildApiSponsoredMessage).filter(Boolean);\n  const users = result.users.map(buildApiUser).filter(Boolean);\n  const chats = result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean);\n\n  return {\n    messages,\n    users,\n    chats,\n  };\n}\n\nexport async function viewSponsoredMessage({ chat, random }: { chat: ApiChat; random: string }) {\n  await invokeRequest(new GramJs.channels.ViewSponsoredMessage({\n    channel: buildInputPeer(chat.id, chat.accessHash),\n    randomId: deserializeBytes(random),\n  }));\n}\n\nexport function clickSponsoredMessage({ chat, random }: { chat: ApiChat; random: string }) {\n  return invokeRequest(new GramJs.channels.ClickSponsoredMessage({\n    channel: buildInputPeer(chat.id, chat.accessHash),\n    randomId: deserializeBytes(random),\n  }));\n}\n\nexport async function readAllMentions({\n  chat,\n}: {\n  chat: ApiChat;\n}) {\n  const result = await invokeRequest(new GramJs.messages.ReadMentions({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n  }));\n\n  if (!result) return;\n\n  processAffectedHistory(chat, result);\n\n  if (result.offset) {\n    await readAllMentions({ chat });\n  }\n}\n\nexport async function readAllReactions({\n  chat,\n}: {\n  chat: ApiChat;\n}) {\n  const result = await invokeRequest(new GramJs.messages.ReadReactions({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n  }));\n\n  if (!result) return;\n\n  processAffectedHistory(chat, result);\n\n  if (result.offset) {\n    await readAllReactions({ chat });\n  }\n}\n\nexport async function fetchUnreadMentions({\n  chat, ...pagination\n}: {\n  chat: ApiChat;\n  offsetId?: number;\n  addOffset?: number;\n  maxId?: number;\n  minId?: number;\n}) {\n  const result = await invokeRequest(new GramJs.messages.GetUnreadMentions({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    limit: MENTION_UNREAD_SLICE,\n    ...pagination,\n  }));\n\n  if (\n    !result\n    || result instanceof GramJs.messages.MessagesNotModified\n    || !result.messages\n  ) {\n    return undefined;\n  }\n\n  updateLocalDb(result);\n\n  const messages = result.messages.map(buildApiMessage).filter(Boolean);\n  dispatchThreadInfoUpdates(result.messages);\n  const users = result.users.map(buildApiUser).filter(Boolean);\n  const chats = result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean);\n\n  return {\n    messages,\n    users,\n    chats,\n  };\n}\n\nexport async function fetchUnreadReactions({\n  chat, ...pagination\n}: {\n  chat: ApiChat;\n  offsetId?: number;\n  addOffset?: number;\n  maxId?: number;\n  minId?: number;\n}) {\n  const result = await invokeRequest(new GramJs.messages.GetUnreadReactions({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    limit: REACTION_UNREAD_SLICE,\n    ...pagination,\n  }));\n\n  if (\n    !result\n    || result instanceof GramJs.messages.MessagesNotModified\n    || !result.messages\n  ) {\n    return undefined;\n  }\n\n  updateLocalDb(result);\n\n  const messages = result.messages.map(buildApiMessage).filter(Boolean);\n  dispatchThreadInfoUpdates(result.messages);\n  const users = result.users.map(buildApiUser).filter(Boolean);\n  const chats = result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean);\n\n  return {\n    messages,\n    users,\n    chats,\n  };\n}\n\nexport async function transcribeAudio({\n  chat, messageId,\n}: {\n  chat: ApiChat; messageId: number;\n}) {\n  const result = await invokeRequest(new GramJs.messages.TranscribeAudio({\n    msgId: messageId,\n    peer: buildInputPeer(chat.id, chat.accessHash),\n  }));\n\n  if (!result) return undefined;\n\n  onUpdate({\n    '@type': 'updateTranscribedAudio',\n    isPending: result.pending,\n    transcriptionId: result.transcriptionId.toString(),\n    text: result.text,\n  });\n\n  return result.transcriptionId.toString();\n}\n\nexport async function translateText(params: TranslateTextParams) {\n  let result;\n  const isMessageTranslation = 'chat' in params;\n  if (isMessageTranslation) {\n    const { chat, messageIds, toLanguageCode } = params;\n    result = await invokeRequest(new GramJs.messages.TranslateText({\n      peer: buildInputPeer(chat.id, chat.accessHash),\n      id: messageIds,\n      toLang: toLanguageCode,\n    }));\n  } else {\n    const { text, toLanguageCode } = params;\n    result = await invokeRequest(new GramJs.messages.TranslateText({\n      text: text.map((t) => buildInputTextWithEntities(t)),\n      toLang: toLanguageCode,\n    }));\n  }\n\n  if (!result) return undefined;\n\n  const formattedText = result.result.map((r) => buildApiFormattedText(r));\n\n  if (isMessageTranslation) {\n    onUpdate({\n      '@type': 'updateMessageTranslations',\n      chatId: params.chat.id,\n      messageIds: params.messageIds,\n      translations: formattedText,\n      toLanguageCode: params.toLanguageCode,\n    });\n  }\n\n  return formattedText;\n}\n\nfunction handleMultipleLocalMessagesUpdate(\n  localMessages: Record<string, ApiMessage>, update: GramJs.TypeUpdates,\n) {\n  if (!('updates' in update)) {\n    handleGramJsUpdate(update);\n    return;\n  }\n\n  update.updates.forEach((u) => {\n    if (u instanceof GramJs.UpdateMessageID) {\n      const localMessage = localMessages[u.randomId.toString()];\n      handleLocalMessageUpdate(localMessage, u);\n    } else {\n      handleGramJsUpdate(u);\n    }\n  });\n}\n\nfunction handleLocalMessageUpdate(localMessage: ApiMessage, update: GramJs.TypeUpdates) {\n  let messageUpdate;\n  if (update instanceof GramJs.UpdateShortSentMessage || update instanceof GramJs.UpdateMessageID) {\n    messageUpdate = update;\n  } else if ('updates' in update) {\n    messageUpdate = update.updates.find((u): u is GramJs.UpdateMessageID => u instanceof GramJs.UpdateMessageID);\n  }\n\n  if (!messageUpdate) {\n    handleGramJsUpdate(update);\n    return;\n  }\n\n  let newContent: MediaContent | undefined;\n  if (messageUpdate instanceof GramJs.UpdateShortSentMessage) {\n    if (localMessage.content.text && messageUpdate.entities) {\n      newContent = {\n        text: buildMessageTextContent(localMessage.content.text.text, messageUpdate.entities),\n      };\n    }\n    if (messageUpdate.media) {\n      newContent = {\n        ...newContent,\n        ...buildMessageMediaContent(messageUpdate.media),\n      };\n    }\n\n    const mtpMessage = buildMessageFromUpdate(messageUpdate.id, localMessage.chatId, messageUpdate);\n    if (isMessageWithMedia(mtpMessage)) {\n      addMessageToLocalDb(mtpMessage);\n    }\n  }\n\n  // Edge case for \"Send When Online\"\n  const isSentBefore = 'date' in messageUpdate && messageUpdate.date * 1000 < Date.now() + getServerTimeOffset() * 1000;\n\n  onUpdate({\n    '@type': localMessage.isScheduled && !isSentBefore\n      ? 'updateScheduledMessageSendSucceeded'\n      : 'updateMessageSendSucceeded',\n    chatId: localMessage.chatId,\n    localId: localMessage.id,\n    message: {\n      ...localMessage,\n      ...(newContent && {\n        content: {\n          ...localMessage.content,\n          ...newContent,\n        },\n      }),\n      id: messageUpdate.id,\n      sendingState: undefined,\n      ...('date' in messageUpdate && { date: messageUpdate.date }),\n    },\n  });\n\n  handleGramJsUpdate(update);\n}\n\nexport async function fetchOutboxReadDate({ chat, messageId }: { chat: ApiChat; messageId: number }) {\n  const { id, accessHash } = chat;\n  const peer = buildInputPeer(id, accessHash);\n\n  const result = await invokeRequest(new GramJs.messages.GetOutboxReadDate({\n    peer: peer as GramJs.TypeInputPeer,\n    msgId: messageId,\n  }), { shouldThrow: true });\n\n  if (!result) return undefined;\n\n  return { date: result.date };\n}\n","import type { ApiMessage } from '../api/types';\n\nexport type MessageKey = `msg${string}-${number}`;\n\nexport function getMessageKey(message: ApiMessage): MessageKey {\n  const { chatId, id, previousLocalId } = message;\n\n  return buildMessageKey(chatId, previousLocalId || id);\n}\n\nfunction buildMessageKey(chatId: string, msgId: number): MessageKey {\n  return `msg${chatId}-${msgId}`;\n}\n\nexport function parseMessageKey(key: MessageKey) {\n  const match = key.match(/^msg(-?\\d+)-(\\d+)/)!;\n\n  return { chatId: match[1], messageId: Number(match[2]) };\n}\n","import BigInt from 'big-integer';\nimport { Api as GramJs } from '../../../lib/gramjs';\n\nimport type {\n  ApiChat, ApiPeer, ApiSticker,\n  ApiUser, OnApiUpdate,\n} from '../../types';\n\nimport { COMMON_CHATS_LIMIT, PROFILE_PHOTOS_LIMIT } from '../../../config';\nimport { buildApiChatFromPreview } from '../apiBuilders/chats';\nimport { buildApiPhoto } from '../apiBuilders/common';\nimport { buildApiPeerId } from '../apiBuilders/peers';\nimport { buildApiUser, buildApiUserFullInfo, buildApiUsersAndStatuses } from '../apiBuilders/users';\nimport {\n  buildInputContact,\n  buildInputEmojiStatus,\n  buildInputEntity,\n  buildInputPeer,\n  buildMtpPeerId,\n  getEntityTypeById,\n} from '../gramjsBuilders';\nimport { addEntitiesToLocalDb, addPhotoToLocalDb, addUserToLocalDb } from '../helpers';\nimport localDb from '../localDb';\nimport { invokeRequest } from './client';\nimport { searchMessagesLocal } from './messages';\n\nlet onUpdate: OnApiUpdate;\n\nexport function init(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nexport async function fetchFullUser({\n  id,\n  accessHash,\n}: {\n  id: string;\n  accessHash?: string;\n}) {\n  const input = buildInputEntity(id, accessHash);\n  if (!(input instanceof GramJs.InputUser)) {\n    return undefined;\n  }\n\n  const result = await invokeRequest(new GramJs.users.GetFullUser({ id: input }));\n\n  if (!result) {\n    return undefined;\n  }\n\n  updateLocalDb(result);\n  addEntitiesToLocalDb(result.users);\n\n  if (result.fullUser.profilePhoto instanceof GramJs.Photo) {\n    localDb.photos[result.fullUser.profilePhoto.id.toString()] = result.fullUser.profilePhoto;\n  }\n\n  if (result.fullUser.personalPhoto instanceof GramJs.Photo) {\n    localDb.photos[result.fullUser.personalPhoto.id.toString()] = result.fullUser.personalPhoto;\n  }\n\n  if (result.fullUser.fallbackPhoto instanceof GramJs.Photo) {\n    localDb.photos[result.fullUser.fallbackPhoto.id.toString()] = result.fullUser.fallbackPhoto;\n  }\n\n  const botInfo = result.fullUser.botInfo;\n  if (botInfo?.descriptionPhoto instanceof GramJs.Photo) {\n    localDb.photos[botInfo.descriptionPhoto.id.toString()] = botInfo.descriptionPhoto;\n  }\n  if (botInfo?.descriptionDocument instanceof GramJs.Document) {\n    localDb.documents[botInfo.descriptionDocument.id.toString()] = botInfo.descriptionDocument;\n  }\n\n  const fullInfo = buildApiUserFullInfo(result);\n  const user = buildApiUser(result.users[0])!;\n\n  onUpdate({\n    '@type': 'updateUser',\n    id,\n    user: {\n      ...user,\n      avatarHash: user?.avatarHash || undefined,\n    },\n    fullInfo,\n  });\n\n  return { user, fullInfo };\n}\n\nexport async function fetchCommonChats(id: string, accessHash?: string, maxId?: string) {\n  const commonChats = await invokeRequest(new GramJs.messages.GetCommonChats({\n    userId: buildInputEntity(id, accessHash) as GramJs.InputUser,\n    maxId: maxId ? buildMtpPeerId(maxId, getEntityTypeById(maxId)) : undefined,\n    limit: COMMON_CHATS_LIMIT,\n  }));\n\n  if (!commonChats) {\n    return undefined;\n  }\n\n  updateLocalDb(commonChats);\n\n  const chatIds: string[] = [];\n  const chats: ApiChat[] = [];\n\n  commonChats.chats.forEach((mtpChat) => {\n    const chat = buildApiChatFromPreview(mtpChat);\n\n    if (chat) {\n      chats.push(chat);\n      chatIds.push(chat.id);\n    }\n  });\n\n  return { chats, chatIds, isFullyLoaded: chatIds.length < COMMON_CHATS_LIMIT };\n}\n\nexport async function fetchNearestCountry() {\n  const dcInfo = await invokeRequest(new GramJs.help.GetNearestDc());\n\n  return dcInfo?.country;\n}\n\nexport async function fetchTopUsers() {\n  const topPeers = await invokeRequest(new GramJs.contacts.GetTopPeers({\n    correspondents: true,\n  }));\n  if (!(topPeers instanceof GramJs.contacts.TopPeers)) {\n    return undefined;\n  }\n\n  const users = topPeers.users.map(buildApiUser).filter((user) => Boolean(user) && !user.isSelf) as ApiUser[];\n  const ids = users.map(({ id }) => id);\n\n  return {\n    ids,\n    users,\n  };\n}\n\nexport async function fetchContactList() {\n  const result = await invokeRequest(new GramJs.contacts.GetContacts({ hash: BigInt('0') }));\n  if (!result || result instanceof GramJs.contacts.ContactsNotModified) {\n    return undefined;\n  }\n\n  addEntitiesToLocalDb(result.users);\n\n  const { users, userStatusesById } = buildApiUsersAndStatuses(result.users);\n\n  return {\n    users,\n    userStatusesById,\n    chats: result.users.map((user) => buildApiChatFromPreview(user)).filter(Boolean),\n  };\n}\n\nexport async function fetchUsers({ users }: { users: ApiUser[] }) {\n  const result = await invokeRequest(new GramJs.users.GetUsers({\n    id: users.map(({ id, accessHash }) => buildInputPeer(id, accessHash)),\n  }));\n  if (!result || !result.length) {\n    return undefined;\n  }\n\n  addEntitiesToLocalDb(result);\n\n  return buildApiUsersAndStatuses(result);\n}\n\nexport async function importContact({\n  phone,\n  firstName,\n  lastName,\n}: {\n  phone?: string;\n  firstName?: string;\n  lastName?: string;\n}) {\n  const result = await invokeRequest(new GramJs.contacts.ImportContacts({\n    contacts: [buildInputContact({\n      phone: phone || '',\n      firstName: firstName || '',\n      lastName: lastName || '',\n    })],\n  }));\n\n  if (result instanceof GramJs.contacts.ImportedContacts && result.users.length) {\n    addUserToLocalDb(result.users[0]);\n  }\n\n  return result?.imported.length ? buildApiPeerId(result.imported[0].userId, 'user') : undefined;\n}\n\nexport function updateContact({\n  id,\n  accessHash,\n  phoneNumber = '',\n  firstName = '',\n  lastName = '',\n  shouldSharePhoneNumber = false,\n}: {\n  id: string;\n  accessHash?: string;\n  phoneNumber?: string;\n  firstName?: string;\n  lastName?: string;\n  shouldSharePhoneNumber?: boolean;\n}) {\n  return invokeRequest(new GramJs.contacts.AddContact({\n    id: buildInputEntity(id, accessHash) as GramJs.InputUser,\n    firstName,\n    lastName,\n    phone: phoneNumber,\n    ...(shouldSharePhoneNumber && { addPhonePrivacyException: shouldSharePhoneNumber }),\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport async function deleteContact({\n  id,\n  accessHash,\n}: {\n  id: string;\n  accessHash?: string;\n}) {\n  const input = buildInputEntity(id, accessHash);\n  if (!(input instanceof GramJs.InputUser)) {\n    return;\n  }\n\n  const result = await invokeRequest(new GramJs.contacts.DeleteContacts({ id: [input] }));\n\n  if (!result) {\n    return;\n  }\n\n  onUpdate({\n    '@type': 'deleteContact',\n    id,\n  });\n}\n\nexport async function fetchProfilePhotos(user?: ApiUser, chat?: ApiChat) {\n  if (user) {\n    const { id, accessHash } = user;\n\n    const result = await invokeRequest(new GramJs.photos.GetUserPhotos({\n      userId: buildInputEntity(id, accessHash) as GramJs.InputUser,\n      limit: PROFILE_PHOTOS_LIMIT,\n      offset: 0,\n      maxId: BigInt('0'),\n    }));\n\n    if (!result) {\n      return undefined;\n    }\n\n    updateLocalDb(result);\n\n    return {\n      photos: result.photos\n        .filter((photo): photo is GramJs.Photo => photo instanceof GramJs.Photo)\n        .map((photo) => buildApiPhoto(photo)),\n      users: result.users.map(buildApiUser).filter(Boolean),\n    };\n  }\n\n  if (chat?.isRestricted) return undefined;\n\n  const result = await searchMessagesLocal({\n    chat: chat!,\n    type: 'profilePhoto',\n    limit: PROFILE_PHOTOS_LIMIT,\n  });\n\n  if (!result) {\n    return undefined;\n  }\n\n  const { messages, users } = result;\n\n  return {\n    photos: messages.map((message) => message.content.action!.photo).filter(Boolean),\n    users,\n  };\n}\n\nexport function reportSpam(userOrChat: ApiPeer) {\n  const { id, accessHash } = userOrChat;\n\n  return invokeRequest(new GramJs.messages.ReportSpam({\n    peer: buildInputPeer(id, accessHash),\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport function updateEmojiStatus(emojiStatus: ApiSticker, expires?: number) {\n  return invokeRequest(new GramJs.account.UpdateEmojiStatus({\n    emojiStatus: buildInputEmojiStatus(emojiStatus, expires),\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport function saveCloseFriends(userIds: string[]) {\n  const id = userIds.map((userId) => buildMtpPeerId(userId, 'user'));\n\n  return invokeRequest(new GramJs.contacts.EditCloseFriends({ id }), {\n    shouldReturnTrue: true,\n  });\n}\n\nfunction updateLocalDb(result: (GramJs.photos.Photos | GramJs.photos.PhotosSlice | GramJs.messages.Chats)) {\n  if ('chats' in result) {\n    addEntitiesToLocalDb(result.chats);\n  }\n\n  if ('photos' in result) {\n    result.photos.forEach(addPhotoToLocalDb);\n  }\n\n  if ('users' in result) {\n    addEntitiesToLocalDb(result.users);\n  }\n}\n","import BigInt from 'big-integer';\nimport { Api as GramJs } from '../../../lib/gramjs';\n\nimport type {\n  ApiSticker, ApiStickerSetInfo, ApiVideo, OnApiUpdate,\n} from '../../types';\n\nimport { DEFAULT_GIF_SEARCH_BOT_USERNAME, RECENT_STATUS_LIMIT, RECENT_STICKERS_LIMIT } from '../../../config';\nimport { buildVideoFromDocument } from '../apiBuilders/messageContent';\nimport { buildApiEmojiStatus } from '../apiBuilders/peers';\nimport {\n  buildStickerSet, buildStickerSetCovered, processStickerPackResult, processStickerResult,\n} from '../apiBuilders/symbols';\nimport { buildInputDocument, buildInputStickerSet, buildInputStickerSetShortName } from '../gramjsBuilders';\nimport localDb from '../localDb';\nimport { invokeRequest } from './client';\n\nlet onUpdate: OnApiUpdate;\n\nexport function init(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nexport async function fetchCustomEmojiSets({ hash = '0' }: { hash?: string }) {\n  const allStickers = await invokeRequest(new GramJs.messages.GetEmojiStickers({ hash: BigInt(hash) }));\n\n  if (!allStickers || allStickers instanceof GramJs.messages.AllStickersNotModified) {\n    return undefined;\n  }\n\n  allStickers.sets.forEach((stickerSet) => {\n    if (stickerSet.thumbs?.length || stickerSet.thumbDocumentId) {\n      localDb.stickerSets[String(stickerSet.id)] = stickerSet;\n    }\n  });\n\n  return {\n    hash: String(allStickers.hash),\n    sets: allStickers.sets.map(buildStickerSet),\n  };\n}\n\nexport async function fetchStickerSets({ hash = '0' }: { hash?: string }) {\n  const allStickers = await invokeRequest(new GramJs.messages.GetAllStickers({ hash: BigInt(hash) }));\n\n  if (!allStickers || allStickers instanceof GramJs.messages.AllStickersNotModified) {\n    return undefined;\n  }\n\n  allStickers.sets.forEach((stickerSet) => {\n    if (stickerSet.thumbs?.length) {\n      localDb.stickerSets[String(stickerSet.id)] = stickerSet;\n    }\n  });\n\n  return {\n    hash: String(allStickers.hash),\n    sets: allStickers.sets.map(buildStickerSet),\n  };\n}\n\nexport async function fetchRecentStickers({ hash = '0' }: { hash?: string }) {\n  const result = await invokeRequest(new GramJs.messages.GetRecentStickers({ hash: BigInt(hash) }));\n\n  if (!result || result instanceof GramJs.messages.RecentStickersNotModified) {\n    return undefined;\n  }\n\n  return {\n    hash: String(result.hash),\n    stickers: processStickerResult(result.stickers.slice(0, RECENT_STICKERS_LIMIT)),\n  };\n}\n\nexport async function fetchFavoriteStickers({ hash = '0' }: { hash?: string }) {\n  const result = await invokeRequest(new GramJs.messages.GetFavedStickers({ hash: BigInt(hash) }));\n\n  if (!result || result instanceof GramJs.messages.FavedStickersNotModified) {\n    return undefined;\n  }\n\n  return {\n    hash: String(result.hash),\n    stickers: processStickerResult(result.stickers),\n  };\n}\n\nexport async function fetchFeaturedStickers({ hash = '0' }: { hash?: string }) {\n  const result = await invokeRequest(new GramJs.messages.GetFeaturedStickers({ hash: BigInt(hash) }));\n\n  if (!result || result instanceof GramJs.messages.FeaturedStickersNotModified) {\n    return undefined;\n  }\n\n  return {\n    hash: String(result.hash),\n    isPremium: Boolean(result.premium),\n    sets: result.sets.map(buildStickerSetCovered),\n  };\n}\n\nexport async function fetchFeaturedEmojiStickers() {\n  const result = await invokeRequest(new GramJs.messages.GetFeaturedEmojiStickers({ hash: BigInt(0) }));\n\n  if (!result || result instanceof GramJs.messages.FeaturedStickersNotModified) {\n    return undefined;\n  }\n\n  result.sets.forEach(({ set }) => {\n    if (set.thumbDocumentId) {\n      localDb.stickerSets[String(set.id)] = set;\n    }\n  });\n\n  return {\n    isPremium: Boolean(result.premium),\n    sets: result.sets.map(buildStickerSetCovered),\n  };\n}\n\nexport async function faveSticker({\n  sticker,\n  unfave,\n}: {\n  sticker: ApiSticker;\n  unfave?: boolean;\n}) {\n  const request = new GramJs.messages.FaveSticker({\n    id: buildInputDocument(sticker),\n    unfave,\n  });\n\n  const result = await invokeRequest(request);\n  if (result) {\n    onUpdate({\n      '@type': 'updateFavoriteStickers',\n    });\n  }\n}\n\nexport function removeRecentSticker({\n  sticker,\n}: {\n  sticker: ApiSticker;\n}) {\n  const request = new GramJs.messages.SaveRecentSticker({\n    id: buildInputDocument(sticker),\n    unsave: true,\n  });\n\n  return invokeRequest(request);\n}\n\nexport function clearRecentStickers() {\n  return invokeRequest(new GramJs.messages.ClearRecentStickers());\n}\n\nexport async function fetchStickers(\n  { stickerSetInfo }:\n  { stickerSetInfo: ApiStickerSetInfo },\n) {\n  if ('isMissing' in stickerSetInfo) return undefined;\n  const result = await invokeRequest(new GramJs.messages.GetStickerSet({\n    stickerset: 'id' in stickerSetInfo\n      ? buildInputStickerSet(stickerSetInfo.id, stickerSetInfo.accessHash)\n      : buildInputStickerSetShortName(stickerSetInfo.shortName),\n  }), {\n    shouldThrow: true,\n  });\n\n  if (!(result instanceof GramJs.messages.StickerSet)) {\n    return undefined;\n  }\n\n  localDb.stickerSets[String(result.set.id)] = result.set;\n\n  return {\n    set: buildStickerSet(result.set),\n    stickers: processStickerResult(result.documents),\n    packs: processStickerPackResult(result.packs),\n  };\n}\n\nexport async function fetchCustomEmoji({ documentId }: { documentId: string[] }) {\n  if (!documentId.length) return undefined;\n  const result = await invokeRequest(new GramJs.messages.GetCustomEmojiDocuments({\n    documentId: documentId.map((id) => BigInt(id)),\n  }));\n  if (!result) return undefined;\n\n  return processStickerResult(result);\n}\n\nexport async function fetchAnimatedEmojis() {\n  const result = await invokeRequest(new GramJs.messages.GetStickerSet({\n    stickerset: new GramJs.InputStickerSetAnimatedEmoji(),\n  }));\n\n  if (!(result instanceof GramJs.messages.StickerSet)) {\n    return undefined;\n  }\n\n  return {\n    set: buildStickerSet(result.set),\n    stickers: processStickerResult(result.documents),\n  };\n}\n\nexport async function fetchAnimatedEmojiEffects() {\n  const result = await invokeRequest(new GramJs.messages.GetStickerSet({\n    stickerset: new GramJs.InputStickerSetAnimatedEmojiAnimations(),\n  }));\n\n  if (!(result instanceof GramJs.messages.StickerSet)) {\n    return undefined;\n  }\n\n  return {\n    set: buildStickerSet(result.set),\n    stickers: processStickerResult(result.documents),\n  };\n}\n\nexport async function fetchGenericEmojiEffects() {\n  const result = await invokeRequest(new GramJs.messages.GetStickerSet({\n    stickerset: new GramJs.InputStickerSetEmojiGenericAnimations(),\n  }));\n\n  if (!(result instanceof GramJs.messages.StickerSet)) {\n    return undefined;\n  }\n\n  return {\n    set: buildStickerSet(result.set),\n    stickers: processStickerResult(result.documents),\n  };\n}\n\nexport async function fetchPremiumGifts() {\n  const result = await invokeRequest(new GramJs.messages.GetStickerSet({\n    stickerset: new GramJs.InputStickerSetPremiumGifts(),\n  }));\n\n  if (!(result instanceof GramJs.messages.StickerSet)) {\n    return undefined;\n  }\n\n  return {\n    set: buildStickerSet(result.set),\n    stickers: processStickerResult(result.documents),\n  };\n}\n\nexport async function fetchDefaultTopicIcons() {\n  const result = await invokeRequest(new GramJs.messages.GetStickerSet({\n    stickerset: new GramJs.InputStickerSetEmojiDefaultTopicIcons(),\n  }));\n\n  if (!(result instanceof GramJs.messages.StickerSet)) {\n    return undefined;\n  }\n\n  return {\n    set: buildStickerSet(result.set),\n    stickers: processStickerResult(result.documents),\n  };\n}\n\nexport async function fetchDefaultStatusEmojis() {\n  const result = await invokeRequest(new GramJs.messages.GetStickerSet({\n    stickerset: new GramJs.InputStickerSetEmojiDefaultStatuses(),\n  }));\n\n  if (!(result instanceof GramJs.messages.StickerSet)) {\n    return undefined;\n  }\n\n  return {\n    set: buildStickerSet(result.set),\n    stickers: processStickerResult(result.documents),\n  };\n}\n\nexport async function searchStickers({ query, hash = '0' }: { query: string; hash?: string }) {\n  const result = await invokeRequest(new GramJs.messages.SearchStickerSets({\n    q: query,\n    hash: BigInt(hash),\n  }));\n\n  if (!result || result instanceof GramJs.messages.FoundStickerSetsNotModified) {\n    return undefined;\n  }\n\n  return {\n    hash: String(result.hash),\n    sets: result.sets.map(buildStickerSetCovered),\n  };\n}\n\nexport async function fetchSavedGifs({ hash = '0' }: { hash?: string }) {\n  const result = await invokeRequest(new GramJs.messages.GetSavedGifs({ hash: BigInt(hash) }));\n\n  if (!result || result instanceof GramJs.messages.SavedGifsNotModified) {\n    return undefined;\n  }\n\n  return {\n    hash: String(result.hash),\n    gifs: processGifResult(result.gifs),\n  };\n}\n\nexport function saveGif({ gif, shouldUnsave }: { gif: ApiVideo; shouldUnsave?: boolean }) {\n  const request = new GramJs.messages.SaveGif({\n    id: buildInputDocument(gif),\n    unsave: shouldUnsave,\n  });\n\n  return invokeRequest(request, { shouldReturnTrue: true });\n}\n\nexport async function installStickerSet({ stickerSetId, accessHash }: { stickerSetId: string; accessHash: string }) {\n  const result = await invokeRequest(new GramJs.messages.InstallStickerSet({\n    stickerset: buildInputStickerSet(stickerSetId, accessHash),\n  }));\n\n  if (result) {\n    onUpdate({\n      '@type': 'updateStickerSet',\n      id: stickerSetId,\n      stickerSet: { installedDate: Date.now() },\n    });\n  }\n}\n\nexport async function uninstallStickerSet({ stickerSetId, accessHash }: { stickerSetId: string; accessHash: string }) {\n  const result = await invokeRequest(new GramJs.messages.UninstallStickerSet({\n    stickerset: buildInputStickerSet(stickerSetId, accessHash),\n  }));\n\n  if (result) {\n    onUpdate({\n      '@type': 'updateStickerSet',\n      id: stickerSetId,\n      stickerSet: { installedDate: undefined },\n    });\n  }\n}\n\nlet inputGifBot: GramJs.InputUser | undefined;\n\nexport async function searchGifs({\n  query,\n  offset = '',\n  username = DEFAULT_GIF_SEARCH_BOT_USERNAME,\n}: { query: string; offset?: string; username?: string }) {\n  if (!inputGifBot) {\n    const resolvedPeer = await invokeRequest(new GramJs.contacts.ResolveUsername({\n      username,\n    }));\n    if (!resolvedPeer || !(resolvedPeer.users[0] instanceof GramJs.User)) {\n      return undefined;\n    }\n\n    inputGifBot = new GramJs.InputUser({\n      userId: (resolvedPeer.peer as GramJs.PeerUser).userId,\n      accessHash: resolvedPeer.users[0].accessHash!,\n    });\n  }\n\n  const result = await invokeRequest(new GramJs.messages.GetInlineBotResults({\n    bot: inputGifBot,\n    peer: new GramJs.InputPeerEmpty(),\n    query,\n    offset,\n  }));\n  if (!result) {\n    return undefined;\n  }\n\n  const documents = result.results\n    .map((foundGif) => {\n      if (foundGif instanceof GramJs.BotInlineMediaResult) {\n        return foundGif.document;\n      }\n\n      return undefined;\n    })\n    .filter(Boolean);\n\n  return {\n    nextOffset: result.nextOffset,\n    gifs: processGifResult(documents),\n  };\n}\n\nexport async function fetchStickersForEmoji({\n  emoji, hash = '0',\n}: { emoji: string; hash?: string }) {\n  const result = await invokeRequest(new GramJs.messages.GetStickers({\n    emoticon: emoji,\n    hash: BigInt(hash),\n  }));\n\n  if (!result || result instanceof GramJs.messages.StickersNotModified) {\n    return undefined;\n  }\n\n  return {\n    stickers: processStickerResult(result.stickers),\n    hash: String(result.hash),\n  };\n}\n\nexport async function fetchEmojiKeywords({ language, fromVersion }: {\n  language: string;\n  fromVersion?: number;\n}) {\n  const result = await invokeRequest(new GramJs.messages.GetEmojiKeywordsDifference({\n    langCode: language,\n    fromVersion,\n  }));\n\n  if (!result) {\n    return undefined;\n  }\n\n  return {\n    language: result.langCode,\n    version: result.version,\n    keywords: result.keywords.reduce((acc, emojiKeyword) => {\n      acc[emojiKeyword.keyword] = emojiKeyword.emoticons;\n\n      return acc;\n    }, {} as Record<string, string[]>),\n  };\n}\n\nexport async function fetchRecentEmojiStatuses(hash = '0') {\n  const result = await invokeRequest(new GramJs.account.GetRecentEmojiStatuses({ hash: BigInt(hash) }));\n\n  if (!result || result instanceof GramJs.account.EmojiStatusesNotModified) {\n    return undefined;\n  }\n\n  const documentIds = result.statuses\n    .slice(0, RECENT_STATUS_LIMIT)\n    .map(buildApiEmojiStatus)\n    .filter(Boolean)\n    .map(({ documentId }) => documentId);\n  const emojiStatuses = await fetchCustomEmoji({ documentId: documentIds });\n\n  return {\n    hash: String(result.hash),\n    emojiStatuses,\n  };\n}\n\nfunction processGifResult(gifs: GramJs.TypeDocument[]) {\n  return gifs\n    .map((document) => {\n      if (document instanceof GramJs.Document) {\n        const gif = buildVideoFromDocument(document);\n        if (gif) {\n          localDb.documents[String(document.id)] = document;\n\n          return gif;\n        }\n      }\n\n      return undefined;\n    })\n    .filter(Boolean);\n}\n","import { Api as GramJs } from '../../../lib/gramjs';\n\nimport type {\n  ApiChat, ApiError, ApiUser, ApiUsername, OnApiUpdate,\n} from '../../types';\n\nimport { USERNAME_PURCHASE_ERROR } from '../../../config';\nimport { buildCollectionByKey } from '../../../util/iteratees';\nimport { buildApiExportedInvite, buildChatInviteImporter } from '../apiBuilders/chats';\nimport { buildApiUser } from '../apiBuilders/users';\nimport { buildInputEntity, buildInputPeer } from '../gramjsBuilders';\nimport { addEntitiesToLocalDb } from '../helpers';\nimport { invokeRequest } from './client';\n\nlet onUpdate: OnApiUpdate;\n\nexport const ACCEPTABLE_USERNAME_ERRORS = new Set([USERNAME_PURCHASE_ERROR, 'USERNAME_INVALID']);\n\nexport function init(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nexport async function checkChatUsername({ username }: { username: string }) {\n  try {\n    const result = await invokeRequest(new GramJs.channels.CheckUsername({\n      channel: new GramJs.InputChannelEmpty(),\n      username,\n    }), {\n      shouldThrow: true,\n    });\n\n    return { result, error: undefined };\n  } catch (error) {\n    const errorMessage = (error as ApiError).message;\n\n    if (ACCEPTABLE_USERNAME_ERRORS.has(errorMessage)) {\n      return {\n        result: false,\n        error: errorMessage,\n      };\n    }\n\n    throw error;\n  }\n}\n\nexport async function setChatUsername(\n  { chat, username }: { chat: ApiChat; username: string },\n) {\n  const result = await invokeRequest(new GramJs.channels.UpdateUsername({\n    channel: buildInputEntity(chat.id, chat.accessHash) as GramJs.InputChannel,\n    username,\n  }));\n\n  let usernames: ApiUsername[] = username ? [{ username, isEditable: true, isActive: true }] : [];\n  if (chat.usernames) {\n    // User can remove username from chat when changing it type to private, so we need to filter out empty usernames\n    usernames = usernames.concat(chat.usernames.filter((u) => u.username && !u.isEditable));\n  }\n\n  if (result) {\n    onUpdate({\n      '@type': 'updateChat',\n      id: chat.id,\n      chat: { usernames: usernames.length ? usernames : undefined },\n    });\n  }\n\n  return result;\n}\n\nexport async function deactivateAllUsernames({ chat }: { chat: ApiChat }) {\n  const result = await invokeRequest(new GramJs.channels.DeactivateAllUsernames({\n    channel: buildInputEntity(chat.id, chat.accessHash) as GramJs.InputChannel,\n  }));\n\n  if (result) {\n    const usernames = chat.usernames\n      ? chat.usernames\n        .map((u) => ({ ...u, isActive: false }))\n        // User can remove username from chat when changing it type to private, so we need to filter out empty usernames\n        .filter((u) => u.username)\n      : undefined;\n\n    onUpdate({\n      '@type': 'updateChat',\n      id: chat.id,\n      chat: { usernames },\n    });\n  }\n\n  return result;\n}\n\nexport async function updatePrivateLink({\n  chat, usageLimit, expireDate,\n}: {\n  chat: ApiChat; usageLimit?: number; expireDate?: number;\n}) {\n  const result = await invokeRequest(new GramJs.messages.ExportChatInvite({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    usageLimit,\n    expireDate,\n  }));\n\n  if (!(result instanceof GramJs.ChatInviteExported)) return undefined;\n\n  onUpdate({\n    '@type': 'updateChatFullInfo',\n    id: chat.id,\n    fullInfo: {\n      inviteLink: result.link,\n    },\n  });\n\n  return result.link;\n}\n\nexport async function fetchExportedChatInvites({\n  peer, admin, limit = 0, isRevoked,\n}: { peer: ApiChat; admin: ApiUser; limit?: number; isRevoked?: boolean }) {\n  const exportedInvites = await invokeRequest(new GramJs.messages.GetExportedChatInvites({\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    adminId: buildInputEntity(admin.id, admin.accessHash) as GramJs.InputUser,\n    limit,\n    revoked: isRevoked || undefined,\n  }), {\n    abortControllerChatId: peer.id,\n  });\n\n  if (!exportedInvites) return undefined;\n  addEntitiesToLocalDb(exportedInvites.users);\n\n  const invites = (exportedInvites.invites\n    .filter((invite): invite is GramJs.ChatInviteExported => invite instanceof GramJs.ChatInviteExported))\n    .map(buildApiExportedInvite);\n\n  return {\n    invites,\n    users: exportedInvites.users.map(buildApiUser).filter(Boolean),\n  };\n}\n\nexport async function editExportedChatInvite({\n  peer, isRevoked, link, expireDate, usageLimit, isRequestNeeded, title,\n}: {\n  peer: ApiChat;\n  isRevoked?: boolean;\n  link: string;\n  expireDate?: number;\n  usageLimit?: number;\n  isRequestNeeded?: boolean;\n  title?: string;\n}) {\n  const invite = await invokeRequest(new GramJs.messages.EditExportedChatInvite({\n    link,\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    expireDate,\n    usageLimit: !isRequestNeeded ? usageLimit : undefined,\n    requestNeeded: isRequestNeeded,\n    title,\n    revoked: isRevoked || undefined,\n  }));\n\n  if (!invite) return undefined;\n\n  addEntitiesToLocalDb(invite.users);\n  if (invite instanceof GramJs.messages.ExportedChatInvite && invite.invite instanceof GramJs.ChatInviteExported) {\n    const replaceInvite = buildApiExportedInvite(invite.invite);\n    return {\n      oldInvite: replaceInvite,\n      newInvite: replaceInvite,\n      users: invite.users.map(buildApiUser).filter(Boolean),\n    };\n  }\n\n  if (invite instanceof GramJs.messages.ExportedChatInviteReplaced\n    && invite.invite instanceof GramJs.ChatInviteExported\n    && invite.newInvite instanceof GramJs.ChatInviteExported) {\n    const oldInvite = buildApiExportedInvite(invite.invite);\n    const newInvite = buildApiExportedInvite(invite.newInvite);\n    return {\n      oldInvite,\n      newInvite,\n      users: invite.users.map(buildApiUser).filter(Boolean),\n    };\n  }\n  return undefined;\n}\n\nexport async function exportChatInvite({\n  peer, expireDate, usageLimit, isRequestNeeded, title,\n}: {\n  peer: ApiChat;\n  expireDate?: number;\n  usageLimit?: number;\n  isRequestNeeded?: boolean;\n  title?: string;\n}) {\n  const invite = await invokeRequest(new GramJs.messages.ExportChatInvite({\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    expireDate,\n    usageLimit: !isRequestNeeded ? usageLimit : undefined,\n    requestNeeded: isRequestNeeded || undefined,\n    title,\n  }));\n\n  if (!(invite instanceof GramJs.ChatInviteExported)) return undefined;\n  return buildApiExportedInvite(invite);\n}\n\nexport async function deleteExportedChatInvite({\n  peer, link,\n}: {\n  peer: ApiChat; link: string;\n}) {\n  const result = await invokeRequest(new GramJs.messages.DeleteExportedChatInvite({\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    link,\n  }));\n\n  return result;\n}\n\nexport async function deleteRevokedExportedChatInvites({\n  peer, admin,\n}: {\n  peer: ApiChat; admin: ApiUser;\n}) {\n  const result = await invokeRequest(new GramJs.messages.DeleteRevokedExportedChatInvites({\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    adminId: buildInputEntity(admin.id, admin.accessHash) as GramJs.InputUser,\n  }));\n\n  return result;\n}\n\nexport async function fetchChatInviteImporters({\n  peer, link, offsetDate = 0, offsetUser, limit = 0, isRequested,\n}: {\n  peer: ApiChat; link?: string; offsetDate?: number; offsetUser?: ApiUser; limit?: number; isRequested?: boolean;\n}) {\n  const result = await invokeRequest(new GramJs.messages.GetChatInviteImporters({\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    link,\n    offsetDate,\n    offsetUser: offsetUser\n      ? buildInputEntity(offsetUser.id, offsetUser.accessHash) as GramJs.InputUser : new GramJs.InputUserEmpty(),\n    limit,\n    requested: isRequested || undefined,\n  }), {\n    abortControllerChatId: peer.id,\n  });\n\n  if (!result) return undefined;\n  const users = result.users.map((user) => buildApiUser(user)).filter(Boolean);\n  addEntitiesToLocalDb(result.users);\n  return {\n    importers: result.importers.map((importer) => buildChatInviteImporter(importer)),\n    users: buildCollectionByKey(users, 'id'),\n  };\n}\n\nexport function hideChatJoinRequest({\n  peer,\n  user,\n  isApproved,\n}: {\n  peer: ApiChat;\n  user: ApiUser;\n  isApproved: boolean;\n}) {\n  return invokeRequest(new GramJs.messages.HideChatJoinRequest({\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    userId: buildInputEntity(user.id, user.accessHash) as GramJs.InputUser,\n    approved: isApproved || undefined,\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport function hideAllChatJoinRequests({\n  peer,\n  isApproved,\n  link,\n}: {\n  peer: ApiChat;\n  isApproved: boolean;\n  link?: string;\n}) {\n  return invokeRequest(new GramJs.messages.HideAllChatJoinRequests({\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    approved: isApproved || undefined,\n    link,\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport function hideChatReportPanel(chat: ApiChat) {\n  const { id, accessHash } = chat;\n\n  return invokeRequest(new GramJs.messages.HidePeerSettingsBar({\n    peer: buildInputPeer(id, accessHash),\n  }));\n}\n","/* eslint-disable @typescript-eslint/naming-convention */\nimport BigInt from 'big-integer';\nimport { Api as GramJs } from '../../../lib/gramjs';\n\nimport type { ApiLimitType } from '../../../global/types';\nimport type { ApiAppConfig } from '../../types';\n\nimport {\n  DEFAULT_LIMITS,\n  SERVICE_NOTIFICATIONS_USER_ID,\n  STORY_EXPIRE_PERIOD,\n  STORY_VIEWERS_EXPIRE_PERIOD,\n} from '../../../config';\nimport localDb from '../localDb';\nimport { buildJson } from './misc';\n\ntype LimitType = 'default' | 'premium';\ntype Limit =\n  | 'upload_max_fileparts'\n  | 'stickers_faved_limit'\n  | 'saved_gifs_limit'\n  | 'dialog_filters_chats_limit'\n  | 'dialog_filters_limit'\n  | 'dialogs_folder_pinned_limit'\n  | 'dialogs_pinned_limit'\n  | 'caption_length_limit'\n  | 'channels_limit'\n  | 'channels_public_limit'\n  | 'about_length_limit'\n  | 'chatlist_invites_limit'\n  | 'chatlist_joined_limit'\n  | 'recommended_channels_limit'\n  | 'saved_dialogs_pinned_limit';\ntype LimitKey = `${Limit}_${LimitType}`;\ntype LimitsConfig = Record<LimitKey, number>;\n\nexport interface GramJsAppConfig extends LimitsConfig {\n  emojies_sounds: Record<string, {\n    id: string;\n    access_hash: string;\n    file_reference_base64: string;\n  }>;\n  emojies_send_dice: string[];\n  groupcall_video_participants_max: number;\n  reactions_uniq_max: number;\n  chat_read_mark_size_threshold: number;\n  chat_read_mark_expire_period: number;\n  pm_read_date_expire_period: number;\n  reactions_user_max_default: number;\n  reactions_user_max_premium: number;\n  autologin_domains: string[];\n  autologin_token: string;\n  url_auth_domains: string[];\n  premium_purchase_blocked: boolean;\n  premium_bot_username: string;\n  premium_invoice_slug: string;\n  premium_promo_order: string[];\n  default_emoji_statuses_stickerset_id: string;\n  hidden_members_group_size_min: number;\n  autoarchive_setting_available: boolean;\n  authorization_autoconfirm_period: number;\n  // Forums\n  topics_pinned_limit: number;\n  // Stories\n  stories_all_hidden?: boolean;\n  story_expire_period: number;\n  story_viewers_expire_period: number;\n  stories_changelog_user_id?: number;\n}\n\nfunction buildEmojiSounds(appConfig: GramJsAppConfig) {\n  const { emojies_sounds } = appConfig;\n  return emojies_sounds ? Object.keys(emojies_sounds).reduce((acc: Record<string, string>, key) => {\n    const l = emojies_sounds[key];\n    localDb.documents[l.id] = new GramJs.Document({\n      id: BigInt(l.id),\n      accessHash: BigInt(l.access_hash),\n      dcId: 1,\n      mimeType: 'audio/ogg',\n      fileReference: Buffer.alloc(0),\n      size: BigInt(0),\n    } as GramJs.Document);\n\n    acc[key] = l.id;\n    return acc;\n  }, {}) : {};\n}\n\nfunction getLimit(appConfig: GramJsAppConfig, key: Limit, fallbackKey: ApiLimitType) {\n  const defaultLimit = appConfig[`${key}_default`] || DEFAULT_LIMITS[fallbackKey][0];\n  const premiumLimit = appConfig[`${key}_premium`] || DEFAULT_LIMITS[fallbackKey][1];\n  return [defaultLimit, premiumLimit] as const;\n}\n\nexport function buildAppConfig(json: GramJs.TypeJSONValue, hash: number): ApiAppConfig {\n  const appConfig = buildJson(json) as GramJsAppConfig;\n\n  return {\n    emojiSounds: buildEmojiSounds(appConfig),\n    seenByMaxChatMembers: appConfig.chat_read_mark_size_threshold,\n    seenByExpiresAt: appConfig.chat_read_mark_expire_period,\n    readDateExpiresAt: appConfig.pm_read_date_expire_period,\n    autologinDomains: appConfig.autologin_domains || [],\n    urlAuthDomains: appConfig.url_auth_domains || [],\n    maxUniqueReactions: appConfig.reactions_uniq_max,\n    premiumBotUsername: appConfig.premium_bot_username,\n    premiumInvoiceSlug: appConfig.premium_invoice_slug,\n    premiumPromoOrder: appConfig.premium_promo_order,\n    isPremiumPurchaseBlocked: appConfig.premium_purchase_blocked,\n    defaultEmojiStatusesStickerSetId: appConfig.default_emoji_statuses_stickerset_id,\n    topicsPinnedLimit: appConfig.topics_pinned_limit,\n    maxUserReactionsDefault: appConfig.reactions_user_max_default,\n    maxUserReactionsPremium: appConfig.reactions_user_max_premium,\n    hiddenMembersMinCount: appConfig.hidden_members_group_size_min,\n    canDisplayAutoarchiveSetting: appConfig.autoarchive_setting_available,\n    limits: {\n      uploadMaxFileparts: getLimit(appConfig, 'upload_max_fileparts', 'uploadMaxFileparts'),\n      stickersFaved: getLimit(appConfig, 'stickers_faved_limit', 'stickersFaved'),\n      savedGifs: getLimit(appConfig, 'saved_gifs_limit', 'savedGifs'),\n      dialogFiltersChats: getLimit(appConfig, 'dialog_filters_chats_limit', 'dialogFiltersChats'),\n      dialogFilters: getLimit(appConfig, 'dialog_filters_limit', 'dialogFilters'),\n      dialogFolderPinned: getLimit(appConfig, 'dialogs_pinned_limit', 'dialogFolderPinned'),\n      captionLength: getLimit(appConfig, 'caption_length_limit', 'captionLength'),\n      channels: getLimit(appConfig, 'channels_limit', 'channels'),\n      channelsPublic: getLimit(appConfig, 'channels_public_limit', 'channelsPublic'),\n      aboutLength: getLimit(appConfig, 'about_length_limit', 'aboutLength'),\n      chatlistInvites: getLimit(appConfig, 'chatlist_invites_limit', 'chatlistInvites'),\n      chatlistJoined: getLimit(appConfig, 'chatlist_joined_limit', 'chatlistJoined'),\n      recommendedChannels: getLimit(appConfig, 'recommended_channels_limit', 'recommendedChannels'),\n      savedDialogsPinned: getLimit(appConfig, 'saved_dialogs_pinned_limit', 'savedDialogsPinned'),\n    },\n    hash,\n    areStoriesHidden: appConfig.stories_all_hidden,\n    storyExpirePeriod: appConfig.story_expire_period ?? STORY_EXPIRE_PERIOD,\n    storyViewersExpirePeriod: appConfig.story_viewers_expire_period ?? STORY_VIEWERS_EXPIRE_PERIOD,\n    storyChangelogUserId: appConfig.stories_changelog_user_id?.toString() ?? SERVICE_NOTIFICATIONS_USER_ID,\n  };\n}\n","import BigInt from 'big-integer';\nimport { Api as GramJs } from '../../../lib/gramjs';\n\nimport type { LANG_PACKS } from '../../../config';\nimport type { ApiInputPrivacyRules, ApiPrivacyKey, LangCode } from '../../../types';\nimport type {\n  ApiAppConfig,\n  ApiConfig,\n  ApiError,\n  ApiLanguage,\n  ApiNotifyException,\n  ApiPhoto,\n  ApiUser,\n} from '../../types';\n\nimport { BLOCKED_LIST_LIMIT, DEFAULT_LANG_PACK, MAX_INT_32 } from '../../../config';\nimport { buildCollectionByKey } from '../../../util/iteratees';\nimport { getServerTime } from '../../../util/serverTime';\nimport { buildAppConfig } from '../apiBuilders/appConfig';\nimport { buildApiChatFromPreview } from '../apiBuilders/chats';\nimport { buildApiPhoto, buildPrivacyRules } from '../apiBuilders/common';\nimport { omitVirtualClassFields } from '../apiBuilders/helpers';\nimport {\n  buildApiConfig,\n  buildApiCountryList,\n  buildApiNotifyException,\n  buildApiPeerColors,\n  buildApiSession,\n  buildApiWallpaper,\n  buildApiWebSession, buildLangPack, buildLangPackString,\n} from '../apiBuilders/misc';\nimport { getApiChatIdFromMtpPeer } from '../apiBuilders/peers';\nimport { buildApiUser } from '../apiBuilders/users';\nimport {\n  buildInputEntity, buildInputPeer, buildInputPhoto,\n  buildInputPrivacyKey,\n  buildInputPrivacyRules,\n} from '../gramjsBuilders';\nimport { addEntitiesToLocalDb, addPhotoToLocalDb } from '../helpers';\nimport localDb from '../localDb';\nimport { getClient, invokeRequest, uploadFile } from './client';\nimport { ACCEPTABLE_USERNAME_ERRORS } from './management';\n\nconst BETA_LANG_CODES = ['ar', 'fa', 'id', 'ko', 'uz', 'en'];\n\nexport function updateProfile({\n  firstName,\n  lastName,\n  about,\n}: {\n  firstName?: string;\n  lastName?: string;\n  about?: string;\n}) {\n  return invokeRequest(new GramJs.account.UpdateProfile({\n    firstName: firstName || '',\n    lastName: lastName || '',\n    about: about || '',\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport async function checkUsername(username: string) {\n  try {\n    const result = await invokeRequest(new GramJs.account.CheckUsername({\n      username,\n    }), {\n      shouldThrow: true,\n    });\n\n    return { result, error: undefined };\n  } catch (error) {\n    const errorMessage = (error as ApiError).message;\n\n    if (ACCEPTABLE_USERNAME_ERRORS.has(errorMessage)) {\n      return {\n        result: false,\n        error: errorMessage,\n      };\n    }\n\n    throw error;\n  }\n}\n\nexport function updateUsername(username: string) {\n  return invokeRequest(new GramJs.account.UpdateUsername({ username }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport async function updateProfilePhoto(photo?: ApiPhoto, isFallback?: boolean) {\n  const photoId = photo ? buildInputPhoto(photo) : new GramJs.InputPhotoEmpty();\n  const result = await invokeRequest(new GramJs.photos.UpdateProfilePhoto({\n    id: photoId,\n    ...(isFallback ? { fallback: true } : undefined),\n  }));\n  if (!result) return undefined;\n\n  addEntitiesToLocalDb(result.users);\n  if (result.photo instanceof GramJs.Photo) {\n    addPhotoToLocalDb(result.photo);\n    return {\n      users: result.users.map(buildApiUser).filter(Boolean),\n      photo: buildApiPhoto(result.photo),\n    };\n  }\n  return undefined;\n}\n\nexport async function uploadProfilePhoto(\n  file: File, isFallback?: boolean, isVideo = false, videoTs = 0, bot?: ApiUser,\n) {\n  const inputFile = await uploadFile(file);\n  const result = await invokeRequest(new GramJs.photos.UploadProfilePhoto({\n    ...(bot ? { bot: buildInputPeer(bot.id, bot.accessHash) } : undefined),\n    ...(isVideo ? { video: inputFile, videoStartTs: videoTs } : { file: inputFile }),\n    ...(isFallback ? { fallback: true } : undefined),\n  }));\n\n  if (!result) return undefined;\n\n  addEntitiesToLocalDb(result.users);\n  if (result.photo instanceof GramJs.Photo) {\n    addPhotoToLocalDb(result.photo);\n    return {\n      users: result.users.map(buildApiUser).filter(Boolean),\n      photo: buildApiPhoto(result.photo),\n    };\n  }\n  return undefined;\n}\n\nexport async function uploadContactProfilePhoto({\n  file, isSuggest, user,\n}: {\n  file?: File;\n  isSuggest?: boolean;\n  user: ApiUser;\n}) {\n  const inputFile = file ? await uploadFile(file) : undefined;\n  const result = await invokeRequest(new GramJs.photos.UploadContactProfilePhoto({\n    userId: buildInputEntity(user.id, user.accessHash) as GramJs.InputUser,\n    file: inputFile,\n    ...(isSuggest ? { suggest: true } : { save: true }),\n  }));\n\n  if (!result) return undefined;\n\n  addEntitiesToLocalDb(result.users);\n\n  const users = result.users.map(buildApiUser).filter(Boolean);\n\n  if (result.photo instanceof GramJs.Photo) {\n    addPhotoToLocalDb(result.photo);\n    return {\n      users,\n      photo: buildApiPhoto(result.photo),\n    };\n  }\n\n  return {\n    users,\n    photo: undefined,\n  };\n}\n\nexport async function deleteProfilePhotos(photos: ApiPhoto[]) {\n  const photoIds = photos.map(buildInputPhoto).filter(Boolean);\n  const isDeleted = await invokeRequest(new GramJs.photos.DeletePhotos({ id: photoIds }), {\n    shouldReturnTrue: true,\n  });\n  if (isDeleted) {\n    photos.forEach((photo) => {\n      delete localDb.photos[photo.id];\n    });\n  }\n  return isDeleted;\n}\n\nexport async function fetchWallpapers() {\n  const result = await invokeRequest(new GramJs.account.GetWallPapers({ hash: BigInt('0') }));\n\n  if (!result || result instanceof GramJs.account.WallPapersNotModified) {\n    return undefined;\n  }\n\n  const filteredWallpapers = result.wallpapers.filter((wallpaper) => {\n    if (\n      !(wallpaper instanceof GramJs.WallPaper)\n      || !(wallpaper.document instanceof GramJs.Document)\n    ) {\n      return false;\n    }\n\n    return !wallpaper.pattern && wallpaper.document.mimeType !== 'application/x-tgwallpattern';\n  }) as GramJs.WallPaper[];\n\n  filteredWallpapers.forEach((wallpaper) => {\n    localDb.documents[String(wallpaper.document.id)] = wallpaper.document as GramJs.Document;\n  });\n\n  return {\n    wallpapers: filteredWallpapers.map(buildApiWallpaper).filter(Boolean),\n  };\n}\n\nexport async function uploadWallpaper(file: File) {\n  const inputFile = await uploadFile(file);\n\n  const result = await invokeRequest(new GramJs.account.UploadWallPaper({\n    file: inputFile,\n    mimeType: file.type,\n    settings: new GramJs.WallPaperSettings(),\n  }));\n\n  if (!result || !(result instanceof GramJs.WallPaper)) {\n    return undefined;\n  }\n\n  const wallpaper = buildApiWallpaper(result);\n  if (!wallpaper) {\n    return undefined;\n  }\n\n  localDb.documents[String(result.document.id)] = result.document as GramJs.Document;\n\n  return { wallpaper };\n}\n\nexport async function fetchBlockedUsers({\n  isOnlyStories,\n}: {\n  isOnlyStories?: true;\n}) {\n  const result = await invokeRequest(new GramJs.contacts.GetBlocked({\n    myStoriesFrom: isOnlyStories,\n    limit: BLOCKED_LIST_LIMIT,\n  }));\n  if (!result) {\n    return undefined;\n  }\n\n  updateLocalDb(result);\n\n  return {\n    users: result.users.map(buildApiUser).filter(Boolean),\n    chats: result.chats.map((chat) => buildApiChatFromPreview(chat)).filter(Boolean),\n    blockedIds: result.blocked.map((blocked) => getApiChatIdFromMtpPeer(blocked.peerId)),\n    totalCount: result instanceof GramJs.contacts.BlockedSlice ? result.count : result.blocked.length,\n  };\n}\n\nexport function blockUser({\n  user,\n  isOnlyStories,\n}: {\n  user: ApiUser;\n  isOnlyStories?: true;\n}) {\n  return invokeRequest(new GramJs.contacts.Block({\n    id: buildInputPeer(user.id, user.accessHash),\n    myStoriesFrom: isOnlyStories,\n  }));\n}\n\nexport function unblockUser({\n  user,\n  isOnlyStories,\n}: {\n  user: ApiUser;\n  isOnlyStories?: true;\n}) {\n  return invokeRequest(new GramJs.contacts.Unblock({\n    id: buildInputPeer(user.id, user.accessHash),\n    myStoriesFrom: isOnlyStories,\n  }));\n}\n\nexport async function fetchAuthorizations() {\n  const result = await invokeRequest(new GramJs.account.GetAuthorizations());\n  if (!result) {\n    return undefined;\n  }\n\n  return {\n    authorizations: buildCollectionByKey(result.authorizations.map(buildApiSession), 'hash'),\n    ttlDays: result.authorizationTtlDays,\n  };\n}\n\nexport function terminateAuthorization(hash: string) {\n  return invokeRequest(new GramJs.account.ResetAuthorization({ hash: BigInt(hash) }));\n}\n\nexport function terminateAllAuthorizations() {\n  return invokeRequest(new GramJs.auth.ResetAuthorizations());\n}\n\nexport async function fetchWebAuthorizations() {\n  const result = await invokeRequest(new GramJs.account.GetWebAuthorizations());\n  if (!result) {\n    return undefined;\n  }\n  addEntitiesToLocalDb(result.users);\n\n  return {\n    users: result.users.map(buildApiUser).filter(Boolean),\n    webAuthorizations: buildCollectionByKey(result.authorizations.map(buildApiWebSession), 'hash'),\n  };\n}\n\nexport function terminateWebAuthorization(hash: string) {\n  return invokeRequest(new GramJs.account.ResetWebAuthorization({ hash: BigInt(hash) }));\n}\n\nexport function terminateAllWebAuthorizations() {\n  return invokeRequest(new GramJs.account.ResetWebAuthorizations());\n}\n\nexport async function fetchNotificationExceptions() {\n  const result = await invokeRequest(new GramJs.account.GetNotifyExceptions({\n    compareSound: true,\n  }), {\n    shouldIgnoreUpdates: true,\n  });\n\n  if (!(result instanceof GramJs.Updates || result instanceof GramJs.UpdatesCombined)) {\n    return undefined;\n  }\n\n  updateLocalDb(result);\n\n  return result.updates.reduce((acc, update) => {\n    if (!(update instanceof GramJs.UpdateNotifySettings && update.peer instanceof GramJs.NotifyPeer)) {\n      return acc;\n    }\n\n    acc.push(buildApiNotifyException(update.notifySettings, update.peer.peer));\n\n    return acc;\n  }, [] as ApiNotifyException[]);\n}\n\nexport async function fetchNotificationSettings() {\n  const [\n    isMutedContactSignUpNotification,\n    privateContactNotificationsSettings,\n    groupNotificationsSettings,\n    broadcastNotificationsSettings,\n  ] = await Promise.all([\n    invokeRequest(new GramJs.account.GetContactSignUpNotification()),\n    invokeRequest(new GramJs.account.GetNotifySettings({\n      peer: new GramJs.InputNotifyUsers(),\n    })),\n    invokeRequest(new GramJs.account.GetNotifySettings({\n      peer: new GramJs.InputNotifyChats(),\n    })),\n    invokeRequest(new GramJs.account.GetNotifySettings({\n      peer: new GramJs.InputNotifyBroadcasts(),\n    })),\n  ]);\n\n  if (!privateContactNotificationsSettings || !groupNotificationsSettings || !broadcastNotificationsSettings) {\n    return false;\n  }\n\n  const {\n    silent: privateSilent, muteUntil: privateMuteUntil, showPreviews: privateShowPreviews,\n  } = privateContactNotificationsSettings;\n  const {\n    silent: groupSilent, muteUntil: groupMuteUntil, showPreviews: groupShowPreviews,\n  } = groupNotificationsSettings;\n  const {\n    silent: broadcastSilent, muteUntil: broadcastMuteUntil, showPreviews: broadcastShowPreviews,\n  } = broadcastNotificationsSettings;\n\n  return {\n    hasContactJoinedNotifications: !isMutedContactSignUpNotification,\n    hasPrivateChatsNotifications: !(\n      privateSilent\n      || (typeof privateMuteUntil === 'number' && getServerTime() < privateMuteUntil)\n    ),\n    hasPrivateChatsMessagePreview: privateShowPreviews,\n    hasGroupNotifications: !(\n      groupSilent || (typeof groupMuteUntil === 'number'\n        && getServerTime() < groupMuteUntil)\n    ),\n    hasGroupMessagePreview: groupShowPreviews,\n    hasBroadcastNotifications: !(\n      broadcastSilent || (typeof broadcastMuteUntil === 'number'\n        && getServerTime() < broadcastMuteUntil)\n    ),\n    hasBroadcastMessagePreview: broadcastShowPreviews,\n  };\n}\n\nexport function updateContactSignUpNotification(isSilent: boolean) {\n  return invokeRequest(new GramJs.account.SetContactSignUpNotification({ silent: isSilent }));\n}\n\nexport function updateNotificationSettings(peerType: 'contact' | 'group' | 'broadcast', {\n  isSilent,\n  shouldShowPreviews,\n}: {\n  isSilent?: boolean;\n  shouldShowPreviews?: boolean;\n}) {\n  let peer: GramJs.TypeInputNotifyPeer;\n  if (peerType === 'contact') {\n    peer = new GramJs.InputNotifyUsers();\n  } else if (peerType === 'group') {\n    peer = new GramJs.InputNotifyChats();\n  } else {\n    peer = new GramJs.InputNotifyBroadcasts();\n  }\n\n  const settings = {\n    showPreviews: shouldShowPreviews,\n    silent: isSilent,\n    muteUntil: isSilent ? MAX_INT_32 : 0,\n  };\n\n  return invokeRequest(new GramJs.account.UpdateNotifySettings({\n    peer,\n    settings: new GramJs.InputPeerNotifySettings(settings),\n  }));\n}\n\nexport async function fetchLanguages(): Promise<ApiLanguage[] | undefined> {\n  const result = await invokeRequest(new GramJs.langpack.GetLanguages({\n    langPack: DEFAULT_LANG_PACK,\n  }));\n  if (!result) {\n    return undefined;\n  }\n\n  return result.map(omitVirtualClassFields);\n}\n\nexport async function fetchLangPack({ sourceLangPacks, langCode }: {\n  sourceLangPacks: typeof LANG_PACKS;\n  langCode: string;\n}) {\n  const results = await Promise.all(sourceLangPacks.map((langPack) => {\n    return invokeRequest(new GramJs.langpack.GetLangPack({\n      langPack,\n      langCode: BETA_LANG_CODES.includes(langCode) ? `${langCode}-raw` : langCode,\n    }));\n  }));\n\n  const collections = results.filter(Boolean).map(buildLangPack);\n  if (!collections.length) {\n    return undefined;\n  }\n\n  return { langPack: Object.assign({}, ...collections.reverse()) as typeof collections[0] };\n}\n\nexport async function fetchLangStrings({ langPack, langCode, keys }: {\n  langPack: string; langCode: string; keys: string[];\n}) {\n  const result = await invokeRequest(new GramJs.langpack.GetStrings({\n    langPack,\n    langCode: BETA_LANG_CODES.includes(langCode) ? `${langCode}-raw` : langCode,\n    keys,\n  }));\n\n  if (!result) {\n    return undefined;\n  }\n\n  return result.map(buildLangPackString);\n}\n\nexport async function fetchPrivacySettings(privacyKey: ApiPrivacyKey) {\n  const key = buildInputPrivacyKey(privacyKey);\n  const result = await invokeRequest(new GramJs.account.GetPrivacy({ key }));\n\n  if (!result) {\n    return undefined;\n  }\n\n  updateLocalDb(result);\n\n  return {\n    users: result.users.map(buildApiUser).filter(Boolean),\n    rules: buildPrivacyRules(result.rules),\n  };\n}\n\nexport function registerDevice(token: string) {\n  const client = getClient();\n  const secret = client.session.getAuthKey().getKey();\n  return invokeRequest(new GramJs.account.RegisterDevice({\n    tokenType: 10,\n    secret,\n    appSandbox: false,\n    otherUids: [],\n    token,\n  }));\n}\n\nexport function unregisterDevice(token: string) {\n  return invokeRequest(new GramJs.account.UnregisterDevice({\n    tokenType: 10,\n    otherUids: [],\n    token,\n  }));\n}\n\nexport async function setPrivacySettings(\n  privacyKey: ApiPrivacyKey, rules: ApiInputPrivacyRules,\n) {\n  const key = buildInputPrivacyKey(privacyKey);\n  const privacyRules = buildInputPrivacyRules(rules);\n\n  const result = await invokeRequest(new GramJs.account.SetPrivacy({ key, rules: privacyRules }));\n\n  if (!result) {\n    return undefined;\n  }\n\n  updateLocalDb(result);\n\n  return {\n    users: result.users.map(buildApiUser).filter(Boolean),\n    rules: buildPrivacyRules(result.rules),\n  };\n}\n\nexport async function updateIsOnline(isOnline: boolean) {\n  await invokeRequest(new GramJs.account.UpdateStatus({ offline: !isOnline }));\n}\n\nexport async function fetchContentSettings() {\n  const result = await invokeRequest(new GramJs.account.GetContentSettings());\n  if (!result) {\n    return undefined;\n  }\n\n  return {\n    isSensitiveEnabled: Boolean(result.sensitiveEnabled),\n    canChangeSensitive: Boolean(result.sensitiveCanChange),\n  };\n}\n\nexport function updateContentSettings(isEnabled: boolean) {\n  return invokeRequest(new GramJs.account.SetContentSettings({\n    sensitiveEnabled: isEnabled || undefined,\n  }));\n}\n\nexport async function fetchAppConfig(hash?: number): Promise<ApiAppConfig | undefined> {\n  const result = await invokeRequest(new GramJs.help.GetAppConfig({ hash }));\n  if (!result || result instanceof GramJs.help.AppConfigNotModified) return undefined;\n\n  const { config, hash: resultHash } = result;\n  return buildAppConfig(config, resultHash);\n}\n\nexport async function fetchConfig(): Promise<ApiConfig | undefined> {\n  const result = await invokeRequest(new GramJs.help.GetConfig());\n  if (!result) return undefined;\n\n  return buildApiConfig(result);\n}\n\nexport async function fetchPeerColors(hash?: number) {\n  const result = await invokeRequest(new GramJs.help.GetPeerColors({\n    hash,\n  }));\n  if (!result) return undefined;\n\n  const colors = buildApiPeerColors(result);\n  if (!colors) return undefined;\n\n  const newHash = result instanceof GramJs.help.PeerColors ? result.hash : undefined;\n\n  return {\n    colors,\n    hash: newHash,\n  };\n}\n\nfunction updateLocalDb(\n  result: (\n    GramJs.account.PrivacyRules | GramJs.contacts.Blocked | GramJs.contacts.BlockedSlice |\n    GramJs.Updates | GramJs.UpdatesCombined\n  ),\n) {\n  addEntitiesToLocalDb(result.users);\n  addEntitiesToLocalDb(result.chats);\n}\n\nexport async function fetchCountryList({ langCode = 'en' }: { langCode?: LangCode }) {\n  const countryList = await invokeRequest(new GramJs.help.GetCountriesList({\n    langCode,\n  }));\n\n  if (!(countryList instanceof GramJs.help.CountriesList)) {\n    return undefined;\n  }\n  return buildApiCountryList(countryList.countries);\n}\n\nexport async function fetchGlobalPrivacySettings() {\n  const result = await invokeRequest(new GramJs.account.GetGlobalPrivacySettings());\n\n  if (!result) {\n    return undefined;\n  }\n\n  return {\n    shouldArchiveAndMuteNewNonContact: Boolean(result.archiveAndMuteNewNoncontactPeers),\n    shouldHideReadMarks: Boolean(result.hideReadMarks),\n    shouldNewNonContactPeersRequirePremium: Boolean(result.newNoncontactPeersRequirePremium),\n  };\n}\n\nexport async function updateGlobalPrivacySettings({\n  shouldArchiveAndMuteNewNonContact,\n  shouldHideReadMarks,\n  shouldNewNonContactPeersRequirePremium,\n}: {\n  shouldArchiveAndMuteNewNonContact?: boolean;\n  shouldHideReadMarks?: boolean;\n  shouldNewNonContactPeersRequirePremium?: boolean;\n}) {\n  const result = await invokeRequest(new GramJs.account.SetGlobalPrivacySettings({\n    settings: new GramJs.GlobalPrivacySettings({\n      ...(shouldArchiveAndMuteNewNonContact && { archiveAndMuteNewNoncontactPeers: true }),\n      ...(shouldHideReadMarks && { hideReadMarks: true }),\n      ...(shouldNewNonContactPeersRequirePremium && { newNoncontactPeersRequirePremium: true }),\n    }),\n  }));\n\n  if (!result) {\n    return undefined;\n  }\n\n  return {\n    shouldArchiveAndMuteNewNonContact: Boolean(result.archiveAndMuteNewNoncontactPeers),\n    shouldHideReadMarks: Boolean(result.hideReadMarks),\n    shouldNewNonContactPeersRequirePremium: Boolean(result.newNoncontactPeersRequirePremium),\n  };\n}\n\nexport function toggleUsername({\n  chatId, accessHash, username, isActive,\n}: {\n  username: string;\n  isActive: boolean;\n  chatId?: string;\n  accessHash?: string;\n}) {\n  if (chatId) {\n    return invokeRequest(new GramJs.channels.ToggleUsername({\n      channel: buildInputEntity(chatId, accessHash) as GramJs.InputChannel,\n      username,\n      active: isActive,\n    }));\n  }\n\n  return invokeRequest(new GramJs.account.ToggleUsername({\n    username,\n    active: isActive,\n  }));\n}\n\nexport function reorderUsernames({ chatId, accessHash, usernames }: {\n  usernames: string[];\n  chatId?: string;\n  accessHash?: string;\n}) {\n  if (chatId) {\n    return invokeRequest(new GramJs.channels.ReorderUsernames({\n      channel: buildInputEntity(chatId, accessHash) as GramJs.InputChannel,\n      order: usernames,\n    }));\n  }\n\n  return invokeRequest(new GramJs.account.ReorderUsernames({\n    order: usernames,\n  }));\n}\n","import { Api as GramJs, errors } from '../../../lib/gramjs';\n\nimport type { OnApiUpdate } from '../../types';\n\nimport { DEBUG } from '../../../config';\nimport { getTmpPassword, invokeRequest, updateTwoFaSettings } from './client';\n\nconst ApiErrors: { [k: string]: string } = {\n  EMAIL_UNCONFIRMED: 'Email unconfirmed',\n  EMAIL_HASH_EXPIRED: 'Email hash expired',\n  NEW_SALT_INVALID: 'The new salt is invalid',\n  NEW_SETTINGS_INVALID: 'The new password settings are invalid',\n  CODE_INVALID: 'Invalid Code',\n  PASSWORD_HASH_INVALID: 'Invalid Password',\n};\n\nconst emailCodeController: {\n  resolve?: Function;\n  reject?: Function;\n} = {};\n\nlet onUpdate: OnApiUpdate;\n\nexport function init(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nexport async function getPasswordInfo() {\n  const result = await invokeRequest(new GramJs.account.GetPassword());\n  if (!result) {\n    return undefined;\n  }\n\n  const { hint, hasPassword } = result;\n\n  return { hint, hasPassword };\n}\n\nfunction onRequestEmailCode(length: number) {\n  onUpdate({\n    '@type': 'updateTwoFaStateWaitCode',\n    length,\n  });\n\n  return new Promise<string>((resolve, reject) => {\n    emailCodeController.resolve = resolve;\n    emailCodeController.reject = reject;\n  });\n}\n\nexport function getTemporaryPaymentPassword(password: string, ttl?: number) {\n  return getTmpPassword(password, ttl);\n}\n\nexport async function checkPassword(currentPassword: string) {\n  try {\n    await updateTwoFaSettings({ isCheckPassword: true, currentPassword });\n\n    return true;\n  } catch (err: any) {\n    onError(err);\n\n    return false;\n  }\n}\n\nexport async function clearPassword(currentPassword: string) {\n  try {\n    await updateTwoFaSettings({ currentPassword });\n\n    return true;\n  } catch (err: any) {\n    onError(err);\n\n    return false;\n  }\n}\n\nexport async function updatePassword(currentPassword: string, password: string, hint?: string, email?: string) {\n  try {\n    await updateTwoFaSettings({\n      currentPassword,\n      newPassword: password,\n      hint,\n      email,\n      emailCodeCallback: onRequestEmailCode,\n      onEmailCodeError: onError,\n    });\n\n    return true;\n  } catch (err: any) {\n    onError(err);\n\n    return false;\n  }\n}\n\nexport async function updateRecoveryEmail(currentPassword: string, email: string) {\n  try {\n    await updateTwoFaSettings({\n      currentPassword,\n      newPassword: currentPassword,\n      email,\n      emailCodeCallback: onRequestEmailCode,\n      onEmailCodeError: onError,\n    });\n\n    return true;\n  } catch (err: any) {\n    onError(err);\n\n    return false;\n  }\n}\n\nexport function provideRecoveryEmailCode(code: string) {\n  emailCodeController.resolve!(code);\n}\n\nfunction onError(err: Error) {\n  let message: string;\n\n  if (err instanceof errors.FloodWaitError) {\n    const hours = Math.ceil(Number(err.seconds) / 60 / 60);\n    message = `Too many attempts. Try again in ${hours > 1 ? `${hours} hours` : 'an hour'}`;\n  } else {\n    message = ApiErrors[err.message];\n  }\n\n  if (!message) {\n    message = 'Unexpected Error';\n\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.error(err);\n    }\n  }\n\n  onUpdate({\n    '@type': 'updateTwoFaError',\n    message,\n  });\n}\n","import BigInt from 'big-integer';\nimport { Api as GramJs } from '../../../lib/gramjs';\n\nimport type { ApiChat, ApiReaction } from '../../types';\n\nimport {\n  API_GENERAL_ID_LIMIT,\n  REACTION_LIST_LIMIT,\n  RECENT_REACTIONS_LIMIT,\n  TOP_REACTIONS_LIMIT,\n} from '../../../config';\nimport { split } from '../../../util/iteratees';\nimport { buildApiChatFromPreview } from '../apiBuilders/chats';\nimport {\n  buildApiAvailableReaction,\n  buildApiReaction,\n  buildApiSavedReactionTag,\n  buildMessagePeerReaction,\n} from '../apiBuilders/reactions';\nimport { buildApiUser } from '../apiBuilders/users';\nimport { buildInputPeer, buildInputReaction } from '../gramjsBuilders';\nimport { addEntitiesToLocalDb } from '../helpers';\nimport localDb from '../localDb';\nimport { invokeRequest } from './client';\n\nexport function sendWatchingEmojiInteraction({\n  chat,\n  emoticon,\n}: {\n  chat: ApiChat; emoticon: string;\n}) {\n  return invokeRequest(new GramJs.messages.SetTyping({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    action: new GramJs.SendMessageEmojiInteractionSeen({\n      emoticon,\n    }),\n  }), {\n    abortControllerChatId: chat.id,\n  });\n}\n\nexport function sendEmojiInteraction({\n  chat,\n  emoticon,\n  messageId,\n  timestamps,\n}: {\n  chat: ApiChat; messageId: number; emoticon: string; timestamps: number[];\n}) {\n  return invokeRequest(new GramJs.messages.SetTyping({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    action: new GramJs.SendMessageEmojiInteraction({\n      emoticon,\n      msgId: messageId,\n      interaction: new GramJs.DataJSON({\n        data: JSON.stringify({\n          v: 1,\n          a: timestamps.map((t: number) => ({\n            t,\n            i: 1,\n          })),\n        }),\n      }),\n    }),\n  }), {\n    abortControllerChatId: chat.id,\n  });\n}\n\nexport async function fetchAvailableReactions() {\n  const result = await invokeRequest(new GramJs.messages.GetAvailableReactions({}));\n\n  if (!result || result instanceof GramJs.messages.AvailableReactionsNotModified) {\n    return undefined;\n  }\n\n  result.reactions.forEach((reaction) => {\n    if (reaction.staticIcon instanceof GramJs.Document) {\n      localDb.documents[String(reaction.staticIcon.id)] = reaction.staticIcon;\n    }\n    if (reaction.selectAnimation instanceof GramJs.Document) {\n      localDb.documents[String(reaction.selectAnimation.id)] = reaction.selectAnimation;\n    }\n    if (reaction.aroundAnimation instanceof GramJs.Document) {\n      localDb.documents[String(reaction.aroundAnimation.id)] = reaction.aroundAnimation;\n    }\n    if (reaction.appearAnimation instanceof GramJs.Document) {\n      localDb.documents[String(reaction.appearAnimation.id)] = reaction.appearAnimation;\n    }\n    if (reaction.centerIcon instanceof GramJs.Document) {\n      localDb.documents[String(reaction.centerIcon.id)] = reaction.centerIcon;\n    }\n  });\n\n  return result.reactions.map(buildApiAvailableReaction);\n}\n\nexport function sendReaction({\n  chat, messageId, reactions, shouldAddToRecent,\n}: {\n  chat: ApiChat;\n  messageId: number;\n  reactions?: ApiReaction[];\n  shouldAddToRecent?: boolean;\n}) {\n  return invokeRequest(new GramJs.messages.SendReaction({\n    reaction: reactions?.map((r) => buildInputReaction(r)),\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    msgId: messageId,\n    ...(shouldAddToRecent && { addToRecent: true }),\n  }), {\n    shouldReturnTrue: true,\n    shouldThrow: true,\n  });\n}\n\nexport function fetchMessageReactions({\n  ids, chat,\n}: {\n  ids: number[]; chat: ApiChat;\n}) {\n  const chunks = split(ids, API_GENERAL_ID_LIMIT);\n  chunks.forEach((chunkIds) => {\n    invokeRequest(new GramJs.messages.GetMessagesReactions({\n      id: chunkIds,\n      peer: buildInputPeer(chat.id, chat.accessHash),\n    }), {\n      shouldReturnTrue: true,\n      abortControllerChatId: chat.id,\n    });\n  });\n}\n\nexport async function fetchMessageReactionsList({\n  chat, messageId, reaction, offset,\n}: {\n  chat: ApiChat; messageId: number; reaction?: ApiReaction; offset?: string;\n}) {\n  const result = await invokeRequest(new GramJs.messages.GetMessageReactionsList({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    id: messageId,\n    ...(reaction && { reaction: buildInputReaction(reaction) }),\n    limit: REACTION_LIST_LIMIT,\n    ...(offset && { offset }),\n  }));\n\n  if (!result) {\n    return undefined;\n  }\n\n  addEntitiesToLocalDb(result.users);\n  addEntitiesToLocalDb(result.chats);\n\n  const { nextOffset, reactions, count } = result;\n\n  return {\n    users: result.users.map(buildApiUser).filter(Boolean),\n    chats: result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean),\n    nextOffset,\n    reactions: reactions.map(buildMessagePeerReaction).filter(Boolean),\n    count,\n  };\n}\n\nexport function setDefaultReaction({\n  reaction,\n}: {\n  reaction: ApiReaction;\n}) {\n  return invokeRequest(new GramJs.messages.SetDefaultReaction({\n    reaction: buildInputReaction(reaction),\n  }));\n}\n\nexport async function fetchTopReactions({ hash = '0' }: { hash?: string }) {\n  const result = await invokeRequest(new GramJs.messages.GetTopReactions({\n    limit: TOP_REACTIONS_LIMIT,\n    hash: BigInt(hash),\n  }));\n\n  if (!result || result instanceof GramJs.messages.ReactionsNotModified) {\n    return undefined;\n  }\n\n  return {\n    hash: String(result.hash),\n    reactions: result.reactions.map(buildApiReaction).filter(Boolean),\n  };\n}\n\nexport async function fetchRecentReactions({ hash = '0' }: { hash?: string }) {\n  const result = await invokeRequest(new GramJs.messages.GetRecentReactions({\n    limit: RECENT_REACTIONS_LIMIT,\n    hash: BigInt(hash),\n  }));\n\n  if (!result || result instanceof GramJs.messages.ReactionsNotModified) {\n    return undefined;\n  }\n\n  return {\n    hash: String(result.hash),\n    reactions: result.reactions.map(buildApiReaction).filter(Boolean),\n  };\n}\n\nexport function clearRecentReactions() {\n  return invokeRequest(new GramJs.messages.ClearRecentReactions());\n}\n\nexport async function fetchDefaultTagReactions({ hash = '0' }: { hash?: string }) {\n  const result = await invokeRequest(new GramJs.messages.GetDefaultTagReactions({\n    hash: BigInt(hash),\n  }));\n\n  if (!result || result instanceof GramJs.messages.ReactionsNotModified) {\n    return undefined;\n  }\n\n  return {\n    hash: String(result.hash),\n    reactions: result.reactions.map(buildApiReaction).filter(Boolean),\n  };\n}\n\nexport async function fetchSavedReactionTags({ hash = '0' }: { hash?: string }) {\n  const result = await invokeRequest(new GramJs.messages.GetSavedReactionTags({ hash: BigInt(hash) }));\n\n  if (!result || result instanceof GramJs.messages.SavedReactionTagsNotModified) {\n    return undefined;\n  }\n\n  return {\n    hash: String(result.hash),\n    tags: result.tags.map(buildApiSavedReactionTag).filter(Boolean),\n  };\n}\n\nexport function updateSavedReactionTag({\n  reaction,\n  title,\n}: {\n  reaction: ApiReaction;\n  title?: string;\n}) {\n  return invokeRequest(new GramJs.messages.UpdateSavedReactionTag({\n    reaction: buildInputReaction(reaction),\n    title,\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n","import { Api as GramJs } from '../../../lib/gramjs';\n\nimport type {\n  ApiChannelStatistics,\n  ApiGroupStatistics,\n  ApiMessagePublicForward,\n  ApiPostStatistics,\n  ApiStoryPublicForward,\n  StatisticsGraph,\n  StatisticsMessageInteractionCounter,\n  StatisticsOverviewItem,\n  StatisticsOverviewPercentage,\n  StatisticsOverviewPeriod,\n  StatisticsStoryInteractionCounter,\n} from '../../types';\n\nimport { buildAvatarHash } from './chats';\nimport { buildApiUsernames } from './common';\nimport { buildApiPeerId, getApiChatIdFromMtpPeer } from './peers';\n\nexport function buildChannelStatistics(stats: GramJs.stats.BroadcastStats): ApiChannelStatistics {\n  return {\n    // Graphs\n    growthGraph: buildGraph(stats.growthGraph),\n    followersGraph: buildGraph(stats.followersGraph),\n    muteGraph: buildGraph(stats.muteGraph),\n    topHoursGraph: buildGraph(stats.topHoursGraph),\n\n    // Async graphs\n    languagesGraph: (stats.languagesGraph as GramJs.StatsGraphAsync).token,\n    viewsBySourceGraph: (stats.viewsBySourceGraph as GramJs.StatsGraphAsync).token,\n    newFollowersBySourceGraph: (stats.newFollowersBySourceGraph as GramJs.StatsGraphAsync).token,\n    interactionsGraph: (stats.interactionsGraph as GramJs.StatsGraphAsync).token,\n    reactionsByEmotionGraph: (stats.reactionsByEmotionGraph as GramJs.StatsGraphAsync).token,\n    storyInteractionsGraph: (stats.storyInteractionsGraph as GramJs.StatsGraphAsync).token,\n    storyReactionsByEmotionGraph: (stats.storyReactionsByEmotionGraph as GramJs.StatsGraphAsync).token,\n\n    // Statistics overview\n    followers: buildStatisticsOverview(stats.followers),\n    viewsPerPost: buildStatisticsOverview(stats.viewsPerPost),\n    sharesPerPost: buildStatisticsOverview(stats.sharesPerPost),\n    enabledNotifications: buildStatisticsPercentage(stats.enabledNotifications),\n    reactionsPerPost: buildStatisticsOverview(stats.reactionsPerPost),\n    viewsPerStory: buildStatisticsOverview(stats.viewsPerStory),\n    sharesPerStory: buildStatisticsOverview(stats.sharesPerStory),\n    reactionsPerStory: buildStatisticsOverview(stats.reactionsPerStory),\n\n    // Recent posts\n    recentPosts: stats.recentPostsInteractions.map(buildApiPostInteractionCounter).filter(Boolean),\n  };\n}\n\nexport function buildApiPostInteractionCounter(\n  interaction: GramJs.TypePostInteractionCounters,\n): StatisticsMessageInteractionCounter | StatisticsStoryInteractionCounter | undefined {\n  if (interaction instanceof GramJs.PostInteractionCountersMessage) {\n    return {\n      msgId: interaction.msgId,\n      forwardsCount: interaction.forwards,\n      viewsCount: interaction.views,\n      reactionsCount: interaction.reactions,\n    };\n  }\n\n  if (interaction instanceof GramJs.PostInteractionCountersStory) {\n    return {\n      storyId: interaction.storyId,\n      reactionsCount: interaction.reactions,\n      viewsCount: interaction.views,\n      forwardsCount: interaction.forwards,\n    };\n  }\n\n  return undefined;\n}\n\nexport function buildGroupStatistics(stats: GramJs.stats.MegagroupStats): ApiGroupStatistics {\n  return {\n    // Graphs\n    growthGraph: buildGraph(stats.growthGraph),\n    membersGraph: buildGraph(stats.membersGraph),\n    topHoursGraph: buildGraph(stats.topHoursGraph),\n\n    // Async graphs\n    languagesGraph: (stats.languagesGraph as GramJs.StatsGraphAsync).token,\n    messagesGraph: (stats.messagesGraph as GramJs.StatsGraphAsync).token,\n    actionsGraph: (stats.actionsGraph as GramJs.StatsGraphAsync).token,\n\n    // Statistics overview\n    period: getOverviewPeriod(stats.period),\n    members: buildStatisticsOverview(stats.members),\n    viewers: buildStatisticsOverview(stats.viewers),\n    messages: buildStatisticsOverview(stats.messages),\n    posters: buildStatisticsOverview(stats.posters),\n  };\n}\n\nexport function buildPostsStatistics(stats: GramJs.stats.MessageStats): ApiPostStatistics {\n  return {\n    viewsGraph: buildGraph(stats.viewsGraph),\n    reactionsGraph: buildGraph(stats.reactionsByEmotionGraph),\n  };\n}\n\nexport function buildMessagePublicForwards(\n  result: GramJs.messages.TypeMessages,\n): ApiMessagePublicForward[] | undefined {\n  if (!result || !('messages' in result)) {\n    return undefined;\n  }\n\n  return result.messages.map((message) => buildApiMessagePublicForward(message, result.chats));\n}\n\nexport function buildStoryPublicForwards(\n  result: GramJs.stats.PublicForwards,\n): Array<ApiStoryPublicForward | ApiMessagePublicForward> | undefined {\n  if (!result || !('forwards' in result)) {\n    return undefined;\n  }\n\n  return result.forwards.map((forward) => {\n    if (forward instanceof GramJs.PublicForwardMessage) {\n      return buildApiMessagePublicForward(forward.message, result.chats);\n    }\n\n    const { peer, story } = forward;\n    const peerId = getApiChatIdFromMtpPeer(peer);\n\n    return {\n      peerId,\n      storyId: story.id,\n      viewsCount: (story as GramJs.StoryItem).views?.viewsCount || 0,\n      reactionsCount: (story as GramJs.StoryItem).views?.reactionsCount || 0,\n    } as ApiStoryPublicForward;\n  });\n}\n\nexport function buildGraph(\n  result: GramJs.TypeStatsGraph, isPercentage?: boolean,\n): StatisticsGraph | undefined {\n  if ((result as GramJs.StatsGraphError).error) {\n    return undefined;\n  }\n\n  const data = JSON.parse((result as GramJs.StatsGraph).json.data);\n  const [x, ...y] = data.columns;\n  const hasSecondYAxis = data.y_scaled;\n\n  return {\n    type: isPercentage ? 'area' : data.types.y0,\n    zoomToken: (result as GramJs.StatsGraph).zoomToken,\n    labelFormatter: data.xTickFormatter,\n    tooltipFormatter: data.xTooltipFormatter,\n    labels: x.slice(1),\n    hideCaption: !data.subchart.show,\n    hasSecondYAxis,\n    isStacked: data.stacked && !hasSecondYAxis,\n    isPercentage,\n    datasets: y.map((item: any) => {\n      const key = item[0];\n\n      return {\n        name: data.names[key],\n        color: extractColor(data.colors[key]),\n        values: item.slice(1),\n      };\n    }),\n    ...calculateMinimapRange(data.subchart.defaultZoom, x.slice(1)),\n  };\n}\n\nfunction extractColor(color: string): string {\n  return color.substring(color.indexOf('#'));\n}\n\nfunction calculateMinimapRange(range: Array<number>, values: Array<number>) {\n  const [min, max] = range;\n\n  let minIndex = 0;\n  let maxIndex = values.length - 1;\n\n  values.forEach((item, index) => {\n    if (!minIndex && item >= min) {\n      minIndex = index;\n    }\n\n    if (!maxIndex && item >= max) {\n      maxIndex = index;\n    }\n  });\n\n  const begin = Math.max(0, minIndex / (values.length - 1));\n  const end = Math.min(1, maxIndex / (values.length - 1));\n\n  return { minimapRange: { begin, end }, labelFromIndex: minIndex, labelToIndex: maxIndex };\n}\n\nfunction buildStatisticsOverview({ current, previous }: GramJs.StatsAbsValueAndPrev): StatisticsOverviewItem {\n  const change = current - previous;\n\n  return {\n    current,\n    change,\n    ...(previous && { percentage: (change ? ((Math.abs(change) / previous) * 100) : 0).toFixed(2) }),\n  };\n}\n\nexport function buildStatisticsPercentage(data: GramJs.StatsPercentValue): StatisticsOverviewPercentage {\n  return {\n    part: data.part,\n    total: data.total,\n    percentage: ((data.part / data.total) * 100).toFixed(2),\n  };\n}\n\nfunction getOverviewPeriod(data: GramJs.StatsDateRangeDays): StatisticsOverviewPeriod {\n  return {\n    maxDate: data.maxDate,\n    minDate: data.minDate,\n  };\n}\n\nfunction buildApiMessagePublicForward(message: GramJs.TypeMessage, chats: GramJs.TypeChat[]): ApiMessagePublicForward {\n  const peerId = getApiChatIdFromMtpPeer(message.peerId!);\n  const channel = chats.find((c) => buildApiPeerId(c.id, 'channel') === peerId);\n\n  return {\n    messageId: message.id,\n    views: (message as GramJs.Message).views,\n    title: (channel as GramJs.Channel).title,\n    chat: {\n      id: peerId,\n      type: 'chatTypeChannel',\n      title: (channel as GramJs.Channel).title,\n      usernames: buildApiUsernames(channel as GramJs.Channel),\n      avatarHash: channel && 'photo' in channel\n        ? buildAvatarHash((channel as GramJs.Channel).photo)\n        : undefined,\n    },\n  };\n}\n","import BigInt from 'big-integer';\nimport { Api as GramJs } from '../../../lib/gramjs';\n\nimport type {\n  ApiChat, ApiMessagePublicForward, ApiPostStatistics, ApiStoryPublicForward, ApiUser, StatisticsGraph,\n} from '../../types';\n\nimport { STATISTICS_PUBLIC_FORWARDS_LIMIT } from '../../../config';\nimport { buildApiChatFromPreview } from '../apiBuilders/chats';\nimport {\n  buildChannelStatistics,\n  buildGraph,\n  buildGroupStatistics,\n  buildMessagePublicForwards,\n  buildPostsStatistics,\n  buildStoryPublicForwards,\n} from '../apiBuilders/statistics';\nimport { buildApiUser } from '../apiBuilders/users';\nimport { buildInputEntity, buildInputPeer } from '../gramjsBuilders';\nimport { addEntitiesToLocalDb } from '../helpers';\nimport { invokeRequest } from './client';\n\nexport async function fetchChannelStatistics({\n  chat, dcId,\n}: { chat: ApiChat; dcId?: number }) {\n  const result = await invokeRequest(new GramJs.stats.GetBroadcastStats({\n    channel: buildInputEntity(chat.id, chat.accessHash) as GramJs.InputChannel,\n  }), {\n    dcId,\n  });\n\n  if (!result) {\n    return undefined;\n  }\n\n  return {\n    stats: buildChannelStatistics(result),\n    users: [],\n  };\n}\n\nexport async function fetchGroupStatistics({\n  chat, dcId,\n}: { chat: ApiChat; dcId?: number }) {\n  const result = await invokeRequest(new GramJs.stats.GetMegagroupStats({\n    channel: buildInputEntity(chat.id, chat.accessHash) as GramJs.InputChannel,\n  }), {\n    dcId,\n  });\n\n  if (!result) {\n    return undefined;\n  }\n\n  addEntitiesToLocalDb(result.users);\n\n  return {\n    users: result.users.map(buildApiUser).filter(Boolean),\n    stats: buildGroupStatistics(result),\n  };\n}\n\nexport async function fetchMessageStatistics({\n  chat,\n  messageId,\n  dcId,\n}: {\n  chat: ApiChat;\n  messageId: number;\n  dcId?: number;\n}): Promise<ApiPostStatistics | undefined> {\n  const result = await invokeRequest(new GramJs.stats.GetMessageStats({\n    channel: buildInputEntity(chat.id, chat.accessHash) as GramJs.InputChannel,\n    msgId: messageId,\n  }), {\n    dcId,\n  });\n\n  if (!result) {\n    return undefined;\n  }\n\n  return buildPostsStatistics(result);\n}\n\nexport async function fetchMessagePublicForwards({\n  chat,\n  messageId,\n  dcId,\n  offset,\n}: {\n  chat: ApiChat;\n  messageId: number;\n  dcId?: number;\n  offset?: string;\n}): Promise<{\n    forwards?: ApiMessagePublicForward[];\n    count?: number;\n    nextOffset?: string;\n    chats: ApiChat[];\n    users: ApiUser[];\n  } | undefined> {\n  const result = await invokeRequest(new GramJs.stats.GetMessagePublicForwards({\n    channel: buildInputEntity(chat.id, chat.accessHash) as GramJs.InputChannel,\n    msgId: messageId,\n    offset,\n    limit: STATISTICS_PUBLIC_FORWARDS_LIMIT,\n  }), {\n    dcId,\n  });\n\n  if (!result) {\n    return undefined;\n  }\n\n  addEntitiesToLocalDb(result.chats);\n  addEntitiesToLocalDb(result.users);\n\n  return {\n    forwards: buildMessagePublicForwards(result),\n    count: result.count,\n    nextOffset: result.nextOffset,\n    chats: result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean),\n    users: result.users.map(buildApiUser).filter(Boolean),\n  };\n}\n\nexport async function fetchStatisticsAsyncGraph({\n  token,\n  x,\n  isPercentage,\n  dcId,\n}: {\n  token: string;\n  x?: number;\n  isPercentage?: boolean;\n  dcId?: number;\n}): Promise<StatisticsGraph | undefined> {\n  const result = await invokeRequest(new GramJs.stats.LoadAsyncGraph({\n    token,\n    ...(x && { x: BigInt(x) }),\n  }), {\n    dcId,\n  });\n\n  if (!result) {\n    return undefined;\n  }\n\n  return buildGraph(result as GramJs.StatsGraph, isPercentage);\n}\n\nexport async function fetchStoryStatistics({\n  chat,\n  storyId,\n  dcId,\n}: {\n  chat: ApiChat;\n  storyId: number;\n  dcId?: number;\n}): Promise<ApiPostStatistics | undefined> {\n  const result = await invokeRequest(new GramJs.stats.GetStoryStats({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    id: storyId,\n  }), {\n    dcId,\n  });\n\n  if (!result) {\n    return undefined;\n  }\n\n  return buildPostsStatistics(result);\n}\n\nexport async function fetchStoryPublicForwards({\n  chat,\n  storyId,\n  dcId,\n  offset,\n}: {\n  chat: ApiChat;\n  storyId: number;\n  dcId?: number;\n  offset?: string;\n}): Promise<{\n    publicForwards: (ApiMessagePublicForward | ApiStoryPublicForward)[] | undefined;\n    users: ApiUser[];\n    chats: ApiChat[];\n    count?: number;\n    nextOffset?: string;\n  } | undefined> {\n  const result = await invokeRequest(new GramJs.stats.GetStoryPublicForwards({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    id: storyId,\n    offset,\n    limit: STATISTICS_PUBLIC_FORWARDS_LIMIT,\n  }), {\n    dcId,\n  });\n\n  if (!result) {\n    return undefined;\n  }\n\n  addEntitiesToLocalDb(result.chats);\n  addEntitiesToLocalDb(result.users);\n\n  return {\n    publicForwards: buildStoryPublicForwards(result),\n    users: result.users.map(buildApiUser).filter(Boolean),\n    chats: result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean),\n    count: result.count,\n    nextOffset: result.nextOffset,\n  };\n}\n","import type bigInt from 'big-integer';\nimport BigInt from 'big-integer';\nimport AuthKey from '../../../lib/gramjs/crypto/AuthKey';\nimport Logger from '../../../lib/gramjs/extensions/Logger';\nimport Helpers from '../../../lib/gramjs/Helpers';\nimport MTProtoState from '../../../lib/gramjs/network/MTProtoState';\n\ntype DhConfig = {\n  p: number[];\n  g: number;\n  random: number[];\n};\n\nlet currentPhoneCallState: PhoneCallState | undefined;\n\nclass PhoneCallState {\n  private state?: MTProtoState;\n\n  private seq = 0;\n\n  private gA?: bigInt.BigInteger;\n\n  private gB: any;\n\n  private p?: bigInt.BigInteger;\n\n  private random?: bigInt.BigInteger;\n\n  private waitForState: Promise<void>;\n\n  private resolveState?: VoidFunction;\n\n  constructor(\n    private isOutgoing: boolean,\n  ) {\n    this.waitForState = new Promise<void>((resolve) => {\n      this.resolveState = resolve;\n    });\n  }\n\n  async requestCall({ p, g, random }: DhConfig) {\n    const pBN = Helpers.readBigIntFromBuffer(Buffer.from(p), false);\n    const randomBN = Helpers.readBigIntFromBuffer(Buffer.from(random), false);\n\n    const gA = Helpers.modExp(BigInt(g), randomBN, pBN);\n\n    this.gA = gA;\n    this.p = pBN;\n    this.random = randomBN;\n\n    const gAHash: Buffer = await Helpers.sha256(Helpers.getByteArray(gA));\n    return Array.from(gAHash);\n  }\n\n  acceptCall({ p, g, random }: DhConfig) {\n    const pLast = Helpers.readBigIntFromBuffer(p, false);\n    const randomLast = Helpers.readBigIntFromBuffer(random, false);\n\n    const gB = Helpers.modExp(BigInt(g), randomLast, pLast);\n    this.gB = gB;\n    this.p = pLast;\n    this.random = randomLast;\n\n    return Array.from(Helpers.getByteArray(gB));\n  }\n\n  async confirmCall(gAOrB: number[], emojiData: Uint16Array, emojiOffsets: number[]) {\n    if (this.isOutgoing) {\n      this.gB = Helpers.readBigIntFromBuffer(Buffer.from(gAOrB), false);\n    } else {\n      this.gA = Helpers.readBigIntFromBuffer(Buffer.from(gAOrB), false);\n    }\n    const authKey = Helpers.modExp(\n      !this.isOutgoing ? this.gA : this.gB,\n      this.random,\n      this.p,\n    );\n    const fingerprint: Buffer = await Helpers.sha1(Helpers.getByteArray(authKey));\n    const keyFingerprint = Helpers.readBigIntFromBuffer(fingerprint.slice(-8).reverse(), false);\n\n    const emojis = await generateEmojiFingerprint(\n      Helpers.getByteArray(authKey),\n      Helpers.getByteArray(this.gA),\n      emojiData,\n      emojiOffsets,\n    );\n\n    const key = new AuthKey();\n    await key.setKey(Helpers.getByteArray(authKey));\n    this.state = new MTProtoState(key, new Logger(), true, this.isOutgoing);\n    this.resolveState!();\n\n    return { gA: Array.from(Helpers.getByteArray(this.gA)), keyFingerprint: keyFingerprint.toString(), emojis };\n  }\n\n  async encode(data: string) {\n    if (!this.state) return undefined;\n\n    const seqArray = new Uint32Array(1);\n    seqArray[0] = this.seq++;\n    const encodedData = await this.state.encryptMessageData(\n      Buffer.concat([Helpers.convertToLittle(seqArray), Buffer.from(data)]),\n    );\n    return Array.from(encodedData);\n  }\n\n  async decode(data: number[]): Promise<any> {\n    if (!this.state) {\n      return this.waitForState.then(() => {\n        return this.decode(data);\n      });\n    }\n\n    const message = await this.state.decryptMessageData(Buffer.from(data));\n\n    return JSON.parse(message.toString());\n  }\n}\n\n// https://github.com/TelegramV/App/blob/ead52320975362139cabad18cf8346f98c349a22/src/js/MTProto/Calls/Internal.js#L72\nfunction computeEmojiIndex(bytes: Uint8Array) {\n  return ((BigInt(bytes[0]).and(0x7F)).shiftLeft(56))\n    .or((BigInt(bytes[1]).shiftLeft(48)))\n    .or((BigInt(bytes[2]).shiftLeft(40)))\n    .or((BigInt(bytes[3]).shiftLeft(32)))\n    .or((BigInt(bytes[4]).shiftLeft(24)))\n    .or((BigInt(bytes[5]).shiftLeft(16)))\n    .or((BigInt(bytes[6]).shiftLeft(8)))\n    .or((BigInt(bytes[7])));\n}\n\nexport async function generateEmojiFingerprint(\n  authKey: Uint8Array, gA: Uint8Array, emojiData: Uint16Array, emojiOffsets: number[],\n) {\n  const hash = await Helpers.sha256(Buffer.concat([new Uint8Array(authKey), new Uint8Array(gA)]));\n  const result = [];\n  const emojiCount = emojiOffsets.length - 1;\n  const kPartSize = 8;\n  for (let partOffset = 0; partOffset !== hash.byteLength; partOffset += kPartSize) {\n    const value = computeEmojiIndex(hash.subarray(partOffset, partOffset + kPartSize));\n    const index = value.modPow(1, emojiCount).toJSNumber();\n    const offset = emojiOffsets[index];\n    const size = emojiOffsets[index + 1] - offset;\n    result.push(String.fromCharCode(...emojiData.subarray(offset, offset + size)));\n  }\n  return result.join('');\n}\n\nexport function createPhoneCallState(params: ConstructorParameters<typeof PhoneCallState>) {\n  currentPhoneCallState = new PhoneCallState(...params);\n}\n\nexport function destroyPhoneCallState() {\n  currentPhoneCallState = undefined;\n}\n\ntype FunctionPropertyOf<T> = {\n  [P in keyof T]: T[P] extends Function\n    ? P\n    : never\n}[keyof T];\n\ntype ParamsOf<T extends FunctionPropertyOf<PhoneCallState>> = Parameters<PhoneCallState[T]>;\ntype ReturnTypeOf<T extends FunctionPropertyOf<PhoneCallState>> = ReturnType<PhoneCallState[T]>;\n\nexport function encodePhoneCallData(params: ParamsOf<'encode'>): ReturnTypeOf<'encode'> {\n  return currentPhoneCallState!.encode(...params);\n}\n\nexport async function decodePhoneCallData(params: ParamsOf<'decode'>) {\n  if (!currentPhoneCallState) {\n    return undefined;\n  }\n  const result = await currentPhoneCallState.decode(...params);\n  return result;\n}\n\nexport function confirmPhoneCall(params: ParamsOf<'confirmCall'>): ReturnTypeOf<'confirmCall'> {\n  return currentPhoneCallState!.confirmCall(...params);\n}\n\nexport function acceptPhoneCall(params: ParamsOf<'acceptCall'>): ReturnTypeOf<'acceptCall'> {\n  return currentPhoneCallState!.acceptCall(...params);\n}\n\nexport function requestPhoneCall(params: ParamsOf<'requestCall'>): ReturnTypeOf<'requestCall'> {\n  return currentPhoneCallState!.requestCall(...params);\n}\n","import BigInt from 'big-integer';\nimport { Api as GramJs } from '../../../lib/gramjs';\n\nimport type {\n  ApiChat, ApiPeer, ApiRequestInputInvoice,\n  OnApiUpdate,\n} from '../../types';\n\nimport { buildCollectionByCallback } from '../../../util/iteratees';\nimport { buildApiChatFromPreview } from '../apiBuilders/chats';\nimport {\n  buildApiBoostsStatus,\n  buildApiCheckedGiftCode,\n  buildApiGiveawayInfo,\n  buildApiInvoiceFromForm,\n  buildApiMyBoost,\n  buildApiPaymentForm,\n  buildApiPremiumPromo,\n  buildApiReceipt,\n  buildShippingOptions,\n} from '../apiBuilders/payments';\nimport { buildApiUser } from '../apiBuilders/users';\nimport { buildInputInvoice, buildInputPeer, buildShippingInfo } from '../gramjsBuilders';\nimport {\n  addEntitiesToLocalDb,\n  deserializeBytes,\n  serializeBytes,\n} from '../helpers';\nimport localDb from '../localDb';\nimport { invokeRequest } from './client';\nimport { getTemporaryPaymentPassword } from './twoFaSettings';\n\nlet onUpdate: OnApiUpdate;\n\nexport function init(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nexport async function validateRequestedInfo({\n  inputInvoice,\n  requestInfo,\n  shouldSave,\n}: {\n  inputInvoice: ApiRequestInputInvoice;\n  requestInfo: GramJs.TypePaymentRequestedInfo;\n  shouldSave?: boolean;\n}): Promise<{\n    id: string;\n    shippingOptions: any;\n  } | undefined> {\n  const result = await invokeRequest(new GramJs.payments.ValidateRequestedInfo({\n    invoice: buildInputInvoice(inputInvoice),\n    save: shouldSave || undefined,\n    info: buildShippingInfo(requestInfo),\n  }));\n  if (!result) {\n    return undefined;\n  }\n\n  const { id, shippingOptions } = result;\n  if (!id) {\n    return undefined;\n  }\n\n  return {\n    id,\n    shippingOptions: buildShippingOptions(shippingOptions),\n  };\n}\n\nexport async function sendPaymentForm({\n  inputInvoice,\n  formId,\n  requestedInfoId,\n  shippingOptionId,\n  credentials,\n  savedCredentialId,\n  temporaryPassword,\n  tipAmount,\n}: {\n  inputInvoice: ApiRequestInputInvoice;\n  formId: string;\n  credentials: any;\n  requestedInfoId?: string;\n  shippingOptionId?: string;\n  savedCredentialId?: string;\n  temporaryPassword?: string;\n  tipAmount?: number;\n}) {\n  const inputCredentials = temporaryPassword && savedCredentialId\n    ? new GramJs.InputPaymentCredentialsSaved({\n      id: savedCredentialId,\n      tmpPassword: deserializeBytes(temporaryPassword),\n    })\n    : new GramJs.InputPaymentCredentials({\n      save: credentials.save,\n      data: new GramJs.DataJSON({ data: JSON.stringify(credentials.data) }),\n    });\n  const result = await invokeRequest(new GramJs.payments.SendPaymentForm({\n    formId: BigInt(formId),\n    invoice: buildInputInvoice(inputInvoice),\n    requestedInfoId,\n    shippingOptionId,\n    credentials: inputCredentials,\n    ...(tipAmount && { tipAmount: BigInt(tipAmount) }),\n  }));\n\n  if (result instanceof GramJs.payments.PaymentVerificationNeeded) {\n    onUpdate({\n      '@type': 'updatePaymentVerificationNeeded',\n      url: result.url,\n    });\n\n    return undefined;\n  }\n\n  return Boolean(result);\n}\n\nexport async function getPaymentForm(inputInvoice: ApiRequestInputInvoice) {\n  const result = await invokeRequest(new GramJs.payments.GetPaymentForm({\n    invoice: buildInputInvoice(inputInvoice),\n  }));\n\n  if (!result) {\n    return undefined;\n  }\n\n  if (result.photo) {\n    localDb.webDocuments[result.photo.url] = result.photo;\n  }\n\n  addEntitiesToLocalDb(result.users);\n\n  return {\n    form: buildApiPaymentForm(result),\n    invoice: buildApiInvoiceFromForm(result),\n    users: result.users.map(buildApiUser).filter(Boolean),\n    botId: result.botId.toString(),\n  };\n}\n\nexport async function getReceipt(chat: ApiChat, msgId: number) {\n  const result = await invokeRequest(new GramJs.payments.GetPaymentReceipt({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    msgId,\n  }));\n\n  if (!result) {\n    return undefined;\n  }\n\n  addEntitiesToLocalDb(result.users);\n\n  return {\n    receipt: buildApiReceipt(result),\n    users: result.users.map(buildApiUser).filter(Boolean),\n  };\n}\n\nexport async function fetchPremiumPromo() {\n  const result = await invokeRequest(new GramJs.help.GetPremiumPromo());\n  if (!result) return undefined;\n\n  addEntitiesToLocalDb(result.users);\n\n  const users = result.users.map(buildApiUser).filter(Boolean);\n  result.videos.forEach((video) => {\n    if (video instanceof GramJs.Document) {\n      localDb.documents[video.id.toString()] = video;\n    }\n  });\n\n  return {\n    promo: buildApiPremiumPromo(result),\n    users,\n  };\n}\n\nexport async function fetchTemporaryPaymentPassword(password: string) {\n  const result = await getTemporaryPaymentPassword(password);\n\n  if (!result) {\n    return undefined;\n  }\n\n  if ('error' in result) {\n    return result;\n  }\n\n  return {\n    value: serializeBytes(result.tmpPassword),\n    validUntil: result.validUntil,\n  };\n}\n\nexport async function fetchMyBoosts() {\n  const result = await invokeRequest(new GramJs.premium.GetMyBoosts());\n\n  if (!result) return undefined;\n\n  addEntitiesToLocalDb(result.users);\n  addEntitiesToLocalDb(result.chats);\n\n  const users = result.users.map(buildApiUser).filter(Boolean);\n  const chats = result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean);\n  const boosts = result.myBoosts.map(buildApiMyBoost);\n\n  return {\n    users,\n    chats,\n    boosts,\n  };\n}\n\nexport async function applyBoost({\n  chat,\n  slots,\n} : {\n  chat: ApiChat;\n  slots: number[];\n}) {\n  const result = await invokeRequest(new GramJs.premium.ApplyBoost({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    slots,\n  }));\n\n  if (!result) return undefined;\n\n  addEntitiesToLocalDb(result.users);\n  addEntitiesToLocalDb(result.chats);\n\n  const users = result.users.map(buildApiUser).filter(Boolean);\n  const chats = result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean);\n  const boosts = result.myBoosts.map(buildApiMyBoost);\n\n  return {\n    users,\n    chats,\n    boosts,\n  };\n}\n\nexport async function fetchBoostsStatus({\n  chat,\n}: {\n  chat: ApiChat;\n}) {\n  const result = await invokeRequest(new GramJs.premium.GetBoostsStatus({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n  }));\n\n  if (!result) {\n    return undefined;\n  }\n\n  return buildApiBoostsStatus(result);\n}\n\nexport async function fetchBoostsList({\n  chat,\n  offset = '',\n  limit,\n}: {\n  chat: ApiChat;\n  offset?: string;\n  limit?: number;\n}) {\n  const result = await invokeRequest(new GramJs.premium.GetBoostsList({\n    peer: buildInputPeer(chat.id, chat.accessHash),\n    offset,\n    limit,\n  }));\n\n  if (!result) {\n    return undefined;\n  }\n\n  addEntitiesToLocalDb(result.users);\n\n  const users = result.users.map(buildApiUser).filter(Boolean);\n\n  const userBoosts = result.boosts.filter((boost) => boost.userId);\n  const boosterIds = userBoosts.map((boost) => boost.userId!.toString());\n  const boosters = buildCollectionByCallback(userBoosts, (boost) => (\n    [boost.userId!.toString(), boost.expires]\n  ));\n\n  return {\n    count: result.count,\n    users,\n    boosters,\n    boosterIds,\n    nextOffset: result.nextOffset,\n  };\n}\n\nexport async function fetchGiveawayInfo({\n  peer,\n  messageId,\n}: {\n  peer: ApiPeer;\n  messageId: number;\n}) {\n  const result = await invokeRequest(new GramJs.payments.GetGiveawayInfo({\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    msgId: messageId,\n  }));\n\n  if (!result) {\n    return undefined;\n  }\n\n  return buildApiGiveawayInfo(result);\n}\n\nexport async function checkGiftCode({\n  slug,\n}: {\n  slug: string;\n}) {\n  const result = await invokeRequest(new GramJs.payments.CheckGiftCode({\n    slug,\n  }));\n\n  if (!result) {\n    return undefined;\n  }\n\n  addEntitiesToLocalDb(result.users);\n  addEntitiesToLocalDb(result.chats);\n\n  return {\n    code: buildApiCheckedGiftCode(result),\n    users: result.users.map(buildApiUser).filter(Boolean),\n    chats: result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean),\n  };\n}\n\nexport function applyGiftCode({\n  slug,\n}: {\n  slug: string;\n}) {\n  return invokeRequest(new GramJs.payments.ApplyGiftCode({\n    slug,\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n","import type {\n  ApiInitialArgs,\n  ApiOnProgress,\n  ApiUpdate,\n  OnApiUpdate,\n} from '../../types';\nimport type { LocalDb } from '../localDb';\nimport type { MethodArgs, MethodResponse, Methods } from './types';\n\nimport { API_THROTTLE_RESET_UPDATES, API_UPDATE_THROTTLE } from '../../../config';\nimport { throttle, throttleWithTickEnd } from '../../../util/schedulers';\nimport { updateFullLocalDb } from '../localDb';\nimport { init as initUpdater } from '../updates/updater';\nimport { init as initAuth } from './auth';\nimport { init as initBots } from './bots';\nimport { init as initCalls } from './calls';\nimport { init as initChats } from './chats';\nimport { init as initClient } from './client';\nimport * as methods from './index';\nimport { init as initManagement } from './management';\nimport { init as initMessages } from './messages';\nimport { init as initPayments } from './payments';\nimport { init as initStickers } from './symbols';\nimport { init as initTwoFaSettings } from './twoFaSettings';\nimport { init as initUsers } from './users';\n\nlet onUpdate: OnApiUpdate;\n\nexport function initApi(_onUpdate: OnApiUpdate, initialArgs: ApiInitialArgs, initialLocalDb?: LocalDb) {\n  onUpdate = _onUpdate;\n\n  initUpdater(handleUpdate);\n  initAuth(handleUpdate);\n  initChats(handleUpdate);\n  initMessages(handleUpdate);\n  initUsers(handleUpdate);\n  initStickers(handleUpdate);\n  initManagement(handleUpdate);\n  initTwoFaSettings(handleUpdate);\n  initBots(handleUpdate);\n  initCalls(handleUpdate);\n  initPayments(handleUpdate);\n\n  if (initialLocalDb) updateFullLocalDb(initialLocalDb);\n\n  initClient(handleUpdate, initialArgs);\n}\n\nexport function callApi<T extends keyof Methods>(fnName: T, ...args: MethodArgs<T>): MethodResponse<T> {\n  // @ts-ignore\n  return methods[fnName](...args) as MethodResponse<T>;\n}\n\nexport function cancelApiProgress(progressCallback: ApiOnProgress) {\n  progressCallback.isCanceled = true;\n}\n\nconst flushUpdatesOnTickEnd = throttleWithTickEnd(flushUpdates);\n\nlet flushUpdatesThrottled: typeof flushUpdatesOnTickEnd | undefined;\nlet currentThrottleId: number | undefined;\n\nlet pendingUpdates: ApiUpdate[] | undefined;\n\nfunction handleUpdate(update: ApiUpdate) {\n  if (!pendingUpdates) {\n    pendingUpdates = [update];\n  } else {\n    pendingUpdates.push(update);\n  }\n\n  if (!flushUpdatesThrottled || API_THROTTLE_RESET_UPDATES.has(update['@type'])) {\n    flushUpdatesThrottled = throttle(flushUpdatesOnTickEnd, API_UPDATE_THROTTLE, true);\n    currentThrottleId = Math.random();\n  }\n\n  flushUpdatesThrottled(currentThrottleId!);\n}\n\nfunction flushUpdates(throttleId: number) {\n  if (!pendingUpdates || throttleId !== currentThrottleId) {\n    return;\n  }\n\n  const currentUpdates = pendingUpdates!;\n  pendingUpdates = undefined;\n  currentUpdates.forEach(onUpdate);\n}\n","import { Api as GramJs } from '../../../lib/gramjs';\n\nimport type { ApiInputPrivacyRules } from '../../../types';\nimport type {\n  ApiChat,\n  ApiPeer,\n  ApiPeerStories,\n  ApiReaction,\n  ApiReportReason,\n  ApiStealthMode,\n  ApiTypeStory,\n  ApiUser,\n} from '../../types';\n\nimport { STORY_LIST_LIMIT } from '../../../config';\nimport { buildCollectionByCallback } from '../../../util/iteratees';\nimport { buildApiChatFromPreview } from '../apiBuilders/chats';\nimport { getApiChatIdFromMtpPeer } from '../apiBuilders/peers';\nimport {\n  buildApiPeerStories,\n  buildApiStealthMode,\n  buildApiStory,\n  buildApiStoryView,\n} from '../apiBuilders/stories';\nimport { buildApiUser } from '../apiBuilders/users';\nimport {\n  buildInputPeer,\n  buildInputPrivacyRules,\n  buildInputReaction,\n  buildInputReportReason,\n} from '../gramjsBuilders';\nimport { addEntitiesToLocalDb, addStoryToLocalDb } from '../helpers';\nimport { invokeRequest } from './client';\n\nexport async function fetchAllStories({\n  stateHash,\n  isFirstRequest = false,\n  isHidden = false,\n}: {\n  isFirstRequest?: boolean;\n  stateHash?: string;\n  isHidden?: boolean;\n}): Promise<\n  undefined\n  | { state: string; stealthMode: ApiStealthMode }\n  | {\n    users: ApiUser[];\n    chats: ApiChat[];\n    peerStories: Record<string, ApiPeerStories>;\n    hasMore?: true;\n    state: string;\n    stealthMode: ApiStealthMode;\n  }> {\n  const params: ConstructorParameters<typeof GramJs.stories.GetAllStories>[0] = isFirstRequest\n    ? (isHidden ? { hidden: true } : {})\n    : { state: stateHash, next: true, ...(isHidden && { hidden: true }) };\n  const result = await invokeRequest(new GramJs.stories.GetAllStories(params));\n\n  if (!result) {\n    return undefined;\n  }\n\n  if (result instanceof GramJs.stories.AllStoriesNotModified) {\n    return {\n      state: result.state,\n      stealthMode: buildApiStealthMode(result.stealthMode),\n    };\n  }\n\n  addEntitiesToLocalDb(result.users);\n  addEntitiesToLocalDb(result.chats);\n  result.peerStories.forEach((peerStories) => (\n    peerStories.stories.forEach((story) => addStoryToLocalDb(story, getApiChatIdFromMtpPeer(peerStories.peer)))\n  ));\n\n  const allUserStories = result.peerStories.reduce<Record<string, ApiPeerStories>>((acc, peerStories) => {\n    const peerId = getApiChatIdFromMtpPeer(peerStories.peer);\n    const stories = buildApiPeerStories(peerStories);\n    const { pinnedIds, orderedIds, lastUpdatedAt } = Object.values(stories).reduce<\n    {\n      pinnedIds: number[];\n      orderedIds: number[];\n      lastUpdatedAt?: number;\n    }\n    >((dataAcc, story) => {\n      if ('isPinned' in story && story.isPinned) {\n        dataAcc.pinnedIds.push(story.id);\n      }\n      if (!('isDeleted' in story)) {\n        dataAcc.orderedIds.push(story.id);\n        dataAcc.lastUpdatedAt = Math.max(story.date, dataAcc.lastUpdatedAt || 0);\n      }\n\n      return dataAcc;\n    }, {\n      pinnedIds: [],\n      orderedIds: [],\n      lastUpdatedAt: undefined,\n    });\n\n    if (orderedIds.length === 0) {\n      return acc;\n    }\n\n    acc[peerId] = {\n      byId: stories,\n      orderedIds,\n      pinnedIds,\n      lastUpdatedAt,\n      lastReadId: peerStories.maxReadId,\n    };\n\n    return acc;\n  }, {});\n\n  return {\n    users: result.users.map(buildApiUser).filter(Boolean),\n    chats: result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean),\n    peerStories: allUserStories,\n    hasMore: result.hasMore,\n    state: result.state,\n    stealthMode: buildApiStealthMode(result.stealthMode),\n  };\n}\n\nexport async function fetchPeerStories({\n  peer,\n}: {\n  peer: ApiPeer;\n}) {\n  const result = await invokeRequest(new GramJs.stories.GetPeerStories({\n    peer: buildInputPeer(peer.id, peer.accessHash),\n  }));\n\n  if (!result) {\n    return undefined;\n  }\n\n  addEntitiesToLocalDb(result.users);\n  result.stories.stories.forEach((story) => addStoryToLocalDb(story, peer.id));\n\n  const users = result.users.map(buildApiUser).filter(Boolean);\n  const chats = result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean);\n  const stories = buildCollectionByCallback(result.stories.stories, (story) => (\n    [story.id, buildApiStory(peer.id, story)]\n  ));\n\n  return {\n    chats,\n    users,\n    stories,\n    lastReadStoryId: result.stories.maxReadId,\n  };\n}\n\nexport function fetchPeerPinnedStories({\n  peer, offsetId,\n}: {\n  peer: ApiPeer;\n  offsetId?: number;\n}) {\n  return fetchCommonStoriesRequest({\n    method: new GramJs.stories.GetPinnedStories({\n      peer: buildInputPeer(peer.id, peer.accessHash),\n      offsetId,\n      limit: STORY_LIST_LIMIT,\n    }),\n    peerId: peer.id,\n  });\n}\n\nexport function fetchStoriesArchive({\n  peer,\n  offsetId,\n}: {\n  peer: ApiPeer;\n  offsetId?: number;\n}) {\n  return fetchCommonStoriesRequest({\n    method: new GramJs.stories.GetStoriesArchive({\n      peer: peer && buildInputPeer(peer.id, peer.accessHash),\n      offsetId,\n      limit: STORY_LIST_LIMIT,\n    }),\n    peerId: peer.id,\n  });\n}\n\nexport async function fetchPeerStoriesByIds({ peer, ids }: { peer: ApiPeer; ids: number[] }) {\n  const result = await invokeRequest(new GramJs.stories.GetStoriesByID({\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    id: ids,\n  }));\n\n  if (!result) {\n    return undefined;\n  }\n\n  addEntitiesToLocalDb(result.users);\n  addEntitiesToLocalDb(result.chats);\n  result.stories.forEach((story) => addStoryToLocalDb(story, peer.id));\n\n  const users = result.users.map(buildApiUser).filter(Boolean);\n  const chats = result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean);\n  const stories = ids.reduce<Record<string, ApiTypeStory>>((acc, id) => {\n    const story = result.stories.find(({ id: currentId }) => currentId === id);\n    if (story) {\n      acc[id] = buildApiStory(peer.id, story);\n    } else {\n      acc[id] = {\n        id,\n        peerId: peer.id,\n        isDeleted: true,\n      };\n    }\n\n    return acc;\n  }, {});\n\n  return {\n    chats,\n    users,\n    stories,\n  };\n}\n\nexport function viewStory({ peer, storyId }: { peer: ApiPeer; storyId: number }) {\n  return invokeRequest(new GramJs.stories.IncrementStoryViews({\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    id: [storyId],\n  }));\n}\n\nexport function markStoryRead({ peer, storyId }: { peer: ApiPeer; storyId: number }) {\n  return invokeRequest(new GramJs.stories.ReadStories({\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    maxId: storyId,\n  }));\n}\n\nexport function deleteStory({ peer, storyId }: { peer: ApiPeer; storyId: number }) {\n  return invokeRequest(new GramJs.stories.DeleteStories({\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    id: [storyId],\n  }));\n}\n\nexport function toggleStoryPinned({ peer, storyId, isPinned }: { peer: ApiPeer; storyId: number; isPinned?: boolean }) {\n  return invokeRequest(new GramJs.stories.TogglePinned({\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    id: [storyId],\n    pinned: isPinned,\n  }));\n}\n\nexport async function fetchStoryViewList({\n  peer,\n  storyId,\n  areJustContacts,\n  query,\n  areReactionsFirst,\n  limit = STORY_LIST_LIMIT,\n  offset = '',\n}: {\n  peer: ApiPeer;\n  storyId: number;\n  areJustContacts?: true;\n  areReactionsFirst?: true;\n  query?: string;\n  limit?: number;\n  offset?: string;\n}) {\n  const result = await invokeRequest(new GramJs.stories.GetStoryViewsList({\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    id: storyId,\n    justContacts: areJustContacts,\n    q: query,\n    reactionsFirst: areReactionsFirst,\n    limit,\n    offset,\n  }));\n\n  if (!result) {\n    return undefined;\n  }\n\n  addEntitiesToLocalDb(result.users);\n  addEntitiesToLocalDb(result.chats);\n  const users = result.users.map(buildApiUser).filter(Boolean);\n  const chats = result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean);\n  const views = result.views.map(buildApiStoryView).filter(Boolean);\n\n  return {\n    users,\n    chats,\n    views,\n    nextOffset: result.nextOffset,\n    reactionsCount: result.reactionsCount,\n    viewsCount: result.count,\n  };\n}\n\nexport async function fetchStoryLink({ peer, storyId }: { peer: ApiPeer ; storyId: number }) {\n  const result = await invokeRequest(new GramJs.stories.ExportStoryLink({\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    id: storyId,\n  }));\n\n  if (!result) {\n    return undefined;\n  }\n\n  return result.link;\n}\n\nexport function reportStory({\n  peer,\n  storyId,\n  reason,\n  description,\n}: {\n  peer: ApiPeer; storyId: number; reason: ApiReportReason; description?: string;\n}) {\n  return invokeRequest(new GramJs.stories.Report({\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    id: [storyId],\n    reason: buildInputReportReason(reason),\n    message: description,\n  }));\n}\n\nexport function editStoryPrivacy({\n  peer,\n  id,\n  privacy,\n}: {\n  peer: ApiPeer;\n  id: number;\n  privacy: ApiInputPrivacyRules;\n}) {\n  return invokeRequest(new GramJs.stories.EditStory({\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    id,\n    privacyRules: buildInputPrivacyRules(privacy),\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport function toggleStoriesHidden({\n  peer,\n  isHidden,\n}: {\n  peer: ApiPeer;\n  isHidden: boolean;\n}) {\n  return invokeRequest(new GramJs.stories.TogglePeerStoriesHidden({\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    hidden: isHidden,\n  }));\n}\n\nexport function fetchStoriesMaxIds({\n  peers,\n}: {\n  peers: ApiPeer[];\n}) {\n  return invokeRequest(new GramJs.stories.GetPeerMaxIDs({\n    id: peers.map((peer) => buildInputPeer(peer.id, peer.accessHash)),\n  }), { shouldIgnoreErrors: true });\n}\n\nasync function fetchCommonStoriesRequest({ method, peerId }: {\n  method: GramJs.stories.GetPinnedStories | GramJs.stories.GetStoriesArchive;\n  peerId: string;\n}) {\n  const result = await invokeRequest(method);\n\n  if (!result) {\n    return undefined;\n  }\n\n  addEntitiesToLocalDb(result.users);\n  addEntitiesToLocalDb(result.chats);\n  result.stories.forEach((story) => addStoryToLocalDb(story, peerId));\n\n  const users = result.users.map(buildApiUser).filter(Boolean);\n  const chats = result.chats.map((c) => buildApiChatFromPreview(c)).filter(Boolean);\n  const stories = buildCollectionByCallback(result.stories, (story) => (\n    [story.id, buildApiStory(peerId, story)]\n  ));\n\n  return {\n    users,\n    chats,\n    stories,\n  };\n}\n\nexport function sendStoryReaction({\n  peer, storyId, reaction, shouldAddToRecent,\n}: {\n  peer: ApiPeer;\n  storyId: number;\n  reaction?: ApiReaction;\n  shouldAddToRecent?: boolean;\n}) {\n  return invokeRequest(new GramJs.stories.SendReaction({\n    reaction: reaction ? buildInputReaction(reaction) : new GramJs.ReactionEmpty(),\n    peer: buildInputPeer(peer.id, peer.accessHash),\n    storyId,\n    ...(shouldAddToRecent && { addToRecent: true }),\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n\nexport function activateStealthMode({\n  isForPast,\n  isForFuture,\n}: {\n  isForPast?: true;\n  isForFuture?: true;\n}) {\n  return invokeRequest(new GramJs.stories.ActivateStealthMode({\n    past: isForPast,\n    future: isForFuture,\n  }), {\n    shouldReturnTrue: true,\n  });\n}\n","import { Api as GramJs } from '../../../lib/gramjs';\n\nimport type {\n  ApiBoostsStatus,\n  ApiCheckedGiftCode,\n  ApiGiveawayInfo,\n  ApiInvoice, ApiLabeledPrice, ApiMyBoost, ApiPaymentCredentials,\n  ApiPaymentForm, ApiPaymentSavedInfo, ApiPremiumPromo, ApiPremiumSubscriptionOption,\n  ApiReceipt,\n} from '../../types';\n\nimport { buildApiMessageEntity } from './common';\nimport { omitVirtualClassFields } from './helpers';\nimport { buildApiDocument, buildApiWebDocument } from './messageContent';\nimport { buildApiPeerId, getApiChatIdFromMtpPeer } from './peers';\nimport { buildStatisticsPercentage } from './statistics';\n\nexport function buildShippingOptions(shippingOptions: GramJs.ShippingOption[] | undefined) {\n  if (!shippingOptions) {\n    return undefined;\n  }\n\n  return Object.values(shippingOptions).map((option) => {\n    return {\n      id: option.id,\n      title: option.title,\n      amount: option.prices.reduce((ac, cur) => ac + cur.amount.toJSNumber(), 0),\n      prices: option.prices.map(({ label, amount }) => {\n        return {\n          label,\n          amount: amount.toJSNumber(),\n        };\n      }),\n    };\n  });\n}\n\nexport function buildApiReceipt(receipt: GramJs.payments.PaymentReceipt): ApiReceipt {\n  const {\n    invoice,\n    info,\n    shipping,\n    currency,\n    totalAmount,\n    credentialsTitle,\n    tipAmount,\n  } = receipt;\n\n  const { shippingAddress, phone, name } = (info || {});\n\n  const { prices } = invoice;\n  const mappedPrices: ApiLabeledPrice[] = prices.map(({ label, amount }) => ({\n    label,\n    amount: amount.toJSNumber(),\n  }));\n\n  let shippingPrices: ApiLabeledPrice[] | undefined;\n  let shippingMethod: string | undefined;\n\n  if (shipping) {\n    shippingPrices = shipping.prices.map(({ label, amount }) => {\n      return {\n        label,\n        amount: amount.toJSNumber(),\n      };\n    });\n    shippingMethod = shipping.title;\n  }\n\n  return {\n    currency,\n    prices: mappedPrices,\n    info: { shippingAddress, phone, name },\n    totalAmount: totalAmount.toJSNumber(),\n    credentialsTitle,\n    shippingPrices,\n    shippingMethod,\n    tipAmount: tipAmount ? tipAmount.toJSNumber() : 0,\n  };\n}\n\nexport function buildApiPaymentForm(form: GramJs.payments.PaymentForm): ApiPaymentForm {\n  const {\n    formId,\n    canSaveCredentials,\n    passwordMissing: isPasswordMissing,\n    providerId,\n    nativeProvider,\n    nativeParams,\n    savedInfo,\n    invoice,\n    savedCredentials,\n    url,\n  } = form;\n\n  const {\n    test: isTest,\n    nameRequested: isNameRequested,\n    phoneRequested: isPhoneRequested,\n    emailRequested: isEmailRequested,\n    shippingAddressRequested: isShippingAddressRequested,\n    flexible: isFlexible,\n    phoneToProvider: shouldSendPhoneToProvider,\n    emailToProvider: shouldSendEmailToProvider,\n    currency,\n    prices,\n  } = invoice;\n\n  const mappedPrices: ApiLabeledPrice[] = prices.map(({ label, amount }) => ({\n    label,\n    amount: amount.toJSNumber(),\n  }));\n  const { shippingAddress } = savedInfo || {};\n  const cleanedInfo: ApiPaymentSavedInfo | undefined = savedInfo ? omitVirtualClassFields(savedInfo) : undefined;\n  if (cleanedInfo && shippingAddress) {\n    cleanedInfo.shippingAddress = omitVirtualClassFields(shippingAddress);\n  }\n\n  const nativeData = nativeParams ? JSON.parse(nativeParams.data) : {};\n\n  return {\n    url,\n    canSaveCredentials,\n    isPasswordMissing,\n    formId: String(formId),\n    providerId: String(providerId),\n    nativeProvider,\n    savedInfo: cleanedInfo,\n    invoiceContainer: {\n      isTest,\n      isNameRequested,\n      isPhoneRequested,\n      isEmailRequested,\n      isShippingAddressRequested,\n      isFlexible,\n      shouldSendPhoneToProvider,\n      shouldSendEmailToProvider,\n      currency,\n      prices: mappedPrices,\n    },\n    nativeParams: {\n      needCardholderName: Boolean(nativeData?.need_cardholder_name),\n      needCountry: Boolean(nativeData?.need_country),\n      needZip: Boolean(nativeData?.need_zip),\n      publishableKey: nativeData?.publishable_key,\n      publicToken: nativeData?.public_token,\n    },\n    ...(savedCredentials && { savedCredentials: buildApiPaymentCredentials(savedCredentials) }),\n  };\n}\n\nexport function buildApiInvoiceFromForm(form: GramJs.payments.PaymentForm): ApiInvoice {\n  const {\n    invoice, description: text, title, photo,\n  } = form;\n  const {\n    test, currency, prices, recurring, termsUrl, maxTipAmount, suggestedTipAmounts,\n  } = invoice;\n\n  const totalAmount = prices.reduce((ac, cur) => ac + cur.amount.toJSNumber(), 0);\n\n  return {\n    text,\n    title,\n    photo: buildApiWebDocument(photo),\n    amount: totalAmount,\n    currency,\n    isTest: test,\n    isRecurring: recurring,\n    termsUrl,\n    maxTipAmount: maxTipAmount?.toJSNumber(),\n    ...(suggestedTipAmounts && { suggestedTipAmounts: suggestedTipAmounts.map((tip) => tip.toJSNumber()) }),\n  };\n}\n\nexport function buildApiPremiumPromo(promo: GramJs.help.PremiumPromo): ApiPremiumPromo {\n  const {\n    statusText, statusEntities, videos, videoSections, periodOptions,\n  } = promo;\n\n  return {\n    statusText,\n    statusEntities: statusEntities.map(buildApiMessageEntity),\n    videoSections,\n    videos: videos.map(buildApiDocument).filter(Boolean),\n    options: periodOptions.map(buildApiPremiumSubscriptionOption),\n  };\n}\n\nfunction buildApiPremiumSubscriptionOption(option: GramJs.PremiumSubscriptionOption): ApiPremiumSubscriptionOption {\n  const {\n    current, canPurchaseUpgrade, currency, amount, botUrl, months,\n  } = option;\n\n  return {\n    isCurrent: current,\n    canPurchaseUpgrade,\n    currency,\n    amount: amount.toJSNumber(),\n    botUrl,\n    months,\n  };\n}\n\nexport function buildApiPaymentCredentials(credentials: GramJs.PaymentSavedCredentialsCard[]): ApiPaymentCredentials[] {\n  return credentials.map(({ id, title }) => ({ id, title }));\n}\n\nexport function buildApiBoostsStatus(boostStatus: GramJs.premium.BoostsStatus): ApiBoostsStatus {\n  const {\n    level, boostUrl, boosts, myBoost, currentLevelBoosts, nextLevelBoosts, premiumAudience,\n  } = boostStatus;\n  return {\n    level,\n    currentLevelBoosts,\n    boosts,\n    hasMyBoost: Boolean(myBoost),\n    boostUrl,\n    nextLevelBoosts,\n    ...(premiumAudience && { premiumSubscribers: buildStatisticsPercentage(premiumAudience) }),\n  };\n}\n\nexport function buildApiMyBoost(myBoost: GramJs.MyBoost): ApiMyBoost {\n  const {\n    date, expires, slot, cooldownUntilDate, peer,\n  } = myBoost;\n\n  return {\n    date,\n    expires,\n    slot,\n    cooldownUntil: cooldownUntilDate,\n    chatId: peer && getApiChatIdFromMtpPeer(peer),\n  };\n}\n\nexport function buildApiGiveawayInfo(info: GramJs.payments.TypeGiveawayInfo): ApiGiveawayInfo | undefined {\n  if (info instanceof GramJs.payments.GiveawayInfo) {\n    const {\n      startDate,\n      adminDisallowedChatId,\n      disallowedCountry,\n      joinedTooEarlyDate,\n      participating,\n      preparingResults,\n    } = info;\n\n    return {\n      type: 'active',\n      startDate,\n      isParticipating: participating,\n      adminDisallowedChatId: adminDisallowedChatId && buildApiPeerId(adminDisallowedChatId, 'channel'),\n      disallowedCountry,\n      joinedTooEarlyDate,\n      isPreparingResults: preparingResults,\n    };\n  } else {\n    const {\n      activatedCount,\n      finishDate,\n      giftCodeSlug,\n      winner,\n      refunded,\n      startDate,\n      winnersCount,\n    } = info;\n\n    return {\n      type: 'results',\n      startDate,\n      activatedCount,\n      finishDate,\n      winnersCount,\n      giftCodeSlug,\n      isRefunded: refunded,\n      isWinner: winner,\n    };\n  }\n}\n\nexport function buildApiCheckedGiftCode(giftcode: GramJs.payments.TypeCheckedGiftCode): ApiCheckedGiftCode {\n  const {\n    date, fromId, months, giveawayMsgId, toId, usedDate, viaGiveaway,\n  } = giftcode;\n\n  return {\n    date,\n    months,\n    toId: toId && buildApiPeerId(toId, 'user'),\n    fromId: fromId && getApiChatIdFromMtpPeer(fromId),\n    usedAt: usedDate,\n    isFromGiveaway: viaGiveaway,\n    giveawayMessageId: giveawayMsgId,\n  };\n}\n","/* eslint-disable no-console */\n\nimport type { DebugLevel } from '../../../util/debugConsole';\nimport type { ApiOnProgress, ApiUpdate } from '../../types';\nimport type { OriginMessageEvent, WorkerMessageData } from './types';\n\nimport { DEBUG } from '../../../config';\nimport { DEBUG_LEVELS } from '../../../util/debugConsole';\nimport { throttleWithTickEnd } from '../../../util/schedulers';\nimport { log } from '../helpers';\nimport { callApi, cancelApiProgress, initApi } from '../methods/init';\n\ndeclare const self: WorkerGlobalScope;\n\nconst ORIGINAL_FUNCTIONS = DEBUG_LEVELS.reduce((acc, level) => {\n  acc[level] = console[level];\n  return acc;\n}, {} as Record<DebugLevel, (...args: any[]) => void>);\n\nfunction enableDebugLog() {\n  DEBUG_LEVELS.forEach((level) => {\n    console[level] = (...args: any[]) => {\n      postMessage({\n        type: 'debugLog',\n        level,\n        args: JSON.parse(JSON.stringify(args, (key, value) => (typeof value === 'bigint'\n          ? value.toString()\n          : value))),\n      });\n    };\n  });\n}\n\nfunction disableDebugLog() {\n  DEBUG_LEVELS.forEach((level) => {\n    console[level] = ORIGINAL_FUNCTIONS[level];\n  });\n}\n\nhandleErrors();\n\nconst callbackState = new Map<string, ApiOnProgress>();\n\nif (DEBUG) {\n  console.log('>>> FINISH LOAD WORKER');\n}\n\nonmessage = async (message: OriginMessageEvent) => {\n  const { data } = message;\n\n  switch (data.type) {\n    case 'initApi': {\n      const { messageId, args } = data;\n      await initApi(onUpdate, args[0], args[1]);\n      if (messageId) {\n        sendToOrigin({\n          type: 'methodResponse',\n          messageId,\n          response: true,\n        });\n      }\n      break;\n    }\n    case 'callMethod': {\n      const {\n        messageId, name, args, withCallback,\n      } = data;\n      try {\n        if (messageId && withCallback) {\n          const callback = (...callbackArgs: any[]) => {\n            const lastArg = callbackArgs[callbackArgs.length - 1];\n\n            sendToOrigin({\n              type: 'methodCallback',\n              messageId,\n              callbackArgs,\n            }, lastArg instanceof ArrayBuffer ? lastArg : undefined);\n          };\n\n          callbackState.set(messageId, callback);\n\n          args.push(callback as never);\n        }\n\n        const response = await callApi(name, ...args);\n\n        if (DEBUG && typeof response === 'object' && 'CONSTRUCTOR_ID' in response) {\n          log('UNEXPECTED RESPONSE', `${name}: ${response.className}`);\n        }\n\n        const { arrayBuffer } = (typeof response === 'object' && 'arrayBuffer' in response && response) || {};\n\n        if (messageId) {\n          sendToOrigin({\n            type: 'methodResponse',\n            messageId,\n            response,\n          }, arrayBuffer);\n        }\n      } catch (error: any) {\n        if (DEBUG) {\n          console.error(error);\n        }\n\n        if (messageId) {\n          sendToOrigin({\n            type: 'methodResponse',\n            messageId,\n            error: { message: error.message },\n          });\n        }\n      }\n\n      if (messageId) {\n        callbackState.delete(messageId);\n      }\n\n      break;\n    }\n    case 'cancelProgress': {\n      const callback = callbackState.get(data.messageId);\n      if (callback) {\n        cancelApiProgress(callback);\n      }\n\n      break;\n    }\n    case 'ping': {\n      sendToOrigin({\n        type: 'methodResponse',\n        messageId: data.messageId!,\n      });\n\n      break;\n    }\n    case 'toggleDebugMode': {\n      if (data.isEnabled) {\n        enableDebugLog();\n      } else {\n        disableDebugLog();\n      }\n    }\n  }\n};\n\nfunction handleErrors() {\n  self.onerror = (e) => {\n    console.error(e);\n    sendToOrigin({ type: 'unhandledError', error: { message: e.error.message || 'Uncaught exception in worker' } });\n  };\n\n  self.addEventListener('unhandledrejection', (e) => {\n    console.error(e);\n    sendToOrigin({ type: 'unhandledError', error: { message: e.reason.message || 'Uncaught rejection in worker' } });\n  });\n}\n\nlet pendingUpdates: ApiUpdate[] = [];\n\nconst sendUpdatesOnTickEnd = throttleWithTickEnd(() => {\n  const currentUpdates = pendingUpdates;\n  pendingUpdates = [];\n\n  sendToOrigin({\n    type: 'updates',\n    updates: currentUpdates,\n  });\n});\n\nfunction onUpdate(update: ApiUpdate) {\n  if (DEBUG && update['@type'] !== 'updateUserStatus' && update['@type'] !== 'updateServerTimeOffset') {\n    log('UPDATE', update['@type'], update);\n  }\n\n  pendingUpdates.push(update);\n  sendUpdatesOnTickEnd();\n}\n\nfunction sendToOrigin(data: WorkerMessageData, arrayBuffer?: ArrayBuffer) {\n  if (arrayBuffer) {\n    postMessage(data, [arrayBuffer]);\n  } else {\n    postMessage(data);\n  }\n}\n","import type { ThreadId } from '../../types';\nimport type { ApiWebDocument } from './bots';\nimport type { ApiGroupCall, PhoneCallAction } from './calls';\nimport type { ApiChat } from './chats';\nimport type { ApiMessageStoryData, ApiWebPageStoryData } from './stories';\n\nexport interface ApiDimensions {\n  width: number;\n  height: number;\n}\n\nexport interface ApiPhotoSize extends ApiDimensions {\n  type: 's' | 'm' | 'x' | 'y' | 'z';\n}\n\nexport interface ApiVideoSize extends ApiDimensions {\n  type: 'u' | 'v';\n  videoStartTs: number;\n  size: number;\n}\n\nexport interface ApiThumbnail extends ApiDimensions {\n  dataUri: string;\n}\n\nexport interface ApiPhoto {\n  id: string;\n  thumbnail?: ApiThumbnail;\n  isVideo?: boolean;\n  sizes: ApiPhotoSize[];\n  videoSizes?: ApiVideoSize[];\n  blobUrl?: string;\n  isSpoiler?: boolean;\n}\n\nexport interface ApiSticker {\n  id: string;\n  stickerSetInfo: ApiStickerSetInfo;\n  emoji?: string;\n  isCustomEmoji?: boolean;\n  isLottie: boolean;\n  isVideo: boolean;\n  width?: number;\n  height?: number;\n  thumbnail?: ApiThumbnail;\n  isPreloadedGlobally?: boolean;\n  hasEffect?: boolean;\n  isFree?: boolean;\n  shouldUseTextColor?: boolean;\n}\n\nexport interface ApiStickerSet {\n  isArchived?: true;\n  isLottie?: true;\n  isVideos?: true;\n  isEmoji?: true;\n  installedDate?: number;\n  id: string;\n  accessHash: string;\n  title: string;\n  hasThumbnail?: boolean;\n  thumbCustomEmojiId?: string;\n  count: number;\n  stickers?: ApiSticker[];\n  packs?: Record<string, ApiSticker[]>;\n  covers?: ApiSticker[];\n  shortName: string;\n}\n\ntype ApiStickerSetInfoShortName = {\n  shortName: string;\n};\n\ntype ApiStickerSetInfoId = {\n  id: string;\n  accessHash: string;\n};\n\ntype ApiStickerSetInfoMissing = {\n  isMissing: true;\n};\n\nexport type ApiStickerSetInfo = ApiStickerSetInfoShortName | ApiStickerSetInfoId | ApiStickerSetInfoMissing;\n\nexport interface ApiVideo {\n  id: string;\n  mimeType: string;\n  duration: number;\n  fileName: string;\n  width?: number;\n  height?: number;\n  supportsStreaming?: boolean;\n  isRound?: boolean;\n  isGif?: boolean;\n  isSpoiler?: boolean;\n  thumbnail?: ApiThumbnail;\n  blobUrl?: string;\n  previewBlobUrl?: string;\n  size: number;\n  noSound?: boolean;\n}\n\nexport interface ApiAudio {\n  id: string;\n  size: number;\n  mimeType: string;\n  fileName: string;\n  duration: number;\n  performer?: string;\n  title?: string;\n  thumbnailSizes?: ApiPhotoSize[];\n}\n\nexport interface ApiVoice {\n  id: string;\n  duration: number;\n  waveform?: number[];\n}\n\nexport interface ApiDocument {\n  id?: string;\n  fileName: string;\n  size: number;\n  timestamp?: number;\n  mimeType: string;\n  thumbnail?: ApiThumbnail;\n  previewBlobUrl?: string;\n  mediaType?: 'photo' | 'video';\n  mediaSize?: ApiDimensions;\n}\n\nexport interface ApiContact {\n  firstName: string;\n  lastName: string;\n  phoneNumber: string;\n  userId: string;\n}\n\nexport interface ApiPollAnswer {\n  text: string;\n  option: string;\n}\n\nexport interface ApiPollResult {\n  isChosen?: true;\n  isCorrect?: true;\n  option: string;\n  votersCount: number;\n}\n\nexport interface ApiPoll {\n  id: string;\n  summary: {\n    closed?: true;\n    isPublic?: true;\n    multipleChoice?: true;\n    quiz?: true;\n    question: string;\n    answers: ApiPollAnswer[];\n    closePeriod?: number;\n    closeDate?: number;\n  };\n  results: {\n    isMin?: true;\n    results?: ApiPollResult[];\n    totalVoters?: number;\n    recentVoterIds?: string[];\n    solution?: string;\n    solutionEntities?: ApiMessageEntity[];\n  };\n}\n\n// First type used for state, second - for API requests\nexport type ApiInputInvoice = {\n  chatId: string;\n  messageId: number;\n  isExtendedMedia?: boolean;\n} | {\n  slug: string;\n};\n\nexport type ApiRequestInputInvoice = {\n  chat: ApiChat;\n  messageId: number;\n} | {\n  slug: string;\n};\n\nexport interface ApiInvoice {\n  text: string;\n  title: string;\n  photo?: ApiWebDocument;\n  amount: number;\n  currency: string;\n  receiptMsgId?: number;\n  isTest?: boolean;\n  isRecurring?: boolean;\n  termsUrl?: string;\n  extendedMedia?: ApiMessageExtendedMediaPreview;\n  maxTipAmount?: number;\n  suggestedTipAmounts?: number[];\n}\n\nexport interface ApiMessageExtendedMediaPreview {\n  width?: number;\n  height?: number;\n  thumbnail?: ApiThumbnail;\n  duration?: number;\n}\n\nexport interface ApiPaymentCredentials {\n  id: string;\n  title: string;\n}\n\nexport interface ApiGeoPoint {\n  long: number;\n  lat: number;\n  accessHash: string;\n  accuracyRadius?: number;\n}\n\ninterface ApiGeo {\n  type: 'geo';\n  geo: ApiGeoPoint;\n}\n\ninterface ApiVenue {\n  type: 'venue';\n  geo: ApiGeoPoint;\n  title: string;\n  address: string;\n  provider: string;\n  venueId: string;\n  venueType: string;\n}\n\ninterface ApiGeoLive {\n  type: 'geoLive';\n  geo: ApiGeoPoint;\n  heading?: number;\n  period: number;\n}\n\nexport type ApiLocation = ApiGeo | ApiVenue | ApiGeoLive;\n\nexport type ApiGame = {\n  title: string;\n  description: string;\n  photo?: ApiPhoto;\n  shortName: string;\n  id: string;\n  accessHash: string;\n  document?: ApiDocument;\n};\n\nexport type ApiGiveaway = {\n  quantity: number;\n  months: number;\n  untilDate: number;\n  isOnlyForNewSubscribers?: true;\n  countries?: string[];\n  channelIds: string[];\n  prizeDescription?: string;\n};\n\nexport type ApiGiveawayResults = {\n  months: number;\n  untilDate: number;\n  isRefunded?: true;\n  isOnlyForNewSubscribers?: true;\n  channelId: string;\n  prizeDescription?: string;\n  winnersCount?: number;\n  winnerIds: string[];\n  additionalPeersCount?: number;\n  launchMessageId: number;\n  unclaimedCount: number;\n};\n\nexport type ApiNewPoll = {\n  summary: ApiPoll['summary'];\n  quiz?: {\n    correctAnswers: string[];\n    solution?: string;\n    solutionEntities?: ApiMessageEntity[];\n  };\n};\n\nexport interface ApiAction {\n  text: string;\n  targetUserIds?: string[];\n  targetChatId?: string;\n  type:\n  | 'historyClear'\n  | 'contactSignUp'\n  | 'chatCreate'\n  | 'topicCreate'\n  | 'suggestProfilePhoto'\n  | 'joinedChannel'\n  | 'other';\n  photo?: ApiPhoto;\n  amount?: number;\n  currency?: string;\n  giftCryptoInfo?: {\n    currency: string;\n    amount: string;\n  };\n  translationValues: string[];\n  call?: Partial<ApiGroupCall>;\n  phoneCall?: PhoneCallAction;\n  score?: number;\n  months?: number;\n  topicEmojiIconId?: string;\n  isTopicAction?: boolean;\n  slug?: string;\n  isGiveaway?: boolean;\n  isUnclaimed?: boolean;\n  pluralValue?: number;\n}\n\nexport interface ApiWebPage {\n  id: number;\n  url: string;\n  displayUrl: string;\n  type?: string;\n  siteName?: string;\n  title?: string;\n  description?: string;\n  photo?: ApiPhoto;\n  duration?: number;\n  document?: ApiDocument;\n  video?: ApiVideo;\n  story?: ApiWebPageStoryData;\n}\n\nexport interface ApiSponsoredWebPage {\n  url: string;\n  siteName: string;\n  photo?: ApiPhoto;\n}\n\nexport type ApiReplyInfo = ApiMessageReplyInfo | ApiStoryReplyInfo;\n\nexport interface ApiMessageReplyInfo {\n  type: 'message';\n  replyToMsgId?: number;\n  replyToPeerId?: string;\n  replyFrom?: ApiMessageForwardInfo;\n  replyMedia?: MediaContent;\n  replyToTopId?: number;\n  isForumTopic?: true;\n  isQuote?: true;\n  quoteText?: ApiFormattedText;\n}\n\nexport interface ApiStoryReplyInfo {\n  type: 'story';\n  userId: string;\n  storyId: number;\n}\n\nexport interface ApiInputMessageReplyInfo {\n  type: 'message';\n  replyToMsgId: number;\n  replyToTopId?: number;\n  replyToPeerId?: string;\n  quoteText?: ApiFormattedText;\n}\n\nexport interface ApiInputStoryReplyInfo {\n  type: 'story';\n  userId: string;\n  storyId: number;\n}\n\nexport type ApiInputReplyInfo = ApiInputMessageReplyInfo | ApiInputStoryReplyInfo;\n\nexport interface ApiMessageForwardInfo {\n  date: number;\n  savedDate?: number;\n  isImported?: boolean;\n  isChannelPost: boolean;\n  channelPostId?: number;\n  isLinkedChannelPost?: boolean;\n  fromChatId?: string;\n  fromId?: string;\n  savedFromPeerId?: string;\n  fromMessageId?: number;\n  hiddenUserName?: string;\n  postAuthorTitle?: string;\n}\n\nexport interface ApiStoryForwardInfo {\n  fromPeerId?: string;\n  fromName?: string;\n  storyId?: number;\n  isModified?: boolean;\n}\n\nexport type ApiMessageEntityDefault = {\n  type: Exclude<\n  `${ApiMessageEntityTypes}`,\n  `${ApiMessageEntityTypes.Pre}` | `${ApiMessageEntityTypes.TextUrl}` | `${ApiMessageEntityTypes.MentionName}` |\n  `${ApiMessageEntityTypes.CustomEmoji}`\n  >;\n  offset: number;\n  length: number;\n};\n\nexport type ApiMessageEntityPre = {\n  type: ApiMessageEntityTypes.Pre;\n  offset: number;\n  length: number;\n  language?: string;\n};\n\nexport type ApiMessageEntityTextUrl = {\n  type: ApiMessageEntityTypes.TextUrl;\n  offset: number;\n  length: number;\n  url: string;\n};\n\nexport type ApiMessageEntityMentionName = {\n  type: ApiMessageEntityTypes.MentionName;\n  offset: number;\n  length: number;\n  userId: string;\n};\n\nexport type ApiMessageEntityCustomEmoji = {\n  type: ApiMessageEntityTypes.CustomEmoji;\n  offset: number;\n  length: number;\n  documentId: string;\n};\n\nexport type ApiMessageEntity = ApiMessageEntityDefault | ApiMessageEntityPre | ApiMessageEntityTextUrl |\nApiMessageEntityMentionName | ApiMessageEntityCustomEmoji;\n\nexport enum ApiMessageEntityTypes {\n  Bold = 'MessageEntityBold',\n  Blockquote = 'MessageEntityBlockquote',\n  BotCommand = 'MessageEntityBotCommand',\n  Cashtag = 'MessageEntityCashtag',\n  Code = 'MessageEntityCode',\n  Email = 'MessageEntityEmail',\n  Hashtag = 'MessageEntityHashtag',\n  Italic = 'MessageEntityItalic',\n  MentionName = 'MessageEntityMentionName',\n  Mention = 'MessageEntityMention',\n  Phone = 'MessageEntityPhone',\n  Pre = 'MessageEntityPre',\n  Strike = 'MessageEntityStrike',\n  TextUrl = 'MessageEntityTextUrl',\n  Url = 'MessageEntityUrl',\n  Underline = 'MessageEntityUnderline',\n  Spoiler = 'MessageEntitySpoiler',\n  CustomEmoji = 'MessageEntityCustomEmoji',\n  Unknown = 'MessageEntityUnknown',\n}\n\nexport interface ApiFormattedText {\n  text: string;\n  entities?: ApiMessageEntity[];\n}\n\nexport type MediaContent = {\n  text?: ApiFormattedText;\n  photo?: ApiPhoto;\n  video?: ApiVideo;\n  altVideo?: ApiVideo;\n  document?: ApiDocument;\n  sticker?: ApiSticker;\n  contact?: ApiContact;\n  poll?: ApiPoll;\n  action?: ApiAction;\n  webPage?: ApiWebPage;\n  audio?: ApiAudio;\n  voice?: ApiVoice;\n  invoice?: ApiInvoice;\n  location?: ApiLocation;\n  game?: ApiGame;\n  storyData?: ApiMessageStoryData;\n  giveaway?: ApiGiveaway;\n  giveawayResults?: ApiGiveawayResults;\n  isExpiredVoice?: boolean;\n  isExpiredRoundVideo?: boolean;\n  ttlSeconds?: number;\n};\n\nexport interface ApiMessage {\n  id: number;\n  chatId: string;\n  content: MediaContent;\n  date: number;\n  isOutgoing: boolean;\n  senderId?: string;\n  replyInfo?: ApiReplyInfo;\n  sendingState?: 'messageSendingStatePending' | 'messageSendingStateFailed';\n  forwardInfo?: ApiMessageForwardInfo;\n  isDeleting?: boolean;\n  previousLocalId?: number;\n  viewsCount?: number;\n  forwardsCount?: number;\n  isEdited?: boolean;\n  editDate?: number;\n  isMentioned?: boolean;\n  isMediaUnread?: boolean;\n  groupedId?: string;\n  isInAlbum?: boolean;\n  hasUnreadMention?: boolean;\n  inlineButtons?: ApiKeyboardButtons;\n  keyboardButtons?: ApiKeyboardButtons;\n  keyboardPlaceholder?: string;\n  isKeyboardSingleUse?: boolean;\n  isKeyboardSelective?: boolean;\n  viaBotId?: string;\n  postAuthorTitle?: string;\n  isScheduled?: boolean;\n  shouldHideKeyboardButtons?: boolean;\n  isHideKeyboardSelective?: boolean;\n  isFromScheduled?: boolean;\n  isSilent?: boolean;\n  isPinned?: boolean;\n  seenByDates?: Record<string, number>;\n  isProtected?: boolean;\n  isForwardingAllowed?: boolean;\n  transcriptionId?: string;\n  isTranscriptionError?: boolean;\n  emojiOnlyCount?: number;\n  reactors?: {\n    nextOffset?: string;\n    count: number;\n    reactions: ApiPeerReaction[];\n  };\n  reactions?: ApiReactions;\n  hasComments?: boolean;\n  readDate?: number;\n  savedPeerId?: string;\n}\n\nexport interface ApiReactions {\n  canSeeList?: boolean;\n  areTags?: boolean;\n  results: ApiReactionCount[];\n  recentReactions?: ApiPeerReaction[];\n}\n\nexport interface ApiPeerReaction {\n  peerId: string;\n  reaction: ApiReaction;\n  isOwn?: boolean;\n  isBig?: boolean;\n  isUnread?: boolean;\n  addedDate: number;\n}\n\nexport interface ApiReactionCount {\n  chosenOrder?: number;\n  count: number;\n  reaction: ApiReaction;\n}\n\nexport interface ApiAvailableReaction {\n  selectAnimation?: ApiDocument;\n  appearAnimation?: ApiDocument;\n  activateAnimation?: ApiDocument;\n  effectAnimation?: ApiDocument;\n  staticIcon?: ApiDocument;\n  centerIcon?: ApiDocument;\n  aroundAnimation?: ApiDocument;\n  reaction: ApiReactionEmoji;\n  title: string;\n  isInactive?: boolean;\n  isPremium?: boolean;\n}\n\ntype ApiChatReactionsAll = {\n  type: 'all';\n  areCustomAllowed?: true;\n};\n\ntype ApiChatReactionsSome = {\n  type: 'some';\n  allowed: ApiReaction[];\n};\n\nexport type ApiChatReactions = ApiChatReactionsAll | ApiChatReactionsSome;\n\nexport type ApiReactionEmoji = {\n  emoticon: string;\n};\n\nexport type ApiReactionCustomEmoji = {\n  documentId: string;\n};\n\nexport type ApiReaction = ApiReactionEmoji | ApiReactionCustomEmoji;\n\nexport type ApiReactionKey = `${string}-${string}`;\n\nexport type ApiSavedReactionTag = {\n  reaction: ApiReaction;\n  title?: string;\n  count: number;\n};\n\ninterface ApiBaseThreadInfo {\n  chatId: string;\n  messagesCount: number;\n  lastMessageId?: number;\n  lastReadInboxMessageId?: number;\n  recentReplierIds?: string[];\n}\n\nexport interface ApiCommentsInfo extends ApiBaseThreadInfo {\n  isCommentsInfo: true;\n  threadId?: ThreadId;\n  originChannelId: string;\n  originMessageId: number;\n}\n\nexport interface ApiMessageThreadInfo extends ApiBaseThreadInfo {\n  isCommentsInfo: false;\n  threadId: ThreadId;\n  // For linked messages in discussion\n  fromChannelId?: string;\n  fromMessageId?: number;\n}\n\nexport type ApiThreadInfo = ApiCommentsInfo | ApiMessageThreadInfo;\n\nexport type ApiMessageOutgoingStatus = 'read' | 'succeeded' | 'pending' | 'failed';\n\nexport type ApiSponsoredMessage = {\n  chatId?: string;\n  randomId: string;\n  isRecommended?: boolean;\n  isAvatarShown?: boolean;\n  isBot?: boolean;\n  channelPostId?: number;\n  startParam?: string;\n  chatInviteHash?: string;\n  chatInviteTitle?: string;\n  text: ApiFormattedText;\n  webPage?: ApiSponsoredWebPage;\n  expiresAt: number;\n  sponsorInfo?: string;\n  additionalInfo?: string;\n  buttonText?: string;\n  botApp?: ApiBotApp;\n};\n\n// KeyboardButtons\n\ninterface ApiKeyboardButtonSimple {\n  type: 'unsupported' | 'buy' | 'command' | 'requestPhone' | 'game';\n  text: string;\n}\n\ninterface ApiKeyboardButtonReceipt {\n  type: 'receipt';\n  text: string;\n  receiptMessageId: number;\n}\n\ninterface ApiKeyboardButtonUrl {\n  type: 'url';\n  text: string;\n  url: string;\n}\n\ninterface ApiKeyboardButtonSimpleWebView {\n  type: 'simpleWebView';\n  text: string;\n  url: string;\n}\n\ninterface ApiKeyboardButtonWebView {\n  type: 'webView';\n  text: string;\n  url: string;\n}\n\ninterface ApiKeyboardButtonCallback {\n  type: 'callback';\n  text: string;\n  data: string;\n}\n\ninterface ApiKeyboardButtonRequestPoll {\n  type: 'requestPoll';\n  text: string;\n  isQuiz?: boolean;\n}\n\ninterface ApiKeyboardButtonSwitchBotInline {\n  type: 'switchBotInline';\n  text: string;\n  query: string;\n  isSamePeer?: boolean;\n}\n\ninterface ApiKeyboardButtonUserProfile {\n  type: 'userProfile';\n  text: string;\n  userId: string;\n}\n\ninterface ApiKeyboardButtonUrlAuth {\n  type: 'urlAuth';\n  text: string;\n  url: string;\n  buttonId: number;\n}\n\nexport type ApiTranscription = {\n  text: string;\n  isPending?: boolean;\n  transcriptionId: string;\n};\n\nexport type ApiKeyboardButton = (\n  ApiKeyboardButtonSimple\n  | ApiKeyboardButtonReceipt\n  | ApiKeyboardButtonUrl\n  | ApiKeyboardButtonCallback\n  | ApiKeyboardButtonRequestPoll\n  | ApiKeyboardButtonSwitchBotInline\n  | ApiKeyboardButtonUserProfile\n  | ApiKeyboardButtonWebView\n  | ApiKeyboardButtonSimpleWebView\n  | ApiKeyboardButtonUrlAuth\n);\n\nexport type ApiKeyboardButtons = ApiKeyboardButton[][];\nexport type ApiReplyKeyboard = {\n  keyboardPlaceholder?: string;\n  isKeyboardSingleUse?: boolean;\n  isKeyboardSelective?: boolean;\n} & {\n  [K in 'inlineButtons' | 'keyboardButtons']?: ApiKeyboardButtons;\n};\n\nexport type ApiMessageSearchType = 'text' | 'media' | 'documents' | 'links' | 'audio' | 'voice' | 'profilePhoto';\nexport type ApiGlobalMessageSearchType = 'text' | 'media' | 'documents' | 'links' | 'audio' | 'voice';\n\nexport type ApiReportReason = 'spam' | 'violence' | 'pornography' | 'childAbuse'\n| 'copyright' | 'geoIrrelevant' | 'fake' | 'illegalDrugs' | 'personalDetails' | 'other';\n\nexport type ApiSendMessageAction = {\n  type: 'cancel' | 'typing' | 'recordAudio' | 'chooseSticker' | 'playingGame';\n};\n\nexport type ApiThemeParameters = {\n  bg_color: string;\n  text_color: string;\n  hint_color: string;\n  link_color: string;\n  button_color: string;\n  button_text_color: string;\n  secondary_bg_color: string;\n  header_bg_color: string;\n  accent_text_color: string;\n  section_bg_color: string;\n  section_header_text_color: string;\n  subtitle_text_color: string;\n  destructive_text_color: string;\n};\n\nexport type ApiBotApp = {\n  id: string;\n  accessHash: string;\n  title: string;\n  shortName: string;\n  description: string;\n  photo?: ApiPhoto;\n  document?: ApiDocument;\n};\n\nexport type ApiMessagesBotApp = ApiBotApp & {\n  isInactive?: boolean;\n  shouldRequestWriteAccess?: boolean;\n};\n\nexport const MAIN_THREAD_ID = -1;\n\n// `Symbol` can not be transferred from worker\nexport const MESSAGE_DELETED = 'MESSAGE_DELETED';\n","// We cache avatars as Data URI for faster initial load\n// and messages media as Blob for smaller size.\n\nexport enum ApiMediaFormat {\n  BlobUrl,\n  Progressive,\n  DownloadUrl,\n  Text,\n}\n\nexport type ApiParsedMedia = string | Blob | ArrayBuffer;\nexport type ApiPreparedMedia = string;\n","const { constructors } = require('./tl');\n\n// eslint-disable-next-line max-len\nconst JPEG_HEADER = Buffer.from('ffd8ffe000104a46494600010100000100010000ffdb004300281c1e231e19282321232d2b28303c64413c37373c7b585d4964918099968f808c8aa0b4e6c3a0aadaad8a8cc8ffcbdaeef5ffffff9bc1fffffffaffe6fdfff8ffdb0043012b2d2d3c353c76414176f8a58ca5f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8ffc00011080000000003012200021101031101ffc4001f0000010501010101010100000000000000000102030405060708090a0bffc400b5100002010303020403050504040000017d01020300041105122131410613516107227114328191a1082342b1c11552d1f02433627282090a161718191a25262728292a3435363738393a434445464748494a535455565758595a636465666768696a737475767778797a838485868788898a92939495969798999aa2a3a4a5a6a7a8a9aab2b3b4b5b6b7b8b9bac2c3c4c5c6c7c8c9cad2d3d4d5d6d7d8d9dae1e2e3e4e5e6e7e8e9eaf1f2f3f4f5f6f7f8f9faffc4001f0100030101010101010101010000000000000102030405060708090a0bffc400b51100020102040403040705040400010277000102031104052131061241510761711322328108144291a1b1c109233352f0156272d10a162434e125f11718191a262728292a35363738393a434445464748494a535455565758595a636465666768696a737475767778797a82838485868788898a92939495969798999aa2a3a4a5a6a7a8a9aab2b3b4b5b6b7b8b9bac2c3c4c5c6c7c8c9cad2d3d4d5d6d7d8d9dae2e3e4e5e6e7e8e9eaf2f3f4f5f6f7f8f9faffda000c03010002110311003f00', 'hex');\nconst JPEG_FOOTER = Buffer.from('ffd9', 'hex');\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nfunction _raiseCastFail(entity, target) {\n    throw new Error(`Cannot cast ${entity.className} to any kind of ${target}`);\n}\n\n/**\n Gets the input peer for the given \"entity\" (user, chat or channel).\n\n A ``TypeError`` is raised if the given entity isn't a supported type\n or if ``check_hash is True`` but the entity's ``accessHash is None``\n *or* the entity contains ``min`` information. In this case, the hash\n cannot be used for general purposes, and thus is not returned to avoid\n any issues which can derive from invalid access hashes.\n\n Note that ``check_hash`` **is ignored** if an input peer is already\n passed since in that case we assume the user knows what they're doing.\n This is key to getting entities by explicitly passing ``hash = 0``.\n\n * @param entity\n * @param allowSelf\n * @param checkHash\n */\nfunction getInputPeer(entity, allowSelf = true, checkHash = true) {\n    if (entity.SUBCLASS_OF_ID === undefined) {\n        // e.g. custom.Dialog (can't cyclic import).\n\n        if (allowSelf && 'inputEntity' in entity) {\n            return entity.inputEntity;\n        } else if ('entity' in entity) {\n            return getInputPeer(entity.entity);\n        } else {\n            _raiseCastFail(entity, 'InputPeer');\n        }\n    }\n    if (entity.SUBCLASS_OF_ID === 0xc91c90b6) { // crc32(b'InputPeer')\n        return entity;\n    }\n\n    if (entity instanceof constructors.User) {\n        if (entity.isSelf && allowSelf) {\n            return new constructors.InputPeerSelf();\n        } else if (entity.accessHash !== undefined || !checkHash) {\n            return new constructors.InputPeerUser({\n                userId: entity.id,\n                accessHash: entity.accessHash,\n            });\n        } else {\n            throw new Error('User without accessHash or min info cannot be input');\n        }\n    }\n    if (entity instanceof constructors.Chat || entity instanceof constructors.ChatEmpty\n        || entity instanceof constructors.ChatForbidden) {\n        return new constructors.InputPeerChat({ chatId: entity.id });\n    }\n    if (entity instanceof constructors.Channel) {\n        if (entity.accessHash !== undefined || !checkHash) {\n            return new constructors.InputPeerChannel({\n                channelId: entity.id,\n                accessHash: entity.accessHash,\n            });\n        } else {\n            throw new TypeError('Channel without accessHash or min info cannot be input');\n        }\n    }\n    if (entity instanceof constructors.ChannelForbidden) {\n        // \"channelForbidden are never min\", and since their hash is\n        // also not optional, we assume that this truly is the case.\n        return new constructors.InputPeerChannel({\n            channelId: entity.id,\n            accessHash: entity.accessHash,\n        });\n    }\n\n    if (entity instanceof constructors.InputUser) {\n        return new constructors.InputPeerUser({\n            userId: entity.userId,\n            accessHash: entity.accessHash,\n        });\n    }\n    if (entity instanceof constructors.InputChannel) {\n        return new constructors.InputPeerChannel({\n            channelId: entity.channelId,\n            accessHash: entity.accessHash,\n        });\n    }\n    if (entity instanceof constructors.UserEmpty) {\n        return new constructors.InputPeerEmpty();\n    }\n    if (entity instanceof constructors.UserFull) {\n        return getInputPeer(entity.user);\n    }\n\n    if (entity instanceof constructors.ChatFull) {\n        return new constructors.InputPeerChat({ chatId: entity.id });\n    }\n\n    if (entity instanceof constructors.PeerChat) {\n        return new constructors.InputPeerChat(entity.chatId);\n    }\n\n    _raiseCastFail(entity, 'InputPeer');\n    return undefined;\n}\n\n/**\n Similar to :meth:`get_input_peer`, but for :tl:`InputChannel`'s alone.\n\n .. important::\n\n This method does not validate for invalid general-purpose access\n hashes, unlike `get_input_peer`. Consider using instead:\n ``get_input_channel(get_input_peer(channel))``.\n\n * @param entity\n * @returns {InputChannel|*}\n */\n/* CONTEST\nfunction getInputChannel(entity) {\n    if (entity.SUBCLASS_OF_ID === undefined) {\n        _raiseCastFail(entity, 'InputChannel')\n    }\n\n    if (entity.SUBCLASS_OF_ID === 0x40f202fd) { // crc32(b'InputChannel')\n        return entity\n    }\n    if (entity instanceof constructors.Channel || entity instanceof constructors.ChannelForbidden) {\n        return new constructors.InputChannel({\n            channelId: entity.id,\n            accessHash: entity.accessHash || 0\n        })\n    }\n\n    if (entity instanceof constructors.InputPeerChannel) {\n        return new constructors.InputChannel({\n            channelId: entity.channelId,\n            accessHash: entity.accessHash\n        })\n    }\n    _raiseCastFail(entity, 'InputChannel')\n}\n*/\n/**\n Similar to :meth:`get_input_peer`, but for :tl:`InputUser`'s alone.\n\n .. important::\n\n This method does not validate for invalid general-purpose access\n hashes, unlike `get_input_peer`. Consider using instead:\n ``get_input_channel(get_input_peer(channel))``.\n\n * @param entity\n */\n/* CONTEST\nfunction getInputUser(entity) {\n    if (entity.SUBCLASS_OF_ID === undefined) {\n        _raiseCastFail(entity, 'InputUser')\n    }\n    if (entity.SUBCLASS_OF_ID === 0xe669bf46) { // crc32(b'InputUser')\n        return entity\n    }\n\n    if (entity instanceof constructors.User) {\n        if (entity.isSelf) {\n            return new constructors.InputPeerSelf()\n        } else {\n            return new constructors.InputUser({\n                userId: entity.id,\n                accessHash: entity.accessHash || 0,\n            })\n        }\n    }\n    if (entity instanceof constructors.InputPeerSelf) {\n        return new constructors.InputPeerSelf()\n    }\n    if (entity instanceof constructors.UserEmpty || entity instanceof constructors.InputPeerEmpty) {\n        return new constructors.InputUserEmpty()\n    }\n\n    if (entity instanceof constructors.UserFull) {\n        return getInputUser(entity.user)\n    }\n\n    if (entity instanceof constructors.InputPeerUser) {\n        return new constructors.InputUser({\n            userId: entity.userId,\n            accessHash: entity.accessHash\n        })\n    }\n\n    _raiseCastFail(entity, 'InputUser')\n}\n*/\n/**\n Similar to :meth:`get_input_peer`, but for dialogs\n * @param dialog\n */\n/* CONTEST\nfunction getInputDialog(dialog) {\n    try {\n        if (dialog.SUBCLASS_OF_ID === 0xa21c9795) { // crc32(b'InputDialogPeer')\n            return dialog\n        }\n        if (dialog.SUBCLASS_OF_ID === 0xc91c90b6) { // crc32(b'InputPeer')\n            return new constructors.InputDialogPeer({ peer: dialog })\n        }\n    } catch (e) {\n        _raiseCastFail(dialog, 'InputDialogPeer')\n    }\n\n    try {\n        return new constructors.InputDialogPeer(getInputPeer(dialog))\n        // eslint-disable-next-line no-empty\n    } catch (e) {\n\n    }\n    _raiseCastFail(dialog, 'InputDialogPeer')\n}\n*/\n\n/* CONTEST\n\nfunction getInputMessage(message) {\n    try {\n        if (typeof message == 'number') { // This case is really common too\n            return new constructors.InputMessageID({\n                id: message,\n            })\n        } else if (message.SUBCLASS_OF_ID === 0x54b6bcc5) { // crc32(b'InputMessage')\n            return message\n        } else if (message.SUBCLASS_OF_ID === 0x790009e3) { // crc32(b'Message')\n            return new constructors.InputMessageID(message.id)\n        }\n        // eslint-disable-next-line no-empty\n    } catch (e) {\n    }\n\n    _raiseCastFail(message, 'InputMessage')\n}\n*/\n\n/**\n * Adds the JPG header and footer to a stripped image.\n * Ported from https://github.com/telegramdesktop/\n * tdesktop/blob/bec39d89e19670eb436dc794a8f20b657cb87c71/Telegram/SourceFiles/ui/image/image.cpp#L225\n\n * @param stripped{Buffer}\n * @returns {Buffer}\n */\nfunction strippedPhotoToJpg(stripped) {\n    // Note: Changes here should update _stripped_real_length\n    if (stripped.length < 3 || stripped[0] !== 1) {\n        return stripped;\n    }\n    const header = Buffer.from(JPEG_HEADER);\n    // eslint-disable-next-line prefer-destructuring\n    header[164] = stripped[1];\n    // eslint-disable-next-line prefer-destructuring\n    header[166] = stripped[2];\n    return Buffer.concat([header, stripped.slice(3), JPEG_FOOTER]);\n}\n\n/* CONTEST\nfunction getInputLocation(location) {\n    try {\n        if (!location.SUBCLASS_OF_ID) {\n            throw new Error()\n        }\n        if (location.SUBCLASS_OF_ID === 0x1523d462) {\n            return {\n                dcId: null,\n                inputLocation: location\n            }\n        }\n    } catch (e) {\n        _raiseCastFail(location, 'InputFileLocation')\n    }\n    if (location instanceof constructors.Message) {\n        location = location.media\n    }\n\n    if (location instanceof constructors.MessageMediaDocument) {\n        location = location.document\n    } else if (location instanceof constructors.MessageMediaPhoto) {\n        location = location.photo\n    }\n\n    if (location instanceof constructors.Document) {\n        return {\n            dcId: location.dcId,\n            inputLocation: new constructors.InputDocumentFileLocation({\n                id: location.id,\n                accessHash: location.accessHash,\n                fileReference: location.fileReference,\n                thumbSize: '', // Presumably to download one of its thumbnails\n            }),\n        }\n    } else if (location instanceof constructors.Photo) {\n        return {\n            dcId: location.dcId,\n            inputLocation: new constructors.InputPhotoFileLocation({\n                id: location.id,\n                accessHash: location.accessHash,\n                fileReference: location.fileReference,\n                thumbSize: location.sizes[location.sizes.length - 1].type,\n            }),\n        }\n    }\n\n    if (location instanceof constructors.FileLocationToBeDeprecated) {\n        throw new Error('Unavailable location cannot be used as input')\n    }\n    _raiseCastFail(location, 'InputFileLocation')\n}\n*/\n\n/**\n * Gets the appropriated part size when downloading files,\n * given an initial file size.\n * @param fileSize\n * @returns {Number}\n */\nfunction getDownloadPartSize(fileSize) {\n    if (fileSize <= 65536) { // 64KB\n        return 64;\n    }\n    if (fileSize <= 104857600) { // 100MB\n        return 128;\n    }\n    if (fileSize <= 786432000) { // 750MB\n        return 256;\n    }\n    if (fileSize <= 2097152000) { // 2000MB\n        return 512;\n    }\n    if (fileSize <= 4194304000) { // 4000MB\n        return 1024;\n    }\n\n    throw new Error('File size too large');\n}\n\n/**\n * Gets the appropriated part size when uploading files,\n * given an initial file size.\n * @param fileSize\n * @returns {Number}\n */\nfunction getUploadPartSize(fileSize) {\n    if (fileSize <= 104857600) { // 100MB\n        return 128;\n    }\n    if (fileSize <= 786432000) { // 750MB\n        return 256;\n    }\n    if (fileSize <= 2097152000) { // 2000MB\n        return 512;\n    }\n    if (fileSize <= 4194304000) { // 4000MB\n        return 512;\n    }\n\n    throw new Error('File size too large');\n}\n\n/* CONTEST\nfunction getPeer(peer) {\n    try {\n        if (typeof peer === 'number') {\n            const res = resolveId(peer)\n\n            if (res[1] === constructors.PeerChannel) {\n                return new res[1]({ channelId: res[0] })\n            } else if (res[1] === constructors.PeerChat) {\n                return new res[1]({ chatId: res[0] })\n            } else {\n                return new res[1]({ userId: res[0] })\n            }\n        }\n        if (peer.SUBCLASS_OF_ID === undefined) {\n            throw new Error()\n        }\n        if (peer.SUBCLASS_OF_ID === 0x2d45687) {\n            return peer\n        } else if (peer instanceof constructors.contacts.ResolvedPeer ||\n            peer instanceof constructors.InputNotifyPeer || peer instanceof constructors.TopPeer ||\n            peer instanceof constructors.Dialog || peer instanceof constructors.DialogPeer) {\n            return peer.peer\n        } else if (peer instanceof constructors.ChannelFull) {\n            return new constructors.PeerChannel({ channelId: peer.id })\n        }\n        if (peer.SUBCLASS_OF_ID === 0x7d7c6f86 || peer.SUBCLASS_OF_ID === 0xd9c7fc18) {\n            // ChatParticipant, ChannelParticipant\n            return new constructors.PeerUser({ userId: peer.userId })\n        }\n        peer = getInputPeer(peer, false, false)\n\n        if (peer instanceof constructors.InputPeerUser) {\n            return new constructors.PeerUser({ userId: peer.userId })\n        } else if (peer instanceof constructors.InputPeerChat) {\n            return new constructors.PeerChat({ chatId: peer.chatId })\n        } else if (peer instanceof constructors.InputPeerChannel) {\n            return new constructors.PeerChannel({ channelId: peer.channelId })\n        }\n        // eslint-disable-next-line no-empty\n    } catch (e) {\n        console.log(e)\n    }\n    _raiseCastFail(peer, 'peer')\n}\n*/\n\n/**\n Convert the given peer into its marked ID by default.\n\n This \"mark\" comes from the \"bot api\" format, and with it the peer type\n can be identified back. User ID is left unmodified, chat ID is negated,\n and channel ID is prefixed with -100:\n\n * ``userId``\n * ``-chatId``\n * ``-100channel_id``\n\n The original ID and the peer type class can be returned with\n a call to :meth:`resolve_id(marked_id)`.\n * @param peer\n * @param addMark\n */\n/* CONTEST\nfunction getPeerId(peer, addMark = true) {\n    // First we assert it's a Peer TLObject, or early return for integers\n    if (typeof peer == 'number') {\n        return addMark ? peer : resolveId(peer)[0]\n    }\n\n    // Tell the user to use their client to resolve InputPeerSelf if we got one\n    if (peer instanceof constructors.InputPeerSelf) {\n        _raiseCastFail(peer, 'int (you might want to use client.get_peer_id)')\n    }\n\n    try {\n        peer = getPeer(peer)\n    } catch (e) {\n        _raiseCastFail(peer, 'int')\n    }\n    if (peer instanceof constructors.PeerUser) {\n        return peer.userId\n    } else if (peer instanceof constructors.PeerChat) {\n        // Check in case the user mixed things up to avoid blowing up\n        if (!(0 < peer.chatId <= 0x7fffffff)) {\n            peer.chatId = resolveId(peer.chatId)[0]\n        }\n\n        return addMark ? -(peer.chatId) : peer.chatId\n    } else { // if (peer instanceof constructors.PeerChannel)\n        // Check in case the user mixed things up to avoid blowing up\n        if (!(0 < peer.channelId <= 0x7fffffff)) {\n            peer.channelId = resolveId(peer.channelId)[0]\n        }\n        if (!addMark) {\n            return peer.channelId\n        }\n        // Concat -100 through math tricks, .to_supergroup() on\n        // Madeline IDs will be strictly positive -> log works.\n        try {\n            return -(peer.channelId + Math.pow(10, Math.floor(Math.log10(peer.channelId) + 3)))\n        } catch (e) {\n            throw new Error('Cannot get marked ID of a channel unless its ID is strictly positive')\n        }\n    }\n}\n*/\n/**\n * Given a marked ID, returns the original ID and its :tl:`Peer` type.\n * @param markedId\n */\n/* CONTEST\nfunction resolveId(markedId) {\n    if (markedId >= 0) {\n        return [markedId, constructors.PeerUser]\n    }\n\n    // There have been report of chat IDs being 10000xyz, which means their\n    // marked version is -10000xyz, which in turn looks like a channel but\n    // it becomes 00xyz (= xyz). Hence, we must assert that there are only\n    // two zeroes.\n    const m = markedId.toString()\n        .match(/-100([^0]\\d*)/)\n    if (m) {\n        return [parseInt(m[1]), constructors.PeerChannel]\n    }\n    return [-markedId, constructors.PeerChat]\n}\n*/\n\n/**\n * returns an entity pair\n * @param entityId\n * @param entities\n * @param cache\n * @param getInputPeer\n * @returns {{inputEntity: *, entity: *}}\n * @private\n */\n\n/* CONTEST\n\nfunction _getEntityPair(entityId, entities, cache, getInputPeer = getInputPeer) {\n    const entity = entities.get(entityId)\n    let inputEntity = cache[entityId]\n    if (inputEntity === undefined) {\n        try {\n            inputEntity = getInputPeer(inputEntity)\n        } catch (e) {\n            inputEntity = null\n        }\n    }\n    return {\n        entity,\n        inputEntity\n    }\n}\n*/\n\nfunction getMessageId(message) {\n    if (message === undefined) {\n        return undefined;\n    }\n    if (typeof message === 'number') {\n        return message;\n    }\n    if (message.SUBCLASS_OF_ID === 0x790009e3) { // crc32(b'Message')\n        return message.id;\n    }\n    throw new Error(`Invalid message type: ${message.constructor.name}`);\n}\n\n/**\n Parses the given username or channel access hash, given\n a string, username or URL. Returns a tuple consisting of\n both the stripped, lowercase username and whether it is\n a joinchat/ hash (in which case is not lowercase'd).\n\n Returns ``(None, False)`` if the ``username`` or link is not valid.\n\n * @param username {string}\n */\n\n/* CONTEST\n\nfunction parseUsername(username) {\n    username = username.trim()\n    const m = username.match(USERNAME_RE) || username.match(TG_JOIN_RE)\n    if (m) {\n        username = username.replace(m[0], '')\n        if (m[1]) {\n            return {\n                username: username,\n                isInvite: true\n            }\n        } else {\n            username = rtrim(username, '/')\n        }\n    }\n    if (username.match(VALID_USERNAME_RE)) {\n        return {\n            username: username.toLowerCase(),\n            isInvite: false\n        }\n    } else {\n        return {\n            username: null,\n            isInvite: false\n        }\n    }\n}\n\nfunction rtrim(s, mask) {\n    while (~mask.indexOf(s[s.length - 1])) {\n        s = s.slice(0, -1)\n    }\n    return s\n}\n\n */\n\n/**\n * Gets the display name for the given :tl:`User`,\n :tl:`Chat` or :tl:`Channel`. Returns an empty string otherwise\n * @param entity\n */\nfunction getDisplayName(entity) {\n    if (entity instanceof constructors.User) {\n        if (entity.lastName && entity.firstName) {\n            return `${entity.firstName} ${entity.lastName}`;\n        } else if (entity.firstName) {\n            return entity.firstName;\n        } else if (entity.lastName) {\n            return entity.lastName;\n        } else {\n            return '';\n        }\n    } else if (entity instanceof constructors.Chat || entity instanceof constructors.Channel) {\n        return entity.title;\n    }\n    return '';\n}\n\n/**\n * check if a given item is an array like or not\n * @param item\n * @returns {boolean}\n */\n\n/* CONTEST\nDuplicate ?\nfunction isListLike(item) {\n    return (\n        Array.isArray(item) ||\n        (Boolean(item) &&\n            typeof item === 'object' &&\n            typeof (item.length) === 'number' &&\n            (item.length === 0 ||\n                (item.length > 0 &&\n                    (item.length - 1) in item)\n            )\n        )\n    )\n}\n*/\n/**\n * Returns the appropriate DC based on the id\n * @param dcId the id of the DC.\n * @param downloadDC whether to use -1 DCs or not\n * (These only support downloading/uploading and not creating a new AUTH key)\n * @return {{port: number, ipAddress: string, id: number}}\n */\nfunction getDC(dcId, downloadDC = false) {\n    // TODO Move to external config\n    switch (dcId) {\n        case 1:\n            return {\n                id: 1,\n                ipAddress: `zws1${downloadDC ? '-1' : ''}.web.telegram.org`,\n                port: 443,\n            };\n        case 2:\n            return {\n                id: 2,\n                ipAddress: `zws2${downloadDC ? '-1' : ''}.web.telegram.org`,\n                port: 443,\n            };\n        case 3:\n            return {\n                id: 3,\n                ipAddress: `zws3${downloadDC ? '-1' : ''}.web.telegram.org`,\n                port: 443,\n            };\n        case 4:\n            return {\n                id: 4,\n                ipAddress: `zws4${downloadDC ? '-1' : ''}.web.telegram.org`,\n                port: 443,\n            };\n        case 5:\n            return {\n                id: 5,\n                ipAddress: `zws5${downloadDC ? '-1' : ''}.web.telegram.org`,\n                port: 443,\n            };\n        default:\n            throw new Error(`Cannot find the DC with the ID of ${dcId}`);\n    }\n    // TODO chose based on current connection method\n    /*\n    if (!this._config) {\n        this._config = await this.invoke(new requests.help.GetConfig())\n    }\n    if (cdn && !this._cdnConfig) {\n        this._cdnConfig = await this.invoke(new requests.help.GetCdnConfig())\n        for (const pk of this._cdnConfig.publicKeys) {\n            addKey(pk.publicKey)\n        }\n    }\n    for (const DC of this._config.dcOptions) {\n        if (DC.id === dcId && Boolean(DC.ipv6) === this._useIPV6 && Boolean(DC.cdn) === cdn) {\n            return DC\n        }\n    } */\n}\n\nmodule.exports = {\n    getMessageId,\n    // _getEntityPair,\n    // getInputMessage,\n    // getInputDialog,\n    // getInputUser,\n    // getInputChannel,\n    getInputPeer,\n    // parsePhone,\n    // parseUsername,\n    // getPeer,\n    // getPeerId,\n    getDisplayName,\n    // resolveId,\n    // isListLike,\n    getDownloadPartSize,\n    getUploadPartSize,\n    // getInputLocation,\n    strippedPhotoToJpg,\n    getDC,\n};\n","// Copyright Twitter Inc. Licensed under MIT\n// https://github.com/twitter/twemoji-parser/blob/master/LICENSE.md\n// Emoji 15.0 support was taken here https://github.com/mei23/twemoji-parser\n// Version d374b2f 21.12.2022\n\nconst vs16RegExp = /\\uFE0F/g;\n// avoid using a string literal like `\\u200D` here because minifiers expand it inline\nconst zeroWidthJoiner = String.fromCharCode(0x200d);\n\nexport function removeVS16s(rawEmoji) {\n  return rawEmoji.indexOf(zeroWidthJoiner) < 0 ? rawEmoji.replace(vs16RegExp, '') : rawEmoji;\n}\n\n// Default Twemoji regex was modified here.\n// An exception for ascii emoji has been added to the beginning of the regular string: 🅰🅱🅾🅿.\n// UTF-16 endcoding are `\\ud83c\\udd70`, `\\ud83c\\udd71`, `\\ud83c\\udd7e` and `\\ud83c\\udd7f`.\n// These emojis in the graphic version must end with the `\\ufe0f` symbol.\n// Therefore, they should be excluded from the regular expression.\n// You must remove next substring `\\udd70\\udd71\\udd7e\\udd7f` from the middle of the regex on every update.\n\n// This file is generated by source/emoji/scripts/generate.sh\n// eslint-disable-next-line max-len\nexport default /(?:\\ud83c[\\udd70\\udd71\\udd7e\\udd7f]\\ufe0f)|(?:\\ud83d\\udc68\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83e\\uddd1\\ud83c[\\udffc-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83e\\uddd1\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83e\\uddd1\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83e\\uddd1\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83e\\uddd1\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udffe]|\\ud83d\\udc68\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffb\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffc-\\udfff]|\\ud83d\\udc68\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffc\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83d\\udc68\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffd\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83d\\udc68\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffe\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83d\\udc68\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udfff\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udffe]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffc-\\udfff]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc69\\ud83c[\\udffc-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc69\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc69\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udffe]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udffe]|\\ud83e\\uddd1\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83e\\uddd1\\ud83c[\\udffc-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffb\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83e\\uddd1\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffc\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83e\\uddd1\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83e\\uddd1\\ud83c\\udffd\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83e\\uddd1\\ud83c\\udffe\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udfff]|\\ud83e\\uddd1\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udffe]|\\ud83e\\uddd1\\ud83c\\udfff\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68|\\ud83d\\udc69\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d[\\udc68\\udc69]|\\ud83d\\udc68\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68|\\ud83d\\udc69\\u200d\\u2764\\ufe0f\\u200d\\ud83d[\\udc68\\udc69]|\\ud83e\\uddd1\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1|\\ud83d\\udc6b\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc6c\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc6d\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc8f\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc91\\ud83c[\\udffb-\\udfff]|\\ud83d[\\udc6b-\\udc6d\\udc8f\\udc91])|(?:\\ud83d[\\udc68\\udc69]|\\ud83e\\uddd1)(?:\\ud83c[\\udffb-\\udfff])?\\u200d(?:\\u2695\\ufe0f|\\u2696\\ufe0f|\\u2708\\ufe0f|\\ud83c[\\udf3e\\udf73\\udf7c\\udf84\\udf93\\udfa4\\udfa8\\udfeb\\udfed]|\\ud83d[\\udcbb\\udcbc\\udd27\\udd2c\\ude80\\ude92]|\\ud83e[\\uddaf-\\uddb3\\uddbc\\uddbd])|(?:\\ud83c[\\udfcb\\udfcc]|\\ud83d[\\udd74\\udd75]|\\u26f9)((?:\\ud83c[\\udffb-\\udfff]|\\ufe0f)\\u200d[\\u2640\\u2642]\\ufe0f)|(?:\\ud83c[\\udfc3\\udfc4\\udfca]|\\ud83d[\\udc6e\\udc70\\udc71\\udc73\\udc77\\udc81\\udc82\\udc86\\udc87\\ude45-\\ude47\\ude4b\\ude4d\\ude4e\\udea3\\udeb4-\\udeb6]|\\ud83e[\\udd26\\udd35\\udd37-\\udd39\\udd3d\\udd3e\\uddb8\\uddb9\\uddcd-\\uddcf\\uddd4\\uddd6-\\udddd])(?:\\ud83c[\\udffb-\\udfff])?\\u200d[\\u2640\\u2642]\\ufe0f|(?:\\ud83d\\udc68\\u200d\\ud83d\\udc68\\u200d\\ud83d\\udc66\\u200d\\ud83d\\udc66|\\ud83d\\udc68\\u200d\\ud83d\\udc68\\u200d\\ud83d\\udc67\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc68\\u200d\\ud83d\\udc69\\u200d\\ud83d\\udc66\\u200d\\ud83d\\udc66|\\ud83d\\udc68\\u200d\\ud83d\\udc69\\u200d\\ud83d\\udc67\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc69\\u200d\\ud83d\\udc69\\u200d\\ud83d\\udc66\\u200d\\ud83d\\udc66|\\ud83d\\udc69\\u200d\\ud83d\\udc69\\u200d\\ud83d\\udc67\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc68\\u200d\\ud83d\\udc66\\u200d\\ud83d\\udc66|\\ud83d\\udc68\\u200d\\ud83d\\udc67\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc68\\u200d\\ud83d\\udc68\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc68\\u200d\\ud83d\\udc69\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc69\\u200d\\ud83d\\udc66\\u200d\\ud83d\\udc66|\\ud83d\\udc69\\u200d\\ud83d\\udc67\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc69\\u200d\\ud83d\\udc69\\u200d\\ud83d[\\udc66\\udc67]|\\ud83c\\udff3\\ufe0f\\u200d\\u26a7\\ufe0f|\\ud83c\\udff3\\ufe0f\\u200d\\ud83c\\udf08|\\ud83d\\ude36\\u200d\\ud83c\\udf2b\\ufe0f|\\u2764\\ufe0f\\u200d\\ud83d\\udd25|\\u2764\\ufe0f\\u200d\\ud83e\\ude79|\\ud83c\\udff4\\u200d\\u2620\\ufe0f|\\ud83d\\udc15\\u200d\\ud83e\\uddba|\\ud83d\\udc3b\\u200d\\u2744\\ufe0f|\\ud83d\\udc41\\u200d\\ud83d\\udde8|\\ud83d\\udc68\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc69\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc6f\\u200d\\u2640\\ufe0f|\\ud83d\\udc6f\\u200d\\u2642\\ufe0f|\\ud83d\\ude2e\\u200d\\ud83d\\udca8|\\ud83d\\ude35\\u200d\\ud83d\\udcab|\\ud83e\\udd3c\\u200d\\u2640\\ufe0f|\\ud83e\\udd3c\\u200d\\u2642\\ufe0f|\\ud83e\\uddde\\u200d\\u2640\\ufe0f|\\ud83e\\uddde\\u200d\\u2642\\ufe0f|\\ud83e\\udddf\\u200d\\u2640\\ufe0f|\\ud83e\\udddf\\u200d\\u2642\\ufe0f|\\ud83d\\udc08\\u200d\\u2b1b|\\ud83d\\udc26\\u200d\\u2b1b)|[#*0-9]\\ufe0f?\\u20e3|(?:[©®\\u2122\\u265f]\\ufe0f)|(?:\\ud83c[\\udc04\\ude02\\ude1a\\ude2f\\ude37\\udf21\\udf24-\\udf2c\\udf36\\udf7d\\udf96\\udf97\\udf99-\\udf9b\\udf9e\\udf9f\\udfcd\\udfce\\udfd4-\\udfdf\\udff3\\udff5\\udff7]|\\ud83d[\\udc3f\\udc41\\udcfd\\udd49\\udd4a\\udd6f\\udd70\\udd73\\udd76-\\udd79\\udd87\\udd8a-\\udd8d\\udda5\\udda8\\uddb1\\uddb2\\uddbc\\uddc2-\\uddc4\\uddd1-\\uddd3\\udddc-\\uddde\\udde1\\udde3\\udde8\\uddef\\uddf3\\uddfa\\udecb\\udecd-\\udecf\\udee0-\\udee5\\udee9\\udef0\\udef3]|[\\u203c\\u2049\\u2139\\u2194-\\u2199\\u21a9\\u21aa\\u231a\\u231b\\u2328\\u23cf\\u23ed-\\u23ef\\u23f1\\u23f2\\u23f8-\\u23fa\\u24c2\\u25aa\\u25ab\\u25b6\\u25c0\\u25fb-\\u25fe\\u2600-\\u2604\\u260e\\u2611\\u2614\\u2615\\u2618\\u2620\\u2622\\u2623\\u2626\\u262a\\u262e\\u262f\\u2638-\\u263a\\u2640\\u2642\\u2648-\\u2653\\u2660\\u2663\\u2665\\u2666\\u2668\\u267b\\u267f\\u2692-\\u2697\\u2699\\u269b\\u269c\\u26a0\\u26a1\\u26a7\\u26aa\\u26ab\\u26b0\\u26b1\\u26bd\\u26be\\u26c4\\u26c5\\u26c8\\u26cf\\u26d1\\u26d3\\u26d4\\u26e9\\u26ea\\u26f0-\\u26f5\\u26f8\\u26fa\\u26fd\\u2702\\u2708\\u2709\\u270f\\u2712\\u2714\\u2716\\u271d\\u2721\\u2733\\u2734\\u2744\\u2747\\u2757\\u2763\\u2764\\u27a1\\u2934\\u2935\\u2b05-\\u2b07\\u2b1b\\u2b1c\\u2b50\\u2b55\\u3030\\u303d\\u3297\\u3299])(?:\\ufe0f|(?!\\ufe0e))|(?:(?:\\ud83c[\\udfcb\\udfcc]|\\ud83d[\\udd74\\udd75\\udd90]|[\\u261d\\u26f7\\u26f9\\u270c\\u270d])(?:\\ufe0f|(?!\\ufe0e))|(?:\\ud83c[\\udf85\\udfc2-\\udfc4\\udfc7\\udfca]|\\ud83d[\\udc42\\udc43\\udc46-\\udc50\\udc66-\\udc69\\udc6e\\udc70-\\udc78\\udc7c\\udc81-\\udc83\\udc85-\\udc87\\udcaa\\udd7a\\udd95\\udd96\\ude45-\\ude47\\ude4b-\\ude4f\\udea3\\udeb4-\\udeb6\\udec0\\udecc]|\\ud83e[\\udd0c\\udd0f\\udd18-\\udd1f\\udd26\\udd30-\\udd39\\udd3d\\udd3e\\udd77\\uddb5\\uddb6\\uddb8\\uddb9\\uddbb\\uddcd-\\uddcf\\uddd1-\\udddd\\udec3-\\udec5\\udef0-\\udef8]|[\\u270a\\u270b]))(?:\\ud83c[\\udffb-\\udfff])?|(?:\\ud83c\\udff4\\udb40\\udc67\\udb40\\udc62\\udb40\\udc65\\udb40\\udc6e\\udb40\\udc67\\udb40\\udc7f|\\ud83c\\udff4\\udb40\\udc67\\udb40\\udc62\\udb40\\udc73\\udb40\\udc63\\udb40\\udc74\\udb40\\udc7f|\\ud83c\\udff4\\udb40\\udc67\\udb40\\udc62\\udb40\\udc77\\udb40\\udc6c\\udb40\\udc73\\udb40\\udc7f|\\ud83c\\udde6\\ud83c[\\udde8-\\uddec\\uddee\\uddf1\\uddf2\\uddf4\\uddf6-\\uddfa\\uddfc\\uddfd\\uddff]|\\ud83c\\udde7\\ud83c[\\udde6\\udde7\\udde9-\\uddef\\uddf1-\\uddf4\\uddf6-\\uddf9\\uddfb\\uddfc\\uddfe\\uddff]|\\ud83c\\udde8\\ud83c[\\udde6\\udde8\\udde9\\uddeb-\\uddee\\uddf0-\\uddf5\\uddf7\\uddfa-\\uddff]|\\ud83c\\udde9\\ud83c[\\uddea\\uddec\\uddef\\uddf0\\uddf2\\uddf4\\uddff]|\\ud83c\\uddea\\ud83c[\\udde6\\udde8\\uddea\\uddec\\udded\\uddf7-\\uddfa]|\\ud83c\\uddeb\\ud83c[\\uddee-\\uddf0\\uddf2\\uddf4\\uddf7]|\\ud83c\\uddec\\ud83c[\\udde6\\udde7\\udde9-\\uddee\\uddf1-\\uddf3\\uddf5-\\uddfa\\uddfc\\uddfe]|\\ud83c\\udded\\ud83c[\\uddf0\\uddf2\\uddf3\\uddf7\\uddf9\\uddfa]|\\ud83c\\uddee\\ud83c[\\udde8-\\uddea\\uddf1-\\uddf4\\uddf6-\\uddf9]|\\ud83c\\uddef\\ud83c[\\uddea\\uddf2\\uddf4\\uddf5]|\\ud83c\\uddf0\\ud83c[\\uddea\\uddec-\\uddee\\uddf2\\uddf3\\uddf5\\uddf7\\uddfc\\uddfe\\uddff]|\\ud83c\\uddf1\\ud83c[\\udde6-\\udde8\\uddee\\uddf0\\uddf7-\\uddfb\\uddfe]|\\ud83c\\uddf2\\ud83c[\\udde6\\udde8-\\udded\\uddf0-\\uddff]|\\ud83c\\uddf3\\ud83c[\\udde6\\udde8\\uddea-\\uddec\\uddee\\uddf1\\uddf4\\uddf5\\uddf7\\uddfa\\uddff]|\\ud83c\\uddf4\\ud83c\\uddf2|\\ud83c\\uddf5\\ud83c[\\udde6\\uddea-\\udded\\uddf0-\\uddf3\\uddf7-\\uddf9\\uddfc\\uddfe]|\\ud83c\\uddf6\\ud83c\\udde6|\\ud83c\\uddf7\\ud83c[\\uddea\\uddf4\\uddf8\\uddfa\\uddfc]|\\ud83c\\uddf8\\ud83c[\\udde6-\\uddea\\uddec-\\uddf4\\uddf7-\\uddf9\\uddfb\\uddfd-\\uddff]|\\ud83c\\uddf9\\ud83c[\\udde6\\udde8\\udde9\\uddeb-\\udded\\uddef-\\uddf4\\uddf7\\uddf9\\uddfb\\uddfc\\uddff]|\\ud83c\\uddfa\\ud83c[\\udde6\\uddec\\uddf2\\uddf3\\uddf8\\uddfe\\uddff]|\\ud83c\\uddfb\\ud83c[\\udde6\\udde8\\uddea\\uddec\\uddee\\uddf3\\uddfa]|\\ud83c\\uddfc\\ud83c[\\uddeb\\uddf8]|\\ud83c\\uddfd\\ud83c\\uddf0|\\ud83c\\uddfe\\ud83c[\\uddea\\uddf9]|\\ud83c\\uddff\\ud83c[\\udde6\\uddf2\\uddfc]|\\ud83c[\\udccf\\udd8e\\udd91-\\udd9a\\udde6-\\uddff\\ude01\\ude32-\\ude36\\ude38-\\ude3a\\ude50\\ude51\\udf00-\\udf20\\udf2d-\\udf35\\udf37-\\udf7c\\udf7e-\\udf84\\udf86-\\udf93\\udfa0-\\udfc1\\udfc5\\udfc6\\udfc8\\udfc9\\udfcf-\\udfd3\\udfe0-\\udff0\\udff4\\udff8-\\udfff]|\\ud83d[\\udc00-\\udc3e\\udc40\\udc44\\udc45\\udc51-\\udc65\\udc6a\\udc6f\\udc79-\\udc7b\\udc7d-\\udc80\\udc84\\udc88-\\udc8e\\udc90\\udc92-\\udca9\\udcab-\\udcfc\\udcff-\\udd3d\\udd4b-\\udd4e\\udd50-\\udd67\\udda4\\uddfb-\\ude44\\ude48-\\ude4a\\ude80-\\udea2\\udea4-\\udeb3\\udeb7-\\udebf\\udec1-\\udec5\\uded0-\\uded2\\uded5-\\uded7\\udedc-\\udedf\\udeeb\\udeec\\udef4-\\udefc\\udfe0-\\udfeb\\udff0]|\\ud83e[\\udd0d\\udd0e\\udd10-\\udd17\\udd20-\\udd25\\udd27-\\udd2f\\udd3a\\udd3c\\udd3f-\\udd45\\udd47-\\udd76\\udd78-\\uddb4\\uddb7\\uddba\\uddbc-\\uddcc\\uddd0\\uddde-\\uddff\\ude70-\\ude7c\\ude80-\\ude88\\ude90-\\udebd\\udebf-\\udec2\\udece-\\udedb\\udee0-\\udee8]|[\\u23e9-\\u23ec\\u23f0\\u23f3\\u267e\\u26ce\\u2705\\u2728\\u274c\\u274e\\u2753-\\u2755\\u2795-\\u2797\\u27b0\\u27bf\\ue50a])|\\ufe0f/g;\n","export default class Deferred<T = void> {\n  promise: Promise<T>;\n\n  reject!: (reason?: any) => void;\n\n  resolve!: (value: T | PromiseLike<T>) => void;\n\n  constructor() {\n    this.promise = new Promise((resolve, reject) => {\n      this.reject = reject;\n      this.resolve = resolve;\n    });\n  }\n\n  static resolved(): Deferred<void>;\n  static resolved<T>(value: T): Deferred<T>;\n  static resolved<T>(value?: T): Deferred<T | void> {\n    const deferred = new Deferred<T | void>();\n    deferred.resolve(value);\n    return deferred;\n  }\n}\n","import twemojiRegex from '../lib/twemojiRegex';\n\nconst DETECT_UP_TO = 100;\nconst MAX_LENGTH = DETECT_UP_TO * 8; // Maximum 8 per one emoji.\nconst RE_EMOJI_ONLY = new RegExp(`^(?:${twemojiRegex.source})+$`, '');\n\nconst parseEmojiOnlyString = (text: string): number | false => {\n  const lines = text.split('\\n');\n  const textWithoutNewlines = lines.join('');\n  if (textWithoutNewlines.length > MAX_LENGTH) {\n    return false;\n  }\n\n  const isEmojiOnly = Boolean(textWithoutNewlines.match(RE_EMOJI_ONLY));\n  if (!isEmojiOnly) {\n    return false;\n  }\n  const countPerLine = lines.map((line) => {\n    let emojiCount = 0;\n    while (twemojiRegex.exec(line)) {\n      emojiCount++;\n\n      if (emojiCount > DETECT_UP_TO) {\n        twemojiRegex.lastIndex = 0;\n        return -1;\n      }\n    }\n\n    return emojiCount;\n  });\n\n  let max = lines.length;\n  for (let i = 0; i < countPerLine.length; i++) {\n    if (countPerLine[i] === -1) {\n      return false;\n    }\n    if (countPerLine[i] > max) {\n      max = countPerLine[i];\n    }\n  }\n\n  return max;\n};\n\nexport default parseEmojiOnlyString;\n","function promisifyRequest(request) {\n    return new Promise((resolve, reject) => {\n        // @ts-ignore - file size hacks\n        request.oncomplete = request.onsuccess = () => resolve(request.result);\n        // @ts-ignore - file size hacks\n        request.onabort = request.onerror = () => reject(request.error);\n    });\n}\nfunction createStore(dbName, storeName) {\n    const request = indexedDB.open(dbName);\n    request.onupgradeneeded = () => request.result.createObjectStore(storeName);\n    const dbp = promisifyRequest(request);\n    return (txMode, callback) => dbp.then((db) => callback(db.transaction(storeName, txMode).objectStore(storeName)));\n}\nlet defaultGetStoreFunc;\nfunction defaultGetStore() {\n    if (!defaultGetStoreFunc) {\n        defaultGetStoreFunc = createStore('keyval-store', 'keyval');\n    }\n    return defaultGetStoreFunc;\n}\n/**\n * Get a value by its key.\n *\n * @param key\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction get(key, customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => promisifyRequest(store.get(key)));\n}\n/**\n * Set a value with a key.\n *\n * @param key\n * @param value\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction set(key, value, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        store.put(value, key);\n        return promisifyRequest(store.transaction);\n    });\n}\n/**\n * Set multiple values at once. This is faster than calling set() multiple times.\n * It's also atomic – if one of the pairs can't be added, none will be added.\n *\n * @param entries Array of entries, where each entry is an array of `[key, value]`.\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction setMany(entries, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        entries.forEach((entry) => store.put(entry[1], entry[0]));\n        return promisifyRequest(store.transaction);\n    });\n}\n/**\n * Get multiple values by their keys\n *\n * @param keys\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction getMany(keys, customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => Promise.all(keys.map((key) => promisifyRequest(store.get(key)))));\n}\n/**\n * Update a value. This lets you see the old value and update it as an atomic operation.\n *\n * @param key\n * @param updater A callback that takes the old value and returns a new value.\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction update(key, updater, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => \n    // Need to create the promise manually.\n    // If I try to chain promises, the transaction closes in browsers\n    // that use a promise polyfill (IE10/11).\n    new Promise((resolve, reject) => {\n        store.get(key).onsuccess = function () {\n            try {\n                store.put(updater(this.result), key);\n                resolve(promisifyRequest(store.transaction));\n            }\n            catch (err) {\n                reject(err);\n            }\n        };\n    }));\n}\n/**\n * Delete a particular key from the store.\n *\n * @param key\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction del(key, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        store.delete(key);\n        return promisifyRequest(store.transaction);\n    });\n}\n/**\n * Delete multiple keys at once.\n *\n * @param keys List of keys to delete.\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction delMany(keys, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        keys.forEach((key) => store.delete(key));\n        return promisifyRequest(store.transaction);\n    });\n}\n/**\n * Clear all values in the store.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction clear(customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        store.clear();\n        return promisifyRequest(store.transaction);\n    });\n}\nfunction eachCursor(store, callback) {\n    store.openCursor().onsuccess = function () {\n        if (!this.result)\n            return;\n        callback(this.result);\n        this.result.continue();\n    };\n    return promisifyRequest(store.transaction);\n}\n/**\n * Get all keys in the store.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction keys(customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => {\n        // Fast path for modern browsers\n        if (store.getAllKeys) {\n            return promisifyRequest(store.getAllKeys());\n        }\n        const items = [];\n        return eachCursor(store, (cursor) => items.push(cursor.key)).then(() => items);\n    });\n}\n/**\n * Get all values in the store.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction values(customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => {\n        // Fast path for modern browsers\n        if (store.getAll) {\n            return promisifyRequest(store.getAll());\n        }\n        const items = [];\n        return eachCursor(store, (cursor) => items.push(cursor.value)).then(() => items);\n    });\n}\n/**\n * Get all entries in the store. Each entry is an array of `[key, value]`.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction entries(customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => {\n        // Fast path for modern browsers\n        // (although, hopefully we'll get a simpler path some day)\n        if (store.getAll && store.getAllKeys) {\n            return Promise.all([\n                promisifyRequest(store.getAllKeys()),\n                promisifyRequest(store.getAll()),\n            ]).then(([keys, values]) => keys.map((key, i) => [key, values[i]]));\n        }\n        const items = [];\n        return customStore('readonly', (store) => eachCursor(store, (cursor) => items.push([cursor.key, cursor.value])).then(() => items));\n    });\n}\n\nexport { clear, createStore, del, delMany, entries, get, getMany, keys, promisifyRequest, set, setMany, update, values };\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n// the startup function\n__webpack_require__.x = () => {\n\t// Load entry module and return exports\n\t// This entry module depends on other loaded chunks and execution need to be delayed\n\tvar __webpack_exports__ = __webpack_require__.O(undefined, [5802,8764,24,1637], () => (__webpack_require__(52040)))\n\t__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n\treturn __webpack_exports__;\n};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks and sibling chunks for the entrypoint\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + chunkId + \".\" + {\"24\":\"7bd20bcabe5759ab9f80\",\"1637\":\"4ed7624a8ef2283ece00\",\"5802\":\"36a9971f58c808c4a974\",\"8764\":\"58763b7a689318950e51\"}[chunkId] + \".js\";\n};","// This function allow to reference async chunks and sibling chunks for the entrypoint\n__webpack_require__.miniCssF = (chunkId) => {\n\t// return url for filenames based on template\n\treturn undefined;\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.nmd = (module) => {\n\tmodule.paths = [];\n\tif (!module.children) module.children = [];\n\treturn module;\n};","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && !scriptUrl) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","// no baseURI\n\n// object to store loaded chunks\n// \"1\" means \"already loaded\"\nvar installedChunks = {\n\t1969: 1\n};\n\n// importScripts chunk loading\nvar installChunk = (data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\tfor(var moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) runtime(__webpack_require__);\n\twhile(chunkIds.length)\n\t\tinstalledChunks[chunkIds.pop()] = 1;\n\tparentChunkLoadingFunction(data);\n};\n__webpack_require__.f.i = (chunkId, promises) => {\n\t// \"1\" is the signal for \"already loaded\"\n\tif(!installedChunks[chunkId]) {\n\t\tif(true) { // all chunks have JS\n\t\t\timportScripts(__webpack_require__.p + __webpack_require__.u(chunkId));\n\t\t}\n\t}\n};\n\nvar chunkLoadingGlobal = self[\"webpackChunktelegram_t\"] = self[\"webpackChunktelegram_t\"] || [];\nvar parentChunkLoadingFunction = chunkLoadingGlobal.push.bind(chunkLoadingGlobal);\nchunkLoadingGlobal.push = installChunk;\n\n// no HMR\n\n// no HMR manifest","// run startup\nvar __webpack_exports__ = __webpack_require__.x();\n"],"names":["deferred","next","APP_CODE_NAME","IS_TEST","process","IS_PACKAGED_ELECTRON","DEBUG","ELECTRON_HOST_URL","MEDIA_CACHE_DISABLED","MEDIA_CACHE_NAME","MEDIA_CACHE_NAME_AVATARS","MEDIA_CACHE_MAX_BYTES","DOWNLOAD_WORKERS","UPLOAD_WORKERS","GLOBAL_SEARCH_CONTACTS_LIMIT","window","innerHeight","MEMBERS_LOAD_SLICE","PINNED_MESSAGES_LIMIT","BLOCKED_LIST_LIMIT","PROFILE_PHOTOS_LIMIT","COMMON_CHATS_LIMIT","GROUP_CALL_PARTICIPANTS_LIMIT","STORY_LIST_LIMIT","API_GENERAL_ID_LIMIT","STATISTICS_PUBLIC_FORWARDS_LIMIT","TOP_REACTIONS_LIMIT","RECENT_REACTIONS_LIMIT","REACTION_LIST_LIMIT","REACTION_UNREAD_SLICE","MENTION_UNREAD_SLICE","TOPICS_SLICE","SPONSORED_MESSAGE_CACHE_MS","MAX_INT_32","API_UPDATE_THROTTLE","Math","round","API_THROTTLE_RESET_UPDATES","Set","RECENT_STICKERS_LIMIT","RECENT_STATUS_LIMIT","DEFAULT_STATUS_ICON_ID","VIDEO_WEBM_TYPE","GIF_MIME_TYPE","LOTTIE_STICKER_MIME_TYPE","VIDEO_STICKER_MIME_TYPE","SUPPORTED_IMAGE_CONTENT_TYPES","SUPPORTED_VIDEO_CONTENT_TYPES","SUPPORTED_AUDIO_CONTENT_TYPES","WEB_APP_PLATFORM","SERVICE_NOTIFICATIONS_USER_ID","CHANNEL_ID_LENGTH","DEFAULT_GIF_SEARCH_BOT_USERNAME","ALL_FOLDER_ID","ARCHIVED_FOLDER_ID","DELETED_COMMENTS_CHANNEL_ID","DEFAULT_LANG_PACK","GENERAL_TOPIC_ID","STORY_EXPIRE_PERIOD","STORY_VIEWERS_EXPIRE_PERIOD","DEFAULT_LIMITS","uploadMaxFileparts","stickersFaved","savedGifs","dialogFiltersChats","dialogFilters","dialogFolderPinned","captionLength","channels","channelsPublic","aboutLength","chatlistInvites","chatlistJoined","recommendedChannels","savedDialogsPinned","DEBUG_LEVELS","throttle","fn","ms","shouldRunFirst","interval","isPending","args","_args","self","setInterval","clearInterval","undefined","throttleWithTickEnd","schedulerFn","waiting","throttleWith","onTickEnd","reduce","acc","level","console","pause","Promise","resolve","setTimeout","onTickEndCallbacks","callback","push","then","currentCallbacks","forEach","cb","isPeerUser","peer","hasOwnProperty","isPeerChat","buildApiPeerId","id","type","toString","getApiChatIdFromMtpPeer","userId","chatId","channelId","buildApiPeerColor","peerColor","color","backgroundEmojiId","buildApiEmojiStatus","mtpEmojiStatus","GramJs","EmojiStatus","documentId","EmojiStatusUntil","until","bytesToDataUri","bytes","shouldOmitPrefix","mimeType","btoa","String","fromCharCode","omitVirtualClassFields","instance","flags","CONSTRUCTOR_ID","SUBCLASS_OF_ID","className","classType","getBytes","rest","IS_MULTITAB_SUPPORTED","channel","BroadcastChannel","batchedUpdates","throttledLocalDbUpdate","postMessage","convertToVirtualClass","value","Uint8Array","Buffer","from","Object","keys","length","BigInt","Array","isArray","map","VirtualClass","split","field","constructors","valueOmited","key","createLocalDbInitial","initial","convertedValue","acc2","key2","typedValue","name","Proxy","get","target","prop","Reflect","set","localDb","broadcastLocalDbUpdateFull","LOG_BACKGROUND","LOG_PREFIX_COLOR","LOG_SUFFIX","INVOKE","BEACON","RESPONSE","CONNECTING","CONNECTED","UPDATE","resolveMessageApiChatId","mtpMessage","Message","MessageService","peerId","isChatFolder","filter","DialogFilter","DialogFilterChatlist","addMessageToLocalDb","message","messageFullId","mockMessage","media","MessageMediaInvoice","extendedMedia","MessageExtendedMedia","messages","addMediaToLocalDb","replyTo","MessageReplyHeader","replyMedia","action","addPhotoToLocalDb","photo","MessageMediaDocument","document","Document","documents","MessageMediaWebPage","webpage","WebPage","MessageMediaGame","game","webDocuments","url","addStoryToLocalDb","story","StoryItem","storyData","MessageMediaPhoto","doc","altDocument","Photo","photos","addUserToLocalDb","user","storedUser","users","min","addEntitiesToLocalDb","entities","entity","User","Chat","Channel","chat","storedChat","chats","isStoredMin","isChatMin","addChatToLocalDb","serializeBytes","deserializeBytes","log","suffix","data","error","warn","buildCollectionByKey","collection","byKey","member","buildCollectionByCallback","pick","object","result","pickTruthy","omit","stringKeys","has","omitUndefined","stringKey","compact","array","Boolean","chunkSize","i","slice","serverTimeOffset","getServerTimeOffset","getServerTime","floor","Date","now","TEMPLATE","LOOKUP","DEFAULT_THUMB_SIZE","w","h","buildApiThumbnailFromStripped","sizes","thumb","find","s","PhotoStrippedSize","realSizes","PhotoSize","dataUri","strippedPhotoToJpg","width","height","buildApiThumbnailFromPath","photoSize","sizeAttribute","replace","path","len","num","buildPath","buildApiPhoto","isSpoiler","PhotoSizeProgressive","buildApiPhotoSize","thumbnail","videoSizes","buildApiVideoSize","isVideo","videoSize","VideoSize","videoStartTs","size","buildApiUsernames","mtpPeer","usernames","username","isActive","isEditable","active","editable","buildPrivacyRules","rules","visibility","isUnspecified","allowUserIds","allowChatIds","blockUserIds","blockChatIds","localChats","rule","PrivacyValueAllowAll","PrivacyValueAllowContacts","PrivacyValueAllowCloseFriends","PrivacyValueDisallowContacts","PrivacyValueDisallowAll","PrivacyValueAllowUsers","PrivacyValueDisallowUsers","PrivacyValueAllowChatParticipants","dialogId","PrivacyValueDisallowChatParticipants","buildApiMessageEntity","offset","MessageEntityMentionName","ApiMessageEntityTypes","MentionName","MessageEntityTextUrl","TextUrl","MessageEntityPre","Pre","language","MessageEntityCustomEmoji","CustomEmoji","buildStickerFromDocument","isNoPremium","DocumentEmpty","videoThumbs","stickerAttribute","attributes","attr","DocumentAttributeSticker","customEmojiAttribute","DocumentAttributeCustomEmoji","fileAttribute","DocumentAttributeFilename","isLottie","isCustomEmoji","shouldUseTextColor","textColor","imageSizeAttribute","DocumentAttributeImageSize","videoSizeAttribute","DocumentAttributeVideo","stickerOrEmojiAttribute","stickerSetInfo","inputSet","stickerset","InputStickerSetID","accessHash","InputStickerSetShortName","shortName","isMissing","emoji","alt","isFree","free","cachedThumb","thumbs","PhotoCachedSize","isWebmSupported","pathThumb","PhotoPathSize","buildApiThumbnailFromCached","hasEffect","some","buildStickerSet","archived","animated","installedDate","videos","title","count","emojis","thumbDocumentId","isArchived","isVideos","isEmoji","hasThumbnail","thumbCustomEmojiId","buildStickerSetCovered","coveredStickerSet","stickerSet","StickerSetNoCovered","stickers","processStickerResult","StickerSetCovered","cover","StickerSetMultiCovered","covers","StickerSetFullCovered","packs","processStickerPackResult","emoticon","sticker","buildMessageContent","content","buildMessageMediaContent","hasUnsupportedMedia","MessageMediaUnsupported","poll","contact","video","isRound","text","buildMessageTextContent","ttlSeconds","isExpiredVoice","voice","isExpiredVoiceMessage","isExpiredRoundVideo","isExpiredRoundVideoMessage","audioAttribute","DocumentAttributeAudio","duration","waveform","buildVoice","buildVideo","nopremium","buildSticker","spoiler","buildPhoto","altVideo","startsWith","buildVideoFromDocument","buildAltVideo","audio","thumbnailSizes","fileName","getFilenameFromDocument","toJSNumber","buildAudio","buildApiDocument","buildDocumentFromMedia","MessageMediaContact","firstName","lastName","phoneNumber","buildContact","MessageMediaPoll","buildPoll","results","buildPollFromMedia","webPage","buildWebPage","invoice","description","test","totalAmount","currency","receiptMsgId","preview","MessageExtendedMediaPreview","buildApiMessageExtendedMediaPreview","buildApiWebDocument","amount","Number","isTest","buildInvoice","buildInvoiceFromMedia","location","MessageMediaGeo","point","buildGeoPoint","geo","buildGeo","MessageMediaVenue","provider","address","venueId","venueType","buildVenue","MessageMediaGeoLive","period","heading","buildGeoLive","buildLocationFromMedia","apiPhoto","apiDocument","buildGame","buildGameFromMedia","MessageMediaStory","viaMention","isMention","buildMessageStoryData","giveaway","MessageMediaGiveaway","months","quantity","untilDate","countriesIso2","onlyNewSubscribers","prizeDescription","channelIds","countries","isOnlyForNewSubscribers","buildGiveaway","buildGiweawayFromMedia","giveawayResults","MessageMediaGiveawayResults","launchMsgId","unclaimedCount","winners","winnersCount","additionalPeersCount","refunded","winnerIds","winner","launchMessageId","isRefunded","buildGiveawayResults","buildGiweawayResultsFromMedia","videoAttr","a","gifAttr","DocumentAttributeAnimated","supportsStreaming","roundMessage","nosound","isGif","noSound","date","mediaType","mediaSize","photoPath","imageAttribute","videoAttribute","timestamp","GeoPointEmpty","long","lat","accuracyRadius","pollResults","answers","rawAnswers","answer","option","summary","isPublic","publicVoters","buildPollResults","rawResults","totalVoters","recentVoters","solution","solutionEntities","chosen","correct","voters","isChosen","isCorrect","votersCount","isMin","recentVoterIds","attributeStory","WebPageAttributeStory","defaultBase","filenameAttribute","extension","videoDuration","WebDocument","sizeAttr","dimensions","buildApiAttachBot","bot","botId","shouldRequestWriteAccess","requestWriteAccess","isForAttachMenu","showInAttachMenu","isForSideMenu","showInSideMenu","attachMenuPeerTypes","peerTypes","buildApiAttachMenuPeerType","icons","buildApiAttachMenuIcon","isInactive","inactive","isDisclaimerNeeded","sideMenuDisclaimerNeeded","peerType","AttachMenuPeerTypeBotPM","AttachMenuPeerTypePM","AttachMenuPeerTypeChat","AttachMenuPeerTypeBroadcast","AttachMenuPeerTypeSameBotPM","icon","buildApiBotInfo","botInfo","descriptionPhoto","descriptionDocument","commands","menuButton","gif","commandsArray","command","buildApiBotCommand","buildApiBotMenuButton","BotMenuButton","buildApiBotApp","app","BotAppNotModified","buildApiGroupCallParticipant","participant","about","versioned","canSelfUnmute","justJoined","left","muted","mutedByYou","source","volume","volumeByAdmin","videoJoined","presentation","raiseHandRating","isSelf","isLeft","isMuted","isMutedByMe","hasJustJoined","isVolumeByAdmin","isVersioned","isVideoJoined","isUser","buildApiGroupCallParticipantVideo","participantVideo","audioSource","endpoint","paused","sourceGroups","isPaused","buildApiGroupCallParticipantVideoSourceGroup","participantVideoSourceGroup","semantics","sources","buildApiGroupCall","groupCall","GroupCallDiscarded","connectionState","participantsCount","version","participants","streamDcId","scheduleDate","canChangeJoinMuted","joinMuted","canStartVideo","scheduleStartSubscribed","isLoaded","buildPhoneCall","call","phoneCall","PhoneCallAccepted","PhoneCallWaiting","PhoneCall","PhoneCallRequested","adminId","participantId","protocol","buildApiCallProtocol","p2pAllowed","gAOrB","keyFingerprint","connections","startDate","state","isP2pAllowed","buildApiCallConnection","PhoneCallDiscarded","reason","buildApiCallDiscardReason","needRating","needDebug","receiveDate","gB","gAHash","discardReason","PhoneCallDiscardReasonMissed","PhoneCallDiscardReasonBusy","PhoneCallDiscardReasonHangup","connection","PhoneConnectionWebrtc","password","turn","stun","ip","ipv6","port","isTurn","isStun","libraryVersions","minLayer","maxLayer","udpP2p","udpReflector","isUdpP2p","isUdpReflector","buildCallProtocol","PhoneCallProtocol","buildMessageReactions","reactions","recentReactions","canSeeList","reactionsAsTags","areTags","buildReactionCount","sort","reactionCountComparator","buildMessagePeerReaction","b","chosenOrder","reactionCount","reaction","apiReaction","buildApiReaction","userReaction","big","unread","my","addedDate","isUnread","isBig","isOwn","ReactionEmoji","ReactionCustomEmoji","buildApiSavedReactionTag","tag","buildApiAvailableReaction","availableReaction","selectAnimation","staticIcon","appearAnimation","aroundAnimation","centerIcon","effectAnimation","activateAnimation","premium","isPremium","buildApiChatFieldsFromPeerEntity","peerEntity","isSupport","hasVideoAvatar","hasVideo","avatarHash","buildAvatarHash","isSignaturesShown","signatures","hasPrivateLink","hasLink","isScam","scam","isFake","fake","isJoinToSend","joinToSend","isJoinRequest","joinRequest","isForum","forum","areStoriesHidden","storiesHidden","maxStoryId","storiesMaxId","storiesUnavailable","emojiStatus","isVerified","verified","isCallActive","callActive","isCallNotEmpty","callNotEmpty","creationDate","membersCount","isProtected","noforwards","buildApiChatPermissions","isCreator","creator","buildApiChatRestrictions","buildApiChatMigrationInfo","fakeType","hasStories","buildApiChatFromDialog","dialog","folderId","unreadMark","unreadCount","unreadMentionsCount","unreadReactionsCount","notifySettings","silent","muteUntil","readOutboxMaxId","readInboxMaxId","draft","viewForumAsMessages","getApiChatTypeFromPeerEntity","getApiChatTitleFromMtpPeer","lastReadOutboxMessageId","lastReadInboxMessageId","hasUnreadMark","DraftMessage","draftDate","isForumAsMessages","adminRights","currentUserBannedRights","bannedRights","defaultBannedRights","ChatForbidden","isForbidden","ChannelForbidden","isRestricted","restrictions","restrictionReason","restricted","restrictionReasons","targetReason","platform","buildApiChatRestrictionReason","assign","isNotJoined","migratedTo","InputChannelEmpty","InputChannel","buildApiChatFromPreview","ChatEmpty","UserEmpty","getUserName","megagroup","getPeerKey","photoId","buildChatMember","ChannelParticipantBanned","ChannelParticipantLeft","inviterId","joinedDate","kickedByUserId","kickedBy","promotedByUserId","promotedBy","customTitle","rank","ChannelParticipantAdmin","ChatParticipantAdmin","isAdmin","ChannelParticipantCreator","ChatParticipantCreator","isOwner","buildChatMembers","ChatParticipants","ChannelParticipants","buildChatTypingStatus","update","SendMessageCancelAction","SendMessageTypingAction","SendMessageRecordVideoAction","SendMessageUploadVideoAction","SendMessageRecordAudioAction","SendMessageUploadAudioAction","SendMessageUploadPhotoAction","SendMessageUploadDocumentAction","SendMessageGeoLocationAction","SendMessageChooseContactAction","SendMessageGamePlayAction","SendMessageRecordRoundAction","SendMessageUploadRoundAction","SendMessageChooseStickerAction","SpeakingInGroupCallAction","SendMessageEmojiInteractionSeen","SendMessageEmojiInteraction","UpdateUserTyping","fromId","buildApiChatFolder","excludedChatIds","includedChatIds","includePeers","pinnedChatIds","pinnedPeers","hasMyInvites","isChatList","broadcasts","excludePeers","buildApiChatFolderFromSuggested","buildApiChatBotCommands","botInfos","botCommands","concat","mtpCommand","buildApiExportedInvite","invite","revoked","expireDate","link","permanent","usage","usageLimit","requested","requestNeeded","isRevoked","isPermanent","isRequestNeeded","buildApiChatSettings","autoarchived","reportSpam","addContact","blockContact","isAutoArchived","canReportSpam","canAddContact","canBlockContact","buildApiChatReactions","chatReactions","ChatReactionsAll","areCustomAllowed","allowCustom","ChatReactionsSome","allowed","buildApiSendAsPeerId","sendAs","premiumRequired","buildApiTopic","forumTopic","ForumTopicDeleted","closed","pinned","hidden","short","iconColor","iconEmojiId","topMessage","isClosed","isPinned","isHidden","lastMessageId","buildApiChatlistExportedInvite","ExportedChatlistInvite","peers","peerIds","interpolateArray","fitCount","peak","newData","springFactor","leftFiller","rightFiller","idx","val","LEGACY_CHANNEL_ID_MIN_LENGTH","getEntityTypeById","chatOrUserId","buildPeer","PeerUser","buildMtpPeerId","PeerChannel","PeerChat","buildInputPeer","InputPeerUser","InputPeerChannel","InputPeerChat","buildInputPeerFromLocalDb","buildInputEntity","InputUser","buildInputStickerSet","buildInputDocument","InputDocument","buildInputMediaDocument","inputDocument","InputMediaDocument","buildInputPollFromExisting","shouldClose","InputMediaPoll","Poll","question","PollAnswer","quiz","multipleChoice","closeDate","closePeriod","correctAnswers","o","buildMtpMessageEntity","generateRandomBigInt","readBigIntFromBuffer","generateRandomBytes","generateRandomInt","buildMessageFromUpdate","Bold","MessageEntityBold","Italic","MessageEntityItalic","Underline","MessageEntityUnderline","Strike","MessageEntityStrike","Code","MessageEntityCode","Blockquote","MessageEntityBlockquote","Url","MessageEntityUrl","Hashtag","MessageEntityHashtag","InputMessageEntityMentionName","Spoiler","MessageEntitySpoiler","MessageEntityUnknown","isMessageWithMedia","buildInputPhoto","localPhoto","InputPhoto","buildInputContact","phone","InputPhoneContact","clientId","buildChatBannedRights","ChatBannedRights","buildChatAdminRights","ChatAdminRights","buildShippingInfo","info","shippingAddress","PaymentRequestedInfo","PostAddress","buildInputPrivacyKey","privacyKey","InputPrivacyKeyPhoneNumber","InputPrivacyKeyAddedByPhone","InputPrivacyKeyStatusTimestamp","InputPrivacyKeyProfilePhoto","InputPrivacyKeyForwards","InputPrivacyKeyChatInvite","InputPrivacyKeyPhoneCall","InputPrivacyKeyPhoneP2P","InputPrivacyKeyVoiceMessages","InputPrivacyKeyAbout","buildInputReportReason","InputReportReasonSpam","InputReportReasonViolence","InputReportReasonChildAbuse","InputReportReasonPornography","InputReportReasonCopyright","InputReportReasonFake","InputReportReasonGeoIrrelevant","InputReportReasonIllegalDrugs","InputReportReasonPersonalDetails","InputReportReasonOther","buildInputThemeParams","params","DataJSON","JSON","stringify","buildInputGroupCall","InputGroupCall","buildInputPhoneCall","InputPhoneCall","buildInputInvoice","InputInvoiceSlug","slug","InputInvoiceMessage","msgId","messageId","buildInputReaction","ReactionEmpty","buildInputEmojiStatus","expires","EmojiStatusEmpty","buildInputTextWithEntities","formatted","TextWithEntities","buildInputBotApp","InputBotAppID","buildInputReplyTo","replyInfo","InputReplyToStory","storyId","replyToMsgId","replyToTopId","replyToPeerId","quoteText","InputReplyToMessage","topMsgId","quoteEntities","buildInputPrivacyRules","privacyRules","allowedUsers","InputPrivacyValueAllowUsers","allowedChats","InputPrivacyValueAllowChatParticipants","blockedUsers","InputPrivacyValueDisallowUsers","blockedChats","InputPrivacyValueDisallowChatParticipants","InputPrivacyValueAllowAll","InputPrivacyValueAllowContacts","InputPrivacyValueDisallowContacts","InputPrivacyValueDisallowAll","LOCAL_MESSAGES_LIMIT","LOCAL_MEDIA_UPLOADING_TEMP_ID","INPUT_WAVEFORM_LENGTH","MIN_SCHEDULED_PERIOD","currentUserId","localMessageCounter","getNextLocalMessageId","buildApiSponsoredMessage","startParam","channelPost","chatInvite","chatInviteHash","randomId","recommended","sponsorInfo","additionalInfo","showPeerPhoto","buttonText","chatInviteTitle","ChatInvite","isBot","expiresAt","isRecommended","buildSponsoredWebPage","isAvatarShown","channelPostId","botApp","buildApiMessage","buildApiMessageWithChatId","isChatWithSelf","isOutgoing","out","post","fwdFrom","senderId","targetPeerId","isChannelPost","MessageActionEmpty","giftCryptoInfo","translationValues","score","topicEmojiIconId","isTopicAction","isGiveaway","isUnclaimed","pluralValue","targetUserIds","targetChatId","MessageActionChatCreate","MessageActionChatEditTitle","MessageActionChatEditPhoto","MessageActionChatDeletePhoto","MessageActionChatAddUser","includes","MessageActionChatDeleteUser","MessageActionChatJoinedByLink","MessageActionChannelCreate","MessageActionChatMigrateTo","MessageActionChannelMigrateFrom","MessageActionPinMessage","MessageActionHistoryClear","MessageActionPhoneCall","withDuration","join","mins","max","MessageActionInviteToGroupCall","MessageActionContactSignUp","MessageActionPaymentSent","MessageActionGroupCall","MessageActionBotAllowed","domain","fromRequest","MessageActionCustomAction","MessageActionChatJoinedByRequest","MessageActionGameScore","MessageActionWebViewDataSent","MessageActionGiftPremium","cryptoCurrency","cryptoAmountWithDecimals","cryptoAmount","divide","toFixed","MessageActionTopicCreate","MessageActionTopicEdit","MessageActionSuggestProfilePhoto","MessageActionGiveawayLaunch","MessageActionGiftCode","viaGiveaway","unclaimed","boostPeer","MessageActionGiveawayResults","buildAction","isScheduled","isInvoiceMedia","isEdited","editDate","editHide","inlineButtons","keyboardButtons","keyboardPlaceholder","isKeyboardSingleUse","isKeyboardSelective","shouldSkipBuyButton","replyMarkup","ReplyKeyboardMarkup","ReplyInlineMarkup","markup","rows","buttons","button","KeyboardButton","KeyboardButtonUrl","KeyboardButtonCallback","requiresPassword","KeyboardButtonRequestPoll","isQuiz","KeyboardButtonRequestPhone","KeyboardButtonBuy","receiptMessageId","KeyboardButtonGame","KeyboardButtonSwitchInline","query","isSamePeer","samePeer","KeyboardButtonUserProfile","KeyboardButtonSimpleWebView","KeyboardButtonWebView","KeyboardButtonUrlAuth","buttonId","every","row","placeholder","singleUse","selective","buildReplyButtons","forwardInfo","buildApiMessageForwardInfo","mediaUnread","isMediaUnread","postAuthor","groupedId","isInAlbum","shouldHideKeyboardButtons","ReplyKeyboardHide","isHideKeyboardSelective","isForwardingAllowed","emojiOnlyCount","getEmojiOnlyCountForMessage","hasComments","replies","comments","savedPeerId","viewsCount","views","forwardsCount","forwards","isFromScheduled","fromScheduled","isSilent","buildApiReplyInfo","hasUnreadMention","mentioned","isMentioned","viaBotId","postAuthorTitle","buildMessageDraft","DraftMessageEmpty","savedFromPeerId","savedFromPeer","savedDate","isImported","imported","isLinkedChannelPost","fromChatId","fromMessageId","savedFromMsgId","hiddenUserName","fromName","replyHeader","MessageReplyStoryHeader","replyFrom","quote","isForumTopic","isQuote","buildNewPoll","localId","buildUploadingMedia","attachment","filename","blobUrl","previewBlobUrl","shouldSendAsFile","shouldSendAsSpoiler","quick","inputWaveform","performer","buildApiThreadInfoFromMessage","buildApiThreadInfo","messageReplies","maxId","readMaxId","recentRepliers","apiChannelId","baseThreadInfo","messagesCount","lastReadMessageId","recentReplierIds","isCommentsInfo","originChannelId","originMessageId","threadId","buildApiUserFullInfo","mtpUserFull","fullUser","commonChatsCount","pinnedMsgId","blocked","profilePhoto","voiceMessagesForbidden","premiumGifts","fallbackPhoto","personalPhoto","translationsDisabled","storiesPinnedAvailable","bio","pinnedMessageId","isBlocked","noVoiceMessages","hasPinnedStories","isTranslationDisabled","gift","botUrl","buildApiPremiumGiftOption","buildApiUser","mtpUser","support","closeFriend","UserProfilePhoto","userType","deleted","isCloseFriend","mutualContact","isContact","canEditBot","botCanEdit","canBeInvitedToGroup","botNochats","noStatus","status","botInlinePlaceholder","botPlaceholder","botAttachMenu","isAttachBot","buildApiUserStatus","mtpStatus","UserStatusEmpty","UserStatusOnline","UserStatusOffline","wasOnline","UserStatusRecently","isReadDateRestrictedByMe","byMe","UserStatusLastWeek","buildApiUsersAndStatuses","mtpUsers","userStatusesById","usersById","duplicateUser","values","buildApiWallpaper","wallpaper","WallPaperNoFile","buildApiSession","session","isCurrent","current","isOfficialApp","officialApp","isPasswordPending","passwordPending","hash","areCallsEnabled","callRequestsDisabled","areSecretChatsEnabled","encryptedRequestsDisabled","isUnconfirmed","unconfirmed","buildApiWebSession","buildApiNotifyException","showPreviews","otherSound","hasSound","NotificationSoundNone","shouldShowPreviews","buildApiCountry","country","code","iso2","defaultName","countryCode","prefixes","patterns","buildJson","json","JsonNull","JsonString","JsonBool","JsonNumber","JsonArray","el","buildApiUrlAuthResult","UrlAuthResultRequest","UrlAuthResultAccepted","UrlAuthResultDefault","buildLangPack","mtpLangPack","strings","mtpString","buildLangPackString","LangPackString","LangPackStringPluralized","buildApiPeerColorSet","colorSet","help","PeerColorSet","colors","padStart","buildApiStory","StoryItemDeleted","isDeleted","StoryItemSkipped","closeFriends","isForCloseFriends","edited","caption","privacy","public","contacts","selectedContacts","mediaAreas","sentReaction","isForContacts","isForSelectedContacts","noForwards","buildApiStoryViews","isOut","buildApiMediaArea","buildApiStoryForwardInfo","reactionsCount","recentViewers","recentViewerIds","viewerId","buildApiStoryView","view","blockedMyStoriesFrom","StoryView","areStoriesBlocked","isUserBlocked","StoryViewPublicForward","StoryViewPublicRepost","buildApiStealthMode","stealthMode","activeUntil","activeUntilDate","cooldownUntil","cooldownUntilDate","buildApiMediaAreaCoordinates","coordinates","x","y","rotation","area","MediaAreaVenue","MediaAreaGeoPoint","MediaAreaSuggestedReaction","dark","flipped","isDark","isFlipped","MediaAreaChannelPost","forwardHeader","modified","fromPeerId","isModified","unmuteTimers","Map","unmuteQueue","scheduleUnmute","item","onUpdate","topicId","clearTimeout","delete","pop","timer","afterNext","scheduleMutedChatUpdate","LocalUpdatePts","constructor","pts","ptsCount","LocalUpdateChannelPts","DELETE_MISSING_CHANNEL_MESSAGE_DELAY","sentMessageIds","dispatchUserAndChatUpdates","e","dispatchThreadInfoUpdates","threadInfoUpdates","sendUpdate","updater","UpdateServerTimeOffset","_serverTimeOffset","timeOffset","UpdateConnectionState","disconnected","broken","connected","UpdateNewMessage","UpdateNewScheduledMessage","UpdateNewChannelMessage","UpdateShortChatMessage","UpdateShortMessage","shouldForceReply","_entities","buildApiMessageFromShort","MessageEmpty","ReplyKeyboardForceReply","hasLocalCopy","invoiceSlug","PhotoEmpty","ChatPhotoEmpty","dcId","ChatPhoto","buildChatPhotoForLocalDb","localDbChatId","newProfilePhoto","isTopicReply","UpdateEditMessage","UpdateEditChannelMessage","UpdateMessageReactions","UpdateMessageExtendedMedia","localMessage","swapLocalInvoiceMedia","UpdateDeleteMessages","ids","UpdateDeleteScheduledMessages","UpdateDeleteChannelMessages","existingIds","missingIds","profilePhotoIds","UpdateServiceNotification","popup","notification","currentDate","inboxDate","buildApiMessageFromNotification","UpdateMessageID","UpdateShortSentMessage","add","UpdateReadMessagesContents","messageUpdate","UpdateChannelReadMessagesContents","UpdateMessagePoll","pollId","apiPoll","pollUpdate","UpdateMessagePollVote","options","UpdateChannelMessageViews","UpdateReadHistoryInbox","stillUnreadCount","UpdateReadHistoryOutbox","UpdateReadChannelInbox","UpdateReadChannelOutbox","UpdateReadChannelDiscussionInbox","UpdateReadChannelDiscussionOutbox","UpdateDialogPinned","DialogPeer","UpdatePinnedDialogs","order","dp","UpdateSavedDialogPinned","UpdatePinnedSavedDialogs","UpdateFolderPeers","folderPeers","folderPeer","UpdateDialogFilter","folder","UpdateDialogFilterOrder","orderedIds","UpdateChatParticipants","replacedMembers","UpdateChatParticipantAdd","addedMember","UpdateChatParticipantDelete","deletedMemberId","UpdatePinnedMessages","UpdatePinnedChannelMessages","messageIds","UpdateNotifySettings","NotifyPeer","payload","NotifyForumTopic","buildApiNotifyExceptionTopic","scheduleMutedTopicUpdate","UpdateChatUserTyping","interaction","parse","timestamps","t","typingStatus","UpdateChannelUserTyping","UpdateChannel","UpdateDialogUnreadMark","UpdateChatDefaultBannedRights","UpdateUserStatus","UpdateUser","UpdateUserEmojiStatus","UpdateUserName","apiUserId","updatedUser","UpdateUserPhone","UpdatePeerSettings","settings","UpdatePeerBlocked","isBlockedFromStories","UpdatePrivacy","buildPrivacyKey","UpdateDraftMessage","UpdateContactsReset","UpdateFavedStickers","UpdateRecentStickers","UpdateRecentReactions","UpdateSavedReactionTags","UpdateMoveStickerSetToTop","masks","UpdateStickerSets","UpdateStickerSetsOrder","n","UpdateNewStickerSet","StickerSet","UpdateSavedGifs","UpdateGroupCall","UpdateGroupCallConnection","UpdateGroupCallParticipants","groupCallId","UpdatePendingJoinRequests","recentRequesterIds","recentRequesters","requestsPending","UpdatePhoneCall","UpdatePhoneCallSignalingData","callId","phoneCallId","UpdateWebViewResultSent","queryId","UpdateBotMenuButton","UpdateTranscribedAudio","transcriptionId","pending","UpdateConfig","UpdateChannelPinnedTopic","UpdateChannelPinnedTopics","UpdateRecentEmojiStatuses","UpdateStory","UpdateReadStories","lastReadId","UpdateSentStoryReaction","UpdateStoriesStealthMode","UpdateAttachMenuBots","UpdateNewAuthorization","device","UpdateChannelViewForumAsMessages","isEnabled","enabled","ApiErrors","PHONE_NUMBER_INVALID","PHONE_CODE_INVALID","PASSWORD_HASH_INVALID","PHONE_PASSWORD_FLOOD","PHONE_NUMBER_BANNED","authController","onWebAuthTokenFailed","onRequestPhoneNumber","buildAuthStateUpdate","reject","onRequestCode","isCodeViaApp","onRequestPassword","hint","noReset","onRequestRegistration","onRequestQrCode","qrCode","token","onAuthError","err","errors","FloodWaitError","hours","ceil","seconds","authorizationState","provideAuthPhoneNumber","provideAuthCode","provideAuthPassword","provideAuthRegistration","registration","restartAuth","Error","restartAuthWithQr","SortedQueue","comparator","this","queue","index","binarySearch","splice","shift","clear","right","middle","comparison","COMMON_BOX_QUEUE_ID","CHANNEL_DIFFERENCE_LIMIT","UPDATE_WAIT_TIMEOUT","invoke","seqTimeout","isInited","PTS_TIMEOUTS","SEQ_QUEUE","seqStart","seq","PTS_QUEUE","applyState","commonBoxState","qts","processUpdate","isFromDifference","shouldOnlySave","scheduleGetDifference","Updates","UpdatesCombined","_isFromDifference","popSeqQueue","saveSeqUpdate","UpdateChannelTooLong","getChannelDifference","getUpdateChannelId","ptsQueue","ptsComparator","popPtsQueue","savePtsUpdate","updateChannelState","currentState","channelPtsById","scheduleGetChannelDifference","applyUpdate","updateObject","updates","localSeq","localPts","getPtsCount","timeout","async","getDifference","forceSync","isFetching","response","GetDifference","DifferenceTooLong","DifferenceEmpty","processDifference","DifferenceSlice","intermediateState","GetChannelDifference","ChannelMessagesFilterEmpty","limit","ChannelDifferenceTooLong","ChannelDifferenceEmpty","final","reset","loadRemoteState","processAffectedHistory","affected","channeId","remoteState","GetState","difference","newMessages","channelTooLongIds","otherUpdates","updateChannelId","shouldApplyImmediately","diff","cacheApi","caches","isSupported","isCacheApiSupported","catch","Type","fetch","cacheName","isHtmlAllowed","request","Request","cache","open","match","contentType","headers","Text","Blob","blob","shouldRecreate","resolvedType","Json","ArrayBuffer","arrayBuffer","save","cacheData","Response","put","remove","MEDIA_ENTITY_TYPES","JPEG_SIZE_TYPES","downloadMedia","mediaFormat","start","end","client","onProgress","fullSize","parsed","parseMediaUrl","entityType","entityId","sizeType","mediaMatchType","parsedParams","URLSearchParams","zoom","scale","downloadStaticMap","stickerSets","progressCallback","workers","getMessageMediaMimeType","downloadStickerSetThumb","getMimeType","downloadProfilePhoto","download","ApiMediaFormat","BlobUrl","Progressive","DownloadUrl","buffer","parseMedia","canCache","dataBlob","fallbackMimeType","subarray","byte","mediaMatch","ChatAbortController","AbortController","getThreadSignal","controller","threads","signal","abortThread","abort","super","DEFAULT_USER_AGENT","DEFAULT_PLATFORM","GramJsLogger","setLevel","gramJsUpdateEventBuilder","build","CHAT_ABORT_CONTROLLERS","ABORT_CONTROLLERS","setIsPremium","LOG_OUT_TIMEOUT","destroy","noLogOut","noClearLocalDb","isConnected","race","invokeRequest","auth","LogOut","resetUpdatesManager","disconnect","onSessionUpdate","sessionData","handleGramJsUpdate","UpdatesTooLong","GetFullUser","InputUserSelf","shouldThrow","handleTerminatedSession","nestedUpdate","currentUser","shouldIgnoreUpdates","shouldIgnoreErrors","abortControllerChatId","abortControllerThreadId","shouldRetryOnTimeout","abortControllerGroup","shouldReturnTrue","abortSignal","UpdateShort","isResponseUpdate","debug","isSlowMode","SendMessage","SendMedia","SendMultiMedia","hasErrorKey","dispatchErrorUpdate","invokeRequestBeacon","invokeBeacon","downloadMediaWithClient","repairFileReference","uploadFile","file","updateTwoFaSettings","abortChatRequests","abortRequestGroup","group","fetchCurrentUser","userFull","currentUserFullInfo","_currentUserId","onCurrentUserUpdate","stories","GetStoriesByID","GetMessages","InputMessageID","MessagesNotModified","setForceHttpTransport","forceHttpTransport","setAllowHttpTransport","allowHttpTransport","setShouldDebugExportedSenders","requestChannelDifference","answerCallbackButton","isGame","GetBotCallbackAnswer","fetchTopInlineBots","topPeers","GetTopPeers","botsInline","TopPeers","fetchInlineBot","resolvedPeer","ResolveUsername","fetchInlineBotResults","GetInlineBotResults","switchWebview","switchPm","nextOffset","isGallery","gallery","BotInlineMediaResult","buildApiBotInlineMediaResult","webDocument","webThumbnail","buildApiBotInlineResult","cacheTime","sendInlineBotResult","resultId","SendInlineBotResult","clearDraft","startBot","StartBot","requestWebView","theme","isFromBotMenu","RequestWebView","themeParams","fromBotMenu","WebViewResultUrl","requestSimpleWebView","isFromSwitchWebView","isFromSideMenu","RequestSimpleWebView","fromSwitchWebview","fromSideMenu","fetchBotApp","appName","GetBotApp","InputBotAppShortName","baseApp","buildApiMessagesBotApp","requestAppWebView","isWriteAllowed","RequestAppWebView","writeAllowed","prolongWebView","ProlongWebView","sendWebViewData","SendWebViewData","loadAttachBots","GetAttachMenuBots","AttachMenuBots","bots","loadAttachBot","GetAttachMenuBot","AttachMenuBotsBot","toggleAttachBot","ToggleBotInAttachMenu","requestBotUrlAuth","RequestUrlAuth","authResult","acceptBotUrlAuth","AcceptUrlAuth","requestLinkUrlAuth","acceptLinkUrlAuth","fetchBotCanSendMessage","CanSendMessage","allowBotSendMessages","AllowSendMessage","invokeWebViewCustomMethod","customMethod","parameters","InvokeWebViewCustomMethod","setBotInfo","langCode","SetBotInfo","getGroupCall","GetGroupCall","c","discardGroupCall","DiscardGroupCall","editGroupCallParticipant","presentationPaused","videoStopped","videoPaused","raiseHand","EditGroupCallParticipant","editGroupCallTitle","EditGroupCallTitle","exportGroupCallInvite","ExportGroupCallInvite","fetchGroupCallParticipants","GetGroupParticipants","leaveGroupCall","isPageUnload","LeaveGroupCall","joinGroupCall","inviteHash","JoinGroupCall","joinAs","InputPeerSelf","u","createGroupCall","CreateGroupCall","joinGroupCallPresentation","JoinGroupCallPresentation","toggleGroupCallStartSubscription","subscribed","ToggleGroupCallStartSubscription","leaveGroupCallPresentation","LeaveGroupCallPresentation","getDhConfig","dhConfig","GetDhConfig","DhConfigNotModified","g","p","random","discardCall","isBusy","DiscardCall","requestCall","RequestCall","setCallRating","rating","comment","SetCallRating","receivedCall","ReceivedCall","acceptCall","AcceptCall","confirmCall","gA","ConfirmCall","sendSignalingData","SendSignalingData","fetchChats","offsetDate","withPinned","lastLocalServiceMessageId","GetDialogs","offsetPeer","InputPeerEmpty","excludePinned","resultPinned","GetPinnedDialogs","DialogsNotModified","updateLocalDb","peersByKey","preparePeers","draftsById","dialogs","orderedPinnedIds","lastMessageByChatId","Dialog","isListed","chatIds","totalChatCount","DialogsSlice","fetchSavedChats","GetSavedDialogs","GetPinnedSavedDialogs","SavedDialogsNotModified","hasPinned","buildApiChatFromSavedDialog","SavedDialogsSlice","fetchFullChat","GetFullChannel","fullChat","ChannelFull","onlineCount","exportedInvite","slowmodeSeconds","slowmodeNextSendDate","migratedFromChatId","migratedFromMaxId","canViewParticipants","canViewStats","linkedChatId","hiddenPrehistory","availableReactions","defaultSendAs","statsDc","chatPhoto","participantsHidden","inviteLink","ChatInviteExported","members","fetchMembers","kickedMembers","bannedUsers","bannedStatusesById","adminMembers","adminUsers","adminStatusesById","mtpLinkedChat","statusesById","fullInfo","slowMode","nextSendDate","migratedFrom","maxMessageId","canViewMembers","canViewStatistics","isPreHistoryHidden","adminMembersById","enabledReactions","sendAsId","statisticsDcId","areParticipantsHidden","getFullChannelInfo","GetFullChat","ChatFull","getFullChatInfo","fetchChatSettings","GetPeerSettings","searchChats","Search","q","accountPeerIds","myResults","allChats","allUsers","accountChats","r","accountUsers","globalChats","globalUsers","fetchChat","GetUsers","GetSupport","requestChatUpdate","lastLocalMessage","noLastMessage","GetPeerDialogs","InputDialogPeer","lastRemoteMessage","lastMessage","chatUpdate","saveDraft","SaveDraft","updateChatMutedState","account","InputNotifyPeer","InputPeerNotifySettings","updateTopicMutedState","InputNotifyForumTopic","createChannel","CreateChannel","broadcast","newChannel","restrictedUserIds","InviteToChannel","handleUserPrivacyRestrictedUpdates","joinChannel","JoinChannel","deleteChatUser","DeleteChatUser","deleteChat","DeleteChat","leaveChannel","LeaveChannel","deleteChannel","DeleteChannel","createGroupChat","CreateChat","newChat","editChatPhoto","inputEntity","inputPhoto","File","uploadedPhoto","InputChatUploadedPhoto","InputChatPhoto","InputChatPhotoEmpty","EditPhoto","EditChatPhoto","toggleChatPinned","shouldBePinned","ToggleDialogPin","toggleSavedDialogPinned","ToggleSavedDialogPin","toggleChatArchived","folders","EditPeerFolders","InputFolderPeer","fetchChatFolders","GetDialogFilters","defaultFolderPosition","findIndex","DialogFilterDefault","byId","fetchRecommendedChatFolders","GetSuggestedDialogFilters","editChatFolder","folderUpdate","nonContacts","groups","excludeArchived","excludeMuted","excludeRead","buildFilterFromApiFolder","deleteChatFolder","isActionSuccessful","recommendedChatFolders","sortChatFolders","UpdateDialogFiltersOrder","toggleDialogUnread","MarkDialogUnread","getChatByPhoneNumber","processResolvedPeer","ResolvePhone","getChatByUsername","togglePreHistoryHidden","TogglePreHistoryHidden","updateChatDefaultBannedRights","EditChatDefaultBannedRights","updateChatMemberBannedRights","EditBanned","updateChatAdmin","EditAdmin","updateChatTitle","EditTitle","EditChatTitle","updateChatAbout","EditChatAbout","toggleSignatures","ToggleSignatures","memberFilter","ChannelParticipantsKicked","ChannelParticipantsAdmins","ChannelParticipantsRecent","GetParticipants","ChannelParticipantsNotModified","fetchGroupsForDiscussion","GetGroupsForDiscussion","setDiscussionGroup","SetDiscussionGroup","migrateChat","MigrateChat","newChannelId","openChatByInvite","CheckChatInvite","isChannel","addChatMembers","addChatUsersResult","all","AddChatUser","flat","deleteChatMember","viewMessages","sendMessages","sendMedia","sendStickers","sendGifs","sendGames","sendInline","embedLinks","sendPolls","changeInfo","inviteUsers","pinMessages","manageTopics","sendPhotos","sendVideos","sendRoundvideos","sendAudios","sendVoices","sendDocs","sendPlain","toggleJoinToSend","ToggleJoinToSend","toggleJoinRequest","ToggleJoinRequest","currentStore","store","importChatInvite","ImportChatInvite","setChatEnabledReactions","SetChatAvailableReactions","ChatReactionsNone","toggleIsProtected","ToggleNoForwards","toggleParticipantsHidden","ToggleParticipantsHidden","toggleForum","ToggleForum","createTopic","CreateForumTopic","fetchTopics","offsetTopicId","offsetId","GetForumTopics","offsetTopic","orderByCreateDate","topics","shouldOrderByCreateDate","topic","ForumTopic","readInboxMessageIdByTopicId","fetchTopicById","GetForumTopicsByID","deleteTopic","DeleteTopicHistory","togglePinnedTopic","UpdatePinnedForumTopic","editTopic","EditForumTopic","checkChatlistInvite","chatlists","CheckChatlistInvite","ChatlistInvite","ChatlistInviteAlready","filterId","missingPeerIds","missingPeers","alreadyPeerIds","alreadyPeers","buildApiChatlistInvite","joinChatlistInvite","JoinChatlistInvite","fetchLeaveChatlistSuggestions","GetLeaveChatlistSuggestions","chatlist","InputChatlistDialogFilter","leaveChatlist","LeaveChatlist","createChalistInvite","ExportChatlistInvite","deleteChatlistInvite","DeleteExportedInvite","editChatlistInvite","EditExportedInvite","fetchChatlistInvites","GetExportedInvites","invites","togglePeerTranslations","TogglePeerTranslations","disabled","setViewForumAsMessages","ToggleViewForumAsMessages","fetchChannelRecommendations","GetChannelRecommendations","similarChannels","_chat","ChatsSlice","eligibleUpdates","UpdateGroupInvitePrivacyForbidden","reportPeer","ReportPeer","reportProfilePhoto","ReportProfilePhoto","changeSessionSettings","isConfirmed","ChangeAuthorizationSettings","confirmed","changeSessionTtl","days","SetAuthorizationTTL","authorizationTtlDays","fileBits","_defineProperty","FAST_SEND_TIMEOUT","fetchMessages","isSavedDialog","pagination","RequestClass","MAIN_THREAD_ID","GetHistory","GetSavedHistory","GetReplies","fetchMessage","MESSAGE_DELETED","mediaQueue","sendMessage","scheduledAt","noWebPage","shouldUpdateStickerSetOrder","wasDrafted","resultReplyInfo","inputInfo","buildLocalMessage","sendingState","groupIndex","groupedUploads","counter","singleMediaByIndex","localMessages","prevMediaQueue","uploadMedia","inputMedia","uploadedMedia","messageMedia","UploadMedia","fileReference","InputMediaPhoto","fetchInputMedia","InputSingleMedia","multiMedia","handleMultipleLocalMessagesUpdate","sendGroupedMedia","messagePromise","pollParams","buildInputPoll","InputMediaStory","buildInputStory","InputMediaContact","vcard","noWebpage","updateStickersetsOrder","handleLocalMessageUpdate","editMessage","newContent","mediaUpdate","mtpEntities","EditMessage","messageErr","rescheduleMessage","patchedOnProgress","progress","isCanceled","previousLocalId","buildMessageKey","getMessageKey","fetchAndUpload","fetchBlob","lastModified","blobToFile","fetchFile","shouldUploadThumb","inputFile","InputMediaUploadedPhoto","InputMediaUploadedDocument","forceFile","pinMessage","isUnpin","isOneSide","UpdatePinnedMessage","unpin","pmOneside","unpinAllMessages","UnpinAllMessages","deleteMessages","shouldDeleteForAll","DeleteMessages","revoke","deleteScheduledMessages","DeleteScheduledMessages","deleteHistory","DeleteHistory","just_clear","deleteSavedHistory","DeleteSavedHistory","reportMessages","Report","sendMessageAction","gramAction","buildSendMessageAction","SetTyping","markMessageListRead","fixedMaxId","ReadHistory","ReadDiscussion","markMessagesRead","ReadMessageContents","fetchMessageViews","shouldIncrement","chunks","chunkIds","GetMessagesViews","increment","viewsList","flatMap","viewsInfo","threadInfo","fetchDiscussionMessage","GetDiscussionMessage","addOffset","topMessages","firstMessageId","searchMessagesLocal","savedTag","minDate","maxDate","InputMessagesFilterPhotoVideo","InputMessagesFilterDocument","InputMessagesFilterUrl","InputMessagesFilterMusic","InputMessagesFilterRoundVoice","InputMessagesFilterChatPhotos","InputMessagesFilterEmpty","savedReaction","nextOffsetId","totalCount","MessagesSlice","ChannelMessages","searchMessagesGlobal","offsetRate","SearchGlobal","nextRate","fetchWebPagePreview","textWithEntities","GetWebPagePreview","sendPollVote","SendVote","closePoll","loadPollOptionResults","shouldResetVoters","GetPollVotes","votes","vote","fetchExtendedMedia","GetExtendedMedia","forwardMessages","fromChat","toChat","toThreadId","withMyScore","noAuthors","noCaptions","isCurrentUserPremium","randomIds","isAudio","asIncomingInChatWithSelf","shouldHideText","shouldDropCustomEmoji","strippedText","updatedContent","isToMainThread","buildLocalForwardedMessage","ForwardMessages","fromPeer","toPeer","dropAuthor","dropMediaCaptions","findFirstMessageIdAfterDate","fetchScheduledHistory","GetScheduledHistory","sendScheduledMessages","SendScheduledMessages","isServiceMessageWithMedia","fetchPinnedMessages","InputMessagesFilterPinned","fetchSeenBy","GetMessageReadParticipants","readDate","fetchSendAs","GetSendAs","saveDefaultSendAs","SaveDefaultSendAs","fetchSponsoredMessages","GetSponsoredMessages","SponsoredMessagesEmpty","viewSponsoredMessage","ViewSponsoredMessage","clickSponsoredMessage","ClickSponsoredMessage","readAllMentions","ReadMentions","readAllReactions","ReadReactions","fetchUnreadMentions","GetUnreadMentions","fetchUnreadReactions","GetUnreadReactions","transcribeAudio","TranscribeAudio","translateText","isMessageTranslation","toLanguageCode","TranslateText","toLang","formattedText","buildApiFormattedText","translations","isSentBefore","fetchOutboxReadDate","GetOutboxReadDate","inputGifBot","fetchFullUser","input","fetchCommonChats","commonChats","GetCommonChats","mtpChat","isFullyLoaded","fetchNearestCountry","dcInfo","GetNearestDc","fetchTopUsers","correspondents","fetchContactList","GetContacts","ContactsNotModified","fetchUsers","importContact","ImportContacts","ImportedContacts","updateContact","shouldSharePhoneNumber","AddContact","addPhonePrivacyException","deleteContact","DeleteContacts","fetchProfilePhotos","GetUserPhotos","userOrChat","ReportSpam","updateEmojiStatus","UpdateEmojiStatus","saveCloseFriends","userIds","EditCloseFriends","fetchCustomEmojiSets","allStickers","GetEmojiStickers","AllStickersNotModified","sets","fetchStickerSets","GetAllStickers","fetchRecentStickers","GetRecentStickers","RecentStickersNotModified","fetchFavoriteStickers","GetFavedStickers","FavedStickersNotModified","fetchFeaturedStickers","GetFeaturedStickers","FeaturedStickersNotModified","fetchFeaturedEmojiStickers","GetFeaturedEmojiStickers","faveSticker","unfave","FaveSticker","removeRecentSticker","SaveRecentSticker","unsave","clearRecentStickers","ClearRecentStickers","fetchStickers","GetStickerSet","fetchCustomEmoji","GetCustomEmojiDocuments","fetchAnimatedEmojis","InputStickerSetAnimatedEmoji","fetchAnimatedEmojiEffects","InputStickerSetAnimatedEmojiAnimations","fetchGenericEmojiEffects","InputStickerSetEmojiGenericAnimations","fetchPremiumGifts","InputStickerSetPremiumGifts","fetchDefaultTopicIcons","InputStickerSetEmojiDefaultTopicIcons","fetchDefaultStatusEmojis","InputStickerSetEmojiDefaultStatuses","searchStickers","SearchStickerSets","FoundStickerSetsNotModified","fetchSavedGifs","GetSavedGifs","SavedGifsNotModified","gifs","processGifResult","saveGif","shouldUnsave","SaveGif","installStickerSet","stickerSetId","InstallStickerSet","uninstallStickerSet","UninstallStickerSet","searchGifs","foundGif","fetchStickersForEmoji","GetStickers","StickersNotModified","fetchEmojiKeywords","fromVersion","GetEmojiKeywordsDifference","keywords","emojiKeyword","keyword","emoticons","fetchRecentEmojiStatuses","GetRecentEmojiStatuses","EmojiStatusesNotModified","documentIds","statuses","emojiStatuses","ACCEPTABLE_USERNAME_ERRORS","checkChatUsername","CheckUsername","errorMessage","setChatUsername","UpdateUsername","deactivateAllUsernames","DeactivateAllUsernames","updatePrivateLink","ExportChatInvite","fetchExportedChatInvites","admin","exportedInvites","GetExportedChatInvites","editExportedChatInvite","EditExportedChatInvite","ExportedChatInvite","replaceInvite","oldInvite","newInvite","ExportedChatInviteReplaced","exportChatInvite","deleteExportedChatInvite","DeleteExportedChatInvite","deleteRevokedExportedChatInvites","DeleteRevokedExportedChatInvites","fetchChatInviteImporters","offsetUser","isRequested","GetChatInviteImporters","InputUserEmpty","importers","importer","viaChatlist","isFromChatList","buildChatInviteImporter","hideChatJoinRequest","isApproved","HideChatJoinRequest","approved","hideAllChatJoinRequests","HideAllChatJoinRequests","hideChatReportPanel","HidePeerSettingsBar","buildEmojiSounds","appConfig","emojies_sounds","l","access_hash","alloc","getLimit","fallbackKey","BETA_LANG_CODES","updateProfile","UpdateProfile","checkUsername","updateUsername","updateProfilePhoto","isFallback","InputPhotoEmpty","UpdateProfilePhoto","fallback","uploadProfilePhoto","videoTs","UploadProfilePhoto","uploadContactProfilePhoto","isSuggest","UploadContactProfilePhoto","suggest","deleteProfilePhotos","photoIds","DeletePhotos","fetchWallpapers","GetWallPapers","WallPapersNotModified","filteredWallpapers","wallpapers","WallPaper","pattern","uploadWallpaper","UploadWallPaper","WallPaperSettings","fetchBlockedUsers","isOnlyStories","GetBlocked","myStoriesFrom","blockedIds","BlockedSlice","blockUser","Block","unblockUser","Unblock","fetchAuthorizations","GetAuthorizations","authorizations","ttlDays","terminateAuthorization","ResetAuthorization","terminateAllAuthorizations","ResetAuthorizations","fetchWebAuthorizations","GetWebAuthorizations","webAuthorizations","terminateWebAuthorization","ResetWebAuthorization","terminateAllWebAuthorizations","ResetWebAuthorizations","fetchNotificationExceptions","GetNotifyExceptions","compareSound","fetchNotificationSettings","isMutedContactSignUpNotification","privateContactNotificationsSettings","groupNotificationsSettings","broadcastNotificationsSettings","GetContactSignUpNotification","GetNotifySettings","InputNotifyUsers","InputNotifyChats","InputNotifyBroadcasts","privateSilent","privateMuteUntil","privateShowPreviews","groupSilent","groupMuteUntil","groupShowPreviews","broadcastSilent","broadcastMuteUntil","broadcastShowPreviews","hasContactJoinedNotifications","hasPrivateChatsNotifications","hasPrivateChatsMessagePreview","hasGroupNotifications","hasGroupMessagePreview","hasBroadcastNotifications","hasBroadcastMessagePreview","updateContactSignUpNotification","SetContactSignUpNotification","updateNotificationSettings","fetchLanguages","langpack","GetLanguages","langPack","fetchLangPack","sourceLangPacks","collections","GetLangPack","reverse","fetchLangStrings","GetStrings","fetchPrivacySettings","GetPrivacy","registerDevice","secret","getAuthKey","getKey","RegisterDevice","tokenType","appSandbox","otherUids","unregisterDevice","UnregisterDevice","setPrivacySettings","SetPrivacy","updateIsOnline","isOnline","UpdateStatus","offline","fetchContentSettings","GetContentSettings","isSensitiveEnabled","sensitiveEnabled","canChangeSensitive","sensitiveCanChange","updateContentSettings","SetContentSettings","fetchAppConfig","GetAppConfig","AppConfigNotModified","config","resultHash","emojiSounds","seenByMaxChatMembers","chat_read_mark_size_threshold","seenByExpiresAt","chat_read_mark_expire_period","readDateExpiresAt","pm_read_date_expire_period","autologinDomains","autologin_domains","urlAuthDomains","url_auth_domains","maxUniqueReactions","reactions_uniq_max","premiumBotUsername","premium_bot_username","premiumInvoiceSlug","premium_invoice_slug","premiumPromoOrder","premium_promo_order","isPremiumPurchaseBlocked","premium_purchase_blocked","defaultEmojiStatusesStickerSetId","default_emoji_statuses_stickerset_id","topicsPinnedLimit","topics_pinned_limit","maxUserReactionsDefault","reactions_user_max_default","maxUserReactionsPremium","reactions_user_max_premium","hiddenMembersMinCount","hidden_members_group_size_min","canDisplayAutoarchiveSetting","autoarchive_setting_available","limits","stories_all_hidden","storyExpirePeriod","story_expire_period","storyViewersExpirePeriod","story_viewers_expire_period","storyChangelogUserId","stories_changelog_user_id","buildAppConfig","fetchConfig","GetConfig","defaultReaction","reactionsDefault","gifSearchUsername","maxGroupSize","chatSizeMax","autologinToken","buildApiConfig","fetchPeerColors","GetPeerColors","wrapper","PeerColors","colorId","darkColors","buildApiPeerColors","fetchCountryList","countryList","GetCountriesList","CountriesList","nonHiddenCountries","phoneCodes","countryCodes","localeCompare","general","buildApiCountryList","fetchGlobalPrivacySettings","GetGlobalPrivacySettings","shouldArchiveAndMuteNewNonContact","archiveAndMuteNewNoncontactPeers","shouldHideReadMarks","hideReadMarks","shouldNewNonContactPeersRequirePremium","newNoncontactPeersRequirePremium","updateGlobalPrivacySettings","SetGlobalPrivacySettings","GlobalPrivacySettings","toggleUsername","ToggleUsername","reorderUsernames","ReorderUsernames","EMAIL_UNCONFIRMED","EMAIL_HASH_EXPIRED","NEW_SALT_INVALID","NEW_SETTINGS_INVALID","CODE_INVALID","emailCodeController","getPasswordInfo","GetPassword","hasPassword","onRequestEmailCode","checkPassword","currentPassword","isCheckPassword","onError","clearPassword","updatePassword","email","newPassword","emailCodeCallback","onEmailCodeError","updateRecoveryEmail","provideRecoveryEmailCode","sendWatchingEmojiInteraction","sendEmojiInteraction","v","fetchAvailableReactions","GetAvailableReactions","AvailableReactionsNotModified","sendReaction","shouldAddToRecent","SendReaction","addToRecent","fetchMessageReactions","GetMessagesReactions","fetchMessageReactionsList","GetMessageReactionsList","setDefaultReaction","SetDefaultReaction","fetchTopReactions","GetTopReactions","ReactionsNotModified","fetchRecentReactions","GetRecentReactions","clearRecentReactions","ClearRecentReactions","fetchDefaultTagReactions","GetDefaultTagReactions","fetchSavedReactionTags","GetSavedReactionTags","SavedReactionTagsNotModified","tags","updateSavedReactionTag","UpdateSavedReactionTag","buildApiPostInteractionCounter","PostInteractionCountersMessage","PostInteractionCountersStory","buildPostsStatistics","stats","viewsGraph","buildGraph","reactionsGraph","reactionsByEmotionGraph","buildMessagePublicForwards","buildApiMessagePublicForward","buildStoryPublicForwards","forward","PublicForwardMessage","isPercentage","columns","hasSecondYAxis","y_scaled","types","y0","zoomToken","labelFormatter","xTickFormatter","tooltipFormatter","xTooltipFormatter","labels","hideCaption","subchart","show","isStacked","stacked","datasets","names","substring","indexOf","calculateMinimapRange","defaultZoom","range","minIndex","maxIndex","minimapRange","begin","labelFromIndex","labelToIndex","buildStatisticsOverview","previous","change","percentage","abs","buildStatisticsPercentage","part","total","fetchChannelStatistics","GetBroadcastStats","growthGraph","followersGraph","muteGraph","topHoursGraph","languagesGraph","viewsBySourceGraph","newFollowersBySourceGraph","interactionsGraph","storyInteractionsGraph","storyReactionsByEmotionGraph","followers","viewsPerPost","sharesPerPost","enabledNotifications","reactionsPerPost","viewsPerStory","sharesPerStory","reactionsPerStory","recentPosts","recentPostsInteractions","fetchGroupStatistics","GetMegagroupStats","membersGraph","messagesGraph","actionsGraph","viewers","posters","fetchMessageStatistics","GetMessageStats","fetchMessagePublicForwards","GetMessagePublicForwards","fetchStatisticsAsyncGraph","LoadAsyncGraph","fetchStoryStatistics","GetStoryStats","fetchStoryPublicForwards","GetStoryPublicForwards","publicForwards","currentPhoneCallState","PhoneCallState","waitForState","resolveState","pBN","Helpers","randomBN","pLast","randomLast","emojiData","emojiOffsets","authKey","fingerprint","emojiCount","partOffset","byteLength","and","shiftLeft","or","modPow","generateEmojiFingerprint","AuthKey","setKey","MTProtoState","Logger","encode","seqArray","Uint32Array","encodedData","encryptMessageData","decode","decryptMessageData","createPhoneCallState","destroyPhoneCallState","encodePhoneCallData","decodePhoneCallData","confirmPhoneCall","acceptPhoneCall","requestPhoneCall","fetchAllStories","stateHash","isFirstRequest","GetAllStories","AllStoriesNotModified","peerStories","allUserStories","buildApiPeerStories","pinnedIds","lastUpdatedAt","dataAcc","maxReadId","hasMore","fetchPeerStories","GetPeerStories","lastReadStoryId","fetchPeerPinnedStories","fetchCommonStoriesRequest","method","GetPinnedStories","fetchStoriesArchive","GetStoriesArchive","fetchPeerStoriesByIds","currentId","viewStory","IncrementStoryViews","markStoryRead","ReadStories","deleteStory","DeleteStories","toggleStoryPinned","TogglePinned","fetchStoryViewList","areJustContacts","areReactionsFirst","GetStoryViewsList","justContacts","reactionsFirst","fetchStoryLink","ExportStoryLink","reportStory","editStoryPrivacy","EditStory","toggleStoriesHidden","TogglePeerStoriesHidden","fetchStoriesMaxIds","GetPeerMaxIDs","sendStoryReaction","activateStealthMode","isForPast","isForFuture","ActivateStealthMode","past","future","buildShippingOptions","shippingOptions","prices","ac","cur","label","buildApiReceipt","receipt","shipping","credentialsTitle","tipAmount","mappedPrices","shippingPrices","shippingMethod","buildApiPaymentForm","form","formId","canSaveCredentials","passwordMissing","isPasswordMissing","providerId","nativeProvider","nativeParams","savedInfo","savedCredentials","nameRequested","isNameRequested","phoneRequested","isPhoneRequested","emailRequested","isEmailRequested","shippingAddressRequested","isShippingAddressRequested","flexible","isFlexible","phoneToProvider","shouldSendPhoneToProvider","emailToProvider","shouldSendEmailToProvider","cleanedInfo","nativeData","invoiceContainer","needCardholderName","need_cardholder_name","needCountry","need_country","needZip","need_zip","publishableKey","publishable_key","publicToken","public_token","credentials","buildApiInvoiceFromForm","recurring","termsUrl","maxTipAmount","suggestedTipAmounts","isRecurring","tip","buildApiPremiumPromo","promo","statusText","statusEntities","videoSections","periodOptions","buildApiPremiumSubscriptionOption","canPurchaseUpgrade","buildApiMyBoost","myBoost","slot","buildApiCheckedGiftCode","giftcode","giveawayMsgId","toId","usedDate","usedAt","isFromGiveaway","giveawayMessageId","validateRequestedInfo","inputInvoice","requestInfo","shouldSave","payments","ValidateRequestedInfo","sendPaymentForm","requestedInfoId","shippingOptionId","savedCredentialId","temporaryPassword","inputCredentials","InputPaymentCredentialsSaved","tmpPassword","InputPaymentCredentials","SendPaymentForm","PaymentVerificationNeeded","getPaymentForm","GetPaymentForm","getReceipt","GetPaymentReceipt","fetchPremiumPromo","GetPremiumPromo","fetchTemporaryPaymentPassword","ttl","getTmpPassword","getTemporaryPaymentPassword","validUntil","fetchMyBoosts","GetMyBoosts","boosts","myBoosts","applyBoost","slots","ApplyBoost","fetchBoostsStatus","GetBoostsStatus","boostStatus","boostUrl","currentLevelBoosts","nextLevelBoosts","premiumAudience","hasMyBoost","premiumSubscribers","buildApiBoostsStatus","fetchBoostsList","GetBoostsList","userBoosts","boost","boosterIds","boosters","fetchGiveawayInfo","GetGiveawayInfo","GiveawayInfo","adminDisallowedChatId","disallowedCountry","joinedTooEarlyDate","participating","preparingResults","isParticipating","isPreparingResults","activatedCount","finishDate","giftCodeSlug","isWinner","buildApiGiveawayInfo","checkGiftCode","CheckGiftCode","applyGiftCode","ApplyGiftCode","initApi","_onUpdate","initialArgs","initialLocalDb","initUpdater","handleUpdate","initAuth","initChats","initMessages","initUsers","initStickers","initManagement","initTwoFaSettings","initBots","initCalls","initPayments","userAgent","maxBufferSize","webAuthToken","mockScenario","shouldForceHttpTransport","shouldAllowHttpTransport","shouldDebugExportedSenders","sessions","CallbackSession","TelegramClient","deviceModel","navigator","systemVersion","appVersion","useWSS","additionalDcsDisabled","testServers","addEventHandler","setPingCallback","phoneCode","firstAndLastNames","initialMethod","shouldThrowIfUnauthorized","webAuthTokenFailed","getSessionData","invokeReq","initUpdatesManager","initClient","flushUpdatesOnTickEnd","throttleId","pendingUpdates","currentThrottleId","currentUpdates","flushUpdatesThrottled","ORIGINAL_FUNCTIONS","onerror","sendToOrigin","addEventListener","callbackState","onmessage","withCallback","callbackArgs","lastArg","fnName","methods","callApi","sendUpdatesOnTickEnd","require","JPEG_HEADER","JPEG_FOOTER","_raiseCastFail","module","exports","getMessageId","getInputPeer","allowSelf","checkHash","TypeError","UserFull","getDisplayName","getDownloadPartSize","fileSize","getUploadPartSize","stripped","header","getDC","downloadDC","ipAddress","Deferred","promise","resolved","RE_EMOJI_ONLY","RegExp","twemojiRegex","lines","textWithoutNewlines","DETECT_UP_TO","countPerLine","line","exec","lastIndex","promisifyRequest","oncomplete","onsuccess","onabort","createStore","dbName","storeName","indexedDB","onupgradeneeded","createObjectStore","dbp","txMode","db","transaction","objectStore","defaultGetStoreFunc","defaultGetStore","customStore","setMany","entries","entry","getMany","del","delMany","eachCursor","openCursor","continue","getAllKeys","items","cursor","getAll","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","loaded","__webpack_modules__","m","__webpack_exports__","O","priority","notFulfilled","Infinity","fulfilled","j","getter","__esModule","d","definition","defineProperty","enumerable","f","chunkId","promises","miniCssF","globalThis","Function","obj","prototype","Symbol","toStringTag","nmd","paths","children","scriptUrl","importScripts","currentScript","src","scripts","getElementsByTagName","installedChunks","chunkLoadingGlobal","parentChunkLoadingFunction","bind","moreModules","runtime"],"sourceRoot":""}